import{d as Oo,c as le,u as jo,e as To,r as E,j as i,f as He,T as fr,A as Qe,m as Ce,h as pr,a as mr}from"./index-Pc5FT4p8.js";import{C as Yt}from"./copy-0ZVTrf7-.js";import{T as zt}from"./type-Cc_-mX9s.js";import{D as gr}from"./download-DhgrBVRX.js";import{D as yr}from"./database-Dlv637-c.js";import{S as br,K as $o}from"./send-_KPazlmo.js";import{a as wr,C as Mo}from"./chevron-up-CL4_qE56.js";var Po=Oo();const Do=[["path",{d:"M12 17V3",key:"1cwfxf"}],["path",{d:"m6 11 6 6 6-6",key:"12ii2o"}],["path",{d:"M19 21H5",key:"150jfl"}]],Lo=le("arrow-down-to-line",Do);const Fo=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}],["line",{x1:"12",x2:"12",y1:"7",y2:"13",key:"1cppfj"}],["line",{x1:"15",x2:"9",y1:"10",y2:"10",key:"1gty7f"}]],Ks=le("bookmark-plus",Fo);const Bo=[["path",{d:"M21 21H8a2 2 0 0 1-1.42-.587l-3.994-3.999a2 2 0 0 1 0-2.828l10-10a2 2 0 0 1 2.829 0l5.999 6a2 2 0 0 1 0 2.828L12.834 21",key:"g5wo59"}],["path",{d:"m5.082 11.09 8.828 8.828",key:"1wx5vj"}]],Ho=le("eraser",Bo);const Uo=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],xr=le("grip-vertical",Uo);const Go=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],Ko=le("maximize-2",Go);const qo=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],Wo=le("message-square",qo);const Xo=[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]],Yo=le("minimize-2",Xo);const zo=[["path",{d:"M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4",key:"re6nr2"}],["path",{d:"M2 6h4",key:"aawbzj"}],["path",{d:"M2 10h4",key:"l0bgd4"}],["path",{d:"M2 14h4",key:"1gsvsf"}],["path",{d:"M2 18h4",key:"1bu2t1"}],["path",{d:"M21.378 5.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"pqwjuv"}]],_r=le("notebook-pen",zo);const Vo=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m16 15-3-3 3-3",key:"14y99z"}]],vr=le("panel-left-close",Vo);const Jo=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m14 9 3 3-3 3",key:"8010ee"}]],Sr=le("panel-left-open",Jo);const Qo=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M15 3v18",key:"14nvp0"}],["path",{d:"m8 9 3 3-3 3",key:"12hl5m"}]],Ar=le("panel-right-close",Qo);const Zo=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M15 3v18",key:"14nvp0"}],["path",{d:"m10 15-3-3 3-3",key:"1pgupc"}]],Cr=le("panel-right-open",Zo);const el=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],Ir=le("rotate-cw",el);const tl=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],sl=le("settings",tl);const nl=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],Er=le("wand-sparkles",nl);var Nr;(function(s){s.STRING="string",s.NUMBER="number",s.INTEGER="integer",s.BOOLEAN="boolean",s.ARRAY="array",s.OBJECT="object"})(Nr||(Nr={}));var kr;(function(s){s.LANGUAGE_UNSPECIFIED="language_unspecified",s.PYTHON="python"})(kr||(kr={}));var Rr;(function(s){s.OUTCOME_UNSPECIFIED="outcome_unspecified",s.OUTCOME_OK="outcome_ok",s.OUTCOME_FAILED="outcome_failed",s.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(Rr||(Rr={}));const Or=["user","model","function","system"];var jr;(function(s){s.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",s.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",s.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",s.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",s.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",s.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(jr||(jr={}));var Tr;(function(s){s.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",s.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",s.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",s.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",s.BLOCK_NONE="BLOCK_NONE"})(Tr||(Tr={}));var $r;(function(s){s.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",s.NEGLIGIBLE="NEGLIGIBLE",s.LOW="LOW",s.MEDIUM="MEDIUM",s.HIGH="HIGH"})($r||($r={}));var Mr;(function(s){s.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",s.SAFETY="SAFETY",s.OTHER="OTHER"})(Mr||(Mr={}));var Et;(function(s){s.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",s.STOP="STOP",s.MAX_TOKENS="MAX_TOKENS",s.SAFETY="SAFETY",s.RECITATION="RECITATION",s.LANGUAGE="LANGUAGE",s.BLOCKLIST="BLOCKLIST",s.PROHIBITED_CONTENT="PROHIBITED_CONTENT",s.SPII="SPII",s.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",s.OTHER="OTHER"})(Et||(Et={}));var Pr;(function(s){s.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",s.RETRIEVAL_QUERY="RETRIEVAL_QUERY",s.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",s.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",s.CLASSIFICATION="CLASSIFICATION",s.CLUSTERING="CLUSTERING"})(Pr||(Pr={}));var Dr;(function(s){s.MODE_UNSPECIFIED="MODE_UNSPECIFIED",s.AUTO="AUTO",s.ANY="ANY",s.NONE="NONE"})(Dr||(Dr={}));var Lr;(function(s){s.MODE_UNSPECIFIED="MODE_UNSPECIFIED",s.MODE_DYNAMIC="MODE_DYNAMIC"})(Lr||(Lr={}));class ie extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class Ze extends ie{constructor(e,t){super(e),this.response=t}}class Ea extends ie{constructor(e,t,n,r){super(e),this.status=t,this.statusText=n,this.errorDetails=r}}class $e extends ie{}class Na extends ie{}const rl="https://generativelanguage.googleapis.com",al="v1beta",il="0.24.1",ol="genai-js";var We;(function(s){s.GENERATE_CONTENT="generateContent",s.STREAM_GENERATE_CONTENT="streamGenerateContent",s.COUNT_TOKENS="countTokens",s.EMBED_CONTENT="embedContent",s.BATCH_EMBED_CONTENTS="batchEmbedContents"})(We||(We={}));class ll{constructor(e,t,n,r,a){this.model=e,this.task=t,this.apiKey=n,this.stream=r,this.requestOptions=a}toString(){var e,t;const n=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||al;let a=`${((t=this.requestOptions)===null||t===void 0?void 0:t.baseUrl)||rl}/${n}/${this.model}:${this.task}`;return this.stream&&(a+="?alt=sse"),a}}function cl(s){const e=[];return s?.apiClient&&e.push(s.apiClient),e.push(`${ol}/${il}`),e.join(" ")}async function dl(s){var e;const t=new Headers;t.append("Content-Type","application/json"),t.append("x-goog-api-client",cl(s.requestOptions)),t.append("x-goog-api-key",s.apiKey);let n=(e=s.requestOptions)===null||e===void 0?void 0:e.customHeaders;if(n){if(!(n instanceof Headers))try{n=new Headers(n)}catch(r){throw new $e(`unable to convert customHeaders value ${JSON.stringify(n)} to Headers: ${r.message}`)}for(const[r,a]of n.entries()){if(r==="x-goog-api-key")throw new $e(`Cannot set reserved header name ${r}`);if(r==="x-goog-api-client")throw new $e(`Header name ${r} can only be set using the apiClient field`);t.append(r,a)}}return t}async function ul(s,e,t,n,r,a){const o=new ll(s,e,t,n,a);return{url:o.toString(),fetchOptions:Object.assign(Object.assign({},ml(a)),{method:"POST",headers:await dl(o),body:r})}}async function $t(s,e,t,n,r,a={},o=fetch){const{url:c,fetchOptions:u}=await ul(s,e,t,n,r,a);return hl(c,u,o)}async function hl(s,e,t=fetch){let n;try{n=await t(s,e)}catch(r){fl(r,s)}return n.ok||await pl(n,s),n}function fl(s,e){let t=s;throw t.name==="AbortError"?(t=new Na(`Request aborted when fetching ${e.toString()}: ${s.message}`),t.stack=s.stack):s instanceof Ea||s instanceof $e||(t=new ie(`Error fetching from ${e.toString()}: ${s.message}`),t.stack=s.stack),t}async function pl(s,e){let t="",n;try{const r=await s.json();t=r.error.message,r.error.details&&(t+=` ${JSON.stringify(r.error.details)}`,n=r.error.details)}catch{}throw new Ea(`Error fetching from ${e.toString()}: [${s.status} ${s.statusText}] ${t}`,s.status,s.statusText,n)}function ml(s){const e={};if(s?.signal!==void 0||s?.timeout>=0){const t=new AbortController;s?.timeout>=0&&setTimeout(()=>t.abort(),s.timeout),s?.signal&&s.signal.addEventListener("abort",()=>{t.abort()}),e.signal=t.signal}return e}function wn(s){return s.text=()=>{if(s.candidates&&s.candidates.length>0){if(s.candidates.length>1&&console.warn(`This response had ${s.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),as(s.candidates[0]))throw new Ze(`${Te(s)}`,s);return gl(s)}else if(s.promptFeedback)throw new Ze(`Text not available. ${Te(s)}`,s);return""},s.functionCall=()=>{if(s.candidates&&s.candidates.length>0){if(s.candidates.length>1&&console.warn(`This response had ${s.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),as(s.candidates[0]))throw new Ze(`${Te(s)}`,s);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),Fr(s)[0]}else if(s.promptFeedback)throw new Ze(`Function call not available. ${Te(s)}`,s)},s.functionCalls=()=>{if(s.candidates&&s.candidates.length>0){if(s.candidates.length>1&&console.warn(`This response had ${s.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),as(s.candidates[0]))throw new Ze(`${Te(s)}`,s);return Fr(s)}else if(s.promptFeedback)throw new Ze(`Function call not available. ${Te(s)}`,s)},s}function gl(s){var e,t,n,r;const a=[];if(!((t=(e=s.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(const o of(r=(n=s.candidates)===null||n===void 0?void 0:n[0].content)===null||r===void 0?void 0:r.parts)o.text&&a.push(o.text),o.executableCode&&a.push("\n```"+o.executableCode.language+`
`+o.executableCode.code+"\n```\n"),o.codeExecutionResult&&a.push("\n```\n"+o.codeExecutionResult.output+"\n```\n");return a.length>0?a.join(""):""}function Fr(s){var e,t,n,r;const a=[];if(!((t=(e=s.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(const o of(r=(n=s.candidates)===null||n===void 0?void 0:n[0].content)===null||r===void 0?void 0:r.parts)o.functionCall&&a.push(o.functionCall);if(a.length>0)return a}const yl=[Et.RECITATION,Et.SAFETY,Et.LANGUAGE];function as(s){return!!s.finishReason&&yl.includes(s.finishReason)}function Te(s){var e,t,n;let r="";if((!s.candidates||s.candidates.length===0)&&s.promptFeedback)r+="Response was blocked",!((e=s.promptFeedback)===null||e===void 0)&&e.blockReason&&(r+=` due to ${s.promptFeedback.blockReason}`),!((t=s.promptFeedback)===null||t===void 0)&&t.blockReasonMessage&&(r+=`: ${s.promptFeedback.blockReasonMessage}`);else if(!((n=s.candidates)===null||n===void 0)&&n[0]){const a=s.candidates[0];as(a)&&(r+=`Candidate was blocked due to ${a.finishReason}`,a.finishMessage&&(r+=`: ${a.finishMessage}`))}return r}function Ot(s){return this instanceof Ot?(this.v=s,this):new Ot(s)}function bl(s,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(s,e||[]),r,a=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(g){n[g]&&(r[g]=function(h){return new Promise(function(S,x){a.push([g,h,S,x])>1||c(g,h)})})}function c(g,h){try{u(n[g](h))}catch(S){p(a[0][3],S)}}function u(g){g.value instanceof Ot?Promise.resolve(g.value.v).then(f,b):p(a[0][2],g)}function f(g){c("next",g)}function b(g){c("throw",g)}function p(g,h){g(h),a.shift(),a.length&&c(a[0][0],a[0][1])}}const Br=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function wl(s){const e=s.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),t=vl(e),[n,r]=t.tee();return{stream:_l(n),response:xl(r)}}async function xl(s){const e=[],t=s.getReader();for(;;){const{done:n,value:r}=await t.read();if(n)return wn(Sl(e));e.push(r)}}function _l(s){return bl(this,arguments,function*(){const t=s.getReader();for(;;){const{value:n,done:r}=yield Ot(t.read());if(r)break;yield yield Ot(wn(n))}})}function vl(s){const e=s.getReader();return new ReadableStream({start(n){let r="";return a();function a(){return e.read().then(({value:o,done:c})=>{if(c){if(r.trim()){n.error(new ie("Failed to parse stream"));return}n.close();return}r+=o;let u=r.match(Br),f;for(;u;){try{f=JSON.parse(u[1])}catch{n.error(new ie(`Error parsing JSON response: "${u[1]}"`));return}n.enqueue(f),r=r.substring(u[0].length),u=r.match(Br)}return a()}).catch(o=>{let c=o;throw c.stack=o.stack,c.name==="AbortError"?c=new Na("Request aborted when reading from the stream"):c=new ie("Error reading from the stream"),c})}}})}function Sl(s){const e=s[s.length-1],t={promptFeedback:e?.promptFeedback};for(const n of s){if(n.candidates){let r=0;for(const a of n.candidates)if(t.candidates||(t.candidates=[]),t.candidates[r]||(t.candidates[r]={index:r}),t.candidates[r].citationMetadata=a.citationMetadata,t.candidates[r].groundingMetadata=a.groundingMetadata,t.candidates[r].finishReason=a.finishReason,t.candidates[r].finishMessage=a.finishMessage,t.candidates[r].safetyRatings=a.safetyRatings,a.content&&a.content.parts){t.candidates[r].content||(t.candidates[r].content={role:a.content.role||"user",parts:[]});const o={};for(const c of a.content.parts)c.text&&(o.text=c.text),c.functionCall&&(o.functionCall=c.functionCall),c.executableCode&&(o.executableCode=c.executableCode),c.codeExecutionResult&&(o.codeExecutionResult=c.codeExecutionResult),Object.keys(o).length===0&&(o.text=""),t.candidates[r].content.parts.push(o)}r++}n.usageMetadata&&(t.usageMetadata=n.usageMetadata)}return t}async function ka(s,e,t,n){const r=await $t(e,We.STREAM_GENERATE_CONTENT,s,!0,JSON.stringify(t),n);return wl(r)}async function Ra(s,e,t,n){const a=await(await $t(e,We.GENERATE_CONTENT,s,!1,JSON.stringify(t),n)).json();return{response:wn(a)}}function Oa(s){if(s!=null){if(typeof s=="string")return{role:"system",parts:[{text:s}]};if(s.text)return{role:"system",parts:[s]};if(s.parts)return s.role?s:{role:"system",parts:s.parts}}}function jt(s){let e=[];if(typeof s=="string")e=[{text:s}];else for(const t of s)typeof t=="string"?e.push({text:t}):e.push(t);return Al(e)}function Al(s){const e={role:"user",parts:[]},t={role:"function",parts:[]};let n=!1,r=!1;for(const a of s)"functionResponse"in a?(t.parts.push(a),r=!0):(e.parts.push(a),n=!0);if(n&&r)throw new ie("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!n&&!r)throw new ie("No content is provided for sending chat message.");return n?e:t}function Cl(s,e){var t;let n={model:e?.model,generationConfig:e?.generationConfig,safetySettings:e?.safetySettings,tools:e?.tools,toolConfig:e?.toolConfig,systemInstruction:e?.systemInstruction,cachedContent:(t=e?.cachedContent)===null||t===void 0?void 0:t.name,contents:[]};const r=s.generateContentRequest!=null;if(s.contents){if(r)throw new $e("CountTokensRequest must have one of contents or generateContentRequest, not both.");n.contents=s.contents}else if(r)n=Object.assign(Object.assign({},n),s.generateContentRequest);else{const a=jt(s);n.contents=[a]}return{generateContentRequest:n}}function Hr(s){let e;return s.contents?e=s:e={contents:[jt(s)]},s.systemInstruction&&(e.systemInstruction=Oa(s.systemInstruction)),e}function Il(s){return typeof s=="string"||Array.isArray(s)?{content:jt(s)}:s}const Ur=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],El={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function Nl(s){let e=!1;for(const t of s){const{role:n,parts:r}=t;if(!e&&n!=="user")throw new ie(`First content should be with role 'user', got ${n}`);if(!Or.includes(n))throw new ie(`Each item should include role field. Got ${n} but valid roles are: ${JSON.stringify(Or)}`);if(!Array.isArray(r))throw new ie("Content should have 'parts' property with an array of Parts");if(r.length===0)throw new ie("Each Content should have at least one part");const a={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const c of r)for(const u of Ur)u in c&&(a[u]+=1);const o=El[n];for(const c of Ur)if(!o.includes(c)&&a[c]>0)throw new ie(`Content with role '${n}' can't contain '${c}' part`);e=!0}}function Gr(s){var e;if(s.candidates===void 0||s.candidates.length===0)return!1;const t=(e=s.candidates[0])===null||e===void 0?void 0:e.content;if(t===void 0||t.parts===void 0||t.parts.length===0)return!1;for(const n of t.parts)if(n===void 0||Object.keys(n).length===0||n.text!==void 0&&n.text==="")return!1;return!0}const Kr="SILENT_ERROR";class kl{constructor(e,t,n,r={}){this.model=t,this.params=n,this._requestOptions=r,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,n?.history&&(Nl(n.history),this._history=n.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,t={}){var n,r,a,o,c,u;await this._sendPromise;const f=jt(e),b={safetySettings:(n=this.params)===null||n===void 0?void 0:n.safetySettings,generationConfig:(r=this.params)===null||r===void 0?void 0:r.generationConfig,tools:(a=this.params)===null||a===void 0?void 0:a.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(c=this.params)===null||c===void 0?void 0:c.systemInstruction,cachedContent:(u=this.params)===null||u===void 0?void 0:u.cachedContent,contents:[...this._history,f]},p=Object.assign(Object.assign({},this._requestOptions),t);let g;return this._sendPromise=this._sendPromise.then(()=>Ra(this._apiKey,this.model,b,p)).then(h=>{var S;if(Gr(h.response)){this._history.push(f);const x=Object.assign({parts:[],role:"model"},(S=h.response.candidates)===null||S===void 0?void 0:S[0].content);this._history.push(x)}else{const x=Te(h.response);x&&console.warn(`sendMessage() was unsuccessful. ${x}. Inspect response object for details.`)}g=h}).catch(h=>{throw this._sendPromise=Promise.resolve(),h}),await this._sendPromise,g}async sendMessageStream(e,t={}){var n,r,a,o,c,u;await this._sendPromise;const f=jt(e),b={safetySettings:(n=this.params)===null||n===void 0?void 0:n.safetySettings,generationConfig:(r=this.params)===null||r===void 0?void 0:r.generationConfig,tools:(a=this.params)===null||a===void 0?void 0:a.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(c=this.params)===null||c===void 0?void 0:c.systemInstruction,cachedContent:(u=this.params)===null||u===void 0?void 0:u.cachedContent,contents:[...this._history,f]},p=Object.assign(Object.assign({},this._requestOptions),t),g=ka(this._apiKey,this.model,b,p);return this._sendPromise=this._sendPromise.then(()=>g).catch(h=>{throw new Error(Kr)}).then(h=>h.response).then(h=>{if(Gr(h)){this._history.push(f);const S=Object.assign({},h.candidates[0].content);S.role||(S.role="model"),this._history.push(S)}else{const S=Te(h);S&&console.warn(`sendMessageStream() was unsuccessful. ${S}. Inspect response object for details.`)}}).catch(h=>{h.message!==Kr&&console.error(h)}),g}}async function Rl(s,e,t,n){return(await $t(e,We.COUNT_TOKENS,s,!1,JSON.stringify(t),n)).json()}async function Ol(s,e,t,n){return(await $t(e,We.EMBED_CONTENT,s,!1,JSON.stringify(t),n)).json()}async function jl(s,e,t,n){const r=t.requests.map(o=>Object.assign(Object.assign({},o),{model:e}));return(await $t(e,We.BATCH_EMBED_CONTENTS,s,!1,JSON.stringify({requests:r}),n)).json()}class qr{constructor(e,t,n={}){this.apiKey=e,this._requestOptions=n,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=Oa(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(e,t={}){var n;const r=Hr(e),a=Object.assign(Object.assign({},this._requestOptions),t);return Ra(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},r),a)}async generateContentStream(e,t={}){var n;const r=Hr(e),a=Object.assign(Object.assign({},this._requestOptions),t);return ka(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},r),a)}startChat(e){var t;return new kl(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(t=this.cachedContent)===null||t===void 0?void 0:t.name},e),this._requestOptions)}async countTokens(e,t={}){const n=Cl(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),r=Object.assign(Object.assign({},this._requestOptions),t);return Rl(this.apiKey,this.model,n,r)}async embedContent(e,t={}){const n=Il(e),r=Object.assign(Object.assign({},this._requestOptions),t);return Ol(this.apiKey,this.model,n,r)}async batchEmbedContents(e,t={}){const n=Object.assign(Object.assign({},this._requestOptions),t);return jl(this.apiKey,this.model,e,n)}}class Tl{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new ie("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new qr(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,n){if(!e.name)throw new $e("Cached content must contain a `name` field.");if(!e.model)throw new $e("Cached content must contain a `model` field.");const r=["model","systemInstruction"];for(const o of r)if(t?.[o]&&e[o]&&t?.[o]!==e[o]){if(o==="model"){const c=t.model.startsWith("models/")?t.model.replace("models/",""):t.model,u=e.model.startsWith("models/")?e.model.replace("models/",""):e.model;if(c===u)continue}throw new $e(`Different value for "${o}" specified in modelParams (${t[o]}) and cachedContent (${e[o]})`)}const a=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new qr(this.apiKey,a,n)}}function I(s,e,t,n,r){if(typeof e=="function"?s!==e||!0:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(s,t),t}function d(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)}let ja=function(){const{crypto:s}=globalThis;if(s?.randomUUID)return ja=s.randomUUID.bind(s),s.randomUUID();const e=new Uint8Array(1),t=s?()=>s.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^t()&15>>+n/4).toString(16))};function tn(s){return typeof s=="object"&&s!==null&&("name"in s&&s.name==="AbortError"||"message"in s&&String(s.message).includes("FetchRequestCanceledException"))}const sn=s=>{if(s instanceof Error)return s;if(typeof s=="object"&&s!==null){try{if(Object.prototype.toString.call(s)==="[object Error]"){const e=new Error(s.message,s.cause?{cause:s.cause}:{});return s.stack&&(e.stack=s.stack),s.cause&&!e.cause&&(e.cause=s.cause),s.name&&(e.name=s.name),e}}catch{}try{return new Error(JSON.stringify(s))}catch{}}return new Error(s)};class C extends Error{}class ae extends C{constructor(e,t,n,r){super(`${ae.makeMessage(e,t,n)}`),this.status=e,this.headers=r,this.requestID=r?.get("x-request-id"),this.error=t;const a=t;this.code=a?.code,this.param=a?.param,this.type=a?.type}static makeMessage(e,t,n){const r=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,n,r){if(!e||!r)return new Cs({message:n,cause:sn(t)});const a=t?.error;return e===400?new Ta(e,a,n,r):e===401?new $a(e,a,n,r):e===403?new Ma(e,a,n,r):e===404?new Pa(e,a,n,r):e===409?new Da(e,a,n,r):e===422?new La(e,a,n,r):e===429?new Fa(e,a,n,r):e>=500?new Ba(e,a,n,r):new ae(e,a,n,r)}}class me extends ae{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class Cs extends ae{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class xn extends Cs{constructor({message:e}={}){super({message:e??"Request timed out."})}}class Ta extends ae{}class $a extends ae{}class Ma extends ae{}class Pa extends ae{}class Da extends ae{}class La extends ae{}class Fa extends ae{}class Ba extends ae{}class Ha extends C{constructor(){super("Could not parse response content as the length limit was reached")}}class Ua extends C{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class gt extends Error{constructor(e){super(e)}}const $l=/^[a-z][a-z0-9+.-]*:/i,Ml=s=>$l.test(s);let de=s=>(de=Array.isArray,de(s)),Wr=de;function Ga(s){return typeof s!="object"?{}:s??{}}function Pl(s){if(!s)return!0;for(const e in s)return!1;return!0}function Dl(s,e){return Object.prototype.hasOwnProperty.call(s,e)}function qs(s){return s!=null&&typeof s=="object"&&!Array.isArray(s)}const Ll=(s,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new C(`${s} must be an integer`);if(e<0)throw new C(`${s} must be a positive integer`);return e},Fl=s=>{try{return JSON.parse(s)}catch{return}},Mt=s=>new Promise(e=>setTimeout(e,s)),rt="6.9.1",Bl=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function Hl(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const Ul=()=>{const s=Hl();if(s==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":rt,"X-Stainless-OS":Yr(Deno.build.os),"X-Stainless-Arch":Xr(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":rt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(s==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":rt,"X-Stainless-OS":Yr(globalThis.process.platform??"unknown"),"X-Stainless-Arch":Xr(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};const e=Gl();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":rt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":rt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Gl(){if(typeof navigator>"u"||!navigator)return null;const s=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of s){const n=t.exec(navigator.userAgent);if(n){const r=n[1]||0,a=n[2]||0,o=n[3]||0;return{browser:e,version:`${r}.${a}.${o}`}}}return null}const Xr=s=>s==="x32"?"x32":s==="x86_64"||s==="x64"?"x64":s==="arm"?"arm":s==="aarch64"||s==="arm64"?"arm64":s?`other:${s}`:"unknown",Yr=s=>(s=s.toLowerCase(),s.includes("ios")?"iOS":s==="android"?"Android":s==="darwin"?"MacOS":s==="win32"?"Windows":s==="freebsd"?"FreeBSD":s==="openbsd"?"OpenBSD":s==="linux"?"Linux":s?`Other:${s}`:"Unknown");let zr;const Kl=()=>zr??(zr=Ul());function ql(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function Ka(...s){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...s)}function qa(s){let e=Symbol.asyncIterator in s?s[Symbol.asyncIterator]():s[Symbol.iterator]();return Ka({start(){},async pull(t){const{done:n,value:r}=await e.next();n?t.close():t.enqueue(r)},async cancel(){await e.return?.()}})}function Wa(s){if(s[Symbol.asyncIterator])return s;const e=s.getReader();return{async next(){try{const t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function Wl(s){if(s===null||typeof s!="object")return;if(s[Symbol.asyncIterator]){await s[Symbol.asyncIterator]().return?.();return}const e=s.getReader(),t=e.cancel();e.releaseLock(),await t}const Xl=({headers:s,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)}),Xa="RFC3986",Ya=s=>String(s),Vr={RFC1738:s=>String(s).replace(/%20/g,"+"),RFC3986:Ya},Yl="RFC1738";let nn=(s,e)=>(nn=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),nn(s,e));const we=(()=>{const s=[];for(let e=0;e<256;++e)s.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return s})(),Ws=1024,zl=(s,e,t,n,r)=>{if(s.length===0)return s;let a=s;if(typeof s=="symbol"?a=Symbol.prototype.toString.call(s):typeof s!="string"&&(a=String(s)),t==="iso-8859-1")return escape(a).replace(/%u[0-9a-f]{4}/gi,function(c){return"%26%23"+parseInt(c.slice(2),16)+"%3B"});let o="";for(let c=0;c<a.length;c+=Ws){const u=a.length>=Ws?a.slice(c,c+Ws):a,f=[];for(let b=0;b<u.length;++b){let p=u.charCodeAt(b);if(p===45||p===46||p===95||p===126||p>=48&&p<=57||p>=65&&p<=90||p>=97&&p<=122||r===Yl&&(p===40||p===41)){f[f.length]=u.charAt(b);continue}if(p<128){f[f.length]=we[p];continue}if(p<2048){f[f.length]=we[192|p>>6]+we[128|p&63];continue}if(p<55296||p>=57344){f[f.length]=we[224|p>>12]+we[128|p>>6&63]+we[128|p&63];continue}b+=1,p=65536+((p&1023)<<10|u.charCodeAt(b)&1023),f[f.length]=we[240|p>>18]+we[128|p>>12&63]+we[128|p>>6&63]+we[128|p&63]}o+=f.join("")}return o};function Vl(s){return!s||typeof s!="object"?!1:!!(s.constructor&&s.constructor.isBuffer&&s.constructor.isBuffer(s))}function Jr(s,e){if(de(s)){const t=[];for(let n=0;n<s.length;n+=1)t.push(e(s[n]));return t}return e(s)}const za={brackets(s){return String(s)+"[]"},comma:"comma",indices(s,e){return String(s)+"["+e+"]"},repeat(s){return String(s)}},Va=function(s,e){Array.prototype.push.apply(s,de(e)?e:[e])};let Qr;const Q={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:zl,encodeValuesOnly:!1,format:Xa,formatter:Ya,indices:!1,serializeDate(s){return(Qr??(Qr=Function.prototype.call.bind(Date.prototype.toISOString)))(s)},skipNulls:!1,strictNullHandling:!1};function Jl(s){return typeof s=="string"||typeof s=="number"||typeof s=="boolean"||typeof s=="symbol"||typeof s=="bigint"}const Xs={};function Ja(s,e,t,n,r,a,o,c,u,f,b,p,g,h,S,x,D,M){let v=s,K=M,$=0,Y=!1;for(;(K=K.get(Xs))!==void 0&&!Y;){const U=K.get(s);if($+=1,typeof U<"u"){if(U===$)throw new RangeError("Cyclic object value");Y=!0}typeof K.get(Xs)>"u"&&($=0)}if(typeof f=="function"?v=f(e,v):v instanceof Date?v=g?.(v):t==="comma"&&de(v)&&(v=Jr(v,function(U){return U instanceof Date?g?.(U):U})),v===null){if(a)return u&&!x?u(e,Q.encoder,D,"key",h):e;v=""}if(Jl(v)||Vl(v)){if(u){const U=x?e:u(e,Q.encoder,D,"key",h);return[S?.(U)+"="+S?.(u(v,Q.encoder,D,"value",h))]}return[S?.(e)+"="+S?.(String(v))]}const q=[];if(typeof v>"u")return q;let k;if(t==="comma"&&de(v))x&&u&&(v=Jr(v,u)),k=[{value:v.length>0?v.join(",")||null:void 0}];else if(de(f))k=f;else{const U=Object.keys(v);k=b?U.sort(b):U}const z=c?String(e).replace(/\./g,"%2E"):String(e),O=n&&de(v)&&v.length===1?z+"[]":z;if(r&&de(v)&&v.length===0)return O+"[]";for(let U=0;U<k.length;++U){const L=k[U],Me=typeof L=="object"&&typeof L.value<"u"?L.value:v[L];if(o&&Me===null)continue;const Ne=p&&c?L.replace(/\./g,"%2E"):L,Lt=de(v)?typeof t=="function"?t(O,Ne):O:O+(p?"."+Ne:"["+Ne+"]");M.set(s,$);const Ft=new WeakMap;Ft.set(Xs,M),Va(q,Ja(Me,Lt,t,n,r,a,o,c,t==="comma"&&x&&de(v)?null:u,f,b,p,g,h,S,x,D,Ft))}return q}function Ql(s=Q){if(typeof s.allowEmptyArrays<"u"&&typeof s.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof s.encodeDotInKeys<"u"&&typeof s.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(s.encoder!==null&&typeof s.encoder<"u"&&typeof s.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=s.charset||Q.charset;if(typeof s.charset<"u"&&s.charset!=="utf-8"&&s.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Xa;if(typeof s.format<"u"){if(!nn(Vr,s.format))throw new TypeError("Unknown format option provided.");t=s.format}const n=Vr[t];let r=Q.filter;(typeof s.filter=="function"||de(s.filter))&&(r=s.filter);let a;if(s.arrayFormat&&s.arrayFormat in za?a=s.arrayFormat:"indices"in s?a=s.indices?"indices":"repeat":a=Q.arrayFormat,"commaRoundTrip"in s&&typeof s.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const o=typeof s.allowDots>"u"?s.encodeDotInKeys?!0:Q.allowDots:!!s.allowDots;return{addQueryPrefix:typeof s.addQueryPrefix=="boolean"?s.addQueryPrefix:Q.addQueryPrefix,allowDots:o,allowEmptyArrays:typeof s.allowEmptyArrays=="boolean"?!!s.allowEmptyArrays:Q.allowEmptyArrays,arrayFormat:a,charset:e,charsetSentinel:typeof s.charsetSentinel=="boolean"?s.charsetSentinel:Q.charsetSentinel,commaRoundTrip:!!s.commaRoundTrip,delimiter:typeof s.delimiter>"u"?Q.delimiter:s.delimiter,encode:typeof s.encode=="boolean"?s.encode:Q.encode,encodeDotInKeys:typeof s.encodeDotInKeys=="boolean"?s.encodeDotInKeys:Q.encodeDotInKeys,encoder:typeof s.encoder=="function"?s.encoder:Q.encoder,encodeValuesOnly:typeof s.encodeValuesOnly=="boolean"?s.encodeValuesOnly:Q.encodeValuesOnly,filter:r,format:t,formatter:n,serializeDate:typeof s.serializeDate=="function"?s.serializeDate:Q.serializeDate,skipNulls:typeof s.skipNulls=="boolean"?s.skipNulls:Q.skipNulls,sort:typeof s.sort=="function"?s.sort:null,strictNullHandling:typeof s.strictNullHandling=="boolean"?s.strictNullHandling:Q.strictNullHandling}}function Zl(s,e={}){let t=s;const n=Ql(e);let r,a;typeof n.filter=="function"?(a=n.filter,t=a("",t)):de(n.filter)&&(a=n.filter,r=a);const o=[];if(typeof t!="object"||t===null)return"";const c=za[n.arrayFormat],u=c==="comma"&&n.commaRoundTrip;r||(r=Object.keys(t)),n.sort&&r.sort(n.sort);const f=new WeakMap;for(let g=0;g<r.length;++g){const h=r[g];n.skipNulls&&t[h]===null||Va(o,Ja(t[h],h,c,u,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,f))}const b=o.join(n.delimiter);let p=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?p+="utf8=%26%2310003%3B&":p+="utf8=%E2%9C%93&"),b.length>0?p+b:""}function ec(s){let e=0;for(const r of s)e+=r.length;const t=new Uint8Array(e);let n=0;for(const r of s)t.set(r,n),n+=r.length;return t}let Zr;function _n(s){let e;return(Zr??(e=new globalThis.TextEncoder,Zr=e.encode.bind(e)))(s)}let ea;function ta(s){let e;return(ea??(e=new globalThis.TextDecoder,ea=e.decode.bind(e)))(s)}var he,fe;class Is{constructor(){he.set(this,void 0),fe.set(this,void 0),I(this,he,new Uint8Array),I(this,fe,null)}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?_n(e):e;I(this,he,ec([d(this,he,"f"),t]));const n=[];let r;for(;(r=tc(d(this,he,"f"),d(this,fe,"f")))!=null;){if(r.carriage&&d(this,fe,"f")==null){I(this,fe,r.index);continue}if(d(this,fe,"f")!=null&&(r.index!==d(this,fe,"f")+1||r.carriage)){n.push(ta(d(this,he,"f").subarray(0,d(this,fe,"f")-1))),I(this,he,d(this,he,"f").subarray(d(this,fe,"f"))),I(this,fe,null);continue}const a=d(this,fe,"f")!==null?r.preceding-1:r.preceding,o=ta(d(this,he,"f").subarray(0,a));n.push(o),I(this,he,d(this,he,"f").subarray(r.index)),I(this,fe,null)}return n}flush(){return d(this,he,"f").length?this.decode(`
`):[]}}he=new WeakMap,fe=new WeakMap;Is.NEWLINE_CHARS=new Set([`
`,"\r"]);Is.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function tc(s,e){for(let r=e??0;r<s.length;r++){if(s[r]===10)return{preceding:r,index:r+1,carriage:!1};if(s[r]===13)return{preceding:r,index:r+1,carriage:!0}}return null}function sc(s){for(let n=0;n<s.length-1;n++){if(s[n]===10&&s[n+1]===10||s[n]===13&&s[n+1]===13)return n+2;if(s[n]===13&&s[n+1]===10&&n+3<s.length&&s[n+2]===13&&s[n+3]===10)return n+4}return-1}const ms={off:0,error:200,warn:300,info:400,debug:500},sa=(s,e,t)=>{if(s){if(Dl(ms,s))return s;ne(t).warn(`${e} was set to ${JSON.stringify(s)}, expected one of ${JSON.stringify(Object.keys(ms))}`)}};function yt(){}function Vt(s,e,t){return!e||ms[s]>ms[t]?yt:e[s].bind(e)}const nc={error:yt,warn:yt,info:yt,debug:yt};let na=new WeakMap;function ne(s){const e=s.logger,t=s.logLevel??"off";if(!e)return nc;const n=na.get(e);if(n&&n[0]===t)return n[1];const r={error:Vt("error",e,t),warn:Vt("warn",e,t),info:Vt("info",e,t),debug:Vt("debug",e,t)};return na.set(e,[t,r]),r}const Ue=s=>(s.options&&(s.options={...s.options},delete s.options.headers),s.headers&&(s.headers=Object.fromEntries((s.headers instanceof Headers?[...s.headers]:Object.entries(s.headers)).map(([e,t])=>[e,e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in s&&(s.retryOfRequestLogID&&(s.retryOf=s.retryOfRequestLogID),delete s.retryOfRequestLogID),s);var pt;class _e{constructor(e,t,n){this.iterator=e,pt.set(this,void 0),this.controller=t,I(this,pt,n)}static fromSSEResponse(e,t,n){let r=!1;const a=n?ne(n):console;async function*o(){if(r)throw new C("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let c=!1;try{for await(const u of rc(e,t))if(!c){if(u.data.startsWith("[DONE]")){c=!0;continue}if(u.event===null||!u.event.startsWith("thread.")){let f;try{f=JSON.parse(u.data)}catch(b){throw a.error("Could not parse message into JSON:",u.data),a.error("From chunk:",u.raw),b}if(f&&f.error)throw new ae(void 0,f.error,void 0,e.headers);yield f}else{let f;try{f=JSON.parse(u.data)}catch(b){throw console.error("Could not parse message into JSON:",u.data),console.error("From chunk:",u.raw),b}if(u.event=="error")throw new ae(void 0,f.error,f.message,void 0);yield{event:u.event,data:f}}}c=!0}catch(u){if(tn(u))return;throw u}finally{c||t.abort()}}return new _e(o,t,n)}static fromReadableStream(e,t,n){let r=!1;async function*a(){const c=new Is,u=Wa(e);for await(const f of u)for(const b of c.decode(f))yield b;for(const f of c.flush())yield f}async function*o(){if(r)throw new C("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let c=!1;try{for await(const u of a())c||u&&(yield JSON.parse(u));c=!0}catch(u){if(tn(u))return;throw u}finally{c||t.abort()}}return new _e(o,t,n)}[(pt=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),r=a=>({next:()=>{if(a.length===0){const o=n.next();e.push(o),t.push(o)}return a.shift()}});return[new _e(()=>r(e),this.controller,d(this,pt,"f")),new _e(()=>r(t),this.controller,d(this,pt,"f"))]}toReadableStream(){const e=this;let t;return Ka({async start(){t=e[Symbol.asyncIterator]()},async pull(n){try{const{value:r,done:a}=await t.next();if(a)return n.close();const o=_n(JSON.stringify(r)+`
`);n.enqueue(o)}catch(r){n.error(r)}},async cancel(){await t.return?.()}})}}async function*rc(s,e){if(!s.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new C("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new C("Attempted to iterate over a response with no body");const t=new ic,n=new Is,r=Wa(s.body);for await(const a of ac(r))for(const o of n.decode(a)){const c=t.decode(o);c&&(yield c)}for(const a of n.flush()){const o=t.decode(a);o&&(yield o)}}async function*ac(s){let e=new Uint8Array;for await(const t of s){if(t==null)continue;const n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?_n(t):t;let r=new Uint8Array(e.length+n.length);r.set(e),r.set(n,e.length),e=r;let a;for(;(a=sc(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}class ic{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,r]=oc(e,":");return r.startsWith(" ")&&(r=r.substring(1)),t==="event"?this.event=r:t==="data"&&this.data.push(r),null}}function oc(s,e){const t=s.indexOf(e);return t!==-1?[s.substring(0,t),e,s.substring(t+e.length)]:[s,"",""]}async function Qa(s,e){const{response:t,requestLogID:n,retryOfRequestLogID:r,startTime:a}=e,o=await(async()=>{if(e.options.stream)return ne(s).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller,s):_e.fromSSEResponse(t,e.controller,s);if(t.status===204)return null;if(e.options.__binaryResponse)return t;const u=t.headers.get("content-type")?.split(";")[0]?.trim();if(u?.includes("application/json")||u?.endsWith("+json")){const p=await t.json();return Za(p,t)}return await t.text()})();return ne(s).debug(`[${n}] response parsed`,Ue({retryOfRequestLogID:r,url:t.url,status:t.status,body:o,durationMs:Date.now()-a})),o}function Za(s,e){return!s||typeof s!="object"||Array.isArray(s)?s:Object.defineProperty(s,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var bt;class Es extends Promise{constructor(e,t,n=Qa){super(r=>{r(null)}),this.responsePromise=t,this.parseResponse=n,bt.set(this,void 0),I(this,bt,e)}_thenUnwrap(e){return new Es(d(this,bt,"f"),this.responsePromise,async(t,n)=>Za(e(await this.parseResponse(t,n),n),n.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(d(this,bt,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}bt=new WeakMap;var Jt;class vn{constructor(e,t,n,r){Jt.set(this,void 0),I(this,Jt,e),this.options=r,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){const e=this.nextPageRequestOptions();if(!e)throw new C("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await d(this,Jt,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Jt=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class lc extends Es{constructor(e,t,n){super(e,t,async(r,a)=>new n(r,a.response,await Qa(r,a),a.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}class Ns extends vn{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class X extends vn{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){const e=this.getPaginatedItems(),t=e[e.length-1]?.id;return t?{...this.options,query:{...Ga(this.options.query),after:t}}:null}}class gs extends vn{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1,this.last_id=n.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){const e=this.last_id;return e?{...this.options,query:{...Ga(this.options.query),after:e}}:null}}const ei=()=>{if(typeof File>"u"){const{process:s}=globalThis,e=typeof s?.versions?.node=="string"&&parseInt(s.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(e?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Nt(s,e,t){return ei(),new File(s,e??"unknown_file",t)}function is(s){return(typeof s=="object"&&s!==null&&("name"in s&&s.name&&String(s.name)||"url"in s&&s.url&&String(s.url)||"filename"in s&&s.filename&&String(s.filename)||"path"in s&&s.path&&String(s.path))||"").split(/[\\/]/).pop()||void 0}const Sn=s=>s!=null&&typeof s=="object"&&typeof s[Symbol.asyncIterator]=="function",ra=async(s,e)=>rn(s.body)?{...s,body:await ti(s.body,e)}:s,Xe=async(s,e)=>({...s,body:await ti(s.body,e)}),aa=new WeakMap;function cc(s){const e=typeof s=="function"?s:s.fetch,t=aa.get(e);if(t)return t;const n=(async()=>{try{const r="Response"in e?e.Response:(await e("data:,")).constructor,a=new FormData;return a.toString()!==await new r(a).text()}catch{return!0}})();return aa.set(e,n),n}const ti=async(s,e)=>{if(!await cc(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const t=new FormData;return await Promise.all(Object.entries(s||{}).map(([n,r])=>an(t,n,r))),t},si=s=>s instanceof Blob&&"name"in s,dc=s=>typeof s=="object"&&s!==null&&(s instanceof Response||Sn(s)||si(s)),rn=s=>{if(dc(s))return!0;if(Array.isArray(s))return s.some(rn);if(s&&typeof s=="object"){for(const e in s)if(rn(s[e]))return!0}return!1},an=async(s,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")s.append(e,String(t));else if(t instanceof Response)s.append(e,Nt([await t.blob()],is(t)));else if(Sn(t))s.append(e,Nt([await new Response(qa(t)).blob()],is(t)));else if(si(t))s.append(e,t,is(t));else if(Array.isArray(t))await Promise.all(t.map(n=>an(s,e+"[]",n)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([n,r])=>an(s,`${e}[${n}]`,r)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}},ni=s=>s!=null&&typeof s=="object"&&typeof s.size=="number"&&typeof s.type=="string"&&typeof s.text=="function"&&typeof s.slice=="function"&&typeof s.arrayBuffer=="function",uc=s=>s!=null&&typeof s=="object"&&typeof s.name=="string"&&typeof s.lastModified=="number"&&ni(s),hc=s=>s!=null&&typeof s=="object"&&typeof s.url=="string"&&typeof s.blob=="function";async function fc(s,e,t){if(ei(),s=await s,uc(s))return s instanceof File?s:Nt([await s.arrayBuffer()],s.name);if(hc(s)){const r=await s.blob();return e||(e=new URL(s.url).pathname.split(/[\\/]/).pop()),Nt(await on(r),e,t)}const n=await on(s);if(e||(e=is(s)),!t?.type){const r=n.find(a=>typeof a=="object"&&"type"in a&&a.type);typeof r=="string"&&(t={...t,type:r})}return Nt(n,e,t)}async function on(s){let e=[];if(typeof s=="string"||ArrayBuffer.isView(s)||s instanceof ArrayBuffer)e.push(s);else if(ni(s))e.push(s instanceof Blob?s:await s.arrayBuffer());else if(Sn(s))for await(const t of s)e.push(...await on(t));else{const t=s?.constructor?.name;throw new Error(`Unexpected data type: ${typeof s}${t?`; constructor: ${t}`:""}${pc(s)}`)}return e}function pc(s){return typeof s!="object"||s===null?"":`; props: [${Object.getOwnPropertyNames(s).map(t=>`"${t}"`).join(", ")}]`}class A{constructor(e){this._client=e}}function ri(s){return s.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const ia=Object.freeze(Object.create(null)),mc=(s=ri)=>function(t,...n){if(t.length===1)return t[0];let r=!1;const a=[],o=t.reduce((b,p,g)=>{/[?#]/.test(p)&&(r=!0);const h=n[g];let S=(r?encodeURIComponent:s)(""+h);return g!==n.length&&(h==null||typeof h=="object"&&h.toString===Object.getPrototypeOf(Object.getPrototypeOf(h.hasOwnProperty??ia)??ia)?.toString)&&(S=h+"",a.push({start:b.length+p.length,length:S.length,error:`Value of type ${Object.prototype.toString.call(h).slice(8,-1)} is not a valid path parameter`})),b+p+(g===n.length?"":S)},""),c=o.split(/[?#]/,1)[0],u=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let f;for(;(f=u.exec(c))!==null;)a.push({start:f.index,length:f[0].length,error:`Value "${f[0]}" can't be safely passed as a path parameter`});if(a.sort((b,p)=>b.start-p.start),a.length>0){let b=0;const p=a.reduce((g,h)=>{const S=" ".repeat(h.start-b),x="^".repeat(h.length);return b=h.start+h.length,g+S+x},"");throw new C(`Path parameters result in path with invalid segments:
${a.map(g=>g.error).join(`
`)}
${o}
${p}`)}return o},m=mc(ri);let ai=class extends A{list(e,t={},n){return this._client.getAPIList(m`/chat/completions/${e}/messages`,X,{query:t,...n})}};function ys(s){return s!==void 0&&"function"in s&&s.function!==void 0}function An(s){return s?.$brand==="auto-parseable-response-format"}function Pt(s){return s?.$brand==="auto-parseable-tool"}function gc(s,e){return!e||!ii(e)?{...s,choices:s.choices.map(t=>(oi(t.message.tool_calls),{...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:Cn(s,e)}function Cn(s,e){const t=s.choices.map(n=>{if(n.finish_reason==="length")throw new Ha;if(n.finish_reason==="content_filter")throw new Ua;return oi(n.message.tool_calls),{...n,message:{...n.message,...n.message.tool_calls?{tool_calls:n.message.tool_calls?.map(r=>bc(e,r))??void 0}:void 0,parsed:n.message.content&&!n.message.refusal?yc(e,n.message.content):null}}});return{...s,choices:t}}function yc(s,e){return s.response_format?.type!=="json_schema"?null:s.response_format?.type==="json_schema"?"$parseRaw"in s.response_format?s.response_format.$parseRaw(e):JSON.parse(e):null}function bc(s,e){const t=s.tools?.find(n=>ys(n)&&n.function?.name===e.function.name);return{...e,function:{...e.function,parsed_arguments:Pt(t)?t.$parseRaw(e.function.arguments):t?.function.strict?JSON.parse(e.function.arguments):null}}}function wc(s,e){if(!s||!("tools"in s)||!s.tools)return!1;const t=s.tools?.find(n=>ys(n)&&n.function?.name===e.function.name);return ys(t)&&(Pt(t)||t?.function.strict||!1)}function ii(s){return An(s.response_format)?!0:s.tools?.some(e=>Pt(e)||e.type==="function"&&e.function.strict===!0)??!1}function oi(s){for(const e of s||[])if(e.type!=="function")throw new C(`Currently only \`function\` tool calls are supported; Received \`${e.type}\``)}function xc(s){for(const e of s??[]){if(e.type!=="function")throw new C(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new C(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}const bs=s=>s?.role==="assistant",li=s=>s?.role==="tool";var ln,os,ls,wt,xt,cs,_t,Ee,vt,ws,xs,at,ci;class In{constructor(){ln.add(this),this.controller=new AbortController,os.set(this,void 0),ls.set(this,()=>{}),wt.set(this,()=>{}),xt.set(this,void 0),cs.set(this,()=>{}),_t.set(this,()=>{}),Ee.set(this,{}),vt.set(this,!1),ws.set(this,!1),xs.set(this,!1),at.set(this,!1),I(this,os,new Promise((e,t)=>{I(this,ls,e,"f"),I(this,wt,t,"f")})),I(this,xt,new Promise((e,t)=>{I(this,cs,e,"f"),I(this,_t,t,"f")})),d(this,os,"f").catch(()=>{}),d(this,xt,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},d(this,ln,"m",ci).bind(this))},0)}_connected(){this.ended||(d(this,ls,"f").call(this),this._emit("connect"))}get ended(){return d(this,vt,"f")}get errored(){return d(this,ws,"f")}get aborted(){return d(this,xs,"f")}abort(){this.controller.abort()}on(e,t){return(d(this,Ee,"f")[e]||(d(this,Ee,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=d(this,Ee,"f")[e];if(!n)return this;const r=n.findIndex(a=>a.listener===t);return r>=0&&n.splice(r,1),this}once(e,t){return(d(this,Ee,"f")[e]||(d(this,Ee,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{I(this,at,!0),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){I(this,at,!0),await d(this,xt,"f")}_emit(e,...t){if(d(this,vt,"f"))return;e==="end"&&(I(this,vt,!0),d(this,cs,"f").call(this));const n=d(this,Ee,"f")[e];if(n&&(d(this,Ee,"f")[e]=n.filter(r=>!r.once),n.forEach(({listener:r})=>r(...t))),e==="abort"){const r=t[0];!d(this,at,"f")&&!n?.length&&Promise.reject(r),d(this,wt,"f").call(this,r),d(this,_t,"f").call(this,r),this._emit("end");return}if(e==="error"){const r=t[0];!d(this,at,"f")&&!n?.length&&Promise.reject(r),d(this,wt,"f").call(this,r),d(this,_t,"f").call(this,r),this._emit("end")}}_emitFinal(){}}os=new WeakMap,ls=new WeakMap,wt=new WeakMap,xt=new WeakMap,cs=new WeakMap,_t=new WeakMap,Ee=new WeakMap,vt=new WeakMap,ws=new WeakMap,xs=new WeakMap,at=new WeakMap,ln=new WeakSet,ci=function(e){if(I(this,ws,!0),e instanceof Error&&e.name==="AbortError"&&(e=new me),e instanceof me)return I(this,xs,!0),this._emit("abort",e);if(e instanceof C)return this._emit("error",e);if(e instanceof Error){const t=new C(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new C(String(e)))};function _c(s){return typeof s.parse=="function"}var oe,cn,_s,dn,un,hn,di,ui;const vc=10;class hi extends In{constructor(){super(...arguments),oe.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),li(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(bs(e)&&e.tool_calls)for(const n of e.tool_calls)n.type==="function"&&this._emit("functionToolCall",n.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new C("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),d(this,oe,"m",cn).call(this)}async finalMessage(){return await this.done(),d(this,oe,"m",_s).call(this)}async finalFunctionToolCall(){return await this.done(),d(this,oe,"m",dn).call(this)}async finalFunctionToolCallResult(){return await this.done(),d(this,oe,"m",un).call(this)}async totalUsage(){return await this.done(),d(this,oe,"m",hn).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=d(this,oe,"m",_s).call(this);t&&this._emit("finalMessage",t);const n=d(this,oe,"m",cn).call(this);n&&this._emit("finalContent",n);const r=d(this,oe,"m",dn).call(this);r&&this._emit("finalFunctionToolCall",r);const a=d(this,oe,"m",un).call(this);a!=null&&this._emit("finalFunctionToolCallResult",a),this._chatCompletions.some(o=>o.usage)&&this._emit("totalUsage",d(this,oe,"m",hn).call(this))}async _createChatCompletion(e,t,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),d(this,oe,"m",di).call(this,t);const a=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Cn(a,t))}async _runChatCompletion(e,t,n){for(const r of t.messages)this._addMessage(r,!1);return await this._createChatCompletion(e,t,n)}async _runTools(e,t,n){const r="tool",{tool_choice:a="auto",stream:o,...c}=t,u=typeof a!="string"&&a.type==="function"&&a?.function?.name,{maxChatCompletions:f=vc}=n||{},b=t.tools.map(h=>{if(Pt(h)){if(!h.$callback)throw new C("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:h.$callback,name:h.function.name,description:h.function.description||"",parameters:h.function.parameters,parse:h.$parseRaw,strict:!0}}}return h}),p={};for(const h of b)h.type==="function"&&(p[h.function.name||h.function.function.name]=h.function);const g="tools"in t?b.map(h=>h.type==="function"?{type:"function",function:{name:h.function.name||h.function.function.name,parameters:h.function.parameters,description:h.function.description,strict:h.function.strict}}:h):void 0;for(const h of t.messages)this._addMessage(h,!1);for(let h=0;h<f;++h){const x=(await this._createChatCompletion(e,{...c,tool_choice:a,tools:g,messages:[...this.messages]},n)).choices[0]?.message;if(!x)throw new C("missing message in ChatCompletion response");if(!x.tool_calls?.length)return;for(const D of x.tool_calls){if(D.type!=="function")continue;const M=D.id,{name:v,arguments:K}=D.function,$=p[v];if($){if(u&&u!==v){const z=`Invalid tool_call: ${JSON.stringify(v)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:r,tool_call_id:M,content:z});continue}}else{const z=`Invalid tool_call: ${JSON.stringify(v)}. Available options are: ${Object.keys(p).map(O=>JSON.stringify(O)).join(", ")}. Please try again`;this._addMessage({role:r,tool_call_id:M,content:z});continue}let Y;try{Y=_c($)?await $.parse(K):K}catch(z){const O=z instanceof Error?z.message:String(z);this._addMessage({role:r,tool_call_id:M,content:O});continue}const q=await $.function(Y,this),k=d(this,oe,"m",ui).call(this,q);if(this._addMessage({role:r,tool_call_id:M,content:k}),u)return}}}}oe=new WeakSet,cn=function(){return d(this,oe,"m",_s).call(this).content??null},_s=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(bs(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new C("stream ended without producing a ChatCompletionMessage with role=assistant")},dn=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(bs(t)&&t?.tool_calls?.length)return t.tool_calls.filter(n=>n.type==="function").at(-1)?.function}},un=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(li(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(n=>n.role==="assistant"&&n.tool_calls?.some(r=>r.type==="function"&&r.id===t.tool_call_id)))return t.content}},hn=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},di=function(e){if(e.n!=null&&e.n>1)throw new C("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},ui=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class En extends hi{static runTools(e,t,n){const r=new En,a={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,a)),r}_addMessage(e,t=!0){super._addMessage(e,t),bs(e)&&e.content&&this._emit("content",e.content)}}const fi=1,pi=2,mi=4,gi=8,yi=16,bi=32,wi=64,xi=128,_i=256,vi=xi|_i,Si=yi|bi|vi|wi,Ai=fi|pi|Si,Ci=mi|gi,Sc=Ai|Ci,te={STR:fi,NUM:pi,ARR:mi,OBJ:gi,NULL:yi,BOOL:bi,NAN:wi,INFINITY:xi,MINUS_INFINITY:_i,INF:vi,SPECIAL:Si,ATOM:Ai,COLLECTION:Ci,ALL:Sc};class Ac extends Error{}class Cc extends Error{}function Ic(s,e=te.ALL){if(typeof s!="string")throw new TypeError(`expecting str, got ${typeof s}`);if(!s.trim())throw new Error(`${s} is empty`);return Ec(s.trim(),e)}const Ec=(s,e)=>{const t=s.length;let n=0;const r=g=>{throw new Ac(`${g} at position ${n}`)},a=g=>{throw new Cc(`${g} at position ${n}`)},o=()=>(p(),n>=t&&r("Unexpected end of input"),s[n]==='"'?c():s[n]==="{"?u():s[n]==="["?f():s.substring(n,n+4)==="null"||te.NULL&e&&t-n<4&&"null".startsWith(s.substring(n))?(n+=4,null):s.substring(n,n+4)==="true"||te.BOOL&e&&t-n<4&&"true".startsWith(s.substring(n))?(n+=4,!0):s.substring(n,n+5)==="false"||te.BOOL&e&&t-n<5&&"false".startsWith(s.substring(n))?(n+=5,!1):s.substring(n,n+8)==="Infinity"||te.INFINITY&e&&t-n<8&&"Infinity".startsWith(s.substring(n))?(n+=8,1/0):s.substring(n,n+9)==="-Infinity"||te.MINUS_INFINITY&e&&1<t-n&&t-n<9&&"-Infinity".startsWith(s.substring(n))?(n+=9,-1/0):s.substring(n,n+3)==="NaN"||te.NAN&e&&t-n<3&&"NaN".startsWith(s.substring(n))?(n+=3,NaN):b()),c=()=>{const g=n;let h=!1;for(n++;n<t&&(s[n]!=='"'||h&&s[n-1]==="\\");)h=s[n]==="\\"?!h:!1,n++;if(s.charAt(n)=='"')try{return JSON.parse(s.substring(g,++n-Number(h)))}catch(S){a(String(S))}else if(te.STR&e)try{return JSON.parse(s.substring(g,n-Number(h))+'"')}catch{return JSON.parse(s.substring(g,s.lastIndexOf("\\"))+'"')}r("Unterminated string literal")},u=()=>{n++,p();const g={};try{for(;s[n]!=="}";){if(p(),n>=t&&te.OBJ&e)return g;const h=c();p(),n++;try{const S=o();Object.defineProperty(g,h,{value:S,writable:!0,enumerable:!0,configurable:!0})}catch(S){if(te.OBJ&e)return g;throw S}p(),s[n]===","&&n++}}catch{if(te.OBJ&e)return g;r("Expected '}' at end of object")}return n++,g},f=()=>{n++;const g=[];try{for(;s[n]!=="]";)g.push(o()),p(),s[n]===","&&n++}catch{if(te.ARR&e)return g;r("Expected ']' at end of array")}return n++,g},b=()=>{if(n===0){s==="-"&&te.NUM&e&&r("Not sure what '-' is");try{return JSON.parse(s)}catch(h){if(te.NUM&e)try{return s[s.length-1]==="."?JSON.parse(s.substring(0,s.lastIndexOf("."))):JSON.parse(s.substring(0,s.lastIndexOf("e")))}catch{}a(String(h))}}const g=n;for(s[n]==="-"&&n++;s[n]&&!",]}".includes(s[n]);)n++;n==t&&!(te.NUM&e)&&r("Unterminated number literal");try{return JSON.parse(s.substring(g,n))}catch{s.substring(g,n)==="-"&&te.NUM&e&&r("Not sure what '-' is");try{return JSON.parse(s.substring(g,s.lastIndexOf("e")))}catch(S){a(String(S))}}},p=()=>{for(;n<t&&` 
\r	`.includes(s[n]);)n++};return o()},oa=s=>Ic(s,te.ALL^te.NUM);var J,Ie,et,Oe,Ys,Qt,zs,Vs,Js,Zt,Qs,la;class Tt extends hi{constructor(e){super(),J.add(this),Ie.set(this,void 0),et.set(this,void 0),Oe.set(this,void 0),I(this,Ie,e),I(this,et,[])}get currentChatCompletionSnapshot(){return d(this,Oe,"f")}static fromReadableStream(e){const t=new Tt(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){const r=new Tt(t);return r._run(()=>r._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createChatCompletion(e,t,n){super._createChatCompletion;const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),d(this,J,"m",Ys).call(this);const a=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const o of a)d(this,J,"m",zs).call(this,o);if(a.controller.signal?.aborted)throw new me;return this._addChatCompletion(d(this,J,"m",Zt).call(this))}async _fromReadableStream(e,t){const n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),d(this,J,"m",Ys).call(this),this._connected();const r=_e.fromReadableStream(e,this.controller);let a;for await(const o of r)a&&a!==o.id&&this._addChatCompletion(d(this,J,"m",Zt).call(this)),d(this,J,"m",zs).call(this,o),a=o.id;if(r.controller.signal?.aborted)throw new me;return this._addChatCompletion(d(this,J,"m",Zt).call(this))}[(Ie=new WeakMap,et=new WeakMap,Oe=new WeakMap,J=new WeakSet,Ys=function(){this.ended||I(this,Oe,void 0)},Qt=function(t){let n=d(this,et,"f")[t.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},d(this,et,"f")[t.index]=n,n)},zs=function(t){if(this.ended)return;const n=d(this,J,"m",la).call(this,t);this._emit("chunk",t,n);for(const r of t.choices){const a=n.choices[r.index];r.delta.content!=null&&a.message?.role==="assistant"&&a.message?.content&&(this._emit("content",r.delta.content,a.message.content),this._emit("content.delta",{delta:r.delta.content,snapshot:a.message.content,parsed:a.message.parsed})),r.delta.refusal!=null&&a.message?.role==="assistant"&&a.message?.refusal&&this._emit("refusal.delta",{delta:r.delta.refusal,snapshot:a.message.refusal}),r.logprobs?.content!=null&&a.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:r.logprobs?.content,snapshot:a.logprobs?.content??[]}),r.logprobs?.refusal!=null&&a.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:r.logprobs?.refusal,snapshot:a.logprobs?.refusal??[]});const o=d(this,J,"m",Qt).call(this,a);a.finish_reason&&(d(this,J,"m",Js).call(this,a),o.current_tool_call_index!=null&&d(this,J,"m",Vs).call(this,a,o.current_tool_call_index));for(const c of r.delta.tool_calls??[])o.current_tool_call_index!==c.index&&(d(this,J,"m",Js).call(this,a),o.current_tool_call_index!=null&&d(this,J,"m",Vs).call(this,a,o.current_tool_call_index)),o.current_tool_call_index=c.index;for(const c of r.delta.tool_calls??[]){const u=a.message.tool_calls?.[c.index];u?.type&&(u?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:u.function?.name,index:c.index,arguments:u.function.arguments,parsed_arguments:u.function.parsed_arguments,arguments_delta:c.function?.arguments??""}):(u?.type,void 0))}}},Vs=function(t,n){if(d(this,J,"m",Qt).call(this,t).done_tool_calls.has(n))return;const a=t.message.tool_calls?.[n];if(!a)throw new Error("no tool call snapshot");if(!a.type)throw new Error("tool call snapshot missing `type`");if(a.type==="function"){const o=d(this,Ie,"f")?.tools?.find(c=>ys(c)&&c.function.name===a.function.name);this._emit("tool_calls.function.arguments.done",{name:a.function.name,index:n,arguments:a.function.arguments,parsed_arguments:Pt(o)?o.$parseRaw(a.function.arguments):o?.function.strict?JSON.parse(a.function.arguments):null})}else a.type},Js=function(t){const n=d(this,J,"m",Qt).call(this,t);if(t.message.content&&!n.content_done){n.content_done=!0;const r=d(this,J,"m",Qs).call(this);this._emit("content.done",{content:t.message.content,parsed:r?r.$parseRaw(t.message.content):null})}t.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),t.logprobs?.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),t.logprobs?.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},Zt=function(){if(this.ended)throw new C("stream has ended, this shouldn't happen");const t=d(this,Oe,"f");if(!t)throw new C("request ended without sending any chunks");return I(this,Oe,void 0),I(this,et,[]),Nc(t,d(this,Ie,"f"))},Qs=function(){const t=d(this,Ie,"f")?.response_format;return An(t)?t:null},la=function(t){var n,r,a,o;let c=d(this,Oe,"f");const{choices:u,...f}=t;c?Object.assign(c,f):c=I(this,Oe,{...f,choices:[]});for(const{delta:b,finish_reason:p,index:g,logprobs:h=null,...S}of t.choices){let x=c.choices[g];if(x||(x=c.choices[g]={finish_reason:p,index:g,message:{},logprobs:h,...S}),h)if(!x.logprobs)x.logprobs=Object.assign({},h);else{const{content:q,refusal:k,...z}=h;Object.assign(x.logprobs,z),q&&((n=x.logprobs).content??(n.content=[]),x.logprobs.content.push(...q)),k&&((r=x.logprobs).refusal??(r.refusal=[]),x.logprobs.refusal.push(...k))}if(p&&(x.finish_reason=p,d(this,Ie,"f")&&ii(d(this,Ie,"f")))){if(p==="length")throw new Ha;if(p==="content_filter")throw new Ua}if(Object.assign(x,S),!b)continue;const{content:D,refusal:M,function_call:v,role:K,tool_calls:$,...Y}=b;if(Object.assign(x.message,Y),M&&(x.message.refusal=(x.message.refusal||"")+M),K&&(x.message.role=K),v&&(x.message.function_call?(v.name&&(x.message.function_call.name=v.name),v.arguments&&((a=x.message.function_call).arguments??(a.arguments=""),x.message.function_call.arguments+=v.arguments)):x.message.function_call=v),D&&(x.message.content=(x.message.content||"")+D,!x.message.refusal&&d(this,J,"m",Qs).call(this)&&(x.message.parsed=oa(x.message.content))),$){x.message.tool_calls||(x.message.tool_calls=[]);for(const{index:q,id:k,type:z,function:O,...U}of $){const L=(o=x.message.tool_calls)[q]??(o[q]={});Object.assign(L,U),k&&(L.id=k),z&&(L.type=z),O&&(L.function??(L.function={name:O.name??"",arguments:""})),O?.name&&(L.function.name=O.name),O?.arguments&&(L.function.arguments+=O.arguments,wc(d(this,Ie,"f"),L)&&(L.function.parsed_arguments=oa(L.function.arguments)))}}}return c},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",r=>{const a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{n=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),this.on("error",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,o)=>t.push({resolve:a,reject:o})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new _e(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function Nc(s,e){const{id:t,choices:n,created:r,model:a,system_fingerprint:o,...c}=s,u={...c,id:t,choices:n.map(({message:f,finish_reason:b,index:p,logprobs:g,...h})=>{if(!b)throw new C(`missing finish_reason for choice ${p}`);const{content:S=null,function_call:x,tool_calls:D,...M}=f,v=f.role;if(!v)throw new C(`missing role for choice ${p}`);if(x){const{arguments:K,name:$}=x;if(K==null)throw new C(`missing function_call.arguments for choice ${p}`);if(!$)throw new C(`missing function_call.name for choice ${p}`);return{...h,message:{content:S,function_call:{arguments:K,name:$},role:v,refusal:f.refusal??null},finish_reason:b,index:p,logprobs:g}}return D?{...h,index:p,finish_reason:b,logprobs:g,message:{...M,role:v,content:S,refusal:f.refusal??null,tool_calls:D.map((K,$)=>{const{function:Y,type:q,id:k,...z}=K,{arguments:O,name:U,...L}=Y||{};if(k==null)throw new C(`missing choices[${p}].tool_calls[${$}].id
${es(s)}`);if(q==null)throw new C(`missing choices[${p}].tool_calls[${$}].type
${es(s)}`);if(U==null)throw new C(`missing choices[${p}].tool_calls[${$}].function.name
${es(s)}`);if(O==null)throw new C(`missing choices[${p}].tool_calls[${$}].function.arguments
${es(s)}`);return{...z,id:k,type:q,function:{...L,name:U,arguments:O}}})}}:{...h,message:{...M,content:S,role:v,refusal:f.refusal??null},finish_reason:b,index:p,logprobs:g}}),created:r,model:a,object:"chat.completion",...o?{system_fingerprint:o}:{}};return gc(u,e)}function es(s){return JSON.stringify(s)}class vs extends Tt{static fromReadableStream(e){const t=new vs(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,n){const r=new vs(t),a={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,a)),r}}let Nn=class extends A{constructor(){super(...arguments),this.messages=new ai(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(m`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(m`/chat/completions/${e}`,{body:t,...n})}list(e={},t){return this._client.getAPIList("/chat/completions",X,{query:e,...t})}delete(e,t){return this._client.delete(m`/chat/completions/${e}`,t)}parse(e,t){return xc(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(n=>Cn(n,e))}runTools(e,t){return e.stream?vs.runTools(this._client,e,t):En.runTools(this._client,e,t)}stream(e,t){return Tt.createChatCompletion(this._client,e,t)}};Nn.Messages=ai;class kn extends A{constructor(){super(...arguments),this.completions=new Nn(this._client)}}kn.Completions=Nn;const Ii=Symbol("brand.privateNullableHeaders");function*kc(s){if(!s)return;if(Ii in s){const{values:n,nulls:r}=s;yield*n.entries();for(const a of r)yield[a,null];return}let e=!1,t;s instanceof Headers?t=s.entries():Wr(s)?t=s:(e=!0,t=Object.entries(s??{}));for(let n of t){const r=n[0];if(typeof r!="string")throw new TypeError("expected header name to be a string");const a=Wr(n[1])?n[1]:[n[1]];let o=!1;for(const c of a)c!==void 0&&(e&&!o&&(o=!0,yield[r,null]),yield[r,c])}}const w=s=>{const e=new Headers,t=new Set;for(const n of s){const r=new Set;for(const[a,o]of kc(n)){const c=a.toLowerCase();r.has(c)||(e.delete(a),r.add(c)),o===null?(e.delete(a),t.add(c)):(e.append(a,o),t.delete(c))}}return{[Ii]:!0,values:e,nulls:t}};class Ei extends A{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:w([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:!0})}}class Ni extends A{create(e,t){return this._client.post("/audio/transcriptions",Xe({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class ki extends A{create(e,t){return this._client.post("/audio/translations",Xe({body:e,...t,__metadata:{model:e.model}},this._client))}}class Dt extends A{constructor(){super(...arguments),this.transcriptions=new Ni(this._client),this.translations=new ki(this._client),this.speech=new Ei(this._client)}}Dt.Transcriptions=Ni;Dt.Translations=ki;Dt.Speech=Ei;class Ri extends A{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(m`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",X,{query:e,...t})}cancel(e,t){return this._client.post(m`/batches/${e}/cancel`,t)}}class Oi extends A{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:w([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(m`/assistants/${e}`,{...t,headers:w([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,n){return this._client.post(m`/assistants/${e}`,{body:t,...n,headers:w([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e={},t){return this._client.getAPIList("/assistants",X,{query:e,...t,headers:w([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(m`/assistants/${e}`,{...t,headers:w([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}let ji=class extends A{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:w([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}};class Ti extends A{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:w([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}let ks=class extends A{constructor(){super(...arguments),this.sessions=new ji(this._client),this.transcriptionSessions=new Ti(this._client)}};ks.Sessions=ji;ks.TranscriptionSessions=Ti;class $i extends A{create(e,t){return this._client.post("/chatkit/sessions",{body:e,...t,headers:w([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}cancel(e,t){return this._client.post(m`/chatkit/sessions/${e}/cancel`,{...t,headers:w([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}}let Mi=class extends A{retrieve(e,t){return this._client.get(m`/chatkit/threads/${e}`,{...t,headers:w([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}list(e={},t){return this._client.getAPIList("/chatkit/threads",gs,{query:e,...t,headers:w([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}delete(e,t){return this._client.delete(m`/chatkit/threads/${e}`,{...t,headers:w([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}listItems(e,t={},n){return this._client.getAPIList(m`/chatkit/threads/${e}/items`,gs,{query:t,...n,headers:w([{"OpenAI-Beta":"chatkit_beta=v1"},n?.headers])})}};class Rs extends A{constructor(){super(...arguments),this.sessions=new $i(this._client),this.threads=new Mi(this._client)}}Rs.Sessions=$i;Rs.Threads=Mi;class Pi extends A{create(e,t,n){return this._client.post(m`/threads/${e}/messages`,{body:t,...n,headers:w([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,t,n){const{thread_id:r}=t;return this._client.get(m`/threads/${r}/messages/${e}`,{...n,headers:w([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,t,n){const{thread_id:r,...a}=t;return this._client.post(m`/threads/${r}/messages/${e}`,{body:a,...n,headers:w([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,t={},n){return this._client.getAPIList(m`/threads/${e}/messages`,X,{query:t,...n,headers:w([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,t,n){const{thread_id:r}=t;return this._client.delete(m`/threads/${r}/messages/${e}`,{...n,headers:w([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}class Di extends A{retrieve(e,t,n){const{thread_id:r,run_id:a,...o}=t;return this._client.get(m`/threads/${r}/runs/${a}/steps/${e}`,{query:o,...n,headers:w([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,t,n){const{thread_id:r,...a}=t;return this._client.getAPIList(m`/threads/${r}/runs/${e}/steps`,X,{query:a,...n,headers:w([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}const Rc=s=>{if(typeof Buffer<"u"){const e=Buffer.from(s,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{const e=atob(s),t=e.length,n=new Uint8Array(t);for(let r=0;r<t;r++)n[r]=e.charCodeAt(r);return Array.from(new Float32Array(n.buffer))}};var Oc={};const tt=s=>{if(typeof globalThis.process<"u")return Oc?.[s]?.trim()??void 0;if(typeof globalThis.Deno<"u")return globalThis.Deno.env?.get?.(s)?.trim()};var re,Ke,fn,xe,ds,ye,qe,ot,Ge,Ss,pe,us,hs,kt,St,At,ca,da,ua,ha,fa,pa,ma;class Rt extends In{constructor(){super(...arguments),re.add(this),fn.set(this,[]),xe.set(this,{}),ds.set(this,{}),ye.set(this,void 0),qe.set(this,void 0),ot.set(this,void 0),Ge.set(this,void 0),Ss.set(this,void 0),pe.set(this,void 0),us.set(this,void 0),hs.set(this,void 0),kt.set(this,void 0)}[(fn=new WeakMap,xe=new WeakMap,ds=new WeakMap,ye=new WeakMap,qe=new WeakMap,ot=new WeakMap,Ge=new WeakMap,Ss=new WeakMap,pe=new WeakMap,us=new WeakMap,hs=new WeakMap,kt=new WeakMap,re=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",r=>{const a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{n=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),this.on("error",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,o)=>t.push({resolve:a,reject:o})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new Ke;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){const n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();const r=_e.fromReadableStream(e,this.controller);for await(const a of r)d(this,re,"m",St).call(this,a);if(r.controller.signal?.aborted)throw new me;return this._addRun(d(this,re,"m",At).call(this))}toReadableStream(){return new _e(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,r){const a=new Ke;return a._run(()=>a._runToolAssistantStream(e,t,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,n,r){const a=r?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o={...n,stream:!0},c=await e.submitToolOutputs(t,o,{...r,signal:this.controller.signal});this._connected();for await(const u of c)d(this,re,"m",St).call(this,u);if(c.controller.signal?.aborted)throw new me;return this._addRun(d(this,re,"m",At).call(this))}static createThreadAssistantStream(e,t,n){const r=new Ke;return r._run(()=>r._threadAssistantStream(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}static createAssistantStream(e,t,n,r){const a=new Ke;return a._run(()=>a._runAssistantStream(e,t,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return d(this,us,"f")}currentRun(){return d(this,hs,"f")}currentMessageSnapshot(){return d(this,ye,"f")}currentRunStepSnapshot(){return d(this,kt,"f")}async finalRunSteps(){return await this.done(),Object.values(d(this,xe,"f"))}async finalMessages(){return await this.done(),Object.values(d(this,ds,"f"))}async finalRun(){if(await this.done(),!d(this,qe,"f"))throw Error("Final run was not received.");return d(this,qe,"f")}async _createThreadAssistantStream(e,t,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));const a={...t,stream:!0},o=await e.createAndRun(a,{...n,signal:this.controller.signal});this._connected();for await(const c of o)d(this,re,"m",St).call(this,c);if(o.controller.signal?.aborted)throw new me;return this._addRun(d(this,re,"m",At).call(this))}async _createAssistantStream(e,t,n,r){const a=r?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o={...n,stream:!0},c=await e.create(t,o,{...r,signal:this.controller.signal});this._connected();for await(const u of c)d(this,re,"m",St).call(this,u);if(c.controller.signal?.aborted)throw new me;return this._addRun(d(this,re,"m",At).call(this))}static accumulateDelta(e,t){for(const[n,r]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=r;continue}let a=e[n];if(a==null){e[n]=r;continue}if(n==="index"||n==="type"){e[n]=r;continue}if(typeof a=="string"&&typeof r=="string")a+=r;else if(typeof a=="number"&&typeof r=="number")a+=r;else if(qs(a)&&qs(r))a=this.accumulateDelta(a,r);else if(Array.isArray(a)&&Array.isArray(r)){if(a.every(o=>typeof o=="string"||typeof o=="number")){a.push(...r);continue}for(const o of r){if(!qs(o))throw new Error(`Expected array delta entry to be an object but got: ${o}`);const c=o.index;if(c==null)throw console.error(o),new Error("Expected array delta entry to have an `index` property");if(typeof c!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${c}`);const u=a[c];u==null?a.push(o):a[c]=this.accumulateDelta(u,o)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${r}, accValue: ${a}`);e[n]=a}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,r){return await this._createAssistantStream(t,e,n,r)}async _runToolAssistantStream(e,t,n,r){return await this._createToolAssistantStream(t,e,n,r)}}Ke=Rt,St=function(e){if(!this.ended)switch(I(this,us,e),d(this,re,"m",ua).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":d(this,re,"m",ma).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":d(this,re,"m",da).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":d(this,re,"m",ca).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},At=function(){if(this.ended)throw new C("stream has ended, this shouldn't happen");if(!d(this,qe,"f"))throw Error("Final run has not been received");return d(this,qe,"f")},ca=function(e){const[t,n]=d(this,re,"m",fa).call(this,e,d(this,ye,"f"));I(this,ye,t),d(this,ds,"f")[t.id]=t;for(const r of n){const a=t.content[r.index];a?.type=="text"&&this._emit("textCreated",a.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const r of e.data.delta.content){if(r.type=="text"&&r.text){let a=r.text,o=t.content[r.index];if(o&&o.type=="text")this._emit("textDelta",a,o.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(r.index!=d(this,ot,"f")){if(d(this,Ge,"f"))switch(d(this,Ge,"f").type){case"text":this._emit("textDone",d(this,Ge,"f").text,d(this,ye,"f"));break;case"image_file":this._emit("imageFileDone",d(this,Ge,"f").image_file,d(this,ye,"f"));break}I(this,ot,r.index)}I(this,Ge,t.content[r.index])}break;case"thread.message.completed":case"thread.message.incomplete":if(d(this,ot,"f")!==void 0){const r=e.data.content[d(this,ot,"f")];if(r)switch(r.type){case"image_file":this._emit("imageFileDone",r.image_file,d(this,ye,"f"));break;case"text":this._emit("textDone",r.text,d(this,ye,"f"));break}}d(this,ye,"f")&&this._emit("messageDone",e.data),I(this,ye,void 0)}},da=function(e){const t=d(this,re,"m",ha).call(this,e);switch(I(this,kt,t),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const a of n.step_details.tool_calls)a.index==d(this,Ss,"f")?this._emit("toolCallDelta",a,t.step_details.tool_calls[a.index]):(d(this,pe,"f")&&this._emit("toolCallDone",d(this,pe,"f")),I(this,Ss,a.index),I(this,pe,t.step_details.tool_calls[a.index]),d(this,pe,"f")&&this._emit("toolCallCreated",d(this,pe,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":I(this,kt,void 0),e.data.step_details.type=="tool_calls"&&d(this,pe,"f")&&(this._emit("toolCallDone",d(this,pe,"f")),I(this,pe,void 0)),this._emit("runStepDone",e.data,t);break}},ua=function(e){d(this,fn,"f").push(e),this._emit("event",e)},ha=function(e){switch(e.event){case"thread.run.step.created":return d(this,xe,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=d(this,xe,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const r=Ke.accumulateDelta(t,n.delta);d(this,xe,"f")[e.data.id]=r}return d(this,xe,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":d(this,xe,"f")[e.data.id]=e.data;break}if(d(this,xe,"f")[e.data.id])return d(this,xe,"f")[e.data.id];throw new Error("No snapshot available")},fa=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let r=e.data;if(r.delta.content)for(const a of r.delta.content)if(a.index in t.content){let o=t.content[a.index];t.content[a.index]=d(this,re,"m",pa).call(this,a,o)}else t.content[a.index]=a,n.push(a);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},pa=function(e,t){return Ke.accumulateDelta(t,e)},ma=function(e){switch(I(this,hs,e.data),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":I(this,qe,e.data),d(this,pe,"f")&&(this._emit("toolCallDone",d(this,pe,"f")),I(this,pe,void 0));break}};let Rn=class extends A{constructor(){super(...arguments),this.steps=new Di(this._client)}create(e,t,n){const{include:r,...a}=t;return this._client.post(m`/threads/${e}/runs`,{query:{include:r},body:a,...n,headers:w([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:t.stream??!1})}retrieve(e,t,n){const{thread_id:r}=t;return this._client.get(m`/threads/${r}/runs/${e}`,{...n,headers:w([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,t,n){const{thread_id:r,...a}=t;return this._client.post(m`/threads/${r}/runs/${e}`,{body:a,...n,headers:w([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,t={},n){return this._client.getAPIList(m`/threads/${e}/runs`,X,{query:t,...n,headers:w([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(e,t,n){const{thread_id:r}=t;return this._client.post(m`/threads/${r}/runs/${e}/cancel`,{...n,headers:w([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(r.id,{thread_id:e},n)}createAndStream(e,t,n){return Rt.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){const r=w([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){const{data:a,response:o}=await this.retrieve(e,t,{...n,headers:{...n?.headers,...r}}).withResponse();switch(a.status){case"queued":case"in_progress":case"cancelling":let c=5e3;if(n?.pollIntervalMs)c=n.pollIntervalMs;else{const u=o.headers.get("openai-poll-after-ms");if(u){const f=parseInt(u);isNaN(f)||(c=f)}}await Mt(c);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return a}}}stream(e,t,n){return Rt.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n){const{thread_id:r,...a}=t;return this._client.post(m`/threads/${r}/runs/${e}/submit_tool_outputs`,{body:a,...n,headers:w([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,n){const r=await this.submitToolOutputs(e,t,n);return await this.poll(r.id,t,n)}submitToolOutputsStream(e,t,n){return Rt.createToolAssistantStream(e,this._client.beta.threads.runs,t,n)}};Rn.Steps=Di;class Os extends A{constructor(){super(...arguments),this.runs=new Rn(this._client),this.messages=new Pi(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:w([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(m`/threads/${e}`,{...t,headers:w([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,n){return this._client.post(m`/threads/${e}`,{body:t,...n,headers:w([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,t){return this._client.delete(m`/threads/${e}`,{...t,headers:w([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:w([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.id,{thread_id:n.thread_id},t)}createAndRunStream(e,t){return Rt.createThreadAssistantStream(e,this._client.beta.threads,t)}}Os.Runs=Rn;Os.Messages=Pi;class lt extends A{constructor(){super(...arguments),this.realtime=new ks(this._client),this.chatkit=new Rs(this._client),this.assistants=new Oi(this._client),this.threads=new Os(this._client)}}lt.Realtime=ks;lt.ChatKit=Rs;lt.Assistants=Oi;lt.Threads=Os;class Li extends A{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class Fi extends A{retrieve(e,t,n){const{container_id:r}=t;return this._client.get(m`/containers/${r}/files/${e}/content`,{...n,headers:w([{Accept:"application/binary"},n?.headers]),__binaryResponse:!0})}}let On=class extends A{constructor(){super(...arguments),this.content=new Fi(this._client)}create(e,t,n){return this._client.post(m`/containers/${e}/files`,Xe({body:t,...n},this._client))}retrieve(e,t,n){const{container_id:r}=t;return this._client.get(m`/containers/${r}/files/${e}`,n)}list(e,t={},n){return this._client.getAPIList(m`/containers/${e}/files`,X,{query:t,...n})}delete(e,t,n){const{container_id:r}=t;return this._client.delete(m`/containers/${r}/files/${e}`,{...n,headers:w([{Accept:"*/*"},n?.headers])})}};On.Content=Fi;class jn extends A{constructor(){super(...arguments),this.files=new On(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(m`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",X,{query:e,...t})}delete(e,t){return this._client.delete(m`/containers/${e}`,{...t,headers:w([{Accept:"*/*"},t?.headers])})}}jn.Files=On;class Bi extends A{create(e,t,n){const{include:r,...a}=t;return this._client.post(m`/conversations/${e}/items`,{query:{include:r},body:a,...n})}retrieve(e,t,n){const{conversation_id:r,...a}=t;return this._client.get(m`/conversations/${r}/items/${e}`,{query:a,...n})}list(e,t={},n){return this._client.getAPIList(m`/conversations/${e}/items`,gs,{query:t,...n})}delete(e,t,n){const{conversation_id:r}=t;return this._client.delete(m`/conversations/${r}/items/${e}`,n)}}class Tn extends A{constructor(){super(...arguments),this.items=new Bi(this._client)}create(e={},t){return this._client.post("/conversations",{body:e,...t})}retrieve(e,t){return this._client.get(m`/conversations/${e}`,t)}update(e,t,n){return this._client.post(m`/conversations/${e}`,{body:t,...n})}delete(e,t){return this._client.delete(m`/conversations/${e}`,t)}}Tn.Items=Bi;class Hi extends A{create(e,t){const n=!!e.encoding_format;let r=n?e.encoding_format:"base64";n&&ne(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);const a=this._client.post("/embeddings",{body:{...e,encoding_format:r},...t});return n?a:(ne(this._client).debug("embeddings/decoding base64 embeddings from base64"),a._thenUnwrap(o=>(o&&o.data&&o.data.forEach(c=>{const u=c.embedding;c.embedding=Rc(u)}),o)))}}class Ui extends A{retrieve(e,t,n){const{eval_id:r,run_id:a}=t;return this._client.get(m`/evals/${r}/runs/${a}/output_items/${e}`,n)}list(e,t,n){const{eval_id:r,...a}=t;return this._client.getAPIList(m`/evals/${r}/runs/${e}/output_items`,X,{query:a,...n})}}class $n extends A{constructor(){super(...arguments),this.outputItems=new Ui(this._client)}create(e,t,n){return this._client.post(m`/evals/${e}/runs`,{body:t,...n})}retrieve(e,t,n){const{eval_id:r}=t;return this._client.get(m`/evals/${r}/runs/${e}`,n)}list(e,t={},n){return this._client.getAPIList(m`/evals/${e}/runs`,X,{query:t,...n})}delete(e,t,n){const{eval_id:r}=t;return this._client.delete(m`/evals/${r}/runs/${e}`,n)}cancel(e,t,n){const{eval_id:r}=t;return this._client.post(m`/evals/${r}/runs/${e}`,n)}}$n.OutputItems=Ui;class Mn extends A{constructor(){super(...arguments),this.runs=new $n(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(m`/evals/${e}`,t)}update(e,t,n){return this._client.post(m`/evals/${e}`,{body:t,...n})}list(e={},t){return this._client.getAPIList("/evals",X,{query:e,...t})}delete(e,t){return this._client.delete(m`/evals/${e}`,t)}}Mn.Runs=$n;let Gi=class extends A{create(e,t){return this._client.post("/files",Xe({body:e,...t},this._client))}retrieve(e,t){return this._client.get(m`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",X,{query:e,...t})}delete(e,t){return this._client.delete(m`/files/${e}`,t)}content(e,t){return this._client.get(m`/files/${e}/content`,{...t,headers:w([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=1800*1e3}={}){const r=new Set(["processed","error","deleted"]),a=Date.now();let o=await this.retrieve(e);for(;!o.status||!r.has(o.status);)if(await Mt(t),o=await this.retrieve(e),Date.now()-a>n)throw new xn({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return o}};class Ki extends A{}let qi=class extends A{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};class Pn extends A{constructor(){super(...arguments),this.graders=new qi(this._client)}}Pn.Graders=qi;class Wi extends A{create(e,t,n){return this._client.getAPIList(m`/fine_tuning/checkpoints/${e}/permissions`,Ns,{body:t,method:"post",...n})}retrieve(e,t={},n){return this._client.get(m`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...n})}delete(e,t,n){const{fine_tuned_model_checkpoint:r}=t;return this._client.delete(m`/fine_tuning/checkpoints/${r}/permissions/${e}`,n)}}let Dn=class extends A{constructor(){super(...arguments),this.permissions=new Wi(this._client)}};Dn.Permissions=Wi;class Xi extends A{list(e,t={},n){return this._client.getAPIList(m`/fine_tuning/jobs/${e}/checkpoints`,X,{query:t,...n})}}class Ln extends A{constructor(){super(...arguments),this.checkpoints=new Xi(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(m`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",X,{query:e,...t})}cancel(e,t){return this._client.post(m`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return this._client.getAPIList(m`/fine_tuning/jobs/${e}/events`,X,{query:t,...n})}pause(e,t){return this._client.post(m`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(m`/fine_tuning/jobs/${e}/resume`,t)}}Ln.Checkpoints=Xi;class ct extends A{constructor(){super(...arguments),this.methods=new Ki(this._client),this.jobs=new Ln(this._client),this.checkpoints=new Dn(this._client),this.alpha=new Pn(this._client)}}ct.Methods=Ki;ct.Jobs=Ln;ct.Checkpoints=Dn;ct.Alpha=Pn;class Yi extends A{}class Fn extends A{constructor(){super(...arguments),this.graderModels=new Yi(this._client)}}Fn.GraderModels=Yi;class zi extends A{createVariation(e,t){return this._client.post("/images/variations",Xe({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",Xe({body:e,...t,stream:e.stream??!1},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t,stream:e.stream??!1})}}class Vi extends A{retrieve(e,t){return this._client.get(m`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Ns,e)}delete(e,t){return this._client.delete(m`/models/${e}`,t)}}class Ji extends A{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class Qi extends A{accept(e,t,n){return this._client.post(m`/realtime/calls/${e}/accept`,{body:t,...n,headers:w([{Accept:"*/*"},n?.headers])})}hangup(e,t){return this._client.post(m`/realtime/calls/${e}/hangup`,{...t,headers:w([{Accept:"*/*"},t?.headers])})}refer(e,t,n){return this._client.post(m`/realtime/calls/${e}/refer`,{body:t,...n,headers:w([{Accept:"*/*"},n?.headers])})}reject(e,t={},n){return this._client.post(m`/realtime/calls/${e}/reject`,{body:t,...n,headers:w([{Accept:"*/*"},n?.headers])})}}class Zi extends A{create(e,t){return this._client.post("/realtime/client_secrets",{body:e,...t})}}class js extends A{constructor(){super(...arguments),this.clientSecrets=new Zi(this._client),this.calls=new Qi(this._client)}}js.ClientSecrets=Zi;js.Calls=Qi;function jc(s,e){return!e||!$c(e)?{...s,output_parsed:null,output:s.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(n=>({...n,parsed:null}))}:t)}:eo(s,e)}function eo(s,e){const t=s.output.map(r=>{if(r.type==="function_call")return{...r,parsed_arguments:Dc(e,r)};if(r.type==="message"){const a=r.content.map(o=>o.type==="output_text"?{...o,parsed:Tc(e,o.text)}:o);return{...r,content:a}}return r}),n=Object.assign({},s,{output:t});return Object.getOwnPropertyDescriptor(s,"output_text")||pn(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(const r of n.output)if(r.type==="message"){for(const a of r.content)if(a.type==="output_text"&&a.parsed!==null)return a.parsed}return null}}),n}function Tc(s,e){return s.text?.format?.type!=="json_schema"?null:"$parseRaw"in s.text?.format?(s.text?.format).$parseRaw(e):JSON.parse(e)}function $c(s){return!!An(s.text?.format)}function Mc(s){return s?.$brand==="auto-parseable-tool"}function Pc(s,e){return s.find(t=>t.type==="function"&&t.name===e)}function Dc(s,e){const t=Pc(s.tools??[],e.name);return{...e,...e,parsed_arguments:Mc(t)?t.$parseRaw(e.arguments):t?.strict?JSON.parse(e.arguments):null}}function pn(s){const e=[];for(const t of s.output)if(t.type==="message")for(const n of t.content)n.type==="output_text"&&e.push(n.text);s.output_text=e.join("")}var st,ts,je,ss,ga,ya,ba,wa;class Bn extends In{constructor(e){super(),st.add(this),ts.set(this,void 0),je.set(this,void 0),ss.set(this,void 0),I(this,ts,e)}static createResponse(e,t,n){const r=new Bn(t);return r._run(()=>r._createOrRetrieveResponse(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createOrRetrieveResponse(e,t,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),d(this,st,"m",ga).call(this);let a,o=null;"response_id"in t?(a=await e.responses.retrieve(t.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),o=t.starting_after??null):a=await e.responses.create({...t,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(const c of a)d(this,st,"m",ya).call(this,c,o);if(a.controller.signal?.aborted)throw new me;return d(this,st,"m",ba).call(this)}[(ts=new WeakMap,je=new WeakMap,ss=new WeakMap,st=new WeakSet,ga=function(){this.ended||I(this,je,void 0)},ya=function(t,n){if(this.ended)return;const r=(o,c)=>{(n==null||c.sequence_number>n)&&this._emit(o,c)},a=d(this,st,"m",wa).call(this,t);switch(r("event",t),t.type){case"response.output_text.delta":{const o=a.output[t.output_index];if(!o)throw new C(`missing output at index ${t.output_index}`);if(o.type==="message"){const c=o.content[t.content_index];if(!c)throw new C(`missing content at index ${t.content_index}`);if(c.type!=="output_text")throw new C(`expected content to be 'output_text', got ${c.type}`);r("response.output_text.delta",{...t,snapshot:c.text})}break}case"response.function_call_arguments.delta":{const o=a.output[t.output_index];if(!o)throw new C(`missing output at index ${t.output_index}`);o.type==="function_call"&&r("response.function_call_arguments.delta",{...t,snapshot:o.arguments});break}default:r(t.type,t);break}},ba=function(){if(this.ended)throw new C("stream has ended, this shouldn't happen");const t=d(this,je,"f");if(!t)throw new C("request ended without sending any events");I(this,je,void 0);const n=Lc(t,d(this,ts,"f"));return I(this,ss,n),n},wa=function(t){let n=d(this,je,"f");if(!n){if(t.type!=="response.created")throw new C(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return n=I(this,je,t.response),n}switch(t.type){case"response.output_item.added":{n.output.push(t.item);break}case"response.content_part.added":{const r=n.output[t.output_index];if(!r)throw new C(`missing output at index ${t.output_index}`);const a=r.type,o=t.part;a==="message"&&o.type!=="reasoning_text"?r.content.push(o):a==="reasoning"&&o.type==="reasoning_text"&&(r.content||(r.content=[]),r.content.push(o));break}case"response.output_text.delta":{const r=n.output[t.output_index];if(!r)throw new C(`missing output at index ${t.output_index}`);if(r.type==="message"){const a=r.content[t.content_index];if(!a)throw new C(`missing content at index ${t.content_index}`);if(a.type!=="output_text")throw new C(`expected content to be 'output_text', got ${a.type}`);a.text+=t.delta}break}case"response.function_call_arguments.delta":{const r=n.output[t.output_index];if(!r)throw new C(`missing output at index ${t.output_index}`);r.type==="function_call"&&(r.arguments+=t.delta);break}case"response.reasoning_text.delta":{const r=n.output[t.output_index];if(!r)throw new C(`missing output at index ${t.output_index}`);if(r.type==="reasoning"){const a=r.content?.[t.content_index];if(!a)throw new C(`missing content at index ${t.content_index}`);if(a.type!=="reasoning_text")throw new C(`expected content to be 'reasoning_text', got ${a.type}`);a.text+=t.delta}break}case"response.completed":{I(this,je,t.response);break}}return n},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",r=>{const a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{n=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),this.on("error",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,o)=>t.push({resolve:a,reject:o})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=d(this,ss,"f");if(!e)throw new C("stream ended without producing a ChatCompletion");return e}}function Lc(s,e){return jc(s,e)}class to extends A{list(e,t={},n){return this._client.getAPIList(m`/responses/${e}/input_items`,X,{query:t,...n})}}class so extends A{count(e={},t){return this._client.post("/responses/input_tokens",{body:e,...t})}}class Ts extends A{constructor(){super(...arguments),this.inputItems=new to(this._client),this.inputTokens=new so(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&pn(n),n))}retrieve(e,t={},n){return this._client.get(m`/responses/${e}`,{query:t,...n,stream:t?.stream??!1})._thenUnwrap(r=>("object"in r&&r.object==="response"&&pn(r),r))}delete(e,t){return this._client.delete(m`/responses/${e}`,{...t,headers:w([{Accept:"*/*"},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(n=>eo(n,e))}stream(e,t){return Bn.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(m`/responses/${e}/cancel`,t)}}Ts.InputItems=to;Ts.InputTokens=so;class no extends A{create(e,t,n){return this._client.post(m`/uploads/${e}/parts`,Xe({body:t,...n},this._client))}}class Hn extends A{constructor(){super(...arguments),this.parts=new no(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(m`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(m`/uploads/${e}/complete`,{body:t,...n})}}Hn.Parts=no;const Fc=async s=>{const e=await Promise.allSettled(s),t=e.filter(r=>r.status==="rejected");if(t.length){for(const r of t)console.error(r.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const n=[];for(const r of e)r.status==="fulfilled"&&n.push(r.value);return n};class ro extends A{create(e,t,n){return this._client.post(m`/vector_stores/${e}/file_batches`,{body:t,...n,headers:w([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,t,n){const{vector_store_id:r}=t;return this._client.get(m`/vector_stores/${r}/file_batches/${e}`,{...n,headers:w([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(e,t,n){const{vector_store_id:r}=t;return this._client.post(m`/vector_stores/${r}/file_batches/${e}/cancel`,{...n,headers:w([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,t,n){const r=await this.create(e,t);return await this.poll(e,r.id,n)}listFiles(e,t,n){const{vector_store_id:r,...a}=t;return this._client.getAPIList(m`/vector_stores/${r}/file_batches/${e}/files`,X,{query:a,...n,headers:w([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async poll(e,t,n){const r=w([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){const{data:a,response:o}=await this.retrieve(t,{vector_store_id:e},{...n,headers:r}).withResponse();switch(a.status){case"in_progress":let c=5e3;if(n?.pollIntervalMs)c=n.pollIntervalMs;else{const u=o.headers.get("openai-poll-after-ms");if(u){const f=parseInt(u);isNaN(f)||(c=f)}}await Mt(c);break;case"failed":case"cancelled":case"completed":return a}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},r){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const a=r?.maxConcurrency??5,o=Math.min(a,t.length),c=this._client,u=t.values(),f=[...n];async function b(g){for(let h of g){const S=await c.files.create({file:h,purpose:"assistants"},r);f.push(S.id)}}const p=Array(o).fill(u).map(b);return await Fc(p),await this.createAndPoll(e,{file_ids:f})}}class ao extends A{create(e,t,n){return this._client.post(m`/vector_stores/${e}/files`,{body:t,...n,headers:w([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,t,n){const{vector_store_id:r}=t;return this._client.get(m`/vector_stores/${r}/files/${e}`,{...n,headers:w([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,t,n){const{vector_store_id:r,...a}=t;return this._client.post(m`/vector_stores/${r}/files/${e}`,{body:a,...n,headers:w([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,t={},n){return this._client.getAPIList(m`/vector_stores/${e}/files`,X,{query:t,...n,headers:w([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,t,n){const{vector_store_id:r}=t;return this._client.delete(m`/vector_stores/${r}/files/${e}`,{...n,headers:w([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}async poll(e,t,n){const r=w([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){const a=await this.retrieve(t,{vector_store_id:e},{...n,headers:r}).withResponse(),o=a.data;switch(o.status){case"in_progress":let c=5e3;if(n?.pollIntervalMs)c=n.pollIntervalMs;else{const u=a.response.headers.get("openai-poll-after-ms");if(u){const f=parseInt(u);isNaN(f)||(c=f)}}await Mt(c);break;case"failed":case"completed":return o}}}async upload(e,t,n){const r=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:r.id},n)}async uploadAndPoll(e,t,n){const r=await this.upload(e,t,n);return await this.poll(e,r.id,n)}content(e,t,n){const{vector_store_id:r}=t;return this._client.getAPIList(m`/vector_stores/${r}/files/${e}/content`,Ns,{...n,headers:w([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}class $s extends A{constructor(){super(...arguments),this.files=new ao(this._client),this.fileBatches=new ro(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:w([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(m`/vector_stores/${e}`,{...t,headers:w([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,n){return this._client.post(m`/vector_stores/${e}`,{body:t,...n,headers:w([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",X,{query:e,...t,headers:w([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(m`/vector_stores/${e}`,{...t,headers:w([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}search(e,t,n){return this._client.getAPIList(m`/vector_stores/${e}/search`,Ns,{body:t,method:"post",...n,headers:w([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}$s.Files=ao;$s.FileBatches=ro;class io extends A{create(e,t){return this._client.post("/videos",ra({body:e,...t},this._client))}retrieve(e,t){return this._client.get(m`/videos/${e}`,t)}list(e={},t){return this._client.getAPIList("/videos",gs,{query:e,...t})}delete(e,t){return this._client.delete(m`/videos/${e}`,t)}downloadContent(e,t={},n){return this._client.get(m`/videos/${e}/content`,{query:t,...n,headers:w([{Accept:"application/binary"},n?.headers]),__binaryResponse:!0})}remix(e,t,n){return this._client.post(m`/videos/${e}/remix`,ra({body:t,...n},this._client))}}var it,oo,fs;class lo extends A{constructor(){super(...arguments),it.add(this)}async unwrap(e,t,n=this._client.webhookSecret,r=300){return await this.verifySignature(e,t,n,r),JSON.parse(e)}async verifySignature(e,t,n=this._client.webhookSecret,r=300){if(typeof crypto>"u"||typeof crypto.subtle.importKey!="function"||typeof crypto.subtle.verify!="function")throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");d(this,it,"m",oo).call(this,n);const a=w([t]).values,o=d(this,it,"m",fs).call(this,a,"webhook-signature"),c=d(this,it,"m",fs).call(this,a,"webhook-timestamp"),u=d(this,it,"m",fs).call(this,a,"webhook-id"),f=parseInt(c,10);if(isNaN(f))throw new gt("Invalid webhook timestamp format");const b=Math.floor(Date.now()/1e3);if(b-f>r)throw new gt("Webhook timestamp is too old");if(f>b+r)throw new gt("Webhook timestamp is too new");const p=o.split(" ").map(x=>x.startsWith("v1,")?x.substring(3):x),g=n.startsWith("whsec_")?Buffer.from(n.replace("whsec_",""),"base64"):Buffer.from(n,"utf-8"),h=u?`${u}.${c}.${e}`:`${c}.${e}`,S=await crypto.subtle.importKey("raw",g,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(const x of p)try{const D=Buffer.from(x,"base64");if(await crypto.subtle.verify("HMAC",S,D,new TextEncoder().encode(h)))return}catch{continue}throw new gt("The given webhook signature does not match the expected signature")}}it=new WeakSet,oo=function(e){if(typeof e!="string"||e.length===0)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},fs=function(e,t){if(!e)throw new Error("Headers are required");const n=e.get(t);if(n==null)throw new Error(`Missing required header: ${t}`);return n};var mn,Un,ps,co;class N{constructor({baseURL:e=tt("OPENAI_BASE_URL"),apiKey:t=tt("OPENAI_API_KEY"),organization:n=tt("OPENAI_ORG_ID")??null,project:r=tt("OPENAI_PROJECT_ID")??null,webhookSecret:a=tt("OPENAI_WEBHOOK_SECRET")??null,...o}={}){if(mn.add(this),ps.set(this,void 0),this.completions=new Li(this),this.chat=new kn(this),this.embeddings=new Hi(this),this.files=new Gi(this),this.images=new zi(this),this.audio=new Dt(this),this.moderations=new Ji(this),this.models=new Vi(this),this.fineTuning=new ct(this),this.graders=new Fn(this),this.vectorStores=new $s(this),this.webhooks=new lo(this),this.beta=new lt(this),this.batches=new Ri(this),this.uploads=new Hn(this),this.responses=new Ts(this),this.realtime=new js(this),this.conversations=new Tn(this),this.evals=new Mn(this),this.containers=new jn(this),this.videos=new io(this),t===void 0)throw new C("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");const c={apiKey:t,organization:n,project:r,webhookSecret:a,...o,baseURL:e||"https://api.openai.com/v1"};if(!c.dangerouslyAllowBrowser&&Bl())throw new C(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);this.baseURL=c.baseURL,this.timeout=c.timeout??Un.DEFAULT_TIMEOUT,this.logger=c.logger??console;const u="warn";this.logLevel=u,this.logLevel=sa(c.logLevel,"ClientOptions.logLevel",this)??sa(tt("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??u,this.fetchOptions=c.fetchOptions,this.maxRetries=c.maxRetries??2,this.fetch=c.fetch??ql(),I(this,ps,Xl),this._options=c,this.apiKey=typeof t=="string"?t:"Missing Key",this.organization=n,this.project=r,this.webhookSecret=a}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}async authHeaders(e){return w([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return Zl(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${rt}`}defaultIdempotencyKey(){return`stainless-node-retry-${ja()}`}makeStatusError(e,t,n,r){return ae.generate(e,t,n,r)}async _callApiKey(){const e=this._options.apiKey;if(typeof e!="function")return!1;let t;try{t=await e()}catch(n){throw n instanceof C?n:new C(`Failed to get token from 'apiKey' function: ${n.message}`,{cause:n})}if(typeof t!="string"||!t)throw new C(`Expected 'apiKey' function argument to return a string but it returned ${t}`);return this.apiKey=t,!0}buildURL(e,t,n){const r=!d(this,mn,"m",co).call(this)&&n||this.baseURL,a=Ml(e)?new URL(e):new URL(r+(r.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),o=this.defaultQuery();return Pl(o)||(t={...o,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(a.search=this.stringifyQuery(t)),a.toString()}async prepareOptions(e){await this._callApiKey()}async prepareRequest(e,{url:t,options:n}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(r=>({method:e,path:t,...r})))}request(e,t=null){return new Es(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){const r=await e,a=r.maxRetries??this.maxRetries;t==null&&(t=a),await this.prepareOptions(r);const{req:o,url:c,timeout:u}=await this.buildRequest(r,{retryCount:a-t});await this.prepareRequest(o,{url:c,options:r});const f="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),b=n===void 0?"":`, retryOf: ${n}`,p=Date.now();if(ne(this).debug(`[${f}] sending request`,Ue({retryOfRequestLogID:n,method:r.method,url:c,options:r,headers:o.headers})),r.signal?.aborted)throw new me;const g=new AbortController,h=await this.fetchWithTimeout(c,o,u,g).catch(sn),S=Date.now();if(h instanceof globalThis.Error){const M=`retrying, ${t} attempts remaining`;if(r.signal?.aborted)throw new me;const v=tn(h)||/timed? ?out/i.test(String(h)+("cause"in h?String(h.cause):""));if(t)return ne(this).info(`[${f}] connection ${v?"timed out":"failed"} - ${M}`),ne(this).debug(`[${f}] connection ${v?"timed out":"failed"} (${M})`,Ue({retryOfRequestLogID:n,url:c,durationMs:S-p,message:h.message})),this.retryRequest(r,t,n??f);throw ne(this).info(`[${f}] connection ${v?"timed out":"failed"} - error; no more retries left`),ne(this).debug(`[${f}] connection ${v?"timed out":"failed"} (error; no more retries left)`,Ue({retryOfRequestLogID:n,url:c,durationMs:S-p,message:h.message})),v?new xn:new Cs({cause:h})}const x=[...h.headers.entries()].filter(([M])=>M==="x-request-id").map(([M,v])=>", "+M+": "+JSON.stringify(v)).join(""),D=`[${f}${b}${x}] ${o.method} ${c} ${h.ok?"succeeded":"failed"} with status ${h.status} in ${S-p}ms`;if(!h.ok){const M=await this.shouldRetry(h);if(t&&M){const k=`retrying, ${t} attempts remaining`;return await Wl(h.body),ne(this).info(`${D} - ${k}`),ne(this).debug(`[${f}] response error (${k})`,Ue({retryOfRequestLogID:n,url:h.url,status:h.status,headers:h.headers,durationMs:S-p})),this.retryRequest(r,t,n??f,h.headers)}const v=M?"error; no more retries left":"error; not retryable";ne(this).info(`${D} - ${v}`);const K=await h.text().catch(k=>sn(k).message),$=Fl(K),Y=$?void 0:K;throw ne(this).debug(`[${f}] response error (${v})`,Ue({retryOfRequestLogID:n,url:h.url,status:h.status,headers:h.headers,message:Y,durationMs:Date.now()-p})),this.makeStatusError(h.status,$,Y,h.headers)}return ne(this).info(D),ne(this).debug(`[${f}] response start`,Ue({retryOfRequestLogID:n,url:h.url,status:h.status,headers:h.headers,durationMs:S-p})),{response:h,options:r,controller:g,requestLogID:f,retryOfRequestLogID:n,startTime:p}}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}requestAPIList(e,t){const n=this.makeRequest(t,null,void 0);return new lc(this,n,e)}async fetchWithTimeout(e,t,n,r){const{signal:a,method:o,...c}=t||{};a&&a.addEventListener("abort",()=>r.abort());const u=setTimeout(()=>r.abort(),n),f=globalThis.ReadableStream&&c.body instanceof globalThis.ReadableStream||typeof c.body=="object"&&c.body!==null&&Symbol.asyncIterator in c.body,b={signal:r.signal,...f?{duplex:"half"}:{},method:"GET",...c};o&&(b.method=o.toUpperCase());try{return await this.fetch.call(void 0,e,b)}finally{clearTimeout(u)}}async shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n,r){let a;const o=r?.get("retry-after-ms");if(o){const u=parseFloat(o);Number.isNaN(u)||(a=u)}const c=r?.get("retry-after");if(c&&!a){const u=parseFloat(c);Number.isNaN(u)?a=Date.parse(c)-Date.now():a=u*1e3}if(!(a&&0<=a&&a<60*1e3)){const u=e.maxRetries??this.maxRetries;a=this.calculateDefaultRetryTimeoutMillis(t,u)}return await Mt(a),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){const a=t-e,o=Math.min(.5*Math.pow(2,a),8),c=1-Math.random()*.25;return o*c*1e3}async buildRequest(e,{retryCount:t=0}={}){const n={...e},{method:r,path:a,query:o,defaultBaseURL:c}=n,u=this.buildURL(a,o,c);"timeout"in n&&Ll("timeout",n.timeout),n.timeout=n.timeout??this.timeout;const{bodyHeaders:f,body:b}=this.buildBody({options:n}),p=await this.buildHeaders({options:e,method:r,bodyHeaders:f,retryCount:t});return{req:{method:r,headers:p,...n.signal&&{signal:n.signal},...globalThis.ReadableStream&&b instanceof globalThis.ReadableStream&&{duplex:"half"},...b&&{body:b},...this.fetchOptions??{},...n.fetchOptions??{}},url:u,timeout:n.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:n,retryCount:r}){let a={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const o=w([a,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(r),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...Kl(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,n,e.headers]);return this.validateHeaders(o),o.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};const n=w([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&n.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:qa(e)}:d(this,ps,"f").call(this,{body:e,headers:n})}}Un=N,ps=new WeakMap,mn=new WeakSet,co=function(){return this.baseURL!=="https://api.openai.com/v1"};N.OpenAI=Un;N.DEFAULT_TIMEOUT=6e5;N.OpenAIError=C;N.APIError=ae;N.APIConnectionError=Cs;N.APIConnectionTimeoutError=xn;N.APIUserAbortError=me;N.NotFoundError=Pa;N.ConflictError=Da;N.RateLimitError=Fa;N.BadRequestError=Ta;N.AuthenticationError=$a;N.InternalServerError=Ba;N.PermissionDeniedError=Ma;N.UnprocessableEntityError=La;N.InvalidWebhookSignatureError=gt;N.toFile=fc;N.Completions=Li;N.Chat=kn;N.Embeddings=Hi;N.Files=Gi;N.Images=zi;N.Audio=Dt;N.Moderations=Ji;N.Models=Vi;N.FineTuning=ct;N.Graders=Fn;N.VectorStores=$s;N.Webhooks=lo;N.Beta=lt;N.Batches=Ri;N.Uploads=Hn;N.Responses=Ts;N.Realtime=js;N.Conversations=Tn;N.Evals=Mn;N.Containers=jn;N.Videos=io;const Bc=[{keywords:["yoy","year over year","growth"],answer:"For Year-over-Year growth, use the 'YoY Growth %' pattern in the DAX Library. It uses `SAMEPERIODLASTYEAR`.",link:"/dax"},{keywords:["blue","color","hex","brand"],answer:"The official HHS Blue hex code is #005EA2. You can find the full palette in the Style Guide.",link:"/style-guide"},{keywords:["pareto","80/20"],answer:"We have a Pareto Analysis pattern in the DAX Library under 'Advanced Analytics'.",link:"/dax"},{keywords:["font","typography"],answer:"The approved font is 'Source Sans Pro'. See the Style Guide for heading sizes.",link:"/style-guide"},{keywords:["dax","measure","calculation"],answer:"The DAX Library contains patterns for Time Intelligence, Financial Formulas, and more. Check the 'DAX Library' tab.",link:"/dax"}],Ct=180,gn=4e3,Hc=280,It=(s,e,t)=>Math.min(Math.max(s,e),t),Uc=()=>typeof window>"u"?360:It(window.innerWidth*.3,Ct,gn),ns=()=>({id:"welcome",text:"Hi, I'm your **Analytics Assistant**. Ask me about **DAX**, **HHS Branding**, or **data strategy**.",sender:"guru",isSystem:!0,createdAt:new Date().toISOString()}),Zs=[{label:"Generate DAX",value:"Create a reusable DAX measure for year-over-year revenue with clear comments."},{label:"Explain Visual",value:"Explain how to design an executive KPI card for Power BI with HHS branding guidance."},{label:"Build Checklist",value:"Give me a pre-publish checklist for a Power BI report destined for leadership review."},{label:"Debug Measure",value:"Help me troubleshoot why my DAX measure is returning blank values."}],xa="guru_session_notes",_a="guru_messages",va="guru_font_size",Sa="guru_line_height",nt={small:{label:"Small",message:"text-xs",meta:"text-[10px]",code:"text-xs",description:"Compact"},medium:{label:"Medium",message:"text-sm",meta:"text-xs",code:"text-sm",description:"Default"},large:{label:"Large",message:"text-base",meta:"text-sm",code:"text-base",description:"Comfortable"},xlarge:{label:"Extra Large",message:"text-lg",meta:"text-sm",code:"text-base",description:"Accessibility"}},rs={normal:{label:"Normal",class:"leading-normal"},relaxed:{label:"Relaxed",class:"leading-relaxed"},loose:{label:"Loose",class:"leading-loose"}},yn=["gemini-1.5-flash","gemini-1.5-pro","gemini-1.0-pro"];yn[0];const mt="v1beta2",Gc=["generateMessage","generateText"],Kc=[{name:"chat-bison-001",method:"generateMessage"},{name:"text-bison-001",method:"generateText"}],Aa="AIzaSyBQmBPQc-dFJRa9456iCbZBHrMimbO1s9A".trim()||"",As=Aa==="YOUR_GOOGLE_GEMINI_API_KEY"?"":Aa,qc="localhost,127.0.0.1,williamdalston.github.io",en=s=>(s||"").replace(/^models\//i,"").trim(),Wc=s=>s.split(",").map(e=>e.trim()).filter(Boolean).map(e=>e.replace(/^https?:\/\//,"").split("/")[0].toLowerCase()),Xc=(s,e,t)=>{if(s==="*")return!0;if(s.startsWith(".")){const n=s.slice(1);return e===n||e.endsWith(`.${n}`)}return s.includes(":")?t===s:e===s},Ca=Wc(qc),Yc=()=>{if(!As||typeof window>"u")return!1;if(Ca.length===0)return!0;const s=window.location.hostname.toLowerCase(),e=window.location.host.toLowerCase();return Ca.some(t=>Xc(t,s,e))},bn=()=>Yc()?As:"",zc=()=>{if(typeof window>"u")return"";const s=window.localStorage.getItem("gemini_api_key");return s?s.trim():""},Ia=()=>{if(typeof window>"u")return"";const s=window.localStorage.getItem("openai_api_key");return s?s.trim():""},Vc=()=>{const s=zc();if(s)return{key:s,source:"custom"};const e=bn();return e?{key:e,source:"project"}:{key:"",source:"none"}},Jc=(s,e=120)=>s?s.length>e?`${s.slice(0,e)}`:s:"",bd=()=>{const{addToast:s}=jo(),{isSidebarCollapsed:e,toggleSidebar:t}=To(),n=E.useRef(Vc()),[r,a]=E.useState(()=>{if(typeof window>"u")return[ns()];try{const l=window.localStorage.getItem(_a);return l?JSON.parse(l).map(j=>j.sender==="bot"?{...j,sender:"guru"}:j):[ns()]}catch(l){return console.error("Failed to parse messages",l),[ns()]}}),[o,c]=E.useState(""),[u,f]=E.useState(n.current.key),[b,p]=E.useState(()=>Ia()),[g,h]=E.useState(n.current.source==="custom"?n.current.key:""),[S,x]=E.useState(()=>Ia()),[D,M]=E.useState(n.current.source==="custom"),[v,K]=E.useState(!1),[$,Y]=E.useState(!1),[q,k]=E.useState(n.current.key?"connecting":"idle"),[z,O]=E.useState(""),[U,L]=E.useState(null),Me=E.useRef(null),Ne=E.useRef(null),Lt=E.useRef({}),[Ft,uo]=E.useState(!0),Bt=E.useRef(null),ke=E.useRef(null),[Gn,Ms]=E.useState(()=>Uc()),[ue,ho]=E.useState(!1),[Re,fo]=E.useState(()=>typeof window>"u"?!1:window.innerWidth>=1024),[Pe,Ps]=E.useState(()=>typeof window>"u"?"":window.localStorage.getItem(xa)||""),[dt,po]=E.useState(!1),[Ds,Kn]=E.useState(!1),[De,qn]=E.useState(null),[Ht,Le]=E.useState(null),[Ye,Wn]=E.useState(()=>typeof window>"u"?"medium":window.localStorage.getItem(va)||"medium"),[ut,Xn]=E.useState(()=>typeof window>"u"?"relaxed":window.localStorage.getItem(Sa)||"relaxed"),[ze,Yn]=E.useState(!1),Ut=E.useCallback(()=>{if(!ke.current||typeof window>"u")return gn;const l=window.getComputedStyle(ke.current),_=parseFloat(l.columnGap||l.gap||"0")||0,R=ke.current.getBoundingClientRect().width-_-Hc;return It(R,Ct,gn)},[ke]),Fe=E.useCallback(()=>{if(typeof window>"u")return;const l=window.innerWidth>=1024;if(fo(l),!l)return;const _=Ut();Ms(j=>It(j,Ct,_))},[Ut]);E.useEffect(()=>{},[]),E.useEffect(()=>{if(Fe(),!(typeof window>"u"))return window.addEventListener("resize",Fe),()=>window.removeEventListener("resize",Fe)},[Fe]),E.useEffect(()=>{Fe();const l=_=>{_.key==="Escape"&&Ds&&Kn(!1)};if(typeof window<"u")return window.addEventListener("keydown",l),()=>window.removeEventListener("keydown",l)},[Ds,Fe]),E.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(_a,JSON.stringify(r))},[r]);const zn=l=>{if(!l)return;const _=document.getElementById(`message-${l}`);_&&_.scrollIntoView({behavior:"smooth",block:"start"})};E.useEffect(()=>{const l=r[r.length-1];if(l?.sender==="guru"&&!l.isSystem&&De?.id){zn(De.id);return}Me.current?.scrollIntoView({behavior:"smooth"})},[r,De]),E.useEffect(()=>{const l=Ne.current;if(!l)return;const _=()=>{const{scrollTop:j,scrollHeight:R,clientHeight:y}=l,P=j+y>=R-10;uo(P)};return l.addEventListener("scroll",_),_(),()=>l.removeEventListener("scroll",_)},[r]);const Vn=()=>{Me.current?.scrollIntoView({behavior:"smooth"})},mo=()=>{Ne.current?.scrollTo({top:0,behavior:"smooth"})},Jn=()=>{confirm("This will clear the cache and refresh the application. Continue?")&&(window.localStorage.clear(),window.location.reload())};E.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(xa,Pe)},[Pe]),E.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(va,Ye)},[Ye]),E.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(Sa,ut)},[ut]);const Qn=E.useCallback(()=>{const l=Bt.current;if(!l)return;l.style.height="auto";const j=Math.min(l.scrollHeight,200);l.style.height=`${j}px`},[]),go=E.useCallback(async(l,_)=>{if(!_||typeof window>"u"||typeof fetch>"u")return{success:!1,models:[]};const j=`${l}:${_}`,R=Lt.current[j];if(R)return R;const y=new URL(`https://generativelanguage.googleapis.com/${l}/models`);y.searchParams.set("pageSize","200"),y.searchParams.set("key",_);const P=new AbortController,V=setTimeout(()=>P.abort(),8e3);try{const W=await fetch(y.toString(),{signal:P.signal});if(clearTimeout(V),!W.ok)return{success:!1,models:[]};const B={success:!0,models:((await W.json()).models||[]).map(H=>({name:en(H.name),supportedGenerationMethods:Array.isArray(H.supportedGenerationMethods)?H.supportedGenerationMethods:[]})).filter(H=>!!H.name)};return Lt.current[j]=B,B}catch{return clearTimeout(V),{success:!1,models:[]}}},[]);E.useEffect(()=>{Qn()},[o,Qn]),E.useEffect(()=>{if(!u.trim()){k("idle"),O(""),L(null);return}k("connected"),O(""),L("v1beta")},[u]);const yo=()=>{const l=g.trim();if(!l){s("Please enter a valid access code","error");return}typeof window<"u"&&window.localStorage.setItem("gemini_api_key",l),M(!0),f(l),h(""),k("connecting"),O(""),K(!1),s("Personal access code saved. Connecting now...","success")},bo=()=>{const l=S.trim();if(!l){s("Please enter a valid OpenAI API key","error");return}typeof window<"u"&&window.localStorage.setItem("openai_api_key",l),p(l),x(""),k("connecting"),O(""),K(!1),s("OpenAI API key saved. Connecting now...","success")},wo=()=>{typeof window<"u"&&window.localStorage.removeItem("gemini_api_key");const l=bn()||"",_=!!As&&!l;M(!1),h(""),f(l),k(l?"connecting":"idle"),O(""),s(l?"Reverted to the built-in HHS access code.":_?"The built-in HHS access code is restricted on this domain. Add your personal key to enable AI responses.":"Access code removed. Running in local knowledge mode.","info")},xo=()=>{typeof window<"u"&&window.localStorage.removeItem("openai_api_key"),p(""),x(""),k("idle"),O(""),s("OpenAI API key removed.","info")},_o=l=>{const _=l.toLowerCase();return Bc.find(j=>j.keywords.some(R=>_.includes(R)))},Ls=async l=>{if(l)try{if(typeof navigator>"u"||!navigator.clipboard)throw new Error("Clipboard unavailable");await navigator.clipboard.writeText(l),s("Message copied to clipboard","success")}catch(_){console.error("Copy failed",_),s("Unable to copy message","error")}},Zn=()=>{confirm("Clear this conversation and start fresh?")&&(a([ns()]),s("Conversation cleared","success"),Vn(),qn(null),Le(null))},er=()=>{const l=r.filter(y=>!y.isSystem).map(y=>`${y.sender.toUpperCase()} (${ht(y,!0)}):
${y.text}`).join(`

---

`),_=new Blob([l],{type:"text/plain"}),j=URL.createObjectURL(_),R=document.createElement("a");R.href=j,R.download=`power-bi-guru-chat-${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(R),R.click(),document.body.removeChild(R),URL.revokeObjectURL(j),s("Chat exported","success")},Fs=l=>{c(l),Bt.current?.focus()},vo=async()=>{if(!Pe.trim()){s("No notes to copy","info");return}try{await navigator.clipboard.writeText(Pe),s("Session notes copied","success")}catch(l){console.error("Copy notes failed",l),s("Unable to copy notes","error")}},So=()=>{Pe.trim()&&confirm("Clear session notes?")&&(Ps(""),s("Session notes cleared","success"))},tr=l=>{if(!Re||ue||!ke.current)return;l.preventDefault();const _=l.clientX,j=Gn,R=document.body.style.userSelect;document.body.style.userSelect="none";const y=V=>{const W=Ut(),se=V.clientX-_,ce=It(j-se,Ct,W);Ms(ce)},P=()=>{document.body.style.userSelect=R,window.removeEventListener("pointermove",y),window.removeEventListener("pointerup",P)};window.addEventListener("pointermove",y),window.addEventListener("pointerup",P)},sr=l=>{if(!Re||ue||!ke.current||l.key!=="ArrowLeft"&&l.key!=="ArrowRight")return;l.preventDefault();const _=Ut(),j=l.key==="ArrowLeft"?24:-24;Ms(R=>It(R+j,Ct,_))},nr=()=>{ho(l=>!l),typeof window<"u"&&requestAnimationFrame(()=>Fe())},Ao=()=>{po(l=>!l)},rr=()=>{Kn(l=>!l)},Bs=l=>{l&&(Ps(_=>`${_?`${_}

`:""}${l}`),s("Saved to session notes","success"))},ht=(l,_=!1)=>{if(l.isSystem&&l.id==="welcome"&&!_)return"";const j=l.createdAt||(typeof l.id=="number"?new Date(l.id).toISOString():null),R=j?new Date(j):_?new Date:null;return R?R.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""},ar=dt?"space-y-2":"space-y-4",ir=dt?"p-3":"p-4",or=(nt[Ye]||nt.medium).meta,Co=(l,_)=>{const[j,R]=E.useState(_?"":l);return E.useEffect(()=>{if(!_){R(l);return}let y=0;const P=setInterval(()=>{if(y>=l.length){clearInterval(P),R(l);return}const W=l.length>1e3?50:l.length>500?25:10;R(l.slice(0,y+W)),y+=W},10);return()=>clearInterval(P)},[l,_]),j},lr=({text:l,shouldAnimate:_,isUser:j=!1})=>{const R=Co(l,_);if(!R)return i.jsx("span",{className:"animate-pulse",children:"..."});const y=R.split(/(```[\s\S]*?```)/g),P=nt[Ye]||nt.medium,V=rs[ut]||rs.relaxed,W=se=>se.split(/(`[^`]+`|\*\*[^*]+\*\*|\*[^*]+\*)/g).map((B,H)=>{if(B.startsWith("`")&&B.endsWith("`")){const Z=B.slice(1,-1);return i.jsx("code",{className:`px-1.5 py-0.5 rounded font-mono text-[0.9em] border ${j?"bg-brand-700 text-brand-50 border-brand-600":"bg-slate-200/60 text-slate-800 border-slate-200/50"}`,children:Z},H)}return B.startsWith("**")&&B.endsWith("**")?i.jsx("strong",{className:"font-bold opacity-100",children:B.slice(2,-2)},H):B.startsWith("*")&&B.endsWith("*")?i.jsx("em",{className:"italic opacity-90",children:B.slice(1,-1)},H):B});return i.jsx("div",{className:`whitespace-pre-wrap break-words overflow-hidden ${V.class} ${P.message}`,children:y.map((se,ce)=>{if(se.startsWith("```")&&se.endsWith("```")){const B=se.match(/^```(\w+)?\n([\s\S]*)```$/),H=B?B[1]:"",Z=B?B[2]:se.slice(3,-3);return i.jsxs("div",{className:"my-3 rounded-lg bg-slate-800 text-slate-100 overflow-hidden shadow-sm border border-slate-700",children:[i.jsxs("div",{className:"flex items-center justify-between px-3 py-1.5 bg-slate-900/50 text-slate-400 border-b border-white/10 select-none",children:[i.jsx("span",{className:`uppercase font-semibold tracking-wider ${P.meta}`,children:H||"CODE"}),i.jsxs("button",{onClick:ve=>{ve.stopPropagation(),Ls(Z.trim())},className:"hover:text-white flex items-center gap-1.5 transition-colors text-xs","aria-label":"Copy code",children:[i.jsx(Yt,{className:"h-3 w-3"})," Copy"]})]}),i.jsx("pre",{className:`p-3 overflow-x-auto font-mono ${P.code} scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-transparent whitespace-pre`,children:i.jsx("code",{children:Z.trim()})})]},ce)}return i.jsx("span",{children:W(se)},ce)})})},Gt=async()=>{if(!o.trim())return;const l={id:Date.now(),text:o,sender:"user",createdAt:new Date().toISOString()};a(y=>[...y,l]),c(""),Y(!0),qn({id:l.id,text:l.text});const _=_o(l.text);if(_){setTimeout(()=>{const y={id:Date.now()+1,text:_.answer,sender:"guru",link:_.link,createdAt:new Date().toISOString()};a(P=>[...P,y]),Le(y.id),Y(!1)},600);return}const j=b.trim(),R=u.trim();if(j)try{const y=new N({apiKey:j,dangerouslyAllowBrowser:!0}),V=`You are an expert Power BI Developer and Data Analyst for the US Department of Health and Human Services (HHS), but you are also a helpful general-purpose AI assistant.
                
Current Date and Time: ${new Date().toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",timeZoneName:"short"})}

You can answer ANY question the user asks, regardless of the topic (including general knowledge, coding in other languages, creative writing, etc.).

Guidelines for Power BI & Data Questions:
- Provide expert, production-ready advice.
- Always format DAX code clearly with line breaks and indentation.
- Explain complex logic step-by-step.
- Reference HHS style guidelines (blue #005EA2, Source Sans Pro) if relevant to visuals.

Guidelines for General Questions:
- Answer helpfully and accurately.
- Do not force a connection to data if the topic is unrelated.
- Be concise and direct.`,W=r.filter(H=>!H.isError&&!H.isSystem).map(H=>({role:H.sender==="user"?"user":"assistant",content:H.text})),se=[{role:"system",content:V},...W,{role:"user",content:l.text}],ce=["gpt-4o","gpt-4o-mini"];let B=!1;for(const H of ce)try{const ve=(await y.chat.completions.create({model:H,messages:se,temperature:.7,max_tokens:4096})).choices[0]?.message?.content;if(ve){const be={id:Date.now()+1,text:ve,sender:"guru",createdAt:new Date().toISOString()};a(Us=>[...Us,be]),Le(be.id),k("connected"),O(""),L(`OpenAI / ${H}`),Y(!1),B=!0;return}}catch{continue}if(!B)throw new Error("All OpenAI models failed")}catch(y){if((y.message?.includes("401")||y.message?.includes("Invalid API key")||y.message?.includes("Incorrect API key")||y.message?.includes("You exceeded your current quota"))&&!R){k("error"),O("OpenAI API key appears to be invalid. Please check your key in settings.");const V={id:Date.now()+1,text:"I couldn't connect to OpenAI. Your API key might be invalid, expired, or missing required permissions. Please check your OpenAI key in settings (it should start with 'sk-'). If the problem persists, you can get a new key at https://platform.openai.com/api-keys. I can still help with local knowledge about DAX and Power BI!",sender:"guru",isError:!0,createdAt:new Date().toISOString()};a(W=>[...W,V]),Le(V.id),Y(!1);return}}if(R){try{let y,P=null,V="",W="";const ce=`You are an expert Power BI Developer and Data Analyst for the US Department of Health and Human Services (HHS), but you are also a helpful general-purpose AI assistant.
                
Current Date and Time: ${new Date().toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",timeZoneName:"short"})}

You can answer ANY question the user asks, regardless of the topic (including general knowledge, coding in other languages, creative writing, etc.).

Guidelines for Power BI & Data Questions:
- Provide expert, production-ready advice.
- Always format DAX code clearly with line breaks and indentation.
- Explain complex logic step-by-step.
- Reference HHS style guidelines (blue #005EA2, Source Sans Pro) if relevant to visuals.

Guidelines for General Questions:
- Answer helpfully and accurately.
- Do not force a connection to data if the topic is unrelated.
- Be concise and direct.

You have access to Google Search tools. Use them proactively to verify facts, find current information, or answer questions about recent events.`,H=[...r.filter(T=>!T.isError&&!T.isSystem).map(T=>({role:T.sender==="user"?"user":"model",parts:[{text:T.text}]})),{role:"user",parts:[{text:l.text}]}],Z=r.filter(T=>!T.isSystem).map(T=>({author:T.sender==="user"?"user":"bot",content:T.text})),ve=[...Z,{author:"user",content:l.text}],Us=[ce,...Z.map(T=>`${T.author==="user"?"User":"Assistant"}: ${T.content}`),`User: ${l.text}`,"Assistant:"].filter(Boolean).join(`

`),No=async()=>{if(typeof fetch>"u")return null;const T=await go(mt,R),G=(T.success?T.models.filter(F=>F.supportedGenerationMethods.some(ee=>Gc.includes(ee))):[]).map(F=>{const ee=F.supportedGenerationMethods.includes("generateMessage"),ge=F.supportedGenerationMethods.includes("generateText");return ee?{name:F.name,method:"generateMessage"}:ge?{name:F.name,method:"generateText"}:null}).filter(Boolean);if(Kc.forEach(F=>{G.some(ee=>ee.name===F.name)||G.push(F)}),G.length===0)return null;for(const F of G)try{if(F.method==="generateMessage"){const ee=`https://generativelanguage.googleapis.com/${mt}/models/${F.name}:generateMessage?key=${R}`,ge=await fetch(ee,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:{context:ce,messages:ve},temperature:.7})}),Be=await ge.json().catch(()=>({}));if(!ge.ok)throw new Error(Be.error?.message||`PaLM model ${F.name} failed (${ge.status})`);const Je=Be.candidates?.[0],Xt=typeof Je?.content=="string"?Je.content.trim():"";if(Xt)return{text:Xt,providerLabel:`${mt} / ${F.name}`};throw new Error(`PaLM model ${F.name} returned no content`)}if(F.method==="generateText"){const ee=`https://generativelanguage.googleapis.com/${mt}/models/${F.name}:generateText?key=${R}`,ge=await fetch(ee,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:{text:Us},temperature:.7})}),Be=await ge.json().catch(()=>({}));if(!ge.ok)throw new Error(Be.error?.message||`PaLM model ${F.name} failed (${ge.status})`);const Je=Be.candidates?.[0]?.output?.trim()||Be.output?.trim();if(Je)return{text:Je,providerLabel:`${mt} / ${F.name}`};throw new Error(`PaLM model ${F.name} returned no content`)}}catch(ee){if(ee.message?.includes("404")||ee.message?.includes("not found")||ee.message?.includes("NOT_FOUND")||ee.message?.includes("400")&&ee.message?.includes("not available"))continue;y=ee}return null},ko=3e4;let Gs;try{Gs=new Tl(R)}catch(T){throw y=T,k("error"),O("Failed to initialize AI client."),T}let Se=yn,Kt=!1;try{const{models:T}=await Gs.listModels(),Ae=(T||[]).filter(G=>(G.supportedGenerationMethods||[]).includes("generateContent")).map(G=>en(G.name));if(Ae.length>0){Kt=!0;const G=yn.filter(F=>Ae.includes(en(F)));G.length>0?Se=G:(Se=[],Kt=!1)}else Kt=!1,Se=[]}catch{Kt=!1,Se=[]}let ft=Se.length>0;if(Se.length===0)ft=!1,y=new Error("No accessible models found for this API key");else for(const T of Se){let Ae;try{const G=Gs.getGenerativeModel({model:T,systemInstruction:ce,safetySettings:[{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_MEDIUM_AND_ABOVE"}]}),F=new Promise((Je,Xt)=>{Ae=setTimeout(()=>Xt(new Error("Request timeout")),ko)}),ee=G.generateContent({contents:H,generationConfig:{maxOutputTokens:8192,temperature:.7,topP:.95,topK:40}}),ge=await Promise.race([ee,F]);Ae&&clearTimeout(Ae),P=await ge.response,V=T,W="current",k("connected"),O(""),ft=!1;break}catch(G){if(Ae&&clearTimeout(Ae),G.message?.includes("404")||G.message?.includes("not found")||G.message?.includes("NOT_FOUND")||G.message?.includes("Requested entity was not found")){y=G;continue}else ft=!1;if(G.message?.includes("API_KEY")||G.message?.includes("PERMISSION_DENIED")){y=G;break}y=G}}let qt=null,Wt=null;if(P)qt=P.text(),Wt=V,L(Wt);else if(!ft&&Se.length>0){const T=await No();T&&(qt=T.text,Wt=T.providerLabel,k("connected"),O(""),L(Wt))}else ft&&Se.length>0&&(k("error"),O("API key does not have access to any AI models. Please check your API key permissions."));if(!qt)throw k("error"),O("No compatible AI model found for this access code."),y||new Error("No compatible AI model found");const Ro=qt,hr={id:Date.now()+1,text:Ro,sender:"guru",createdAt:new Date().toISOString()};a(T=>[...T,hr]),Le(hr.id)}catch(y){console.error("AI Connection Error:",y.message);const P=y.message?.includes("OpenAI")||y.message?.includes("openai")||y.message?.includes("Invalid API key")||y.message?.includes("Incorrect API key"),V=y.message?.includes("No accessible models")||y.message?.includes("No compatible AI model"),W=y.message?.includes("API_KEY")||y.message?.includes("PERMISSION_DENIED")||y.message?.includes("INVALID_ARGUMENT")||y.message?.includes("401")||y.message?.includes("Unauthorized"),se=y.message?.includes("not found")||y.message?.includes("NOT_FOUND")||y.message?.includes("404")||y.message?.includes("Requested entity was not found"),ce=y.message?.includes("rate limit")||y.message?.includes("429")||y.message?.includes("quota"),B=y.message?.includes("timeout")||y.message?.includes("Timeout"),H=y.message?.includes("network")||y.message?.includes("fetch")||y.message?.includes("Failed to fetch");if(V||W||se||P){k("error");let be="Unable to connect to AI service";P?be="OpenAI API key may be invalid or expired. Please check your key in settings.":V||se?be="API key doesn't have access to AI models. Please check your key permissions.":W&&(be="Invalid API key or insufficient permissions."),O(be)}let Z;P?Z="I couldn't connect to OpenAI. Your API key might be invalid, expired, or missing required permissions. Please check your OpenAI key in settings (it should start with 'sk-'). You can get a new key at https://platform.openai.com/api-keys. In the meantime, I can still help with local knowledge about DAX and Power BI!":ce?Z="I've hit a rate limit or quota on the AI service. This usually means you've made too many requests recently, or your API account needs more credits. Please wait a moment and try again, or check your API account billing. I can still help with local knowledge about DAX and Power BI while we wait!":V||se?Z="I couldn't find any AI models that work with your API key. This might mean your key doesn't have the right permissions, or the model isn't available in your region. Please check your API key settings - for OpenAI, visit https://platform.openai.com/api-keys, or for Gemini, visit https://makersuite.google.com/app/apikey. I can still help with what I know about DAX and Power BI!":W?Z="I couldn't authenticate with the AI service. Your API key might be incorrect or expired. Please double-check your API key in settings and make sure it's entered correctly. You can always add a different API key if needed. I can still help with local knowledge about DAX and Power BI!":B?Z="The AI service is taking too long to respond - this can happen on slower internet connections or when the service is busy. Please try again in a moment. In the meantime, I can still help with local knowledge about DAX and Power BI!":H?Z="I'm having trouble reaching the AI service. This might be a temporary network issue or the service could be down. Please check your internet connection and try again. I can still help with local knowledge about DAX and Power BI!":Z="Something went wrong connecting to the AI service. This might be temporary - please try again in a moment. I'm still here to help with what I know about DAX and Power BI!";const ve={id:Date.now()+1,text:Z,sender:"guru",isError:!0,createdAt:new Date().toISOString()};a(be=>[...be,ve]),Le(ve.id)}finally{Y(!1)}return}setTimeout(()=>{const y={id:Date.now()+1,text:"I don't have an answer for that in my local knowledge base. To unlock full AI capabilities, please configure the AI Access Code in settings.",sender:"guru",isSystem:!0,createdAt:new Date().toISOString()};a(P=>[...P,y]),Le(y.id),Y(!1)},600)},Hs=!!bn(),Io=!!As&&!Hs,Ve=u?q==="connected"?{text:U?`AI Connected (${U})`:"AI Connected",className:"bg-emerald-100 text-emerald-700"}:q==="connecting"?{text:"Verifying Access Code",className:"bg-sky-100 text-sky-700"}:q==="error"?{text:"Connection Error",className:"bg-rose-100 text-rose-700"}:null:null,cr=!ue,dr=Re?{width:`${Gn}px`}:void 0,ur=i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex items-center justify-between mb-3 gap-2",children:[i.jsxs("div",{children:[i.jsxs("p",{className:"text-sm font-semibold text-slate-900 flex items-center gap-2",children:[i.jsx(_r,{className:"h-4 w-4 text-brand-500"}),"Session Notes"]}),i.jsx("p",{className:"text-xs text-slate-500",children:"Capture insights or follow-ups"})]}),i.jsxs("div",{className:"flex gap-1",children:[i.jsx("button",{onClick:vo,className:"p-2 text-slate-400 hover:text-brand-600 hover:bg-brand-50 rounded transition-colors",title:"Copy notes","aria-label":"Copy notes",children:i.jsx(Yt,{className:"h-4 w-4"})}),i.jsx("button",{onClick:So,className:"p-2 text-slate-400 hover:text-rose-600 hover:bg-rose-50 rounded transition-colors",title:"Clear notes","aria-label":"Clear notes",children:i.jsx(Ho,{className:"h-4 w-4"})})]})]}),i.jsx("textarea",{value:Pe,onChange:l=>Ps(l.target.value),placeholder:"Capture project context, action items, or next steps...",className:"input-field flex-1 min-h-[200px] resize-none"}),i.jsxs("p",{className:"text-[11px] text-slate-400 text-right mt-2",children:["Autosaved locally  ",Pe.trim().length," chars"]})]}),Eo=({onPromptClick:l})=>i.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 text-center animate-fadeIn",children:[i.jsx("div",{className:"bg-brand-50 p-6 rounded-full mb-6 ring-8 ring-brand-50/50",children:i.jsx(He,{className:"h-12 w-12 text-brand-600"})}),i.jsx("h3",{className:"text-2xl font-bold text-slate-900 mb-2",children:"How can I help you today?"}),i.jsx("p",{className:"text-slate-600 max-w-md mb-8",children:"I'm your dedicated analytics assistant. Ask me about DAX patterns, report design, or HHS data standards."}),i.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 max-w-2xl w-full",children:Zs.map(_=>i.jsxs("button",{onClick:()=>l(_.value),className:"p-4 bg-white border border-slate-200 rounded-xl hover:border-brand-300 hover:shadow-brand transition-all text-left group",children:[i.jsx("span",{className:"text-xs font-bold text-brand-600 uppercase tracking-wider mb-1 block group-hover:text-brand-700",children:_.label}),i.jsx("span",{className:"text-sm text-slate-700 group-hover:text-slate-900",children:_.value})]},_.label))})]});return Ds?Po.createPortal(i.jsxs("div",{className:"fixed inset-0 z-[100] bg-white flex flex-col animate-fadeIn",children:[i.jsxs("div",{className:"bg-white/90 backdrop-blur-md border-b border-slate-200 px-4 py-3 flex flex-wrap items-center justify-between gap-3 sticky top-0 z-20",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(He,{className:"h-5 w-5 text-brand-600"}),i.jsx("h2",{className:"text-lg font-bold text-slate-900",children:"Power BI Guru"}),Ve&&i.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full font-medium ${Ve.className}`,children:Ve.text})]}),i.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[i.jsx("button",{onClick:Jn,className:"p-2 hover:bg-slate-100 rounded-lg text-slate-500 transition-colors",title:"Clear Cache & Refresh",children:i.jsx(Ir,{className:"h-5 w-5"})}),i.jsxs("button",{onClick:t,"aria-pressed":e,"aria-label":e?"Show sidebar":"Hide sidebar",className:`hidden lg:flex p-2 rounded-lg text-sm font-medium items-center gap-2 border transition-colors ${e?"border-slate-200 text-slate-600 hover:bg-slate-100":"bg-emerald-50 text-emerald-700 border-emerald-100"}`,title:e?"Show sidebar":"Hide sidebar",children:[e?i.jsx(Sr,{className:"h-4 w-4"}):i.jsx(vr,{className:"h-4 w-4"}),i.jsx("span",{className:"hidden xl:inline",children:e?"Show sidebar":"Hide sidebar"})]}),i.jsxs("button",{onClick:nr,"aria-pressed":!ue,"aria-label":ue?"Show notes panel":"Hide notes panel",className:`p-2 rounded-lg text-sm font-medium flex items-center gap-2 border transition-colors ${ue?"border-slate-200 text-slate-600 hover:bg-slate-100":"bg-brand-50 text-brand-700 border-brand-100"}`,children:[ue?i.jsx(Cr,{className:"h-4 w-4"}):i.jsx(Ar,{className:"h-4 w-4"}),i.jsx("span",{className:"hidden sm:inline",children:ue?"Show notes":"Hide notes"})]}),i.jsx("button",{onClick:rr,className:"p-2 hover:bg-slate-200 rounded-lg transition-colors text-slate-600",title:"Exit Fullscreen",children:i.jsx(Yo,{className:"h-5 w-5"})})]})]}),i.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:i.jsxs("div",{ref:ke,className:"flex-1 flex flex-col gap-4 lg:flex-row lg:items-stretch px-4 pb-4 pt-2 overflow-hidden",children:[i.jsxs("div",{className:"flex-1 flex flex-col min-w-0 bg-white relative border border-slate-200 rounded-xl shadow-sm",children:[i.jsxs("div",{className:"px-4 py-2 border-b border-slate-100 bg-white flex items-center gap-2 overflow-x-auto shrink-0",children:[i.jsxs("div",{className:"flex items-center gap-2 text-xs font-semibold uppercase text-slate-500 whitespace-nowrap",children:[i.jsx(Er,{className:"h-3 w-3 text-brand-500"}),"Quick prompts"]}),i.jsx("div",{className:"flex gap-2",children:Zs.map(l=>i.jsx("button",{onClick:()=>Fs(l.value),className:"flex-shrink-0 px-3 py-1 text-xs bg-slate-100 text-slate-700 rounded-full hover:bg-brand-50 hover:text-brand-700 transition-colors whitespace-nowrap",children:l.label},l.label))}),i.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[i.jsx("button",{onClick:()=>Yn(!ze),className:`p-1.5 rounded transition-colors flex items-center gap-1 ${ze?"bg-brand-100 text-brand-700":"text-slate-400 hover:text-slate-600 hover:bg-slate-200"}`,title:"Text & Style Settings","aria-label":"Text style settings",children:i.jsx(zt,{className:"h-4 w-4"})}),i.jsx("button",{onClick:er,className:"p-1.5 text-slate-400 hover:text-slate-600 hover:bg-slate-200 rounded transition-colors",title:"Export chat","aria-label":"Export chat",children:i.jsx(gr,{className:"h-4 w-4"})}),i.jsx("button",{onClick:Zn,className:"p-1.5 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded transition-colors",title:"Clear chat","aria-label":"Clear chat",children:i.jsx(fr,{className:"h-4 w-4"})})]})]}),i.jsx(Qe,{children:ze&&i.jsx(Ce.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden border-b border-slate-200",children:i.jsxs("div",{className:"px-4 py-3 bg-gradient-to-br from-brand-50 to-slate-50",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[i.jsx(zt,{className:"h-4 w-4 text-brand-600"}),i.jsx("h3",{className:"font-semibold text-slate-900 text-sm",children:"Text & Style Settings"})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 max-w-3xl",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-2",children:"Font Size"}),i.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(nt).map(([l,_])=>i.jsxs("button",{onClick:()=>Wn(l),className:`px-3 py-2 text-xs rounded-lg border transition-all ${Ye===l?"bg-brand-600 text-white border-brand-600 shadow-md":"bg-white text-slate-700 border-slate-200 hover:border-brand-300 hover:bg-brand-50"}`,children:[i.jsx("div",{className:"font-semibold",children:_.label}),i.jsx("div",{className:"text-[10px] opacity-75",children:_.description})]},l))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-2",children:"Line Spacing"}),i.jsx("div",{className:"grid grid-cols-1 gap-2",children:Object.entries(rs).map(([l,_])=>i.jsx("button",{onClick:()=>Xn(l),className:`px-3 py-2 text-xs rounded-lg border transition-all ${ut===l?"bg-brand-600 text-white border-brand-600 shadow-md":"bg-white text-slate-700 border-slate-200 hover:border-brand-300 hover:bg-brand-50"}`,children:_.label},l))})]})]}),i.jsxs("p",{className:"text-xs text-slate-500 mt-3 flex items-center gap-1",children:[i.jsx(He,{className:"h-3 w-3"}),"Settings are saved automatically and persist across sessions"]})]})})}),i.jsxs("div",{ref:Ne,className:`flex-1 overflow-y-auto p-4 md:p-8 ${ar} relative`,children:[r.length<=1?i.jsx(Eo,{onPromptClick:Fs}):r.map(l=>i.jsx(Ce.div,{id:`message-${l.id}`,initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex ${l.sender==="user"?"justify-end":"justify-start"}`,children:i.jsxs("div",{className:`max-w-[90%] md:max-w-[70%] rounded-2xl ${ir} group relative shadow-sm ${l.sender==="user"?"bg-brand-600 text-white rounded-br-none":l.isSystem?"bg-amber-50 text-amber-800 border border-amber-100":"bg-slate-100 text-slate-800 rounded-bl-none"} ${l.id===Ht?"ring-2 ring-brand-200 shadow-brand-200/60":""}`,children:[i.jsx("button",{onClick:()=>Ls(l.text),className:`absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded ${l.sender==="user"?"text-brand-100 hover:text-white hover:bg-brand-500":"text-slate-400 hover:text-brand-600 hover:bg-slate-200"}`,title:"Copy message","aria-label":"Copy message",children:i.jsx(Yt,{className:"h-3 w-3"})}),l.sender==="guru"&&!l.isSystem&&i.jsx("button",{onClick:()=>Bs(l.text),className:`absolute top-2 right-10 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded ${l.sender==="user"?"text-brand-100 hover:text-white hover:bg-brand-500":"text-slate-400 hover:text-brand-600 hover:bg-slate-200"}`,title:"Save to notes","aria-label":"Save to notes",children:i.jsx(Ks,{className:"h-3 w-3"})}),i.jsxs("div",{className:`flex items-center justify-between mb-1 opacity-75 ${or}`,children:[i.jsxs("div",{className:"flex items-center gap-2",children:[l.sender==="user"?i.jsx(pr,{className:"h-3 w-3"}):i.jsx(He,{className:"h-3 w-3"}),i.jsx("span",{className:"uppercase font-bold tracking-wider",children:l.sender})]}),ht(l)&&i.jsx("span",{className:"opacity-75",children:ht(l)})]}),i.jsx(lr,{text:l.text,shouldAnimate:l.id===Ht&&l.sender==="guru"&&!l.isSystem,isUser:l.sender==="user"}),l.link&&i.jsx("div",{className:`mt-3 pt-3 border-t ${l.sender==="user"?"border-white/20":"border-black/10"}`,children:i.jsxs("a",{href:`#${l.link}`,className:`text-xs font-bold flex items-center gap-1 hover:underline ${l.sender==="user"?"text-white":"text-brand-600"}`,children:["View Resource ",i.jsx(yr,{className:"h-3 w-3"})]})})]})},l.id)),i.jsx(Qe,{children:$&&i.jsx(Ce.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex justify-start",children:i.jsxs("div",{className:"bg-slate-100 rounded-2xl rounded-bl-none p-4 flex gap-1",children:[i.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce"}),i.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce delay-75"}),i.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce delay-150"})]})})}),i.jsx("div",{ref:Me})]}),i.jsxs("div",{className:"p-4 bg-white border-t border-slate-200 shrink-0 shadow-up z-10",children:[i.jsxs("div",{className:"max-w-4xl mx-auto w-full flex gap-2",children:[i.jsx("textarea",{ref:Bt,value:o,onChange:l=>{c(l.target.value)},onKeyDown:l=>{l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),Gt())},placeholder:"Ask anything about Power BI... (Shift+Enter for new line)",className:"input-field flex-1 shadow-sm resize-none min-h-[48px] max-h-[200px] overflow-hidden",rows:1}),i.jsx("button",{onClick:Gt,disabled:!o.trim()||$,className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed px-6","aria-label":"Send message",children:i.jsx(br,{className:"h-5 w-5"})})]}),!u&&i.jsxs("p",{className:"text-xs text-slate-400 mt-2 text-center",children:["Running in ",i.jsx("span",{className:"font-semibold text-brand-600",children:"Local Knowledge Mode"}),". Add an Access Code for full AI features."]})]})]}),cr&&i.jsxs("div",{className:"flex flex-col gap-4 lg:gap-0 lg:flex-row shrink-0 w-full lg:w-auto",children:[Re&&i.jsx("div",{className:"hidden lg:flex items-center justify-center w-5 cursor-col-resize select-none text-slate-400 hover:bg-slate-100 hover:text-brand-500 transition-colors -ml-2.5 z-10 group",role:"separator","aria-label":"Resize session notes panel","aria-orientation":"vertical",tabIndex:0,onPointerDown:tr,onKeyDown:sr,title:"Drag to resize notes",children:i.jsx("div",{className:"flex flex-col items-center gap-1 bg-white/80 rounded-full px-1 py-3 shadow-sm border border-slate-200 group-hover:border-brand-300 group-hover:scale-110 transition-all",children:i.jsx(xr,{className:"h-4 w-4"})})}),i.jsx("div",{className:"border border-slate-200 bg-slate-50 rounded-xl shadow-inner p-4 sm:p-5 flex flex-col w-full lg:w-auto transition-[width] duration-200 max-h-[300px] lg:max-h-none",style:dr,children:ur})]})]})})]}),document.body):i.jsxs("div",{className:"flex flex-col gap-4 min-h-[calc(100vh-10rem)] sm:min-h-[calc(100vh-8rem)]",children:[i.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3 mb-2 sm:mb-4",children:[i.jsxs("div",{children:[i.jsxs("h2",{className:"text-xl sm:text-2xl font-bold text-slate-900 flex flex-wrap items-center gap-2",children:[i.jsx(He,{className:`h-5 w-5 sm:h-6 sm:w-6 text-brand-600 ${$?"animate-pulse":""}`}),"Power BI Guru",Ve&&i.jsx("span",{className:`text-[10px] sm:text-xs px-2 py-0.5 rounded-full font-medium ${Ve.className}`,children:Ve.text})]}),i.jsx("p",{className:"text-sm sm:text-base text-slate-600 mt-1",children:"Your AI assistant for DAX, Design, and Strategy."}),u&&i.jsx("p",{className:"mt-1 text-xs text-slate-500",children:D?"Using your personal Gemini access code.":Hs?"Using the built-in HHS Gemini access code.":"Using the currently stored Gemini access code."}),!u&&Io&&i.jsxs("p",{className:"mt-1 text-xs text-amber-600 flex items-center gap-1",children:[i.jsx(mr,{className:"h-3 w-3"}),"Built-in cloud access is limited to approved internal domains. Add your own access code in settings to chat from this site."]}),q==="error"&&u&&i.jsxs("p",{className:"mt-1 text-sm text-rose-600 flex items-center gap-1",children:[i.jsx(mr,{className:"h-4 w-4"}),i.jsx("span",{children:z||"Unable to connect to the AI. Update the access code in settings."})]})]}),i.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[i.jsx("button",{onClick:Jn,className:"p-2.5 sm:p-2 rounded-lg text-slate-500 hover:text-brand-600 hover:bg-slate-100 transition-colors",title:"Clear Cache & Refresh App","aria-label":"Clear Cache & Refresh App",children:i.jsx(Ir,{className:"h-5 w-5 sm:h-4 sm:w-4"})}),Re&&i.jsxs("button",{onClick:t,"aria-pressed":e,"aria-label":e?"Show sidebar":"Hide sidebar",className:"p-2.5 sm:p-2 rounded-lg text-sm font-medium flex items-center gap-2 border transition-colors border-slate-200 text-slate-600 hover:bg-slate-100",title:e?"Show sidebar":"Hide sidebar",children:[e?i.jsx(Sr,{className:"h-4 w-4"}):i.jsx(vr,{className:"h-4 w-4"}),i.jsx("span",{className:"hidden xl:inline",children:e?"Show sidebar":"Hide sidebar"})]}),i.jsxs("button",{onClick:nr,"aria-pressed":!ue,"aria-label":ue?"Show notes panel":"Hide notes panel",className:`p-2.5 sm:p-2 rounded-lg text-xs sm:text-sm font-medium flex items-center gap-1.5 sm:gap-2 border transition-colors ${ue?"border-slate-200 text-slate-600 hover:bg-slate-100":"bg-brand-50 text-brand-700 border-brand-100"}`,children:[ue?Re?i.jsx(Cr,{className:"h-4 w-4"}):i.jsx(_r,{className:"h-4 w-4"}):Re?i.jsx(Ar,{className:"h-4 w-4"}):i.jsx(wr,{className:"h-4 w-4"}),i.jsx("span",{className:"hidden sm:inline",children:ue?"Show notes":"Hide notes"})]}),i.jsx("button",{onClick:rr,className:"p-2.5 sm:p-2 rounded-lg bg-slate-100 text-slate-600 hover:bg-slate-200 transition-colors",title:"Maximize (Fullscreen Mode)","aria-label":"Maximize (Fullscreen Mode)",children:i.jsx(Ko,{className:"h-5 w-5"})}),i.jsx("button",{onClick:()=>K(!v),className:`p-2.5 sm:p-2 rounded-lg transition-colors ${v?"bg-brand-50 text-brand-700":D?"bg-emerald-100 text-emerald-700":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,title:"Manage AI Access Code","aria-label":"Manage AI Access Code",children:i.jsx(sl,{className:"h-5 w-5"})})]})]}),i.jsx(Qe,{children:v&&i.jsx(Ce.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden mb-4",children:i.jsxs("div",{className:"bg-slate-50 border border-slate-200 rounded-lg p-4",children:[i.jsxs("h3",{className:"font-semibold text-slate-900 mb-2 flex items-center gap-2",children:[i.jsx($o,{className:"h-4 w-4"})," AI Settings"]}),i.jsx("p",{className:"text-sm text-slate-600 mb-4",children:"Enter an API key to enable full AI chat capabilities. OpenAI is recommended for better reliability."}),i.jsxs("div",{className:"mb-4",children:[i.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-2",children:"OpenAI API Key (Recommended)"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("input",{type:"password",value:S,onChange:l=>x(l.target.value),placeholder:"sk-...",className:"input-field flex-1"}),i.jsx("button",{onClick:bo,className:"btn-primary",children:"Save"}),b&&i.jsx("button",{onClick:xo,className:"btn-secondary text-red-600 hover:bg-red-50",children:"Clear"})]}),i.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Get your key at ",i.jsx("a",{href:"https://platform.openai.com/api-keys",target:"_blank",rel:"noopener noreferrer",className:"text-brand-600 hover:underline",children:"platform.openai.com/api-keys"})]})]}),i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-2",children:"Google Gemini API Key (Alternative)"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("input",{type:"password",value:g,onChange:l=>h(l.target.value),placeholder:"Enter Gemini Access Code...",className:"input-field flex-1"}),i.jsx("button",{onClick:yo,className:"btn-primary",children:"Save"}),D&&i.jsx("button",{onClick:wo,className:"btn-secondary text-red-600 hover:bg-red-50",children:"Clear"})]}),i.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Get your key at ",i.jsx("a",{href:"https://makersuite.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"text-brand-600 hover:underline",children:"makersuite.google.com/app/apikey"})]})]}),i.jsxs("div",{className:"text-xs text-slate-500 mt-3 space-y-1 border-t border-slate-200 pt-3",children:[i.jsx("p",{children:b?"Using OpenAI API. It will be tried first, then Gemini if available.":D?"Currently using your personal Gemini key. Clear to switch back to the built-in HHS access code.":Hs?"Using the built-in HHS Gemini key by default. Add your own key if you need to run chats under a personal quota.":"No API key is configured yet. Add one to enable cloud AI responses."}),i.jsx("p",{className:"text-slate-400",children:"Any personal key you add stays in your browser only."})]})]})})}),i.jsxs("div",{ref:ke,className:"flex-1 flex flex-col gap-4 lg:flex-row lg:items-stretch overflow-hidden",children:[i.jsxs("div",{className:"flex-1 bg-white border border-slate-200 rounded-xl shadow-sm overflow-hidden flex flex-col relative min-w-0 min-h-[420px]",children:[i.jsxs("div",{className:"bg-slate-50 border-b border-slate-200 px-3 sm:px-4 py-2 sm:py-3 flex flex-wrap items-center gap-3",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Wo,{className:"h-4 w-4 text-slate-500"}),i.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Conversation"}),i.jsxs("span",{className:"text-xs text-slate-500 bg-slate-200 px-2 py-0.5 rounded-full",children:[r.filter(l=>!l.isSystem).length," messages"]})]}),i.jsxs("div",{className:"flex gap-1.5 sm:gap-2 ml-auto",children:[i.jsx("button",{onClick:er,className:"p-1.5 text-slate-400 hover:text-slate-600 hover:bg-slate-200 rounded transition-colors",title:"Export chat",children:i.jsx(gr,{className:"h-4 w-4"})}),i.jsx("button",{onClick:Zn,className:"p-1.5 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded transition-colors",title:"Clear chat",children:i.jsx(fr,{className:"h-4 w-4"})})]})]}),r.length>1&&i.jsxs("div",{className:"px-3 sm:px-4 py-2 sm:py-3 border-b border-slate-100 bg-white flex flex-wrap items-center gap-2",children:[i.jsxs("div",{className:"flex items-center gap-2 text-[10px] sm:text-xs font-semibold uppercase text-slate-500",children:[i.jsx(Er,{className:"h-3 w-3 text-brand-500"}),i.jsx("span",{className:"hidden xs:inline",children:"Quick prompts"})]}),i.jsx("div",{className:"flex flex-wrap gap-1.5 sm:gap-2",children:Zs.map(l=>i.jsx("button",{onClick:()=>Fs(l.value),className:"px-2.5 sm:px-3 py-1.5 sm:py-1 text-[11px] sm:text-xs bg-slate-100 text-slate-700 rounded-full hover:bg-brand-50 hover:text-brand-700 transition-colors whitespace-nowrap flex-shrink-0",children:l.label},l.label))}),i.jsxs("div",{className:"ml-auto flex items-center gap-1.5 sm:gap-2",children:[i.jsxs("button",{onClick:()=>Yn(!ze),className:`text-[11px] sm:text-xs px-2.5 sm:px-3 py-1.5 sm:py-1 rounded-full border flex items-center gap-1 sm:gap-1.5 ${ze?"bg-brand-600 text-white border-brand-600":"border-slate-200 text-slate-600 hover:bg-slate-100"}`,title:"Text & Style Settings","aria-label":"Text & Style Settings",children:[i.jsx(zt,{className:"h-3 w-3"}),i.jsx("span",{className:"hidden sm:inline",children:"Style"})]}),i.jsx("button",{onClick:Ao,className:`text-[11px] sm:text-xs px-2.5 sm:px-3 py-1.5 sm:py-1 rounded-full border whitespace-nowrap ${dt?"bg-brand-600 text-white border-brand-600":"border-slate-200 text-slate-600"}`,"aria-label":dt?"Switch to normal mode":"Switch to compact mode",children:dt?"Compact":"Normal"})]})]}),i.jsx(Qe,{children:ze&&i.jsx(Ce.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden border-b border-slate-200",children:i.jsxs("div",{className:"px-3 sm:px-4 py-3 bg-gradient-to-br from-brand-50 to-slate-50",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[i.jsx(zt,{className:"h-4 w-4 text-brand-600"}),i.jsx("h3",{className:"font-semibold text-slate-900 text-sm",children:"Text & Style Settings"})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-2",children:"Font Size"}),i.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(nt).map(([l,_])=>i.jsxs("button",{onClick:()=>Wn(l),className:`px-3 py-2 text-xs rounded-lg border transition-all ${Ye===l?"bg-brand-600 text-white border-brand-600 shadow-md":"bg-white text-slate-700 border-slate-200 hover:border-brand-300 hover:bg-brand-50"}`,children:[i.jsx("div",{className:"font-semibold",children:_.label}),i.jsx("div",{className:"text-[10px] opacity-75",children:_.description})]},l))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-2",children:"Line Spacing"}),i.jsx("div",{className:"grid grid-cols-1 gap-2",children:Object.entries(rs).map(([l,_])=>i.jsx("button",{onClick:()=>Xn(l),className:`px-3 py-2 text-xs rounded-lg border transition-all ${ut===l?"bg-brand-600 text-white border-brand-600 shadow-md":"bg-white text-slate-700 border-slate-200 hover:border-brand-300 hover:bg-brand-50"}`,children:_.label},l))})]})]}),i.jsxs("p",{className:"text-xs text-slate-500 mt-3 flex items-center gap-1",children:[i.jsx(He,{className:"h-3 w-3"}),"Settings are saved automatically and persist across sessions"]})]})})}),De&&i.jsxs("div",{className:"px-3 sm:px-4 py-2 sm:py-3 border-b border-slate-100 bg-slate-50 flex flex-wrap items-center gap-3",children:[i.jsxs("div",{className:"flex-1 min-w-[240px]",children:[i.jsx("p",{className:"text-xs uppercase font-semibold text-slate-500 tracking-wide",children:"Current question"}),i.jsx("p",{className:"font-medium text-slate-900",children:Jc(De.text,160)})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("button",{onClick:()=>zn(De.id),className:"px-3 py-1.5 text-xs rounded-full bg-white border border-slate-200 hover:border-brand-300 hover:text-brand-600 transition-colors flex items-center gap-1",children:[i.jsx(Lo,{className:"h-3 w-3"})," Jump to question"]}),i.jsxs("button",{onClick:()=>Bs(De.text),className:"px-3 py-1.5 text-xs rounded-full bg-brand-50 text-brand-700 border border-brand-100 flex items-center gap-1",children:[i.jsx(Ks,{className:"h-3 w-3"})," Save"]})]})]}),i.jsxs("div",{ref:Ne,className:`flex-1 overflow-y-auto p-3 sm:p-4 lg:p-5 ${ar} relative`,children:[r.map(l=>i.jsx(Ce.div,{id:`message-${l.id}`,initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex ${l.sender==="user"?"justify-end":"justify-start"}`,children:i.jsxs("div",{className:`max-w-[80%] rounded-2xl ${ir} group relative ${l.sender==="user"?"bg-brand-600 text-white rounded-br-none":l.isSystem?"bg-amber-50 text-amber-800 border border-amber-100":"bg-slate-100 text-slate-800 rounded-bl-none"} ${l.id===Ht?"ring-2 ring-brand-200 shadow-lg shadow-brand-200/60":""}`,children:[i.jsx("button",{onClick:()=>Ls(l.text),className:`absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded ${l.sender==="user"?"text-brand-100 hover:text-white hover:bg-brand-500":"text-slate-400 hover:text-brand-600 hover:bg-slate-200"}`,title:"Copy message","aria-label":"Copy message",children:i.jsx(Yt,{className:"h-4 w-4"})}),l.sender==="guru"&&!l.isSystem&&i.jsx("button",{onClick:()=>Bs(l.text),className:`absolute top-2 right-10 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded ${l.sender==="user"?"text-brand-100 hover:text-white hover:bg-brand-500":"text-slate-400 hover:text-brand-600 hover:bg-slate-200"}`,title:"Save to notes","aria-label":"Save to notes",children:i.jsx(Ks,{className:"h-4 w-4"})}),i.jsxs("div",{className:`flex items-center justify-between mb-1 opacity-75 ${or}`,children:[i.jsxs("div",{className:"flex items-center gap-2",children:[l.sender==="user"?i.jsx(pr,{className:"h-3 w-3"}):i.jsx(He,{className:"h-3 w-3"}),i.jsx("span",{className:"uppercase font-bold tracking-wider",children:l.sender})]}),ht(l)&&i.jsx("span",{className:`text-xs ${l.sender==="user"?"text-brand-100":"text-slate-400"}`,children:ht(l)})]}),i.jsx(lr,{text:l.text,shouldAnimate:l.id===Ht&&l.sender==="guru"&&!l.isSystem}),l.link&&i.jsx("div",{className:`mt-3 pt-3 border-t ${l.sender==="user"?"border-white/20":"border-black/10"}`,children:i.jsxs("a",{href:`#${l.link}`,className:`text-xs font-bold flex items-center gap-1 hover:underline ${l.sender==="user"?"text-white":"text-brand-600"}`,children:["View Resource ",i.jsx(yr,{className:"h-3 w-3"})]})})]})},l.id)),i.jsx(Qe,{children:$&&i.jsx(Ce.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex justify-start",children:i.jsxs("div",{className:"bg-slate-100 rounded-2xl rounded-bl-none p-4 flex gap-1",children:[i.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce"}),i.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce delay-75"}),i.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce delay-150"})]})})}),i.jsx("div",{ref:Me})]}),i.jsx(Qe,{children:!Ft&&i.jsx(Ce.button,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},onClick:Vn,className:"absolute bottom-24 right-4 bg-brand-600 text-white p-2 rounded-full shadow-lg hover:bg-brand-700 transition-colors z-10",title:"Scroll to bottom",children:i.jsx(wr,{className:"h-4 w-4"})})}),i.jsx(Ce.button,{initial:{opacity:0,scale:.8},animate:{opacity:.5,scale:1},whileHover:{opacity:1,scale:1.1},onClick:mo,className:"absolute bottom-36 right-4 bg-slate-100 text-slate-600 border border-slate-200 p-2 rounded-full shadow-md hover:bg-white hover:text-brand-600 transition-all z-10",title:"Scroll to top",children:i.jsx(Mo,{className:"h-4 w-4"})}),i.jsxs("div",{className:"p-3 sm:p-4 bg-white border-t border-slate-200 shadow-up z-10",children:[i.jsxs("div",{className:"flex gap-2",children:[i.jsx("textarea",{ref:Bt,value:o,onChange:l=>c(l.target.value),onKeyDown:l=>{l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),Gt())},placeholder:"Ask anything about Power BI...",className:"input-field flex-1 shadow-sm resize-none min-h-[48px] sm:min-h-[44px] max-h-[200px] text-base sm:text-sm",rows:1}),i.jsx("button",{onClick:Gt,disabled:!o.trim()||$,className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed min-w-[48px] sm:min-w-[44px]","aria-label":"Send message",children:i.jsx(br,{className:"h-5 w-5 sm:h-4 sm:w-4"})})]}),i.jsxs("p",{className:"text-[10px] sm:text-xs text-slate-400 mt-2 text-center flex flex-wrap items-center justify-center gap-x-2 gap-y-1",children:[i.jsx("span",{className:"hidden sm:inline",children:"Enter = Send"}),i.jsx("span",{className:"hidden sm:inline",children:"Shift+Enter = New line"}),i.jsx("span",{className:"sm:hidden",children:"Tap Send or press Enter"}),i.jsx("span",{className:"hidden md:inline",children:"Copy buttons appear when you hover a message"})]}),!u&&i.jsxs("p",{className:"text-xs text-slate-400 mt-2 text-center",children:["Running in ",i.jsx("span",{className:"font-semibold text-brand-600",children:"Local Knowledge Mode"}),". Add an Access Code for full AI features."]})]})]}),cr&&i.jsxs("div",{className:"flex flex-col gap-4 lg:gap-0 lg:flex-row shrink-0 w-full lg:w-auto",children:[Re&&i.jsx("div",{className:"hidden lg:flex items-center justify-center w-5 cursor-col-resize select-none text-slate-400 hover:bg-slate-100 hover:text-brand-500 transition-colors -ml-2.5 z-10 group",role:"separator","aria-label":"Resize session notes panel","aria-orientation":"vertical",tabIndex:0,onPointerDown:tr,onKeyDown:sr,title:"Drag to resize notes",children:i.jsx("div",{className:"flex flex-col items-center gap-1 bg-white/80 rounded-full px-1 py-3 shadow-sm border border-slate-200 group-hover:border-brand-300 group-hover:scale-110 transition-all",children:i.jsx(xr,{className:"h-4 w-4"})})}),i.jsx("aside",{className:"bg-white border border-slate-200 rounded-xl shadow-sm p-4 sm:p-5 flex flex-col w-full lg:w-auto min-h-[260px] max-h-[300px] lg:max-h-none transition-[width] duration-200",style:dr,children:ur})]})]})]})};export{bd as default};
