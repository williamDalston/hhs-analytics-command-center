import{c as E,u as Pt,r as h,j as t,b as Pe,T as Be,m as P,d as Fe,A as re,a as Bt}from"./index-DTWYKStE.js";import{C as le}from"./copy-Cf31OIn-.js";import{D as Ye}from"./download-BQlBxOAH.js";import{D as qe}from"./database-DKEW5e7M.js";import{S as Ve,K as Ft}from"./send-BQeUSq3q.js";import{C as Yt}from"./chevron-down-g7SQtYrc.js";const qt=[["path",{d:"M12 17V3",key:"1cwfxf"}],["path",{d:"m6 11 6 6 6-6",key:"12ii2o"}],["path",{d:"M19 21H5",key:"150jfl"}]],Vt=E("arrow-down-to-line",qt);const zt=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}],["line",{x1:"12",x2:"12",y1:"7",y2:"13",key:"1cppfj"}],["line",{x1:"15",x2:"9",y1:"10",y2:"10",key:"1gty7f"}]],ge=E("bookmark-plus",zt);const Wt=[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]],ze=E("bot",Wt);const Xt=[["path",{d:"M21 21H8a2 2 0 0 1-1.42-.587l-3.994-3.999a2 2 0 0 1 0-2.828l10-10a2 2 0 0 1 2.829 0l5.999 6a2 2 0 0 1 0 2.828L12.834 21",key:"g5wo59"}],["path",{d:"m5.082 11.09 8.828 8.828",key:"1wx5vj"}]],Jt=E("eraser",Xt);const Qt=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],We=E("grip-vertical",Qt);const Zt=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],es=E("maximize-2",Zt);const ts=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],ss=E("message-square",ts);const ns=[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]],os=E("minimize-2",ns);const as=[["path",{d:"M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4",key:"re6nr2"}],["path",{d:"M2 6h4",key:"aawbzj"}],["path",{d:"M2 10h4",key:"l0bgd4"}],["path",{d:"M2 14h4",key:"1gsvsf"}],["path",{d:"M2 18h4",key:"1bu2t1"}],["path",{d:"M21.378 5.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"pqwjuv"}]],is=E("notebook-pen",as);const rs=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M15 3v18",key:"14nvp0"}],["path",{d:"m8 9 3 3-3 3",key:"12hl5m"}]],Xe=E("panel-right-close",rs);const ls=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M15 3v18",key:"14nvp0"}],["path",{d:"m10 15-3-3 3-3",key:"1pgupc"}]],Je=E("panel-right-open",ls);const cs=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ds=E("settings",cs);const us=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],Qe=E("wand-sparkles",us);var Ze;(function(e){e.STRING="string",e.NUMBER="number",e.INTEGER="integer",e.BOOLEAN="boolean",e.ARRAY="array",e.OBJECT="object"})(Ze||(Ze={}));var et;(function(e){e.LANGUAGE_UNSPECIFIED="language_unspecified",e.PYTHON="python"})(et||(et={}));var tt;(function(e){e.OUTCOME_UNSPECIFIED="outcome_unspecified",e.OUTCOME_OK="outcome_ok",e.OUTCOME_FAILED="outcome_failed",e.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(tt||(tt={}));const st=["user","model","function","system"];var nt;(function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(nt||(nt={}));var ot;(function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"})(ot||(ot={}));var at;(function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"})(at||(at={}));var it;(function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER"})(it||(it={}));var X;(function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.OTHER="OTHER"})(X||(X={}));var rt;(function(e){e.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",e.RETRIEVAL_QUERY="RETRIEVAL_QUERY",e.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",e.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",e.CLASSIFICATION="CLASSIFICATION",e.CLUSTERING="CLUSTERING"})(rt||(rt={}));var lt;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE"})(lt||(lt={}));var ct;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"})(ct||(ct={}));class w extends Error{constructor(s){super(`[GoogleGenerativeAI Error]: ${s}`)}}class B extends w{constructor(s,n){super(s),this.response=n}}class wt extends w{constructor(s,n,a,i){super(s),this.status=n,this.statusText=a,this.errorDetails=i}}class O extends w{}class vt extends w{}const hs="https://generativelanguage.googleapis.com",fs="v1beta",ps="0.24.1",xs="genai-js";var G;(function(e){e.GENERATE_CONTENT="generateContent",e.STREAM_GENERATE_CONTENT="streamGenerateContent",e.COUNT_TOKENS="countTokens",e.EMBED_CONTENT="embedContent",e.BATCH_EMBED_CONTENTS="batchEmbedContents"})(G||(G={}));class ms{constructor(s,n,a,i,r){this.model=s,this.task=n,this.apiKey=a,this.stream=i,this.requestOptions=r}toString(){var s,n;const a=((s=this.requestOptions)===null||s===void 0?void 0:s.apiVersion)||fs;let r=`${((n=this.requestOptions)===null||n===void 0?void 0:n.baseUrl)||hs}/${a}/${this.model}:${this.task}`;return this.stream&&(r+="?alt=sse"),r}}function gs(e){const s=[];return e?.apiClient&&s.push(e.apiClient),s.push(`${xs}/${ps}`),s.join(" ")}async function bs(e){var s;const n=new Headers;n.append("Content-Type","application/json"),n.append("x-goog-api-client",gs(e.requestOptions)),n.append("x-goog-api-key",e.apiKey);let a=(s=e.requestOptions)===null||s===void 0?void 0:s.customHeaders;if(a){if(!(a instanceof Headers))try{a=new Headers(a)}catch(i){throw new O(`unable to convert customHeaders value ${JSON.stringify(a)} to Headers: ${i.message}`)}for(const[i,r]of a.entries()){if(i==="x-goog-api-key")throw new O(`Cannot set reserved header name ${i}`);if(i==="x-goog-api-client")throw new O(`Header name ${i} can only be set using the apiClient field`);n.append(i,r)}}return n}async function ys(e,s,n,a,i,r){const l=new ms(e,s,n,a,r);return{url:l.toString(),fetchOptions:Object.assign(Object.assign({},Cs(r)),{method:"POST",headers:await bs(l),body:i})}}async function Z(e,s,n,a,i,r={},l=fetch){const{url:c,fetchOptions:g}=await ys(e,s,n,a,i,r);return ws(c,g,l)}async function ws(e,s,n=fetch){let a;try{a=await n(e,s)}catch(i){vs(i,e)}return a.ok||await Ns(a,e),a}function vs(e,s){let n=e;throw n.name==="AbortError"?(n=new vt(`Request aborted when fetching ${s.toString()}: ${e.message}`),n.stack=e.stack):e instanceof wt||e instanceof O||(n=new w(`Error fetching from ${s.toString()}: ${e.message}`),n.stack=e.stack),n}async function Ns(e,s){let n="",a;try{const i=await e.json();n=i.error.message,i.error.details&&(n+=` ${JSON.stringify(i.error.details)}`,a=i.error.details)}catch{}throw new wt(`Error fetching from ${s.toString()}: [${e.status} ${e.statusText}] ${n}`,e.status,e.statusText,a)}function Cs(e){const s={};if(e?.signal!==void 0||e?.timeout>=0){const n=new AbortController;e?.timeout>=0&&setTimeout(()=>n.abort(),e.timeout),e?.signal&&e.signal.addEventListener("abort",()=>{n.abort()}),s.signal=n.signal}return s}function ye(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),de(e.candidates[0]))throw new B(`${R(e)}`,e);return Es(e)}else if(e.promptFeedback)throw new B(`Text not available. ${R(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),de(e.candidates[0]))throw new B(`${R(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),dt(e)[0]}else if(e.promptFeedback)throw new B(`Function call not available. ${R(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),de(e.candidates[0]))throw new B(`${R(e)}`,e);return dt(e)}else if(e.promptFeedback)throw new B(`Function call not available. ${R(e)}`,e)},e}function Es(e){var s,n,a,i;const r=[];if(!((n=(s=e.candidates)===null||s===void 0?void 0:s[0].content)===null||n===void 0)&&n.parts)for(const l of(i=(a=e.candidates)===null||a===void 0?void 0:a[0].content)===null||i===void 0?void 0:i.parts)l.text&&r.push(l.text),l.executableCode&&r.push("\n```"+l.executableCode.language+`
`+l.executableCode.code+"\n```\n"),l.codeExecutionResult&&r.push("\n```\n"+l.codeExecutionResult.output+"\n```\n");return r.length>0?r.join(""):""}function dt(e){var s,n,a,i;const r=[];if(!((n=(s=e.candidates)===null||s===void 0?void 0:s[0].content)===null||n===void 0)&&n.parts)for(const l of(i=(a=e.candidates)===null||a===void 0?void 0:a[0].content)===null||i===void 0?void 0:i.parts)l.functionCall&&r.push(l.functionCall);if(r.length>0)return r}const Ss=[X.RECITATION,X.SAFETY,X.LANGUAGE];function de(e){return!!e.finishReason&&Ss.includes(e.finishReason)}function R(e){var s,n,a;let i="";if((!e.candidates||e.candidates.length===0)&&e.promptFeedback)i+="Response was blocked",!((s=e.promptFeedback)===null||s===void 0)&&s.blockReason&&(i+=` due to ${e.promptFeedback.blockReason}`),!((n=e.promptFeedback)===null||n===void 0)&&n.blockReasonMessage&&(i+=`: ${e.promptFeedback.blockReasonMessage}`);else if(!((a=e.candidates)===null||a===void 0)&&a[0]){const r=e.candidates[0];de(r)&&(i+=`Candidate was blocked due to ${r.finishReason}`,r.finishMessage&&(i+=`: ${r.finishMessage}`))}return i}function J(e){return this instanceof J?(this.v=e,this):new J(e)}function Is(e,s,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a=n.apply(e,s||[]),i,r=[];return i={},l("next"),l("throw"),l("return"),i[Symbol.asyncIterator]=function(){return this},i;function l(x){a[x]&&(i[x]=function(m){return new Promise(function(y,I){r.push([x,m,y,I])>1||c(x,m)})})}function c(x,m){try{g(a[x](m))}catch(y){_(r[0][3],y)}}function g(x){x.value instanceof J?Promise.resolve(x.value.v).then(v,S):_(r[0][2],x)}function v(x){c("next",x)}function S(x){c("throw",x)}function _(x,m){x(m),r.shift(),r.length&&c(r[0][0],r[0][1])}}const ut=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function js(e){const s=e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),n=ks(s),[a,i]=n.tee();return{stream:As(a),response:_s(i)}}async function _s(e){const s=[],n=e.getReader();for(;;){const{done:a,value:i}=await n.read();if(a)return ye(Rs(s));s.push(i)}}function As(e){return Is(this,arguments,function*(){const n=e.getReader();for(;;){const{value:a,done:i}=yield J(n.read());if(i)break;yield yield J(ye(a))}})}function ks(e){const s=e.getReader();return new ReadableStream({start(a){let i="";return r();function r(){return s.read().then(({value:l,done:c})=>{if(c){if(i.trim()){a.error(new w("Failed to parse stream"));return}a.close();return}i+=l;let g=i.match(ut),v;for(;g;){try{v=JSON.parse(g[1])}catch{a.error(new w(`Error parsing JSON response: "${g[1]}"`));return}a.enqueue(v),i=i.substring(g[0].length),g=i.match(ut)}return r()}).catch(l=>{let c=l;throw c.stack=l.stack,c.name==="AbortError"?c=new vt("Request aborted when reading from the stream"):c=new w("Error reading from the stream"),c})}}})}function Rs(e){const s=e[e.length-1],n={promptFeedback:s?.promptFeedback};for(const a of e){if(a.candidates){let i=0;for(const r of a.candidates)if(n.candidates||(n.candidates=[]),n.candidates[i]||(n.candidates[i]={index:i}),n.candidates[i].citationMetadata=r.citationMetadata,n.candidates[i].groundingMetadata=r.groundingMetadata,n.candidates[i].finishReason=r.finishReason,n.candidates[i].finishMessage=r.finishMessage,n.candidates[i].safetyRatings=r.safetyRatings,r.content&&r.content.parts){n.candidates[i].content||(n.candidates[i].content={role:r.content.role||"user",parts:[]});const l={};for(const c of r.content.parts)c.text&&(l.text=c.text),c.functionCall&&(l.functionCall=c.functionCall),c.executableCode&&(l.executableCode=c.executableCode),c.codeExecutionResult&&(l.codeExecutionResult=c.codeExecutionResult),Object.keys(l).length===0&&(l.text=""),n.candidates[i].content.parts.push(l)}i++}a.usageMetadata&&(n.usageMetadata=a.usageMetadata)}return n}async function Nt(e,s,n,a){const i=await Z(s,G.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(n),a);return js(i)}async function Ct(e,s,n,a){const r=await(await Z(s,G.GENERATE_CONTENT,e,!1,JSON.stringify(n),a)).json();return{response:ye(r)}}function Et(e){if(e!=null){if(typeof e=="string")return{role:"system",parts:[{text:e}]};if(e.text)return{role:"system",parts:[e]};if(e.parts)return e.role?e:{role:"system",parts:e.parts}}}function Q(e){let s=[];if(typeof e=="string")s=[{text:e}];else for(const n of e)typeof n=="string"?s.push({text:n}):s.push(n);return Os(s)}function Os(e){const s={role:"user",parts:[]},n={role:"function",parts:[]};let a=!1,i=!1;for(const r of e)"functionResponse"in r?(n.parts.push(r),i=!0):(s.parts.push(r),a=!0);if(a&&i)throw new w("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!a&&!i)throw new w("No content is provided for sending chat message.");return a?s:n}function Ms(e,s){var n;let a={model:s?.model,generationConfig:s?.generationConfig,safetySettings:s?.safetySettings,tools:s?.tools,toolConfig:s?.toolConfig,systemInstruction:s?.systemInstruction,cachedContent:(n=s?.cachedContent)===null||n===void 0?void 0:n.name,contents:[]};const i=e.generateContentRequest!=null;if(e.contents){if(i)throw new O("CountTokensRequest must have one of contents or generateContentRequest, not both.");a.contents=e.contents}else if(i)a=Object.assign(Object.assign({},a),e.generateContentRequest);else{const r=Q(e);a.contents=[r]}return{generateContentRequest:a}}function ht(e){let s;return e.contents?s=e:s={contents:[Q(e)]},e.systemInstruction&&(s.systemInstruction=Et(e.systemInstruction)),s}function Ts(e){return typeof e=="string"||Array.isArray(e)?{content:Q(e)}:e}const ft=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],Ds={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function Ls(e){let s=!1;for(const n of e){const{role:a,parts:i}=n;if(!s&&a!=="user")throw new w(`First content should be with role 'user', got ${a}`);if(!st.includes(a))throw new w(`Each item should include role field. Got ${a} but valid roles are: ${JSON.stringify(st)}`);if(!Array.isArray(i))throw new w("Content should have 'parts' property with an array of Parts");if(i.length===0)throw new w("Each Content should have at least one part");const r={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const c of i)for(const g of ft)g in c&&(r[g]+=1);const l=Ds[a];for(const c of ft)if(!l.includes(c)&&r[c]>0)throw new w(`Content with role '${a}' can't contain '${c}' part`);s=!0}}function pt(e){var s;if(e.candidates===void 0||e.candidates.length===0)return!1;const n=(s=e.candidates[0])===null||s===void 0?void 0:s.content;if(n===void 0||n.parts===void 0||n.parts.length===0)return!1;for(const a of n.parts)if(a===void 0||Object.keys(a).length===0||a.text!==void 0&&a.text==="")return!1;return!0}const xt="SILENT_ERROR";class $s{constructor(s,n,a,i={}){this.model=n,this.params=a,this._requestOptions=i,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=s,a?.history&&(Ls(a.history),this._history=a.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(s,n={}){var a,i,r,l,c,g;await this._sendPromise;const v=Q(s),S={safetySettings:(a=this.params)===null||a===void 0?void 0:a.safetySettings,generationConfig:(i=this.params)===null||i===void 0?void 0:i.generationConfig,tools:(r=this.params)===null||r===void 0?void 0:r.tools,toolConfig:(l=this.params)===null||l===void 0?void 0:l.toolConfig,systemInstruction:(c=this.params)===null||c===void 0?void 0:c.systemInstruction,cachedContent:(g=this.params)===null||g===void 0?void 0:g.cachedContent,contents:[...this._history,v]},_=Object.assign(Object.assign({},this._requestOptions),n);let x;return this._sendPromise=this._sendPromise.then(()=>Ct(this._apiKey,this.model,S,_)).then(m=>{var y;if(pt(m.response)){this._history.push(v);const I=Object.assign({parts:[],role:"model"},(y=m.response.candidates)===null||y===void 0?void 0:y[0].content);this._history.push(I)}else{const I=R(m.response);I&&console.warn(`sendMessage() was unsuccessful. ${I}. Inspect response object for details.`)}x=m}).catch(m=>{throw this._sendPromise=Promise.resolve(),m}),await this._sendPromise,x}async sendMessageStream(s,n={}){var a,i,r,l,c,g;await this._sendPromise;const v=Q(s),S={safetySettings:(a=this.params)===null||a===void 0?void 0:a.safetySettings,generationConfig:(i=this.params)===null||i===void 0?void 0:i.generationConfig,tools:(r=this.params)===null||r===void 0?void 0:r.tools,toolConfig:(l=this.params)===null||l===void 0?void 0:l.toolConfig,systemInstruction:(c=this.params)===null||c===void 0?void 0:c.systemInstruction,cachedContent:(g=this.params)===null||g===void 0?void 0:g.cachedContent,contents:[...this._history,v]},_=Object.assign(Object.assign({},this._requestOptions),n),x=Nt(this._apiKey,this.model,S,_);return this._sendPromise=this._sendPromise.then(()=>x).catch(m=>{throw new Error(xt)}).then(m=>m.response).then(m=>{if(pt(m)){this._history.push(v);const y=Object.assign({},m.candidates[0].content);y.role||(y.role="model"),this._history.push(y)}else{const y=R(m);y&&console.warn(`sendMessageStream() was unsuccessful. ${y}. Inspect response object for details.`)}}).catch(m=>{m.message!==xt&&console.error(m)}),x}}async function Gs(e,s,n,a){return(await Z(s,G.COUNT_TOKENS,e,!1,JSON.stringify(n),a)).json()}async function Hs(e,s,n,a){return(await Z(s,G.EMBED_CONTENT,e,!1,JSON.stringify(n),a)).json()}async function Us(e,s,n,a){const i=n.requests.map(l=>Object.assign(Object.assign({},l),{model:s}));return(await Z(s,G.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:i}),a)).json()}class mt{constructor(s,n,a={}){this.apiKey=s,this._requestOptions=a,n.model.includes("/")?this.model=n.model:this.model=`models/${n.model}`,this.generationConfig=n.generationConfig||{},this.safetySettings=n.safetySettings||[],this.tools=n.tools,this.toolConfig=n.toolConfig,this.systemInstruction=Et(n.systemInstruction),this.cachedContent=n.cachedContent}async generateContent(s,n={}){var a;const i=ht(s),r=Object.assign(Object.assign({},this._requestOptions),n);return Ct(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(a=this.cachedContent)===null||a===void 0?void 0:a.name},i),r)}async generateContentStream(s,n={}){var a;const i=ht(s),r=Object.assign(Object.assign({},this._requestOptions),n);return Nt(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(a=this.cachedContent)===null||a===void 0?void 0:a.name},i),r)}startChat(s){var n;return new $s(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},s),this._requestOptions)}async countTokens(s,n={}){const a=Ms(s,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),i=Object.assign(Object.assign({},this._requestOptions),n);return Gs(this.apiKey,this.model,a,i)}async embedContent(s,n={}){const a=Ts(s),i=Object.assign(Object.assign({},this._requestOptions),n);return Hs(this.apiKey,this.model,a,i)}async batchEmbedContents(s,n={}){const a=Object.assign(Object.assign({},this._requestOptions),n);return Us(this.apiKey,this.model,s,a)}}class Ks{constructor(s){this.apiKey=s}getGenerativeModel(s,n){if(!s.model)throw new w("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new mt(this.apiKey,s,n)}getGenerativeModelFromCachedContent(s,n,a){if(!s.name)throw new O("Cached content must contain a `name` field.");if(!s.model)throw new O("Cached content must contain a `model` field.");const i=["model","systemInstruction"];for(const l of i)if(n?.[l]&&s[l]&&n?.[l]!==s[l]){if(l==="model"){const c=n.model.startsWith("models/")?n.model.replace("models/",""):n.model,g=s.model.startsWith("models/")?s.model.replace("models/",""):s.model;if(c===g)continue}throw new O(`Different value for "${l}" specified in modelParams (${n[l]}) and cachedContent (${s[l]})`)}const r=Object.assign(Object.assign({},n),{model:s.model,tools:s.tools,toolConfig:s.toolConfig,systemInstruction:s.systemInstruction,cachedContent:s});return new mt(this.apiKey,r,a)}}const Ps=[{keywords:["yoy","year over year","growth"],answer:"For Year-over-Year growth, use the 'YoY Growth %' pattern in the DAX Library. It uses `SAMEPERIODLASTYEAR`.",link:"/dax"},{keywords:["blue","color","hex","brand"],answer:"The official HHS Blue hex code is #005EA2. You can find the full palette in the Style Guide.",link:"/style-guide"},{keywords:["pareto","80/20"],answer:"We have a Pareto Analysis pattern in the DAX Library under 'Advanced Analytics'.",link:"/dax"},{keywords:["font","typography"],answer:"The approved font is 'Source Sans Pro'. See the Style Guide for heading sizes.",link:"/style-guide"},{keywords:["dax","measure","calculation"],answer:"The DAX Library contains patterns for Time Intelligence, Financial Formulas, and more. Check the 'DAX Library' tab.",link:"/dax"}],z=180,be=4e3,Bs=280,W=(e,s,n)=>Math.min(Math.max(e,s),n),Fs=()=>typeof window>"u"?360:W(window.innerWidth*.3,z,be),ce=()=>({id:"welcome",text:"Hi, I'm your Analytics Assistant. Ask me about DAX, HHS Branding, or data strategy.",sender:"bot",isSystem:!0,createdAt:new Date().toISOString()}),gt=[{label:"Generate DAX",value:"Create a reusable DAX measure for year-over-year revenue with clear comments."},{label:"Explain Visual",value:"Explain how to design an executive KPI card for Power BI with HHS branding guidance."},{label:"Build Checklist",value:"Give me a pre-publish checklist for a Power BI report destined for leadership review."},{label:"Debug Measure",value:"Help me troubleshoot why my DAX measure is returning blank values."}],bt="guru_session_notes",yt="guru_messages",St=["gemini-2.5-flash","gemini-2.0-flash","gemini-1.5-flash","gemini-pro"],Ys=["v1beta","v1"],qs=St[0],ue="AIzaSyDwiE6kUBveR6ncuUlphCbdK2EGqeLnMXY".trim()||"",Vs=()=>{if(typeof window>"u")return"";const e=window.localStorage.getItem("gemini_api_key");return e?e.trim():""},zs=()=>{const e=Vs();return e?{key:e,source:"custom"}:ue?{key:ue,source:"project"}:{key:"",source:"none"}},Ws=(e,s=120)=>e?e.length>s?`${e.slice(0,s)}…`:e:"",sn=()=>{const{addToast:e}=Pt(),s=h.useRef(zs()),[n,a]=h.useState(()=>{if(typeof window>"u")return[ce()];try{const o=window.localStorage.getItem(yt);return o?JSON.parse(o):[ce()]}catch(o){return console.error("Failed to parse messages",o),[ce()]}}),[i,r]=h.useState(""),[l,c]=h.useState(s.current.key),[g,v]=h.useState(s.current.source==="custom"?s.current.key:""),[S,_]=h.useState(s.current.source==="custom"),[x,m]=h.useState(!1),[y,I]=h.useState(!1),[ee,M]=h.useState(s.current.key?"connecting":"idle"),[It,T]=h.useState(""),[we,te]=h.useState(null),se=h.useRef(null),he=h.useRef(null),[jt,_t]=h.useState(!0),F=h.useRef(null),k=h.useRef(null),[ve,fe]=h.useState(()=>Fs()),[N,At]=h.useState(!1),[Y,kt]=h.useState(()=>typeof window>"u"?!1:window.innerWidth>=1024),[D,pe]=h.useState(()=>typeof window>"u"?"":window.localStorage.getItem(bt)||""),[H,Rt]=h.useState(!1),[Ne,Ot]=h.useState(!1),[L,Ce]=h.useState(null),[ne,q]=h.useState(null),oe=h.useCallback(()=>{if(!k.current||typeof window>"u")return be;const o=window.getComputedStyle(k.current),d=parseFloat(o.columnGap||o.gap||"0")||0,u=k.current.getBoundingClientRect().width-d-Bs;return W(u,z,be)},[k]),$=h.useCallback(()=>{if(typeof window>"u")return;const o=window.innerWidth>=1024;if(kt(o),!o)return;const d=oe();fe(p=>W(p,z,d))},[oe]);h.useEffect(()=>{},[]),h.useEffect(()=>{if($(),!(typeof window>"u"))return window.addEventListener("resize",$),()=>window.removeEventListener("resize",$)},[$]),h.useEffect(()=>{$()},[Ne,$]),h.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(yt,JSON.stringify(n))},[n]);const Ee=o=>{if(!o)return;const d=document.getElementById(`message-${o}`);d&&d.scrollIntoView({behavior:"smooth",block:"start"})};h.useEffect(()=>{const o=n[n.length-1];if(o?.sender==="bot"&&!o.isSystem&&L?.id){Ee(L.id);return}se.current?.scrollIntoView({behavior:"smooth"})},[n,L]),h.useEffect(()=>{const o=he.current;if(!o)return;const d=()=>{const{scrollTop:p,scrollHeight:u,clientHeight:f}=o,b=p+f>=u-10;_t(b)};return o.addEventListener("scroll",d),d(),()=>o.removeEventListener("scroll",d)},[n]);const Se=()=>{se.current?.scrollIntoView({behavior:"smooth"})};h.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(bt,D)},[D]),h.useEffect(()=>{if(!F.current)return;const o=F.current;o.style.height="auto";const d=200;o.style.height=`${Math.min(o.scrollHeight,d)}px`},[i]),h.useEffect(()=>{const o=l.trim();if(!o){M("idle"),T(""),te(null);return}let d=!1;const p=new AbortController;return(async()=>{M("connecting"),T(""),te(null);for(const f of Ys)try{const b=await fetch(`https://generativelanguage.googleapis.com/${f}/models/${encodeURIComponent(qs)}?key=${encodeURIComponent(o)}`,{signal:p.signal});if(!b.ok){const C=await b.json().catch(()=>({})),j=C?.error?.message||"Unable to verify access code";if(b.status===404||C?.error?.status==="NOT_FOUND")continue;throw new Error(j)}if(d)return;M("connected"),T(""),te(f);return}catch{if(p.signal.aborted||d)return;break}M("idle"),T(""),te(null)})(),()=>{d=!0,p.abort()}},[l]);const Mt=()=>{const o=g.trim();if(!o){e("Please enter a valid access code","error");return}typeof window<"u"&&window.localStorage.setItem("gemini_api_key",o),_(!0),c(o),v(""),M("connecting"),T(""),m(!1),e("Personal access code saved. Connecting now...","success")},Tt=()=>{typeof window<"u"&&window.localStorage.removeItem("gemini_api_key");const o=ue||"";_(!1),v(""),c(o),M(o?"connecting":"idle"),T(""),e(o?"Reverted to the built-in HHS access code.":"Access code removed. Running in local knowledge mode.","info")},Dt=o=>{const d=o.toLowerCase();return Ps.find(p=>p.keywords.some(u=>d.includes(u)))},xe=async o=>{if(o)try{if(typeof navigator>"u"||!navigator.clipboard)throw new Error("Clipboard unavailable");await navigator.clipboard.writeText(o),e("Message copied to clipboard","success")}catch(d){console.error("Copy failed",d),e("Unable to copy message","error")}},Ie=()=>{confirm("Clear this conversation and start fresh?")&&(a([ce()]),e("Conversation cleared","success"),Se(),Ce(null),q(null))},je=()=>{const o=n.filter(f=>!f.isSystem).map(f=>`${f.sender.toUpperCase()} (${V(f,!0)}):
${f.text}`).join(`

---

`),d=new Blob([o],{type:"text/plain"}),p=URL.createObjectURL(d),u=document.createElement("a");u.href=p,u.download=`power-bi-guru-chat-${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(p),e("Chat exported","success")},_e=o=>{r(o),F.current?.focus()},Lt=async()=>{if(!D.trim()){e("No notes to copy","info");return}try{await navigator.clipboard.writeText(D),e("Session notes copied","success")}catch(o){console.error("Copy notes failed",o),e("Unable to copy notes","error")}},$t=()=>{D.trim()&&confirm("Clear session notes?")&&(pe(""),e("Session notes cleared","success"))},Ae=o=>{if(!Y||N||!k.current)return;o.preventDefault();const d=o.clientX,p=ve,u=document.body.style.userSelect;document.body.style.userSelect="none";const f=C=>{const j=oe(),K=C.clientX-d,ie=W(p-K,z,j);fe(ie)},b=()=>{document.body.style.userSelect=u,window.removeEventListener("pointermove",f),window.removeEventListener("pointerup",b)};window.addEventListener("pointermove",f),window.addEventListener("pointerup",b)},ke=o=>{if(!Y||N||!k.current||o.key!=="ArrowLeft"&&o.key!=="ArrowRight")return;o.preventDefault();const d=oe(),p=o.key==="ArrowLeft"?24:-24;fe(u=>W(u+p,z,d))},Re=()=>{At(o=>!o),typeof window<"u"&&requestAnimationFrame(()=>$())},Gt=()=>{Rt(o=>!o)},Oe=()=>{Ot(o=>!o)},me=o=>{o&&(pe(d=>`${d?`${d}

`:""}${o}`),e("Saved to session notes","success"))},V=(o,d=!1)=>{if(o.isSystem&&o.id==="welcome"&&!d)return"";const p=o.createdAt||(typeof o.id=="number"?new Date(o.id).toISOString():null),u=p?new Date(p):d?new Date:null;return u?u.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""},Me=H?"space-y-2":"space-y-4",Te=H?"p-3 text-[13px]":"p-4 text-sm",De=H?"text-[10px]":"text-xs",Ht=(o,d)=>{const[p,u]=h.useState(d?"":o);return h.useEffect(()=>{if(!d){u(o);return}let f=0;const b=setInterval(()=>{if(f>=o.length){clearInterval(b),u(o);return}const j=o.length>1e3?50:o.length>500?25:10;u(o.slice(0,f+j)),f+=j},10);return()=>clearInterval(b)},[o,d]),p},Le=({text:o,shouldAnimate:d})=>{const p=Ht(o,d);if(!p)return t.jsx("span",{className:"animate-pulse",children:"..."});const u=p.split(/(```[\s\S]*?```)/g);return t.jsx("div",{className:`whitespace-pre-wrap leading-relaxed ${H?"text-[13px]":"text-sm"}`,children:u.map((f,b)=>{if(f.startsWith("```")&&f.endsWith("```")){const C=f.match(/^```(\w+)?\n([\s\S]*)```$/),j=C?C[1]:"",K=C?C[2]:f.slice(3,-3);return t.jsxs("div",{className:"my-3 rounded-lg bg-slate-800 text-slate-100 overflow-hidden shadow-sm border border-slate-700",children:[t.jsxs("div",{className:"flex items-center justify-between px-3 py-1.5 bg-slate-900/50 text-xs text-slate-400 border-b border-white/10 select-none",children:[t.jsx("span",{className:"uppercase font-semibold tracking-wider text-[10px]",children:j||"CODE"}),t.jsxs("button",{onClick:ie=>{ie.stopPropagation(),xe(K.trim())},className:"hover:text-white flex items-center gap-1.5 transition-colors","aria-label":"Copy code",children:[t.jsx(le,{className:"h-3 w-3"})," Copy"]})]}),t.jsx("pre",{className:"p-3 overflow-x-auto font-mono text-xs sm:text-sm scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-transparent",children:t.jsx("code",{children:K.trim()})})]},b)}return t.jsx("span",{children:f},b)})})},ae=async()=>{if(!i.trim())return;const o={id:Date.now(),text:i,sender:"user",createdAt:new Date().toISOString()};a(u=>[...u,o]),r(""),I(!0),Ce({id:o.id,text:o.text});const d=Dt(o.text);if(d){setTimeout(()=>{const u={id:Date.now()+1,text:d.answer,sender:"bot",link:d.link,createdAt:new Date().toISOString()};a(f=>[...f,u]),q(u.id),I(!1)},600);return}const p=l.trim();if(p){try{const u=new Ks(p);let f,b;for(const A of St)try{f=u.getGenerativeModel({model:A,systemInstruction:"You are an expert Power BI Developer and Data Analyst for the US Department of Health and Human Services (HHS). Answer questions concisely and professionally. If it involves DAX, provide code snippets."});break}catch(Kt){b=Kt;continue}if(!f)throw b||new Error("No compatible Gemini model found");const j=[...n.filter(A=>!A.isError&&!A.isSystem).map(A=>({role:A.sender==="user"?"user":"model",parts:[{text:A.text}]})),{role:"user",parts:[{text:o.text}]}],Ut=(await(await f.generateContent({contents:j,generationConfig:{maxOutputTokens:1e3}})).response).text(),Ke={id:Date.now()+1,text:Ut,sender:"bot",createdAt:new Date().toISOString()};a(A=>[...A,Ke]),q(Ke.id)}catch(u){console.error("AI Connection Error:",u.message);const f=u.message?.includes("API_KEY")||u.message?.includes("PERMISSION_DENIED")||u.message?.includes("INVALID_ARGUMENT");f&&(M("error"),T("Invalid API key or insufficient permissions"));const b={id:Date.now()+1,text:f?"I couldn't connect to the AI service with the current access code. Please update your API key in settings, or I can help with local knowledge about DAX and Power BI.":"I'm having trouble connecting to the AI service right now. Let me help with what I know about DAX and Power BI instead.",sender:"bot",isError:!0,createdAt:new Date().toISOString()};a(C=>[...C,b]),q(b.id)}finally{I(!1)}return}setTimeout(()=>{const u={id:Date.now()+1,text:"I don't have an answer for that in my local knowledge base. To unlock full AI capabilities, please configure the AI Access Code in settings.",sender:"bot",isSystem:!0,createdAt:new Date().toISOString()};a(f=>[...f,u]),q(u.id),I(!1)},600)},$e=!!ue,U=l?ee==="connected"?{text:we?`AI Connected (${we})`:"AI Connected",className:"bg-emerald-100 text-emerald-700"}:ee==="connecting"?{text:"Verifying Access Code",className:"bg-sky-100 text-sky-700"}:ee==="error"?{text:"Connection Error",className:"bg-rose-100 text-rose-700"}:null:null,Ge=!N,He=Y?{width:`${ve}px`}:void 0,Ue=t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center justify-between mb-3 gap-2",children:[t.jsxs("div",{children:[t.jsxs("p",{className:"text-sm font-semibold text-slate-900 flex items-center gap-2",children:[t.jsx(is,{className:"h-4 w-4 text-brand-500"}),"Session Notes"]}),t.jsx("p",{className:"text-xs text-slate-500",children:"Capture insights or follow-ups"})]}),t.jsxs("div",{className:"flex gap-1",children:[t.jsx("button",{onClick:Lt,className:"p-2 text-slate-400 hover:text-brand-600 hover:bg-brand-50 rounded transition-colors",title:"Copy notes","aria-label":"Copy notes",children:t.jsx(le,{className:"h-4 w-4"})}),t.jsx("button",{onClick:$t,className:"p-2 text-slate-400 hover:text-rose-600 hover:bg-rose-50 rounded transition-colors",title:"Clear notes","aria-label":"Clear notes",children:t.jsx(Jt,{className:"h-4 w-4"})})]})]}),t.jsx("textarea",{value:D,onChange:o=>pe(o.target.value),placeholder:"Capture project context, action items, or next steps...",className:"input-field flex-1 min-h-[200px] resize-none"}),t.jsxs("p",{className:"text-[11px] text-slate-400 text-right mt-2",children:["Autosaved locally • ",D.trim().length," chars"]})]});return Ne?t.jsxs("div",{className:"fixed inset-0 z-50 bg-white flex flex-col",children:[t.jsxs("div",{className:"bg-slate-50 border-b border-slate-200 px-4 py-3 flex flex-wrap items-center justify-between gap-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Pe,{className:"h-5 w-5 text-brand-600"}),t.jsx("h2",{className:"text-lg font-bold text-slate-900",children:"Power BI Guru"}),U&&t.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full font-medium ${U.className}`,children:U.text})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsxs("button",{onClick:Re,"aria-pressed":!N,"aria-label":N?"Show notes panel":"Hide notes panel",className:`p-2 rounded-lg text-sm font-medium flex items-center gap-2 border transition-colors ${N?"border-slate-200 text-slate-600 hover:bg-slate-100":"bg-brand-50 text-brand-700 border-brand-100"}`,children:[N?t.jsx(Je,{className:"h-4 w-4"}):t.jsx(Xe,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:N?"Show notes":"Hide notes"})]}),t.jsx("button",{onClick:Oe,className:"p-2 hover:bg-slate-200 rounded-lg transition-colors text-slate-600",title:"Exit Fullscreen",children:t.jsx(os,{className:"h-5 w-5"})})]})]}),t.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:t.jsxs("div",{ref:k,className:"flex-1 flex flex-col gap-4 lg:flex-row lg:items-stretch px-4 pb-4 pt-2 overflow-hidden",children:[t.jsxs("div",{className:"flex-1 flex flex-col min-w-0 bg-white relative border border-slate-200 rounded-xl shadow-sm",children:[t.jsxs("div",{className:"px-4 py-2 border-b border-slate-100 bg-white flex items-center gap-2 overflow-x-auto shrink-0",children:[t.jsxs("div",{className:"flex items-center gap-2 text-xs font-semibold uppercase text-slate-500 whitespace-nowrap",children:[t.jsx(Qe,{className:"h-3 w-3 text-brand-500"}),"Quick prompts"]}),t.jsx("div",{className:"flex gap-2",children:gt.map(o=>t.jsx("button",{onClick:()=>_e(o.value),className:"flex-shrink-0 px-3 py-1 text-xs bg-slate-100 text-slate-700 rounded-full hover:bg-brand-50 hover:text-brand-700 transition-colors whitespace-nowrap",children:o.label},o.label))}),t.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[t.jsx("button",{onClick:je,className:"p-1.5 text-slate-400 hover:text-slate-600 hover:bg-slate-200 rounded transition-colors",title:"Export chat","aria-label":"Export chat",children:t.jsx(Ye,{className:"h-4 w-4"})}),t.jsx("button",{onClick:Ie,className:"p-1.5 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded transition-colors",title:"Clear chat","aria-label":"Clear chat",children:t.jsx(Be,{className:"h-4 w-4"})})]})]}),t.jsxs("div",{ref:he,className:`flex-1 overflow-y-auto p-4 md:p-8 ${Me} relative`,children:[n.map(o=>t.jsx(P.div,{id:`message-${o.id}`,initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex ${o.sender==="user"?"justify-end":"justify-start"}`,children:t.jsxs("div",{className:`max-w-[90%] md:max-w-[70%] rounded-2xl ${Te} group relative shadow-sm ${o.sender==="user"?"bg-brand-600 text-white rounded-br-none":o.isSystem?"bg-amber-50 text-amber-800 border border-amber-100":"bg-slate-100 text-slate-800 rounded-bl-none"} ${o.id===ne?"ring-2 ring-brand-200 shadow-brand-200/60":""}`,children:[t.jsx("button",{onClick:()=>xe(o.text),className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity text-slate-400 hover:text-brand-600 bg-white/20 p-1 rounded",title:"Copy message","aria-label":"Copy message",children:t.jsx(le,{className:"h-3 w-3"})}),o.sender==="bot"&&!o.isSystem&&t.jsx("button",{onClick:()=>me(o.text),className:"absolute top-2 right-12 opacity-0 group-hover:opacity-100 transition-opacity text-slate-400 hover:text-brand-600 bg-white/20 p-1 rounded",title:"Save to notes","aria-label":"Save to notes",children:t.jsx(ge,{className:"h-3 w-3"})}),t.jsxs("div",{className:`flex items-center justify-between mb-1 opacity-75 ${De}`,children:[t.jsxs("div",{className:"flex items-center gap-2",children:[o.sender==="user"?t.jsx(Fe,{className:"h-3 w-3"}):t.jsx(ze,{className:"h-3 w-3"}),t.jsx("span",{className:"uppercase font-bold tracking-wider",children:o.sender})]}),V(o)&&t.jsx("span",{className:"opacity-75",children:V(o)})]}),t.jsx(Le,{text:o.text,shouldAnimate:o.id===ne&&o.sender==="bot"&&!o.isSystem}),o.link&&t.jsx("div",{className:"mt-3 pt-3 border-t border-black/10",children:t.jsxs("a",{href:`#${o.link}`,className:"text-xs font-bold flex items-center gap-1 hover:underline",children:["View Resource ",t.jsx(qe,{className:"h-3 w-3"})]})})]})},o.id)),t.jsx(re,{children:y&&t.jsx(P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex justify-start",children:t.jsxs("div",{className:"bg-slate-100 rounded-2xl rounded-bl-none p-4 flex gap-1",children:[t.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce"}),t.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce delay-75"}),t.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce delay-150"})]})})}),t.jsx("div",{ref:se})]}),t.jsxs("div",{className:"p-4 bg-slate-50 border-t border-slate-200 shrink-0",children:[t.jsxs("div",{className:"max-w-4xl mx-auto w-full flex gap-2",children:[t.jsx("textarea",{ref:F,value:i,onChange:o=>r(o.target.value),onKeyDown:o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),ae())},placeholder:"Ask anything about Power BI... (Shift+Enter for new line)",className:"input-field flex-1 shadow-sm resize-none min-h-[48px] max-h-[200px]",rows:1}),t.jsx("button",{onClick:ae,disabled:!i.trim()||y,className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed px-6","aria-label":"Send message",children:t.jsx(Ve,{className:"h-5 w-5"})})]}),!l&&t.jsxs("p",{className:"text-xs text-slate-400 mt-2 text-center",children:["Running in ",t.jsx("span",{className:"font-semibold text-brand-600",children:"Local Knowledge Mode"}),". Add an Access Code for full AI features."]})]})]}),Ge&&t.jsxs("div",{className:"flex flex-col gap-4 lg:gap-0 lg:flex-row shrink-0 w-full lg:w-auto",children:[Y&&t.jsx("div",{className:"hidden lg:flex items-center justify-center w-5 cursor-col-resize select-none text-slate-400 hover:bg-slate-100 hover:text-brand-500 transition-colors -ml-2.5 z-10",role:"separator","aria-label":"Resize session notes panel","aria-orientation":"vertical",tabIndex:0,onPointerDown:Ae,onKeyDown:ke,title:"Drag to resize notes",children:t.jsx("div",{className:"flex flex-col items-center gap-1 bg-white/80 rounded-full px-1 py-3 shadow-sm border border-slate-200",children:t.jsx(We,{className:"h-4 w-4"})})}),t.jsx("div",{className:"border border-slate-200 bg-slate-50 rounded-xl shadow-inner p-4 sm:p-5 flex flex-col w-full lg:w-auto transition-[width] duration-200",style:He,children:Ue})]})]})})]}):t.jsxs("div",{className:"flex flex-col gap-4 min-h-[calc(100vh-10rem)] sm:min-h-[calc(100vh-8rem)]",children:[t.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3 mb-2 sm:mb-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-2xl font-bold text-slate-900 flex items-center gap-2",children:[t.jsx(Pe,{className:"h-6 w-6 text-brand-600"}),"Power BI Guru",U&&t.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full font-medium ${U.className}`,children:U.text})]}),t.jsx("p",{className:"text-slate-600",children:"Your AI assistant for DAX, Design, and Strategy."}),l&&t.jsx("p",{className:"mt-1 text-xs text-slate-500",children:S?"Using your personal Gemini access code.":$e?"Using the built-in HHS Gemini access code.":"Using the currently stored Gemini access code."}),ee==="error"&&l&&t.jsxs("p",{className:"mt-1 text-sm text-rose-600 flex items-center gap-1",children:[t.jsx(Bt,{className:"h-4 w-4"}),t.jsx("span",{children:It||"Unable to connect to the AI. Update the access code in settings."})]})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsxs("button",{onClick:Re,"aria-pressed":!N,"aria-label":N?"Show notes panel":"Hide notes panel",className:`p-2 rounded-lg text-sm font-medium flex items-center gap-2 border transition-colors ${N?"border-slate-200 text-slate-600 hover:bg-slate-100":"bg-brand-50 text-brand-700 border-brand-100"}`,children:[N?t.jsx(Je,{className:"h-4 w-4"}):t.jsx(Xe,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:N?"Show notes":"Hide notes"})]}),t.jsx("button",{onClick:Oe,className:"p-2 rounded-lg bg-slate-100 text-slate-600 hover:bg-slate-200 transition-colors",title:"Maximize (Fullscreen Mode)",children:t.jsx(es,{className:"h-5 w-5"})}),t.jsx("button",{onClick:()=>m(!x),className:`p-2 rounded-lg transition-colors ${x?"bg-brand-50 text-brand-700":S?"bg-emerald-100 text-emerald-700":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,title:"Manage AI Access Code",children:t.jsx(ds,{className:"h-5 w-5"})})]})]}),t.jsx(re,{children:x&&t.jsx(P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden mb-4",children:t.jsxs("div",{className:"bg-slate-50 border border-slate-200 rounded-lg p-4",children:[t.jsxs("h3",{className:"font-semibold text-slate-900 mb-2 flex items-center gap-2",children:[t.jsx(Ft,{className:"h-4 w-4"})," AI Settings"]}),t.jsx("p",{className:"text-sm text-slate-600 mb-3",children:"Enter your access code to enable full AI chat capabilities."}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"password",value:g,onChange:o=>v(o.target.value),placeholder:"Enter Access Code...",className:"input-field flex-1"}),t.jsx("button",{onClick:Mt,className:"btn-primary",children:"Save & Connect"}),S&&t.jsx("button",{onClick:Tt,className:"btn-secondary text-red-600 hover:bg-red-50",children:"Clear"})]}),t.jsxs("div",{className:"text-xs text-slate-500 mt-3 space-y-1",children:[t.jsx("p",{children:S?"Currently using your personal Gemini key. Clear to switch back to the built-in HHS access code.":$e?"Using the built-in HHS Gemini key by default. Add your own key if you need to run chats under a personal quota.":"No access code is configured yet. Add one to enable cloud AI responses."}),t.jsx("p",{className:"text-slate-400",children:"Any personal key you add stays in your browser only."})]})]})})}),t.jsxs("div",{ref:k,className:"flex-1 flex flex-col gap-4 lg:flex-row lg:items-stretch overflow-hidden",children:[t.jsxs("div",{className:"flex-1 bg-white border border-slate-200 rounded-xl shadow-sm overflow-hidden flex flex-col relative min-w-0 min-h-[420px]",children:[t.jsxs("div",{className:"bg-slate-50 border-b border-slate-200 px-3 sm:px-4 py-2 sm:py-3 flex flex-wrap items-center gap-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ss,{className:"h-4 w-4 text-slate-500"}),t.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Conversation"}),t.jsxs("span",{className:"text-xs text-slate-500 bg-slate-200 px-2 py-0.5 rounded-full",children:[n.filter(o=>!o.isSystem).length," messages"]})]}),t.jsxs("div",{className:"flex gap-1.5 sm:gap-2 ml-auto",children:[t.jsx("button",{onClick:je,className:"p-1.5 text-slate-400 hover:text-slate-600 hover:bg-slate-200 rounded transition-colors",title:"Export chat",children:t.jsx(Ye,{className:"h-4 w-4"})}),t.jsx("button",{onClick:Ie,className:"p-1.5 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded transition-colors",title:"Clear chat",children:t.jsx(Be,{className:"h-4 w-4"})})]})]}),t.jsxs("div",{className:"px-3 sm:px-4 py-2 sm:py-3 border-b border-slate-100 bg-white flex flex-wrap items-center gap-2",children:[t.jsxs("div",{className:"flex items-center gap-2 text-xs font-semibold uppercase text-slate-500",children:[t.jsx(Qe,{className:"h-3 w-3 text-brand-500"}),"Quick prompts"]}),t.jsx("div",{className:"flex flex-wrap gap-2",children:gt.map(o=>t.jsx("button",{onClick:()=>_e(o.value),className:"px-3 py-1 text-xs bg-slate-100 text-slate-700 rounded-full hover:bg-brand-50 hover:text-brand-700 transition-colors",children:o.label},o.label))}),t.jsx("button",{onClick:Gt,className:`ml-auto text-xs px-3 py-1 rounded-full border ${H?"bg-brand-600 text-white border-brand-600":"border-slate-200 text-slate-600"}`,children:H?"Compact mode on":"Compact mode off"})]}),L&&t.jsxs("div",{className:"px-3 sm:px-4 py-2 sm:py-3 border-b border-slate-100 bg-slate-50 flex flex-wrap items-center gap-3",children:[t.jsxs("div",{className:"flex-1 min-w-[240px]",children:[t.jsx("p",{className:"text-xs uppercase font-semibold text-slate-500 tracking-wide",children:"Current question"}),t.jsx("p",{className:"font-medium text-slate-900",children:Ws(L.text,160)})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("button",{onClick:()=>Ee(L.id),className:"px-3 py-1.5 text-xs rounded-full bg-white border border-slate-200 hover:border-brand-300 hover:text-brand-600 transition-colors flex items-center gap-1",children:[t.jsx(Vt,{className:"h-3 w-3"})," Jump to question"]}),t.jsxs("button",{onClick:()=>me(L.text),className:"px-3 py-1.5 text-xs rounded-full bg-brand-50 text-brand-700 border border-brand-100 flex items-center gap-1",children:[t.jsx(ge,{className:"h-3 w-3"})," Save"]})]})]}),t.jsxs("div",{ref:he,className:`flex-1 overflow-y-auto p-3 sm:p-4 lg:p-5 ${Me} relative`,children:[n.map(o=>t.jsx(P.div,{id:`message-${o.id}`,initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex ${o.sender==="user"?"justify-end":"justify-start"}`,children:t.jsxs("div",{className:`max-w-[80%] rounded-2xl ${Te} group relative ${o.sender==="user"?"bg-brand-600 text-white rounded-br-none":o.isSystem?"bg-amber-50 text-amber-800 border border-amber-100":"bg-slate-100 text-slate-800 rounded-bl-none"} ${o.id===ne?"ring-2 ring-brand-200 shadow-lg shadow-brand-200/60":""}`,children:[t.jsx("button",{onClick:()=>xe(o.text),className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity text-slate-400 hover:text-brand-600",title:"Copy message","aria-label":"Copy message",children:t.jsx(le,{className:"h-4 w-4"})}),o.sender==="bot"&&!o.isSystem&&t.jsx("button",{onClick:()=>me(o.text),className:"absolute top-2 right-10 opacity-0 group-hover:opacity-100 transition-opacity text-slate-400 hover:text-brand-600",title:"Save to notes","aria-label":"Save to notes",children:t.jsx(ge,{className:"h-4 w-4"})}),t.jsxs("div",{className:`flex items-center justify-between mb-1 opacity-75 ${De}`,children:[t.jsxs("div",{className:"flex items-center gap-2",children:[o.sender==="user"?t.jsx(Fe,{className:"h-3 w-3"}):t.jsx(ze,{className:"h-3 w-3"}),t.jsx("span",{className:"uppercase font-bold tracking-wider",children:o.sender})]}),V(o)&&t.jsx("span",{className:"text-slate-400",children:V(o)})]}),t.jsx(Le,{text:o.text,shouldAnimate:o.id===ne&&o.sender==="bot"&&!o.isSystem}),o.link&&t.jsx("div",{className:"mt-3 pt-3 border-t border-black/10",children:t.jsxs("a",{href:`#${o.link}`,className:"text-xs font-bold flex items-center gap-1 hover:underline",children:["View Resource ",t.jsx(qe,{className:"h-3 w-3"})]})})]})},o.id)),t.jsx(re,{children:y&&t.jsx(P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex justify-start",children:t.jsxs("div",{className:"bg-slate-100 rounded-2xl rounded-bl-none p-4 flex gap-1",children:[t.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce"}),t.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce delay-75"}),t.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce delay-150"})]})})}),t.jsx("div",{ref:se})]}),t.jsx(re,{children:!jt&&t.jsx(P.button,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},onClick:Se,className:"absolute bottom-24 right-4 bg-brand-600 text-white p-2 rounded-full shadow-lg hover:bg-brand-700 transition-colors z-10",title:"Scroll to bottom",children:t.jsx(Yt,{className:"h-4 w-4"})})}),t.jsxs("div",{className:"p-3 sm:p-4 bg-slate-50 border-t border-slate-200",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx("textarea",{ref:F,value:i,onChange:o=>r(o.target.value),onKeyDown:o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),ae())},placeholder:"Ask anything about Power BI... (Shift+Enter for new line)",className:"input-field flex-1 shadow-sm resize-none min-h-[48px] max-h-[200px]",rows:1}),t.jsx("button",{onClick:ae,disabled:!i.trim()||y,className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Send message",children:t.jsx(Ve,{className:"h-4 w-4"})})]}),t.jsxs("p",{className:"text-xs text-slate-400 mt-2 text-center flex flex-wrap items-center justify-center gap-2",children:[t.jsx("span",{children:"Enter = Send"}),t.jsx("span",{children:"Shift+Enter = New line"}),t.jsx("span",{children:"Copy buttons appear when you hover a message"})]}),!l&&t.jsxs("p",{className:"text-xs text-slate-400 mt-2 text-center",children:["Running in ",t.jsx("span",{className:"font-semibold text-brand-600",children:"Local Knowledge Mode"}),". Add an Access Code for full AI features."]})]})]}),Ge&&t.jsxs("div",{className:"flex flex-col gap-4 lg:gap-0 lg:flex-row shrink-0 w-full lg:w-auto",children:[Y&&t.jsx("div",{className:"hidden lg:flex items-center justify-center w-5 cursor-col-resize select-none text-slate-400 hover:bg-slate-100 hover:text-brand-500 transition-colors -ml-2.5 z-10",role:"separator","aria-label":"Resize session notes panel","aria-orientation":"vertical",tabIndex:0,onPointerDown:Ae,onKeyDown:ke,title:"Drag to resize notes",children:t.jsx("div",{className:"flex flex-col items-center gap-1 bg-white/80 rounded-full px-1 py-3 shadow-sm border border-slate-200",children:t.jsx(We,{className:"h-4 w-4"})})}),t.jsx("aside",{className:"bg-white border border-slate-200 rounded-xl shadow-sm p-4 sm:p-5 flex flex-col w-full lg:w-auto min-h-[260px] transition-[width] duration-200",style:He,children:Ue})]})]})]})};export{sn as default};
