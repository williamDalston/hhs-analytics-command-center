import{d as Ro,c as oe,u as Oo,e as jo,r as N,j as i,f as Le,T as ur,A as ze,m as Se,h as hr,a as fr}from"./index-DE0rIXK_.js";import{C as qt}from"./copy-BmmwHTvq.js";import{T as Xt}from"./type-CPNjxQbR.js";import{D as pr}from"./download-Dlr2Ls5S.js";import{D as mr}from"./database-oe90iFQf.js";import{S as gr,K as To}from"./send-DMg1MClI.js";import{a as br,C as $o}from"./chevron-up-BmMtaR_w.js";var Mo=Ro();const Po=[["path",{d:"M12 17V3",key:"1cwfxf"}],["path",{d:"m6 11 6 6 6-6",key:"12ii2o"}],["path",{d:"M19 21H5",key:"150jfl"}]],Do=oe("arrow-down-to-line",Po);const Lo=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}],["line",{x1:"12",x2:"12",y1:"7",y2:"13",key:"1cppfj"}],["line",{x1:"15",x2:"9",y1:"10",y2:"10",key:"1gty7f"}]],Us=oe("bookmark-plus",Lo);const Fo=[["path",{d:"M21 21H8a2 2 0 0 1-1.42-.587l-3.994-3.999a2 2 0 0 1 0-2.828l10-10a2 2 0 0 1 2.829 0l5.999 6a2 2 0 0 1 0 2.828L12.834 21",key:"g5wo59"}],["path",{d:"m5.082 11.09 8.828 8.828",key:"1wx5vj"}]],Ho=oe("eraser",Fo);const Bo=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],yr=oe("grip-vertical",Bo);const Uo=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],Go=oe("maximize-2",Uo);const Ko=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],Wo=oe("message-square",Ko);const qo=[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]],Xo=oe("minimize-2",qo);const Yo=[["path",{d:"M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4",key:"re6nr2"}],["path",{d:"M2 6h4",key:"aawbzj"}],["path",{d:"M2 10h4",key:"l0bgd4"}],["path",{d:"M2 14h4",key:"1gsvsf"}],["path",{d:"M2 18h4",key:"1bu2t1"}],["path",{d:"M21.378 5.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"pqwjuv"}]],wr=oe("notebook-pen",Yo);const Vo=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m16 15-3-3 3-3",key:"14y99z"}]],xr=oe("panel-left-close",Vo);const zo=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m14 9 3 3-3 3",key:"8010ee"}]],_r=oe("panel-left-open",zo);const Jo=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M15 3v18",key:"14nvp0"}],["path",{d:"m8 9 3 3-3 3",key:"12hl5m"}]],vr=oe("panel-right-close",Jo);const Qo=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M15 3v18",key:"14nvp0"}],["path",{d:"m10 15-3-3 3-3",key:"1pgupc"}]],Sr=oe("panel-right-open",Qo);const Zo=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],Cr=oe("rotate-cw",Zo);const el=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],tl=oe("settings",el);const sl=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],Ar=oe("wand-sparkles",sl);var Er;(function(s){s.STRING="string",s.NUMBER="number",s.INTEGER="integer",s.BOOLEAN="boolean",s.ARRAY="array",s.OBJECT="object"})(Er||(Er={}));var Nr;(function(s){s.LANGUAGE_UNSPECIFIED="language_unspecified",s.PYTHON="python"})(Nr||(Nr={}));var Ir;(function(s){s.OUTCOME_UNSPECIFIED="outcome_unspecified",s.OUTCOME_OK="outcome_ok",s.OUTCOME_FAILED="outcome_failed",s.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(Ir||(Ir={}));const kr=["user","model","function","system"];var Rr;(function(s){s.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",s.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",s.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",s.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",s.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",s.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(Rr||(Rr={}));var Or;(function(s){s.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",s.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",s.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",s.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",s.BLOCK_NONE="BLOCK_NONE"})(Or||(Or={}));var jr;(function(s){s.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",s.NEGLIGIBLE="NEGLIGIBLE",s.LOW="LOW",s.MEDIUM="MEDIUM",s.HIGH="HIGH"})(jr||(jr={}));var Tr;(function(s){s.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",s.SAFETY="SAFETY",s.OTHER="OTHER"})(Tr||(Tr={}));var At;(function(s){s.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",s.STOP="STOP",s.MAX_TOKENS="MAX_TOKENS",s.SAFETY="SAFETY",s.RECITATION="RECITATION",s.LANGUAGE="LANGUAGE",s.BLOCKLIST="BLOCKLIST",s.PROHIBITED_CONTENT="PROHIBITED_CONTENT",s.SPII="SPII",s.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",s.OTHER="OTHER"})(At||(At={}));var $r;(function(s){s.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",s.RETRIEVAL_QUERY="RETRIEVAL_QUERY",s.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",s.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",s.CLASSIFICATION="CLASSIFICATION",s.CLUSTERING="CLUSTERING"})($r||($r={}));var Mr;(function(s){s.MODE_UNSPECIFIED="MODE_UNSPECIFIED",s.AUTO="AUTO",s.ANY="ANY",s.NONE="NONE"})(Mr||(Mr={}));var Pr;(function(s){s.MODE_UNSPECIFIED="MODE_UNSPECIFIED",s.MODE_DYNAMIC="MODE_DYNAMIC"})(Pr||(Pr={}));class ne extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class Je extends ne{constructor(e,t){super(e),this.response=t}}class Aa extends ne{constructor(e,t,n,r){super(e),this.status=t,this.statusText=n,this.errorDetails=r}}class je extends ne{}class Ea extends ne{}const nl="https://generativelanguage.googleapis.com",rl="v1beta",al="0.24.1",il="genai-js";var Ge;(function(s){s.GENERATE_CONTENT="generateContent",s.STREAM_GENERATE_CONTENT="streamGenerateContent",s.COUNT_TOKENS="countTokens",s.EMBED_CONTENT="embedContent",s.BATCH_EMBED_CONTENTS="batchEmbedContents"})(Ge||(Ge={}));class ol{constructor(e,t,n,r,a){this.model=e,this.task=t,this.apiKey=n,this.stream=r,this.requestOptions=a}toString(){var e,t;const n=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||rl;let a=`${((t=this.requestOptions)===null||t===void 0?void 0:t.baseUrl)||nl}/${n}/${this.model}:${this.task}`;return this.stream&&(a+="?alt=sse"),a}}function ll(s){const e=[];return s?.apiClient&&e.push(s.apiClient),e.push(`${il}/${al}`),e.join(" ")}async function cl(s){var e;const t=new Headers;t.append("Content-Type","application/json"),t.append("x-goog-api-client",ll(s.requestOptions)),t.append("x-goog-api-key",s.apiKey);let n=(e=s.requestOptions)===null||e===void 0?void 0:e.customHeaders;if(n){if(!(n instanceof Headers))try{n=new Headers(n)}catch(r){throw new je(`unable to convert customHeaders value ${JSON.stringify(n)} to Headers: ${r.message}`)}for(const[r,a]of n.entries()){if(r==="x-goog-api-key")throw new je(`Cannot set reserved header name ${r}`);if(r==="x-goog-api-client")throw new je(`Header name ${r} can only be set using the apiClient field`);t.append(r,a)}}return t}async function dl(s,e,t,n,r,a){const o=new ol(s,e,t,n,a);return{url:o.toString(),fetchOptions:Object.assign(Object.assign({},pl(a)),{method:"POST",headers:await cl(o),body:r})}}async function jt(s,e,t,n,r,a={},o=fetch){const{url:c,fetchOptions:u}=await dl(s,e,t,n,r,a);return ul(c,u,o)}async function ul(s,e,t=fetch){let n;try{n=await t(s,e)}catch(r){hl(r,s)}return n.ok||await fl(n,s),n}function hl(s,e){let t=s;throw t.name==="AbortError"?(t=new Ea(`Request aborted when fetching ${e.toString()}: ${s.message}`),t.stack=s.stack):s instanceof Aa||s instanceof je||(t=new ne(`Error fetching from ${e.toString()}: ${s.message}`),t.stack=s.stack),t}async function fl(s,e){let t="",n;try{const r=await s.json();t=r.error.message,r.error.details&&(t+=` ${JSON.stringify(r.error.details)}`,n=r.error.details)}catch{}throw new Aa(`Error fetching from ${e.toString()}: [${s.status} ${s.statusText}] ${t}`,s.status,s.statusText,n)}function pl(s){const e={};if(s?.signal!==void 0||s?.timeout>=0){const t=new AbortController;s?.timeout>=0&&setTimeout(()=>t.abort(),s.timeout),s?.signal&&s.signal.addEventListener("abort",()=>{t.abort()}),e.signal=t.signal}return e}function bn(s){return s.text=()=>{if(s.candidates&&s.candidates.length>0){if(s.candidates.length>1&&console.warn(`This response had ${s.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),ns(s.candidates[0]))throw new Je(`${Oe(s)}`,s);return ml(s)}else if(s.promptFeedback)throw new Je(`Text not available. ${Oe(s)}`,s);return""},s.functionCall=()=>{if(s.candidates&&s.candidates.length>0){if(s.candidates.length>1&&console.warn(`This response had ${s.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),ns(s.candidates[0]))throw new Je(`${Oe(s)}`,s);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),Dr(s)[0]}else if(s.promptFeedback)throw new Je(`Function call not available. ${Oe(s)}`,s)},s.functionCalls=()=>{if(s.candidates&&s.candidates.length>0){if(s.candidates.length>1&&console.warn(`This response had ${s.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),ns(s.candidates[0]))throw new Je(`${Oe(s)}`,s);return Dr(s)}else if(s.promptFeedback)throw new Je(`Function call not available. ${Oe(s)}`,s)},s}function ml(s){var e,t,n,r;const a=[];if(!((t=(e=s.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(const o of(r=(n=s.candidates)===null||n===void 0?void 0:n[0].content)===null||r===void 0?void 0:r.parts)o.text&&a.push(o.text),o.executableCode&&a.push("\n```"+o.executableCode.language+`
`+o.executableCode.code+"\n```\n"),o.codeExecutionResult&&a.push("\n```\n"+o.codeExecutionResult.output+"\n```\n");return a.length>0?a.join(""):""}function Dr(s){var e,t,n,r;const a=[];if(!((t=(e=s.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(const o of(r=(n=s.candidates)===null||n===void 0?void 0:n[0].content)===null||r===void 0?void 0:r.parts)o.functionCall&&a.push(o.functionCall);if(a.length>0)return a}const gl=[At.RECITATION,At.SAFETY,At.LANGUAGE];function ns(s){return!!s.finishReason&&gl.includes(s.finishReason)}function Oe(s){var e,t,n;let r="";if((!s.candidates||s.candidates.length===0)&&s.promptFeedback)r+="Response was blocked",!((e=s.promptFeedback)===null||e===void 0)&&e.blockReason&&(r+=` due to ${s.promptFeedback.blockReason}`),!((t=s.promptFeedback)===null||t===void 0)&&t.blockReasonMessage&&(r+=`: ${s.promptFeedback.blockReasonMessage}`);else if(!((n=s.candidates)===null||n===void 0)&&n[0]){const a=s.candidates[0];ns(a)&&(r+=`Candidate was blocked due to ${a.finishReason}`,a.finishMessage&&(r+=`: ${a.finishMessage}`))}return r}function kt(s){return this instanceof kt?(this.v=s,this):new kt(s)}function bl(s,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(s,e||[]),r,a=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(g){n[g]&&(r[g]=function(h){return new Promise(function(v,w){a.push([g,h,v,w])>1||c(g,h)})})}function c(g,h){try{u(n[g](h))}catch(v){p(a[0][3],v)}}function u(g){g.value instanceof kt?Promise.resolve(g.value.v).then(f,b):p(a[0][2],g)}function f(g){c("next",g)}function b(g){c("throw",g)}function p(g,h){g(h),a.shift(),a.length&&c(a[0][0],a[0][1])}}const Lr=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function yl(s){const e=s.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),t=_l(e),[n,r]=t.tee();return{stream:xl(n),response:wl(r)}}async function wl(s){const e=[],t=s.getReader();for(;;){const{done:n,value:r}=await t.read();if(n)return bn(vl(e));e.push(r)}}function xl(s){return bl(this,arguments,function*(){const t=s.getReader();for(;;){const{value:n,done:r}=yield kt(t.read());if(r)break;yield yield kt(bn(n))}})}function _l(s){const e=s.getReader();return new ReadableStream({start(n){let r="";return a();function a(){return e.read().then(({value:o,done:c})=>{if(c){if(r.trim()){n.error(new ne("Failed to parse stream"));return}n.close();return}r+=o;let u=r.match(Lr),f;for(;u;){try{f=JSON.parse(u[1])}catch{n.error(new ne(`Error parsing JSON response: "${u[1]}"`));return}n.enqueue(f),r=r.substring(u[0].length),u=r.match(Lr)}return a()}).catch(o=>{let c=o;throw c.stack=o.stack,c.name==="AbortError"?c=new Ea("Request aborted when reading from the stream"):c=new ne("Error reading from the stream"),c})}}})}function vl(s){const e=s[s.length-1],t={promptFeedback:e?.promptFeedback};for(const n of s){if(n.candidates){let r=0;for(const a of n.candidates)if(t.candidates||(t.candidates=[]),t.candidates[r]||(t.candidates[r]={index:r}),t.candidates[r].citationMetadata=a.citationMetadata,t.candidates[r].groundingMetadata=a.groundingMetadata,t.candidates[r].finishReason=a.finishReason,t.candidates[r].finishMessage=a.finishMessage,t.candidates[r].safetyRatings=a.safetyRatings,a.content&&a.content.parts){t.candidates[r].content||(t.candidates[r].content={role:a.content.role||"user",parts:[]});const o={};for(const c of a.content.parts)c.text&&(o.text=c.text),c.functionCall&&(o.functionCall=c.functionCall),c.executableCode&&(o.executableCode=c.executableCode),c.codeExecutionResult&&(o.codeExecutionResult=c.codeExecutionResult),Object.keys(o).length===0&&(o.text=""),t.candidates[r].content.parts.push(o)}r++}n.usageMetadata&&(t.usageMetadata=n.usageMetadata)}return t}async function Na(s,e,t,n){const r=await jt(e,Ge.STREAM_GENERATE_CONTENT,s,!0,JSON.stringify(t),n);return yl(r)}async function Ia(s,e,t,n){const a=await(await jt(e,Ge.GENERATE_CONTENT,s,!1,JSON.stringify(t),n)).json();return{response:bn(a)}}function ka(s){if(s!=null){if(typeof s=="string")return{role:"system",parts:[{text:s}]};if(s.text)return{role:"system",parts:[s]};if(s.parts)return s.role?s:{role:"system",parts:s.parts}}}function Rt(s){let e=[];if(typeof s=="string")e=[{text:s}];else for(const t of s)typeof t=="string"?e.push({text:t}):e.push(t);return Sl(e)}function Sl(s){const e={role:"user",parts:[]},t={role:"function",parts:[]};let n=!1,r=!1;for(const a of s)"functionResponse"in a?(t.parts.push(a),r=!0):(e.parts.push(a),n=!0);if(n&&r)throw new ne("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!n&&!r)throw new ne("No content is provided for sending chat message.");return n?e:t}function Cl(s,e){var t;let n={model:e?.model,generationConfig:e?.generationConfig,safetySettings:e?.safetySettings,tools:e?.tools,toolConfig:e?.toolConfig,systemInstruction:e?.systemInstruction,cachedContent:(t=e?.cachedContent)===null||t===void 0?void 0:t.name,contents:[]};const r=s.generateContentRequest!=null;if(s.contents){if(r)throw new je("CountTokensRequest must have one of contents or generateContentRequest, not both.");n.contents=s.contents}else if(r)n=Object.assign(Object.assign({},n),s.generateContentRequest);else{const a=Rt(s);n.contents=[a]}return{generateContentRequest:n}}function Fr(s){let e;return s.contents?e=s:e={contents:[Rt(s)]},s.systemInstruction&&(e.systemInstruction=ka(s.systemInstruction)),e}function Al(s){return typeof s=="string"||Array.isArray(s)?{content:Rt(s)}:s}const Hr=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],El={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function Nl(s){let e=!1;for(const t of s){const{role:n,parts:r}=t;if(!e&&n!=="user")throw new ne(`First content should be with role 'user', got ${n}`);if(!kr.includes(n))throw new ne(`Each item should include role field. Got ${n} but valid roles are: ${JSON.stringify(kr)}`);if(!Array.isArray(r))throw new ne("Content should have 'parts' property with an array of Parts");if(r.length===0)throw new ne("Each Content should have at least one part");const a={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const c of r)for(const u of Hr)u in c&&(a[u]+=1);const o=El[n];for(const c of Hr)if(!o.includes(c)&&a[c]>0)throw new ne(`Content with role '${n}' can't contain '${c}' part`);e=!0}}function Br(s){var e;if(s.candidates===void 0||s.candidates.length===0)return!1;const t=(e=s.candidates[0])===null||e===void 0?void 0:e.content;if(t===void 0||t.parts===void 0||t.parts.length===0)return!1;for(const n of t.parts)if(n===void 0||Object.keys(n).length===0||n.text!==void 0&&n.text==="")return!1;return!0}const Ur="SILENT_ERROR";class Il{constructor(e,t,n,r={}){this.model=t,this.params=n,this._requestOptions=r,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,n?.history&&(Nl(n.history),this._history=n.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,t={}){var n,r,a,o,c,u;await this._sendPromise;const f=Rt(e),b={safetySettings:(n=this.params)===null||n===void 0?void 0:n.safetySettings,generationConfig:(r=this.params)===null||r===void 0?void 0:r.generationConfig,tools:(a=this.params)===null||a===void 0?void 0:a.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(c=this.params)===null||c===void 0?void 0:c.systemInstruction,cachedContent:(u=this.params)===null||u===void 0?void 0:u.cachedContent,contents:[...this._history,f]},p=Object.assign(Object.assign({},this._requestOptions),t);let g;return this._sendPromise=this._sendPromise.then(()=>Ia(this._apiKey,this.model,b,p)).then(h=>{var v;if(Br(h.response)){this._history.push(f);const w=Object.assign({parts:[],role:"model"},(v=h.response.candidates)===null||v===void 0?void 0:v[0].content);this._history.push(w)}else{const w=Oe(h.response);w&&console.warn(`sendMessage() was unsuccessful. ${w}. Inspect response object for details.`)}g=h}).catch(h=>{throw this._sendPromise=Promise.resolve(),h}),await this._sendPromise,g}async sendMessageStream(e,t={}){var n,r,a,o,c,u;await this._sendPromise;const f=Rt(e),b={safetySettings:(n=this.params)===null||n===void 0?void 0:n.safetySettings,generationConfig:(r=this.params)===null||r===void 0?void 0:r.generationConfig,tools:(a=this.params)===null||a===void 0?void 0:a.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(c=this.params)===null||c===void 0?void 0:c.systemInstruction,cachedContent:(u=this.params)===null||u===void 0?void 0:u.cachedContent,contents:[...this._history,f]},p=Object.assign(Object.assign({},this._requestOptions),t),g=Na(this._apiKey,this.model,b,p);return this._sendPromise=this._sendPromise.then(()=>g).catch(h=>{throw new Error(Ur)}).then(h=>h.response).then(h=>{if(Br(h)){this._history.push(f);const v=Object.assign({},h.candidates[0].content);v.role||(v.role="model"),this._history.push(v)}else{const v=Oe(h);v&&console.warn(`sendMessageStream() was unsuccessful. ${v}. Inspect response object for details.`)}}).catch(h=>{h.message!==Ur&&console.error(h)}),g}}async function kl(s,e,t,n){return(await jt(e,Ge.COUNT_TOKENS,s,!1,JSON.stringify(t),n)).json()}async function Rl(s,e,t,n){return(await jt(e,Ge.EMBED_CONTENT,s,!1,JSON.stringify(t),n)).json()}async function Ol(s,e,t,n){const r=t.requests.map(o=>Object.assign(Object.assign({},o),{model:e}));return(await jt(e,Ge.BATCH_EMBED_CONTENTS,s,!1,JSON.stringify({requests:r}),n)).json()}class Gr{constructor(e,t,n={}){this.apiKey=e,this._requestOptions=n,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=ka(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(e,t={}){var n;const r=Fr(e),a=Object.assign(Object.assign({},this._requestOptions),t);return Ia(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},r),a)}async generateContentStream(e,t={}){var n;const r=Fr(e),a=Object.assign(Object.assign({},this._requestOptions),t);return Na(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},r),a)}startChat(e){var t;return new Il(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(t=this.cachedContent)===null||t===void 0?void 0:t.name},e),this._requestOptions)}async countTokens(e,t={}){const n=Cl(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),r=Object.assign(Object.assign({},this._requestOptions),t);return kl(this.apiKey,this.model,n,r)}async embedContent(e,t={}){const n=Al(e),r=Object.assign(Object.assign({},this._requestOptions),t);return Rl(this.apiKey,this.model,n,r)}async batchEmbedContents(e,t={}){const n=Object.assign(Object.assign({},this._requestOptions),t);return Ol(this.apiKey,this.model,e,n)}}class jl{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new ne("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new Gr(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,n){if(!e.name)throw new je("Cached content must contain a `name` field.");if(!e.model)throw new je("Cached content must contain a `model` field.");const r=["model","systemInstruction"];for(const o of r)if(t?.[o]&&e[o]&&t?.[o]!==e[o]){if(o==="model"){const c=t.model.startsWith("models/")?t.model.replace("models/",""):t.model,u=e.model.startsWith("models/")?e.model.replace("models/",""):e.model;if(c===u)continue}throw new je(`Different value for "${o}" specified in modelParams (${t[o]}) and cachedContent (${e[o]})`)}const a=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new Gr(this.apiKey,a,n)}}function E(s,e,t,n,r){if(typeof e=="function"?s!==e||!0:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(s,t),t}function d(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)}let Ra=function(){const{crypto:s}=globalThis;if(s?.randomUUID)return Ra=s.randomUUID.bind(s),s.randomUUID();const e=new Uint8Array(1),t=s?()=>s.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^t()&15>>+n/4).toString(16))};function Zs(s){return typeof s=="object"&&s!==null&&("name"in s&&s.name==="AbortError"||"message"in s&&String(s.message).includes("FetchRequestCanceledException"))}const en=s=>{if(s instanceof Error)return s;if(typeof s=="object"&&s!==null){try{if(Object.prototype.toString.call(s)==="[object Error]"){const e=new Error(s.message,s.cause?{cause:s.cause}:{});return s.stack&&(e.stack=s.stack),s.cause&&!e.cause&&(e.cause=s.cause),s.name&&(e.name=s.name),e}}catch{}try{return new Error(JSON.stringify(s))}catch{}}return new Error(s)};class C extends Error{}class se extends C{constructor(e,t,n,r){super(`${se.makeMessage(e,t,n)}`),this.status=e,this.headers=r,this.requestID=r?.get("x-request-id"),this.error=t;const a=t;this.code=a?.code,this.param=a?.param,this.type=a?.type}static makeMessage(e,t,n){const r=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,n,r){if(!e||!r)return new Ss({message:n,cause:en(t)});const a=t?.error;return e===400?new Oa(e,a,n,r):e===401?new ja(e,a,n,r):e===403?new Ta(e,a,n,r):e===404?new $a(e,a,n,r):e===409?new Ma(e,a,n,r):e===422?new Pa(e,a,n,r):e===429?new Da(e,a,n,r):e>=500?new La(e,a,n,r):new se(e,a,n,r)}}class pe extends se{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class Ss extends se{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class yn extends Ss{constructor({message:e}={}){super({message:e??"Request timed out."})}}class Oa extends se{}class ja extends se{}class Ta extends se{}class $a extends se{}class Ma extends se{}class Pa extends se{}class Da extends se{}class La extends se{}class Fa extends C{constructor(){super("Could not parse response content as the length limit was reached")}}class Ha extends C{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class pt extends Error{constructor(e){super(e)}}const Tl=/^[a-z][a-z0-9+.-]*:/i,$l=s=>Tl.test(s);let ce=s=>(ce=Array.isArray,ce(s)),Kr=ce;function Ba(s){return typeof s!="object"?{}:s??{}}function Ml(s){if(!s)return!0;for(const e in s)return!1;return!0}function Pl(s,e){return Object.prototype.hasOwnProperty.call(s,e)}function Gs(s){return s!=null&&typeof s=="object"&&!Array.isArray(s)}const Dl=(s,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new C(`${s} must be an integer`);if(e<0)throw new C(`${s} must be a positive integer`);return e},Ll=s=>{try{return JSON.parse(s)}catch{return}},Tt=s=>new Promise(e=>setTimeout(e,s)),st="6.9.1",Fl=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function Hl(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const Bl=()=>{const s=Hl();if(s==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":st,"X-Stainless-OS":qr(Deno.build.os),"X-Stainless-Arch":Wr(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":st,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(s==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":st,"X-Stainless-OS":qr(globalThis.process.platform??"unknown"),"X-Stainless-Arch":Wr(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};const e=Ul();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":st,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":st,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Ul(){if(typeof navigator>"u"||!navigator)return null;const s=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of s){const n=t.exec(navigator.userAgent);if(n){const r=n[1]||0,a=n[2]||0,o=n[3]||0;return{browser:e,version:`${r}.${a}.${o}`}}}return null}const Wr=s=>s==="x32"?"x32":s==="x86_64"||s==="x64"?"x64":s==="arm"?"arm":s==="aarch64"||s==="arm64"?"arm64":s?`other:${s}`:"unknown",qr=s=>(s=s.toLowerCase(),s.includes("ios")?"iOS":s==="android"?"Android":s==="darwin"?"MacOS":s==="win32"?"Windows":s==="freebsd"?"FreeBSD":s==="openbsd"?"OpenBSD":s==="linux"?"Linux":s?`Other:${s}`:"Unknown");let Xr;const Gl=()=>Xr??(Xr=Bl());function Kl(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function Ua(...s){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...s)}function Ga(s){let e=Symbol.asyncIterator in s?s[Symbol.asyncIterator]():s[Symbol.iterator]();return Ua({start(){},async pull(t){const{done:n,value:r}=await e.next();n?t.close():t.enqueue(r)},async cancel(){await e.return?.()}})}function Ka(s){if(s[Symbol.asyncIterator])return s;const e=s.getReader();return{async next(){try{const t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function Wl(s){if(s===null||typeof s!="object")return;if(s[Symbol.asyncIterator]){await s[Symbol.asyncIterator]().return?.();return}const e=s.getReader(),t=e.cancel();e.releaseLock(),await t}const ql=({headers:s,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)}),Wa="RFC3986",qa=s=>String(s),Yr={RFC1738:s=>String(s).replace(/%20/g,"+"),RFC3986:qa},Xl="RFC1738";let tn=(s,e)=>(tn=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),tn(s,e));const ye=(()=>{const s=[];for(let e=0;e<256;++e)s.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return s})(),Ks=1024,Yl=(s,e,t,n,r)=>{if(s.length===0)return s;let a=s;if(typeof s=="symbol"?a=Symbol.prototype.toString.call(s):typeof s!="string"&&(a=String(s)),t==="iso-8859-1")return escape(a).replace(/%u[0-9a-f]{4}/gi,function(c){return"%26%23"+parseInt(c.slice(2),16)+"%3B"});let o="";for(let c=0;c<a.length;c+=Ks){const u=a.length>=Ks?a.slice(c,c+Ks):a,f=[];for(let b=0;b<u.length;++b){let p=u.charCodeAt(b);if(p===45||p===46||p===95||p===126||p>=48&&p<=57||p>=65&&p<=90||p>=97&&p<=122||r===Xl&&(p===40||p===41)){f[f.length]=u.charAt(b);continue}if(p<128){f[f.length]=ye[p];continue}if(p<2048){f[f.length]=ye[192|p>>6]+ye[128|p&63];continue}if(p<55296||p>=57344){f[f.length]=ye[224|p>>12]+ye[128|p>>6&63]+ye[128|p&63];continue}b+=1,p=65536+((p&1023)<<10|u.charCodeAt(b)&1023),f[f.length]=ye[240|p>>18]+ye[128|p>>12&63]+ye[128|p>>6&63]+ye[128|p&63]}o+=f.join("")}return o};function Vl(s){return!s||typeof s!="object"?!1:!!(s.constructor&&s.constructor.isBuffer&&s.constructor.isBuffer(s))}function Vr(s,e){if(ce(s)){const t=[];for(let n=0;n<s.length;n+=1)t.push(e(s[n]));return t}return e(s)}const Xa={brackets(s){return String(s)+"[]"},comma:"comma",indices(s,e){return String(s)+"["+e+"]"},repeat(s){return String(s)}},Ya=function(s,e){Array.prototype.push.apply(s,ce(e)?e:[e])};let zr;const Y={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:Yl,encodeValuesOnly:!1,format:Wa,formatter:qa,indices:!1,serializeDate(s){return(zr??(zr=Function.prototype.call.bind(Date.prototype.toISOString)))(s)},skipNulls:!1,strictNullHandling:!1};function zl(s){return typeof s=="string"||typeof s=="number"||typeof s=="boolean"||typeof s=="symbol"||typeof s=="bigint"}const Ws={};function Va(s,e,t,n,r,a,o,c,u,f,b,p,g,h,v,w,L,P){let _=s,G=P,M=0,V=!1;for(;(G=G.get(Ws))!==void 0&&!V;){const B=G.get(s);if(M+=1,typeof B<"u"){if(B===M)throw new RangeError("Cyclic object value");V=!0}typeof G.get(Ws)>"u"&&(M=0)}if(typeof f=="function"?_=f(e,_):_ instanceof Date?_=g?.(_):t==="comma"&&ce(_)&&(_=Vr(_,function(B){return B instanceof Date?g?.(B):B})),_===null){if(a)return u&&!w?u(e,Y.encoder,L,"key",h):e;_=""}if(zl(_)||Vl(_)){if(u){const B=w?e:u(e,Y.encoder,L,"key",h);return[v?.(B)+"="+v?.(u(_,Y.encoder,L,"value",h))]}return[v?.(e)+"="+v?.(String(_))]}const K=[];if(typeof _>"u")return K;let k;if(t==="comma"&&ce(_))w&&u&&(_=Vr(_,u)),k=[{value:_.length>0?_.join(",")||null:void 0}];else if(ce(f))k=f;else{const B=Object.keys(_);k=b?B.sort(b):B}const q=c?String(e).replace(/\./g,"%2E"):String(e),j=n&&ce(_)&&_.length===1?q+"[]":q;if(r&&ce(_)&&_.length===0)return j+"[]";for(let B=0;B<k.length;++B){const F=k[B],Te=typeof F=="object"&&typeof F.value<"u"?F.value:_[F];if(o&&Te===null)continue;const Ee=p&&c?F.replace(/\./g,"%2E"):F,Pt=ce(_)?typeof t=="function"?t(j,Ee):j:j+(p?"."+Ee:"["+Ee+"]");P.set(s,M);const Dt=new WeakMap;Dt.set(Ws,P),Ya(K,Va(Te,Pt,t,n,r,a,o,c,t==="comma"&&w&&ce(_)?null:u,f,b,p,g,h,v,w,L,Dt))}return K}function Jl(s=Y){if(typeof s.allowEmptyArrays<"u"&&typeof s.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof s.encodeDotInKeys<"u"&&typeof s.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(s.encoder!==null&&typeof s.encoder<"u"&&typeof s.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=s.charset||Y.charset;if(typeof s.charset<"u"&&s.charset!=="utf-8"&&s.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Wa;if(typeof s.format<"u"){if(!tn(Yr,s.format))throw new TypeError("Unknown format option provided.");t=s.format}const n=Yr[t];let r=Y.filter;(typeof s.filter=="function"||ce(s.filter))&&(r=s.filter);let a;if(s.arrayFormat&&s.arrayFormat in Xa?a=s.arrayFormat:"indices"in s?a=s.indices?"indices":"repeat":a=Y.arrayFormat,"commaRoundTrip"in s&&typeof s.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const o=typeof s.allowDots>"u"?s.encodeDotInKeys?!0:Y.allowDots:!!s.allowDots;return{addQueryPrefix:typeof s.addQueryPrefix=="boolean"?s.addQueryPrefix:Y.addQueryPrefix,allowDots:o,allowEmptyArrays:typeof s.allowEmptyArrays=="boolean"?!!s.allowEmptyArrays:Y.allowEmptyArrays,arrayFormat:a,charset:e,charsetSentinel:typeof s.charsetSentinel=="boolean"?s.charsetSentinel:Y.charsetSentinel,commaRoundTrip:!!s.commaRoundTrip,delimiter:typeof s.delimiter>"u"?Y.delimiter:s.delimiter,encode:typeof s.encode=="boolean"?s.encode:Y.encode,encodeDotInKeys:typeof s.encodeDotInKeys=="boolean"?s.encodeDotInKeys:Y.encodeDotInKeys,encoder:typeof s.encoder=="function"?s.encoder:Y.encoder,encodeValuesOnly:typeof s.encodeValuesOnly=="boolean"?s.encodeValuesOnly:Y.encodeValuesOnly,filter:r,format:t,formatter:n,serializeDate:typeof s.serializeDate=="function"?s.serializeDate:Y.serializeDate,skipNulls:typeof s.skipNulls=="boolean"?s.skipNulls:Y.skipNulls,sort:typeof s.sort=="function"?s.sort:null,strictNullHandling:typeof s.strictNullHandling=="boolean"?s.strictNullHandling:Y.strictNullHandling}}function Ql(s,e={}){let t=s;const n=Jl(e);let r,a;typeof n.filter=="function"?(a=n.filter,t=a("",t)):ce(n.filter)&&(a=n.filter,r=a);const o=[];if(typeof t!="object"||t===null)return"";const c=Xa[n.arrayFormat],u=c==="comma"&&n.commaRoundTrip;r||(r=Object.keys(t)),n.sort&&r.sort(n.sort);const f=new WeakMap;for(let g=0;g<r.length;++g){const h=r[g];n.skipNulls&&t[h]===null||Ya(o,Va(t[h],h,c,u,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,f))}const b=o.join(n.delimiter);let p=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?p+="utf8=%26%2310003%3B&":p+="utf8=%E2%9C%93&"),b.length>0?p+b:""}function Zl(s){let e=0;for(const r of s)e+=r.length;const t=new Uint8Array(e);let n=0;for(const r of s)t.set(r,n),n+=r.length;return t}let Jr;function wn(s){let e;return(Jr??(e=new globalThis.TextEncoder,Jr=e.encode.bind(e)))(s)}let Qr;function Zr(s){let e;return(Qr??(e=new globalThis.TextDecoder,Qr=e.decode.bind(e)))(s)}var ue,he;class Cs{constructor(){ue.set(this,void 0),he.set(this,void 0),E(this,ue,new Uint8Array),E(this,he,null)}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?wn(e):e;E(this,ue,Zl([d(this,ue,"f"),t]));const n=[];let r;for(;(r=ec(d(this,ue,"f"),d(this,he,"f")))!=null;){if(r.carriage&&d(this,he,"f")==null){E(this,he,r.index);continue}if(d(this,he,"f")!=null&&(r.index!==d(this,he,"f")+1||r.carriage)){n.push(Zr(d(this,ue,"f").subarray(0,d(this,he,"f")-1))),E(this,ue,d(this,ue,"f").subarray(d(this,he,"f"))),E(this,he,null);continue}const a=d(this,he,"f")!==null?r.preceding-1:r.preceding,o=Zr(d(this,ue,"f").subarray(0,a));n.push(o),E(this,ue,d(this,ue,"f").subarray(r.index)),E(this,he,null)}return n}flush(){return d(this,ue,"f").length?this.decode(`
`):[]}}ue=new WeakMap,he=new WeakMap;Cs.NEWLINE_CHARS=new Set([`
`,"\r"]);Cs.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function ec(s,e){for(let r=e??0;r<s.length;r++){if(s[r]===10)return{preceding:r,index:r+1,carriage:!1};if(s[r]===13)return{preceding:r,index:r+1,carriage:!0}}return null}function tc(s){for(let n=0;n<s.length-1;n++){if(s[n]===10&&s[n+1]===10||s[n]===13&&s[n+1]===13)return n+2;if(s[n]===13&&s[n+1]===10&&n+3<s.length&&s[n+2]===13&&s[n+3]===10)return n+4}return-1}const fs={off:0,error:200,warn:300,info:400,debug:500},ea=(s,e,t)=>{if(s){if(Pl(fs,s))return s;ee(t).warn(`${e} was set to ${JSON.stringify(s)}, expected one of ${JSON.stringify(Object.keys(fs))}`)}};function mt(){}function Yt(s,e,t){return!e||fs[s]>fs[t]?mt:e[s].bind(e)}const sc={error:mt,warn:mt,info:mt,debug:mt};let ta=new WeakMap;function ee(s){const e=s.logger,t=s.logLevel??"off";if(!e)return sc;const n=ta.get(e);if(n&&n[0]===t)return n[1];const r={error:Yt("error",e,t),warn:Yt("warn",e,t),info:Yt("info",e,t),debug:Yt("debug",e,t)};return ta.set(e,[t,r]),r}const Fe=s=>(s.options&&(s.options={...s.options},delete s.options.headers),s.headers&&(s.headers=Object.fromEntries((s.headers instanceof Headers?[...s.headers]:Object.entries(s.headers)).map(([e,t])=>[e,e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in s&&(s.retryOfRequestLogID&&(s.retryOf=s.retryOfRequestLogID),delete s.retryOfRequestLogID),s);var ht;class xe{constructor(e,t,n){this.iterator=e,ht.set(this,void 0),this.controller=t,E(this,ht,n)}static fromSSEResponse(e,t,n){let r=!1;const a=n?ee(n):console;async function*o(){if(r)throw new C("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let c=!1;try{for await(const u of nc(e,t))if(!c){if(u.data.startsWith("[DONE]")){c=!0;continue}if(u.event===null||!u.event.startsWith("thread.")){let f;try{f=JSON.parse(u.data)}catch(b){throw a.error("Could not parse message into JSON:",u.data),a.error("From chunk:",u.raw),b}if(f&&f.error)throw new se(void 0,f.error,void 0,e.headers);yield f}else{let f;try{f=JSON.parse(u.data)}catch(b){throw console.error("Could not parse message into JSON:",u.data),console.error("From chunk:",u.raw),b}if(u.event=="error")throw new se(void 0,f.error,f.message,void 0);yield{event:u.event,data:f}}}c=!0}catch(u){if(Zs(u))return;throw u}finally{c||t.abort()}}return new xe(o,t,n)}static fromReadableStream(e,t,n){let r=!1;async function*a(){const c=new Cs,u=Ka(e);for await(const f of u)for(const b of c.decode(f))yield b;for(const f of c.flush())yield f}async function*o(){if(r)throw new C("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let c=!1;try{for await(const u of a())c||u&&(yield JSON.parse(u));c=!0}catch(u){if(Zs(u))return;throw u}finally{c||t.abort()}}return new xe(o,t,n)}[(ht=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),r=a=>({next:()=>{if(a.length===0){const o=n.next();e.push(o),t.push(o)}return a.shift()}});return[new xe(()=>r(e),this.controller,d(this,ht,"f")),new xe(()=>r(t),this.controller,d(this,ht,"f"))]}toReadableStream(){const e=this;let t;return Ua({async start(){t=e[Symbol.asyncIterator]()},async pull(n){try{const{value:r,done:a}=await t.next();if(a)return n.close();const o=wn(JSON.stringify(r)+`
`);n.enqueue(o)}catch(r){n.error(r)}},async cancel(){await t.return?.()}})}}async function*nc(s,e){if(!s.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new C("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new C("Attempted to iterate over a response with no body");const t=new ac,n=new Cs,r=Ka(s.body);for await(const a of rc(r))for(const o of n.decode(a)){const c=t.decode(o);c&&(yield c)}for(const a of n.flush()){const o=t.decode(a);o&&(yield o)}}async function*rc(s){let e=new Uint8Array;for await(const t of s){if(t==null)continue;const n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?wn(t):t;let r=new Uint8Array(e.length+n.length);r.set(e),r.set(n,e.length),e=r;let a;for(;(a=tc(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}class ac{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,r]=ic(e,":");return r.startsWith(" ")&&(r=r.substring(1)),t==="event"?this.event=r:t==="data"&&this.data.push(r),null}}function ic(s,e){const t=s.indexOf(e);return t!==-1?[s.substring(0,t),e,s.substring(t+e.length)]:[s,"",""]}async function za(s,e){const{response:t,requestLogID:n,retryOfRequestLogID:r,startTime:a}=e,o=await(async()=>{if(e.options.stream)return ee(s).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller,s):xe.fromSSEResponse(t,e.controller,s);if(t.status===204)return null;if(e.options.__binaryResponse)return t;const u=t.headers.get("content-type")?.split(";")[0]?.trim();if(u?.includes("application/json")||u?.endsWith("+json")){const p=await t.json();return Ja(p,t)}return await t.text()})();return ee(s).debug(`[${n}] response parsed`,Fe({retryOfRequestLogID:r,url:t.url,status:t.status,body:o,durationMs:Date.now()-a})),o}function Ja(s,e){return!s||typeof s!="object"||Array.isArray(s)?s:Object.defineProperty(s,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var gt;class As extends Promise{constructor(e,t,n=za){super(r=>{r(null)}),this.responsePromise=t,this.parseResponse=n,gt.set(this,void 0),E(this,gt,e)}_thenUnwrap(e){return new As(d(this,gt,"f"),this.responsePromise,async(t,n)=>Ja(e(await this.parseResponse(t,n),n),n.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(d(this,gt,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}gt=new WeakMap;var Vt;class xn{constructor(e,t,n,r){Vt.set(this,void 0),E(this,Vt,e),this.options=r,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){const e=this.nextPageRequestOptions();if(!e)throw new C("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await d(this,Vt,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Vt=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class oc extends As{constructor(e,t,n){super(e,t,async(r,a)=>new n(r,a.response,await za(r,a),a.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}class Es extends xn{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class W extends xn{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){const e=this.getPaginatedItems(),t=e[e.length-1]?.id;return t?{...this.options,query:{...Ba(this.options.query),after:t}}:null}}class ps extends xn{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1,this.last_id=n.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){const e=this.last_id;return e?{...this.options,query:{...Ba(this.options.query),after:e}}:null}}const Qa=()=>{if(typeof File>"u"){const{process:s}=globalThis,e=typeof s?.versions?.node=="string"&&parseInt(s.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(e?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Et(s,e,t){return Qa(),new File(s,e??"unknown_file",t)}function rs(s){return(typeof s=="object"&&s!==null&&("name"in s&&s.name&&String(s.name)||"url"in s&&s.url&&String(s.url)||"filename"in s&&s.filename&&String(s.filename)||"path"in s&&s.path&&String(s.path))||"").split(/[\\/]/).pop()||void 0}const _n=s=>s!=null&&typeof s=="object"&&typeof s[Symbol.asyncIterator]=="function",sa=async(s,e)=>sn(s.body)?{...s,body:await Za(s.body,e)}:s,Ke=async(s,e)=>({...s,body:await Za(s.body,e)}),na=new WeakMap;function lc(s){const e=typeof s=="function"?s:s.fetch,t=na.get(e);if(t)return t;const n=(async()=>{try{const r="Response"in e?e.Response:(await e("data:,")).constructor,a=new FormData;return a.toString()!==await new r(a).text()}catch{return!0}})();return na.set(e,n),n}const Za=async(s,e)=>{if(!await lc(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const t=new FormData;return await Promise.all(Object.entries(s||{}).map(([n,r])=>nn(t,n,r))),t},ei=s=>s instanceof Blob&&"name"in s,cc=s=>typeof s=="object"&&s!==null&&(s instanceof Response||_n(s)||ei(s)),sn=s=>{if(cc(s))return!0;if(Array.isArray(s))return s.some(sn);if(s&&typeof s=="object"){for(const e in s)if(sn(s[e]))return!0}return!1},nn=async(s,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")s.append(e,String(t));else if(t instanceof Response)s.append(e,Et([await t.blob()],rs(t)));else if(_n(t))s.append(e,Et([await new Response(Ga(t)).blob()],rs(t)));else if(ei(t))s.append(e,t,rs(t));else if(Array.isArray(t))await Promise.all(t.map(n=>nn(s,e+"[]",n)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([n,r])=>nn(s,`${e}[${n}]`,r)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}},ti=s=>s!=null&&typeof s=="object"&&typeof s.size=="number"&&typeof s.type=="string"&&typeof s.text=="function"&&typeof s.slice=="function"&&typeof s.arrayBuffer=="function",dc=s=>s!=null&&typeof s=="object"&&typeof s.name=="string"&&typeof s.lastModified=="number"&&ti(s),uc=s=>s!=null&&typeof s=="object"&&typeof s.url=="string"&&typeof s.blob=="function";async function hc(s,e,t){if(Qa(),s=await s,dc(s))return s instanceof File?s:Et([await s.arrayBuffer()],s.name);if(uc(s)){const r=await s.blob();return e||(e=new URL(s.url).pathname.split(/[\\/]/).pop()),Et(await rn(r),e,t)}const n=await rn(s);if(e||(e=rs(s)),!t?.type){const r=n.find(a=>typeof a=="object"&&"type"in a&&a.type);typeof r=="string"&&(t={...t,type:r})}return Et(n,e,t)}async function rn(s){let e=[];if(typeof s=="string"||ArrayBuffer.isView(s)||s instanceof ArrayBuffer)e.push(s);else if(ti(s))e.push(s instanceof Blob?s:await s.arrayBuffer());else if(_n(s))for await(const t of s)e.push(...await rn(t));else{const t=s?.constructor?.name;throw new Error(`Unexpected data type: ${typeof s}${t?`; constructor: ${t}`:""}${fc(s)}`)}return e}function fc(s){return typeof s!="object"||s===null?"":`; props: [${Object.getOwnPropertyNames(s).map(t=>`"${t}"`).join(", ")}]`}class S{constructor(e){this._client=e}}function si(s){return s.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const ra=Object.freeze(Object.create(null)),pc=(s=si)=>function(t,...n){if(t.length===1)return t[0];let r=!1;const a=[],o=t.reduce((b,p,g)=>{/[?#]/.test(p)&&(r=!0);const h=n[g];let v=(r?encodeURIComponent:s)(""+h);return g!==n.length&&(h==null||typeof h=="object"&&h.toString===Object.getPrototypeOf(Object.getPrototypeOf(h.hasOwnProperty??ra)??ra)?.toString)&&(v=h+"",a.push({start:b.length+p.length,length:v.length,error:`Value of type ${Object.prototype.toString.call(h).slice(8,-1)} is not a valid path parameter`})),b+p+(g===n.length?"":v)},""),c=o.split(/[?#]/,1)[0],u=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let f;for(;(f=u.exec(c))!==null;)a.push({start:f.index,length:f[0].length,error:`Value "${f[0]}" can't be safely passed as a path parameter`});if(a.sort((b,p)=>b.start-p.start),a.length>0){let b=0;const p=a.reduce((g,h)=>{const v=" ".repeat(h.start-b),w="^".repeat(h.length);return b=h.start+h.length,g+v+w},"");throw new C(`Path parameters result in path with invalid segments:
${a.map(g=>g.error).join(`
`)}
${o}
${p}`)}return o},m=pc(si);let ni=class extends S{list(e,t={},n){return this._client.getAPIList(m`/chat/completions/${e}/messages`,W,{query:t,...n})}};function ms(s){return s!==void 0&&"function"in s&&s.function!==void 0}function vn(s){return s?.$brand==="auto-parseable-response-format"}function $t(s){return s?.$brand==="auto-parseable-tool"}function mc(s,e){return!e||!ri(e)?{...s,choices:s.choices.map(t=>(ai(t.message.tool_calls),{...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:Sn(s,e)}function Sn(s,e){const t=s.choices.map(n=>{if(n.finish_reason==="length")throw new Fa;if(n.finish_reason==="content_filter")throw new Ha;return ai(n.message.tool_calls),{...n,message:{...n.message,...n.message.tool_calls?{tool_calls:n.message.tool_calls?.map(r=>bc(e,r))??void 0}:void 0,parsed:n.message.content&&!n.message.refusal?gc(e,n.message.content):null}}});return{...s,choices:t}}function gc(s,e){return s.response_format?.type!=="json_schema"?null:s.response_format?.type==="json_schema"?"$parseRaw"in s.response_format?s.response_format.$parseRaw(e):JSON.parse(e):null}function bc(s,e){const t=s.tools?.find(n=>ms(n)&&n.function?.name===e.function.name);return{...e,function:{...e.function,parsed_arguments:$t(t)?t.$parseRaw(e.function.arguments):t?.function.strict?JSON.parse(e.function.arguments):null}}}function yc(s,e){if(!s||!("tools"in s)||!s.tools)return!1;const t=s.tools?.find(n=>ms(n)&&n.function?.name===e.function.name);return ms(t)&&($t(t)||t?.function.strict||!1)}function ri(s){return vn(s.response_format)?!0:s.tools?.some(e=>$t(e)||e.type==="function"&&e.function.strict===!0)??!1}function ai(s){for(const e of s||[])if(e.type!=="function")throw new C(`Currently only \`function\` tool calls are supported; Received \`${e.type}\``)}function wc(s){for(const e of s??[]){if(e.type!=="function")throw new C(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new C(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}const gs=s=>s?.role==="assistant",ii=s=>s?.role==="tool";var an,as,is,bt,yt,os,wt,Ae,xt,bs,ys,nt,oi;class Cn{constructor(){an.add(this),this.controller=new AbortController,as.set(this,void 0),is.set(this,()=>{}),bt.set(this,()=>{}),yt.set(this,void 0),os.set(this,()=>{}),wt.set(this,()=>{}),Ae.set(this,{}),xt.set(this,!1),bs.set(this,!1),ys.set(this,!1),nt.set(this,!1),E(this,as,new Promise((e,t)=>{E(this,is,e,"f"),E(this,bt,t,"f")})),E(this,yt,new Promise((e,t)=>{E(this,os,e,"f"),E(this,wt,t,"f")})),d(this,as,"f").catch(()=>{}),d(this,yt,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},d(this,an,"m",oi).bind(this))},0)}_connected(){this.ended||(d(this,is,"f").call(this),this._emit("connect"))}get ended(){return d(this,xt,"f")}get errored(){return d(this,bs,"f")}get aborted(){return d(this,ys,"f")}abort(){this.controller.abort()}on(e,t){return(d(this,Ae,"f")[e]||(d(this,Ae,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=d(this,Ae,"f")[e];if(!n)return this;const r=n.findIndex(a=>a.listener===t);return r>=0&&n.splice(r,1),this}once(e,t){return(d(this,Ae,"f")[e]||(d(this,Ae,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{E(this,nt,!0),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){E(this,nt,!0),await d(this,yt,"f")}_emit(e,...t){if(d(this,xt,"f"))return;e==="end"&&(E(this,xt,!0),d(this,os,"f").call(this));const n=d(this,Ae,"f")[e];if(n&&(d(this,Ae,"f")[e]=n.filter(r=>!r.once),n.forEach(({listener:r})=>r(...t))),e==="abort"){const r=t[0];!d(this,nt,"f")&&!n?.length&&Promise.reject(r),d(this,bt,"f").call(this,r),d(this,wt,"f").call(this,r),this._emit("end");return}if(e==="error"){const r=t[0];!d(this,nt,"f")&&!n?.length&&Promise.reject(r),d(this,bt,"f").call(this,r),d(this,wt,"f").call(this,r),this._emit("end")}}_emitFinal(){}}as=new WeakMap,is=new WeakMap,bt=new WeakMap,yt=new WeakMap,os=new WeakMap,wt=new WeakMap,Ae=new WeakMap,xt=new WeakMap,bs=new WeakMap,ys=new WeakMap,nt=new WeakMap,an=new WeakSet,oi=function(e){if(E(this,bs,!0),e instanceof Error&&e.name==="AbortError"&&(e=new pe),e instanceof pe)return E(this,ys,!0),this._emit("abort",e);if(e instanceof C)return this._emit("error",e);if(e instanceof Error){const t=new C(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new C(String(e)))};function xc(s){return typeof s.parse=="function"}var ie,on,ws,ln,cn,dn,li,ci;const _c=10;class di extends Cn{constructor(){super(...arguments),ie.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),ii(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(gs(e)&&e.tool_calls)for(const n of e.tool_calls)n.type==="function"&&this._emit("functionToolCall",n.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new C("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),d(this,ie,"m",on).call(this)}async finalMessage(){return await this.done(),d(this,ie,"m",ws).call(this)}async finalFunctionToolCall(){return await this.done(),d(this,ie,"m",ln).call(this)}async finalFunctionToolCallResult(){return await this.done(),d(this,ie,"m",cn).call(this)}async totalUsage(){return await this.done(),d(this,ie,"m",dn).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=d(this,ie,"m",ws).call(this);t&&this._emit("finalMessage",t);const n=d(this,ie,"m",on).call(this);n&&this._emit("finalContent",n);const r=d(this,ie,"m",ln).call(this);r&&this._emit("finalFunctionToolCall",r);const a=d(this,ie,"m",cn).call(this);a!=null&&this._emit("finalFunctionToolCallResult",a),this._chatCompletions.some(o=>o.usage)&&this._emit("totalUsage",d(this,ie,"m",dn).call(this))}async _createChatCompletion(e,t,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),d(this,ie,"m",li).call(this,t);const a=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Sn(a,t))}async _runChatCompletion(e,t,n){for(const r of t.messages)this._addMessage(r,!1);return await this._createChatCompletion(e,t,n)}async _runTools(e,t,n){const r="tool",{tool_choice:a="auto",stream:o,...c}=t,u=typeof a!="string"&&a.type==="function"&&a?.function?.name,{maxChatCompletions:f=_c}=n||{},b=t.tools.map(h=>{if($t(h)){if(!h.$callback)throw new C("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:h.$callback,name:h.function.name,description:h.function.description||"",parameters:h.function.parameters,parse:h.$parseRaw,strict:!0}}}return h}),p={};for(const h of b)h.type==="function"&&(p[h.function.name||h.function.function.name]=h.function);const g="tools"in t?b.map(h=>h.type==="function"?{type:"function",function:{name:h.function.name||h.function.function.name,parameters:h.function.parameters,description:h.function.description,strict:h.function.strict}}:h):void 0;for(const h of t.messages)this._addMessage(h,!1);for(let h=0;h<f;++h){const w=(await this._createChatCompletion(e,{...c,tool_choice:a,tools:g,messages:[...this.messages]},n)).choices[0]?.message;if(!w)throw new C("missing message in ChatCompletion response");if(!w.tool_calls?.length)return;for(const L of w.tool_calls){if(L.type!=="function")continue;const P=L.id,{name:_,arguments:G}=L.function,M=p[_];if(M){if(u&&u!==_){const q=`Invalid tool_call: ${JSON.stringify(_)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:r,tool_call_id:P,content:q});continue}}else{const q=`Invalid tool_call: ${JSON.stringify(_)}. Available options are: ${Object.keys(p).map(j=>JSON.stringify(j)).join(", ")}. Please try again`;this._addMessage({role:r,tool_call_id:P,content:q});continue}let V;try{V=xc(M)?await M.parse(G):G}catch(q){const j=q instanceof Error?q.message:String(q);this._addMessage({role:r,tool_call_id:P,content:j});continue}const K=await M.function(V,this),k=d(this,ie,"m",ci).call(this,K);if(this._addMessage({role:r,tool_call_id:P,content:k}),u)return}}}}ie=new WeakSet,on=function(){return d(this,ie,"m",ws).call(this).content??null},ws=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(gs(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new C("stream ended without producing a ChatCompletionMessage with role=assistant")},ln=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(gs(t)&&t?.tool_calls?.length)return t.tool_calls.filter(n=>n.type==="function").at(-1)?.function}},cn=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(ii(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(n=>n.role==="assistant"&&n.tool_calls?.some(r=>r.type==="function"&&r.id===t.tool_call_id)))return t.content}},dn=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},li=function(e){if(e.n!=null&&e.n>1)throw new C("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},ci=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class An extends di{static runTools(e,t,n){const r=new An,a={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,a)),r}_addMessage(e,t=!0){super._addMessage(e,t),gs(e)&&e.content&&this._emit("content",e.content)}}const ui=1,hi=2,fi=4,pi=8,mi=16,gi=32,bi=64,yi=128,wi=256,xi=yi|wi,_i=mi|gi|xi|bi,vi=ui|hi|_i,Si=fi|pi,vc=vi|Si,Z={STR:ui,NUM:hi,ARR:fi,OBJ:pi,NULL:mi,BOOL:gi,NAN:bi,INFINITY:yi,MINUS_INFINITY:wi,INF:xi,SPECIAL:_i,ATOM:vi,COLLECTION:Si,ALL:vc};class Sc extends Error{}class Cc extends Error{}function Ac(s,e=Z.ALL){if(typeof s!="string")throw new TypeError(`expecting str, got ${typeof s}`);if(!s.trim())throw new Error(`${s} is empty`);return Ec(s.trim(),e)}const Ec=(s,e)=>{const t=s.length;let n=0;const r=g=>{throw new Sc(`${g} at position ${n}`)},a=g=>{throw new Cc(`${g} at position ${n}`)},o=()=>(p(),n>=t&&r("Unexpected end of input"),s[n]==='"'?c():s[n]==="{"?u():s[n]==="["?f():s.substring(n,n+4)==="null"||Z.NULL&e&&t-n<4&&"null".startsWith(s.substring(n))?(n+=4,null):s.substring(n,n+4)==="true"||Z.BOOL&e&&t-n<4&&"true".startsWith(s.substring(n))?(n+=4,!0):s.substring(n,n+5)==="false"||Z.BOOL&e&&t-n<5&&"false".startsWith(s.substring(n))?(n+=5,!1):s.substring(n,n+8)==="Infinity"||Z.INFINITY&e&&t-n<8&&"Infinity".startsWith(s.substring(n))?(n+=8,1/0):s.substring(n,n+9)==="-Infinity"||Z.MINUS_INFINITY&e&&1<t-n&&t-n<9&&"-Infinity".startsWith(s.substring(n))?(n+=9,-1/0):s.substring(n,n+3)==="NaN"||Z.NAN&e&&t-n<3&&"NaN".startsWith(s.substring(n))?(n+=3,NaN):b()),c=()=>{const g=n;let h=!1;for(n++;n<t&&(s[n]!=='"'||h&&s[n-1]==="\\");)h=s[n]==="\\"?!h:!1,n++;if(s.charAt(n)=='"')try{return JSON.parse(s.substring(g,++n-Number(h)))}catch(v){a(String(v))}else if(Z.STR&e)try{return JSON.parse(s.substring(g,n-Number(h))+'"')}catch{return JSON.parse(s.substring(g,s.lastIndexOf("\\"))+'"')}r("Unterminated string literal")},u=()=>{n++,p();const g={};try{for(;s[n]!=="}";){if(p(),n>=t&&Z.OBJ&e)return g;const h=c();p(),n++;try{const v=o();Object.defineProperty(g,h,{value:v,writable:!0,enumerable:!0,configurable:!0})}catch(v){if(Z.OBJ&e)return g;throw v}p(),s[n]===","&&n++}}catch{if(Z.OBJ&e)return g;r("Expected '}' at end of object")}return n++,g},f=()=>{n++;const g=[];try{for(;s[n]!=="]";)g.push(o()),p(),s[n]===","&&n++}catch{if(Z.ARR&e)return g;r("Expected ']' at end of array")}return n++,g},b=()=>{if(n===0){s==="-"&&Z.NUM&e&&r("Not sure what '-' is");try{return JSON.parse(s)}catch(h){if(Z.NUM&e)try{return s[s.length-1]==="."?JSON.parse(s.substring(0,s.lastIndexOf("."))):JSON.parse(s.substring(0,s.lastIndexOf("e")))}catch{}a(String(h))}}const g=n;for(s[n]==="-"&&n++;s[n]&&!",]}".includes(s[n]);)n++;n==t&&!(Z.NUM&e)&&r("Unterminated number literal");try{return JSON.parse(s.substring(g,n))}catch{s.substring(g,n)==="-"&&Z.NUM&e&&r("Not sure what '-' is");try{return JSON.parse(s.substring(g,s.lastIndexOf("e")))}catch(v){a(String(v))}}},p=()=>{for(;n<t&&` 
\r	`.includes(s[n]);)n++};return o()},aa=s=>Ac(s,Z.ALL^Z.NUM);var X,Ce,Qe,ke,qs,zt,Xs,Ys,Vs,Jt,zs,ia;class Ot extends di{constructor(e){super(),X.add(this),Ce.set(this,void 0),Qe.set(this,void 0),ke.set(this,void 0),E(this,Ce,e),E(this,Qe,[])}get currentChatCompletionSnapshot(){return d(this,ke,"f")}static fromReadableStream(e){const t=new Ot(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){const r=new Ot(t);return r._run(()=>r._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createChatCompletion(e,t,n){super._createChatCompletion;const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),d(this,X,"m",qs).call(this);const a=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const o of a)d(this,X,"m",Xs).call(this,o);if(a.controller.signal?.aborted)throw new pe;return this._addChatCompletion(d(this,X,"m",Jt).call(this))}async _fromReadableStream(e,t){const n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),d(this,X,"m",qs).call(this),this._connected();const r=xe.fromReadableStream(e,this.controller);let a;for await(const o of r)a&&a!==o.id&&this._addChatCompletion(d(this,X,"m",Jt).call(this)),d(this,X,"m",Xs).call(this,o),a=o.id;if(r.controller.signal?.aborted)throw new pe;return this._addChatCompletion(d(this,X,"m",Jt).call(this))}[(Ce=new WeakMap,Qe=new WeakMap,ke=new WeakMap,X=new WeakSet,qs=function(){this.ended||E(this,ke,void 0)},zt=function(t){let n=d(this,Qe,"f")[t.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},d(this,Qe,"f")[t.index]=n,n)},Xs=function(t){if(this.ended)return;const n=d(this,X,"m",ia).call(this,t);this._emit("chunk",t,n);for(const r of t.choices){const a=n.choices[r.index];r.delta.content!=null&&a.message?.role==="assistant"&&a.message?.content&&(this._emit("content",r.delta.content,a.message.content),this._emit("content.delta",{delta:r.delta.content,snapshot:a.message.content,parsed:a.message.parsed})),r.delta.refusal!=null&&a.message?.role==="assistant"&&a.message?.refusal&&this._emit("refusal.delta",{delta:r.delta.refusal,snapshot:a.message.refusal}),r.logprobs?.content!=null&&a.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:r.logprobs?.content,snapshot:a.logprobs?.content??[]}),r.logprobs?.refusal!=null&&a.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:r.logprobs?.refusal,snapshot:a.logprobs?.refusal??[]});const o=d(this,X,"m",zt).call(this,a);a.finish_reason&&(d(this,X,"m",Vs).call(this,a),o.current_tool_call_index!=null&&d(this,X,"m",Ys).call(this,a,o.current_tool_call_index));for(const c of r.delta.tool_calls??[])o.current_tool_call_index!==c.index&&(d(this,X,"m",Vs).call(this,a),o.current_tool_call_index!=null&&d(this,X,"m",Ys).call(this,a,o.current_tool_call_index)),o.current_tool_call_index=c.index;for(const c of r.delta.tool_calls??[]){const u=a.message.tool_calls?.[c.index];u?.type&&(u?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:u.function?.name,index:c.index,arguments:u.function.arguments,parsed_arguments:u.function.parsed_arguments,arguments_delta:c.function?.arguments??""}):(u?.type,void 0))}}},Ys=function(t,n){if(d(this,X,"m",zt).call(this,t).done_tool_calls.has(n))return;const a=t.message.tool_calls?.[n];if(!a)throw new Error("no tool call snapshot");if(!a.type)throw new Error("tool call snapshot missing `type`");if(a.type==="function"){const o=d(this,Ce,"f")?.tools?.find(c=>ms(c)&&c.function.name===a.function.name);this._emit("tool_calls.function.arguments.done",{name:a.function.name,index:n,arguments:a.function.arguments,parsed_arguments:$t(o)?o.$parseRaw(a.function.arguments):o?.function.strict?JSON.parse(a.function.arguments):null})}else a.type},Vs=function(t){const n=d(this,X,"m",zt).call(this,t);if(t.message.content&&!n.content_done){n.content_done=!0;const r=d(this,X,"m",zs).call(this);this._emit("content.done",{content:t.message.content,parsed:r?r.$parseRaw(t.message.content):null})}t.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),t.logprobs?.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),t.logprobs?.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},Jt=function(){if(this.ended)throw new C("stream has ended, this shouldn't happen");const t=d(this,ke,"f");if(!t)throw new C("request ended without sending any chunks");return E(this,ke,void 0),E(this,Qe,[]),Nc(t,d(this,Ce,"f"))},zs=function(){const t=d(this,Ce,"f")?.response_format;return vn(t)?t:null},ia=function(t){var n,r,a,o;let c=d(this,ke,"f");const{choices:u,...f}=t;c?Object.assign(c,f):c=E(this,ke,{...f,choices:[]});for(const{delta:b,finish_reason:p,index:g,logprobs:h=null,...v}of t.choices){let w=c.choices[g];if(w||(w=c.choices[g]={finish_reason:p,index:g,message:{},logprobs:h,...v}),h)if(!w.logprobs)w.logprobs=Object.assign({},h);else{const{content:K,refusal:k,...q}=h;Object.assign(w.logprobs,q),K&&((n=w.logprobs).content??(n.content=[]),w.logprobs.content.push(...K)),k&&((r=w.logprobs).refusal??(r.refusal=[]),w.logprobs.refusal.push(...k))}if(p&&(w.finish_reason=p,d(this,Ce,"f")&&ri(d(this,Ce,"f")))){if(p==="length")throw new Fa;if(p==="content_filter")throw new Ha}if(Object.assign(w,v),!b)continue;const{content:L,refusal:P,function_call:_,role:G,tool_calls:M,...V}=b;if(Object.assign(w.message,V),P&&(w.message.refusal=(w.message.refusal||"")+P),G&&(w.message.role=G),_&&(w.message.function_call?(_.name&&(w.message.function_call.name=_.name),_.arguments&&((a=w.message.function_call).arguments??(a.arguments=""),w.message.function_call.arguments+=_.arguments)):w.message.function_call=_),L&&(w.message.content=(w.message.content||"")+L,!w.message.refusal&&d(this,X,"m",zs).call(this)&&(w.message.parsed=aa(w.message.content))),M){w.message.tool_calls||(w.message.tool_calls=[]);for(const{index:K,id:k,type:q,function:j,...B}of M){const F=(o=w.message.tool_calls)[K]??(o[K]={});Object.assign(F,B),k&&(F.id=k),q&&(F.type=q),j&&(F.function??(F.function={name:j.name??"",arguments:""})),j?.name&&(F.function.name=j.name),j?.arguments&&(F.function.arguments+=j.arguments,yc(d(this,Ce,"f"),F)&&(F.function.parsed_arguments=aa(F.function.arguments)))}}}return c},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",r=>{const a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{n=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),this.on("error",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,o)=>t.push({resolve:a,reject:o})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new xe(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function Nc(s,e){const{id:t,choices:n,created:r,model:a,system_fingerprint:o,...c}=s,u={...c,id:t,choices:n.map(({message:f,finish_reason:b,index:p,logprobs:g,...h})=>{if(!b)throw new C(`missing finish_reason for choice ${p}`);const{content:v=null,function_call:w,tool_calls:L,...P}=f,_=f.role;if(!_)throw new C(`missing role for choice ${p}`);if(w){const{arguments:G,name:M}=w;if(G==null)throw new C(`missing function_call.arguments for choice ${p}`);if(!M)throw new C(`missing function_call.name for choice ${p}`);return{...h,message:{content:v,function_call:{arguments:G,name:M},role:_,refusal:f.refusal??null},finish_reason:b,index:p,logprobs:g}}return L?{...h,index:p,finish_reason:b,logprobs:g,message:{...P,role:_,content:v,refusal:f.refusal??null,tool_calls:L.map((G,M)=>{const{function:V,type:K,id:k,...q}=G,{arguments:j,name:B,...F}=V||{};if(k==null)throw new C(`missing choices[${p}].tool_calls[${M}].id
${Qt(s)}`);if(K==null)throw new C(`missing choices[${p}].tool_calls[${M}].type
${Qt(s)}`);if(B==null)throw new C(`missing choices[${p}].tool_calls[${M}].function.name
${Qt(s)}`);if(j==null)throw new C(`missing choices[${p}].tool_calls[${M}].function.arguments
${Qt(s)}`);return{...q,id:k,type:K,function:{...F,name:B,arguments:j}}})}}:{...h,message:{...P,content:v,role:_,refusal:f.refusal??null},finish_reason:b,index:p,logprobs:g}}),created:r,model:a,object:"chat.completion",...o?{system_fingerprint:o}:{}};return mc(u,e)}function Qt(s){return JSON.stringify(s)}class xs extends Ot{static fromReadableStream(e){const t=new xs(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,n){const r=new xs(t),a={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,a)),r}}let En=class extends S{constructor(){super(...arguments),this.messages=new ni(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(m`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(m`/chat/completions/${e}`,{body:t,...n})}list(e={},t){return this._client.getAPIList("/chat/completions",W,{query:e,...t})}delete(e,t){return this._client.delete(m`/chat/completions/${e}`,t)}parse(e,t){return wc(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(n=>Sn(n,e))}runTools(e,t){return e.stream?xs.runTools(this._client,e,t):An.runTools(this._client,e,t)}stream(e,t){return Ot.createChatCompletion(this._client,e,t)}};En.Messages=ni;class Nn extends S{constructor(){super(...arguments),this.completions=new En(this._client)}}Nn.Completions=En;const Ci=Symbol("brand.privateNullableHeaders");function*Ic(s){if(!s)return;if(Ci in s){const{values:n,nulls:r}=s;yield*n.entries();for(const a of r)yield[a,null];return}let e=!1,t;s instanceof Headers?t=s.entries():Kr(s)?t=s:(e=!0,t=Object.entries(s??{}));for(let n of t){const r=n[0];if(typeof r!="string")throw new TypeError("expected header name to be a string");const a=Kr(n[1])?n[1]:[n[1]];let o=!1;for(const c of a)c!==void 0&&(e&&!o&&(o=!0,yield[r,null]),yield[r,c])}}const y=s=>{const e=new Headers,t=new Set;for(const n of s){const r=new Set;for(const[a,o]of Ic(n)){const c=a.toLowerCase();r.has(c)||(e.delete(a),r.add(c)),o===null?(e.delete(a),t.add(c)):(e.append(a,o),t.delete(c))}}return{[Ci]:!0,values:e,nulls:t}};class Ai extends S{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:y([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:!0})}}class Ei extends S{create(e,t){return this._client.post("/audio/transcriptions",Ke({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class Ni extends S{create(e,t){return this._client.post("/audio/translations",Ke({body:e,...t,__metadata:{model:e.model}},this._client))}}class Mt extends S{constructor(){super(...arguments),this.transcriptions=new Ei(this._client),this.translations=new Ni(this._client),this.speech=new Ai(this._client)}}Mt.Transcriptions=Ei;Mt.Translations=Ni;Mt.Speech=Ai;class Ii extends S{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(m`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",W,{query:e,...t})}cancel(e,t){return this._client.post(m`/batches/${e}/cancel`,t)}}class ki extends S{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:y([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(m`/assistants/${e}`,{...t,headers:y([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,n){return this._client.post(m`/assistants/${e}`,{body:t,...n,headers:y([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e={},t){return this._client.getAPIList("/assistants",W,{query:e,...t,headers:y([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(m`/assistants/${e}`,{...t,headers:y([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}let Ri=class extends S{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:y([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}};class Oi extends S{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:y([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}let Ns=class extends S{constructor(){super(...arguments),this.sessions=new Ri(this._client),this.transcriptionSessions=new Oi(this._client)}};Ns.Sessions=Ri;Ns.TranscriptionSessions=Oi;class ji extends S{create(e,t){return this._client.post("/chatkit/sessions",{body:e,...t,headers:y([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}cancel(e,t){return this._client.post(m`/chatkit/sessions/${e}/cancel`,{...t,headers:y([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}}let Ti=class extends S{retrieve(e,t){return this._client.get(m`/chatkit/threads/${e}`,{...t,headers:y([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}list(e={},t){return this._client.getAPIList("/chatkit/threads",ps,{query:e,...t,headers:y([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}delete(e,t){return this._client.delete(m`/chatkit/threads/${e}`,{...t,headers:y([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}listItems(e,t={},n){return this._client.getAPIList(m`/chatkit/threads/${e}/items`,ps,{query:t,...n,headers:y([{"OpenAI-Beta":"chatkit_beta=v1"},n?.headers])})}};class Is extends S{constructor(){super(...arguments),this.sessions=new ji(this._client),this.threads=new Ti(this._client)}}Is.Sessions=ji;Is.Threads=Ti;class $i extends S{create(e,t,n){return this._client.post(m`/threads/${e}/messages`,{body:t,...n,headers:y([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,t,n){const{thread_id:r}=t;return this._client.get(m`/threads/${r}/messages/${e}`,{...n,headers:y([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,t,n){const{thread_id:r,...a}=t;return this._client.post(m`/threads/${r}/messages/${e}`,{body:a,...n,headers:y([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,t={},n){return this._client.getAPIList(m`/threads/${e}/messages`,W,{query:t,...n,headers:y([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,t,n){const{thread_id:r}=t;return this._client.delete(m`/threads/${r}/messages/${e}`,{...n,headers:y([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}class Mi extends S{retrieve(e,t,n){const{thread_id:r,run_id:a,...o}=t;return this._client.get(m`/threads/${r}/runs/${a}/steps/${e}`,{query:o,...n,headers:y([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,t,n){const{thread_id:r,...a}=t;return this._client.getAPIList(m`/threads/${r}/runs/${e}/steps`,W,{query:a,...n,headers:y([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}const kc=s=>{if(typeof Buffer<"u"){const e=Buffer.from(s,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{const e=atob(s),t=e.length,n=new Uint8Array(t);for(let r=0;r<t;r++)n[r]=e.charCodeAt(r);return Array.from(new Float32Array(n.buffer))}};var Rc={};const Ze=s=>{if(typeof globalThis.process<"u")return Rc?.[s]?.trim()??void 0;if(typeof globalThis.Deno<"u")return globalThis.Deno.env?.get?.(s)?.trim()};var te,Be,un,we,ls,ge,Ue,at,He,_s,fe,cs,ds,Nt,_t,vt,oa,la,ca,da,ua,ha,fa;class It extends Cn{constructor(){super(...arguments),te.add(this),un.set(this,[]),we.set(this,{}),ls.set(this,{}),ge.set(this,void 0),Ue.set(this,void 0),at.set(this,void 0),He.set(this,void 0),_s.set(this,void 0),fe.set(this,void 0),cs.set(this,void 0),ds.set(this,void 0),Nt.set(this,void 0)}[(un=new WeakMap,we=new WeakMap,ls=new WeakMap,ge=new WeakMap,Ue=new WeakMap,at=new WeakMap,He=new WeakMap,_s=new WeakMap,fe=new WeakMap,cs=new WeakMap,ds=new WeakMap,Nt=new WeakMap,te=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",r=>{const a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{n=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),this.on("error",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,o)=>t.push({resolve:a,reject:o})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new Be;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){const n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();const r=xe.fromReadableStream(e,this.controller);for await(const a of r)d(this,te,"m",_t).call(this,a);if(r.controller.signal?.aborted)throw new pe;return this._addRun(d(this,te,"m",vt).call(this))}toReadableStream(){return new xe(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,r){const a=new Be;return a._run(()=>a._runToolAssistantStream(e,t,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,n,r){const a=r?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o={...n,stream:!0},c=await e.submitToolOutputs(t,o,{...r,signal:this.controller.signal});this._connected();for await(const u of c)d(this,te,"m",_t).call(this,u);if(c.controller.signal?.aborted)throw new pe;return this._addRun(d(this,te,"m",vt).call(this))}static createThreadAssistantStream(e,t,n){const r=new Be;return r._run(()=>r._threadAssistantStream(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}static createAssistantStream(e,t,n,r){const a=new Be;return a._run(()=>a._runAssistantStream(e,t,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return d(this,cs,"f")}currentRun(){return d(this,ds,"f")}currentMessageSnapshot(){return d(this,ge,"f")}currentRunStepSnapshot(){return d(this,Nt,"f")}async finalRunSteps(){return await this.done(),Object.values(d(this,we,"f"))}async finalMessages(){return await this.done(),Object.values(d(this,ls,"f"))}async finalRun(){if(await this.done(),!d(this,Ue,"f"))throw Error("Final run was not received.");return d(this,Ue,"f")}async _createThreadAssistantStream(e,t,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));const a={...t,stream:!0},o=await e.createAndRun(a,{...n,signal:this.controller.signal});this._connected();for await(const c of o)d(this,te,"m",_t).call(this,c);if(o.controller.signal?.aborted)throw new pe;return this._addRun(d(this,te,"m",vt).call(this))}async _createAssistantStream(e,t,n,r){const a=r?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o={...n,stream:!0},c=await e.create(t,o,{...r,signal:this.controller.signal});this._connected();for await(const u of c)d(this,te,"m",_t).call(this,u);if(c.controller.signal?.aborted)throw new pe;return this._addRun(d(this,te,"m",vt).call(this))}static accumulateDelta(e,t){for(const[n,r]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=r;continue}let a=e[n];if(a==null){e[n]=r;continue}if(n==="index"||n==="type"){e[n]=r;continue}if(typeof a=="string"&&typeof r=="string")a+=r;else if(typeof a=="number"&&typeof r=="number")a+=r;else if(Gs(a)&&Gs(r))a=this.accumulateDelta(a,r);else if(Array.isArray(a)&&Array.isArray(r)){if(a.every(o=>typeof o=="string"||typeof o=="number")){a.push(...r);continue}for(const o of r){if(!Gs(o))throw new Error(`Expected array delta entry to be an object but got: ${o}`);const c=o.index;if(c==null)throw console.error(o),new Error("Expected array delta entry to have an `index` property");if(typeof c!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${c}`);const u=a[c];u==null?a.push(o):a[c]=this.accumulateDelta(u,o)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${r}, accValue: ${a}`);e[n]=a}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,r){return await this._createAssistantStream(t,e,n,r)}async _runToolAssistantStream(e,t,n,r){return await this._createToolAssistantStream(t,e,n,r)}}Be=It,_t=function(e){if(!this.ended)switch(E(this,cs,e),d(this,te,"m",ca).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":d(this,te,"m",fa).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":d(this,te,"m",la).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":d(this,te,"m",oa).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},vt=function(){if(this.ended)throw new C("stream has ended, this shouldn't happen");if(!d(this,Ue,"f"))throw Error("Final run has not been received");return d(this,Ue,"f")},oa=function(e){const[t,n]=d(this,te,"m",ua).call(this,e,d(this,ge,"f"));E(this,ge,t),d(this,ls,"f")[t.id]=t;for(const r of n){const a=t.content[r.index];a?.type=="text"&&this._emit("textCreated",a.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const r of e.data.delta.content){if(r.type=="text"&&r.text){let a=r.text,o=t.content[r.index];if(o&&o.type=="text")this._emit("textDelta",a,o.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(r.index!=d(this,at,"f")){if(d(this,He,"f"))switch(d(this,He,"f").type){case"text":this._emit("textDone",d(this,He,"f").text,d(this,ge,"f"));break;case"image_file":this._emit("imageFileDone",d(this,He,"f").image_file,d(this,ge,"f"));break}E(this,at,r.index)}E(this,He,t.content[r.index])}break;case"thread.message.completed":case"thread.message.incomplete":if(d(this,at,"f")!==void 0){const r=e.data.content[d(this,at,"f")];if(r)switch(r.type){case"image_file":this._emit("imageFileDone",r.image_file,d(this,ge,"f"));break;case"text":this._emit("textDone",r.text,d(this,ge,"f"));break}}d(this,ge,"f")&&this._emit("messageDone",e.data),E(this,ge,void 0)}},la=function(e){const t=d(this,te,"m",da).call(this,e);switch(E(this,Nt,t),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const a of n.step_details.tool_calls)a.index==d(this,_s,"f")?this._emit("toolCallDelta",a,t.step_details.tool_calls[a.index]):(d(this,fe,"f")&&this._emit("toolCallDone",d(this,fe,"f")),E(this,_s,a.index),E(this,fe,t.step_details.tool_calls[a.index]),d(this,fe,"f")&&this._emit("toolCallCreated",d(this,fe,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":E(this,Nt,void 0),e.data.step_details.type=="tool_calls"&&d(this,fe,"f")&&(this._emit("toolCallDone",d(this,fe,"f")),E(this,fe,void 0)),this._emit("runStepDone",e.data,t);break}},ca=function(e){d(this,un,"f").push(e),this._emit("event",e)},da=function(e){switch(e.event){case"thread.run.step.created":return d(this,we,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=d(this,we,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const r=Be.accumulateDelta(t,n.delta);d(this,we,"f")[e.data.id]=r}return d(this,we,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":d(this,we,"f")[e.data.id]=e.data;break}if(d(this,we,"f")[e.data.id])return d(this,we,"f")[e.data.id];throw new Error("No snapshot available")},ua=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let r=e.data;if(r.delta.content)for(const a of r.delta.content)if(a.index in t.content){let o=t.content[a.index];t.content[a.index]=d(this,te,"m",ha).call(this,a,o)}else t.content[a.index]=a,n.push(a);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},ha=function(e,t){return Be.accumulateDelta(t,e)},fa=function(e){switch(E(this,ds,e.data),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":E(this,Ue,e.data),d(this,fe,"f")&&(this._emit("toolCallDone",d(this,fe,"f")),E(this,fe,void 0));break}};let In=class extends S{constructor(){super(...arguments),this.steps=new Mi(this._client)}create(e,t,n){const{include:r,...a}=t;return this._client.post(m`/threads/${e}/runs`,{query:{include:r},body:a,...n,headers:y([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:t.stream??!1})}retrieve(e,t,n){const{thread_id:r}=t;return this._client.get(m`/threads/${r}/runs/${e}`,{...n,headers:y([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,t,n){const{thread_id:r,...a}=t;return this._client.post(m`/threads/${r}/runs/${e}`,{body:a,...n,headers:y([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,t={},n){return this._client.getAPIList(m`/threads/${e}/runs`,W,{query:t,...n,headers:y([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(e,t,n){const{thread_id:r}=t;return this._client.post(m`/threads/${r}/runs/${e}/cancel`,{...n,headers:y([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(r.id,{thread_id:e},n)}createAndStream(e,t,n){return It.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){const r=y([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){const{data:a,response:o}=await this.retrieve(e,t,{...n,headers:{...n?.headers,...r}}).withResponse();switch(a.status){case"queued":case"in_progress":case"cancelling":let c=5e3;if(n?.pollIntervalMs)c=n.pollIntervalMs;else{const u=o.headers.get("openai-poll-after-ms");if(u){const f=parseInt(u);isNaN(f)||(c=f)}}await Tt(c);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return a}}}stream(e,t,n){return It.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n){const{thread_id:r,...a}=t;return this._client.post(m`/threads/${r}/runs/${e}/submit_tool_outputs`,{body:a,...n,headers:y([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,n){const r=await this.submitToolOutputs(e,t,n);return await this.poll(r.id,t,n)}submitToolOutputsStream(e,t,n){return It.createToolAssistantStream(e,this._client.beta.threads.runs,t,n)}};In.Steps=Mi;class ks extends S{constructor(){super(...arguments),this.runs=new In(this._client),this.messages=new $i(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:y([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(m`/threads/${e}`,{...t,headers:y([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,n){return this._client.post(m`/threads/${e}`,{body:t,...n,headers:y([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,t){return this._client.delete(m`/threads/${e}`,{...t,headers:y([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:y([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.id,{thread_id:n.thread_id},t)}createAndRunStream(e,t){return It.createThreadAssistantStream(e,this._client.beta.threads,t)}}ks.Runs=In;ks.Messages=$i;class it extends S{constructor(){super(...arguments),this.realtime=new Ns(this._client),this.chatkit=new Is(this._client),this.assistants=new ki(this._client),this.threads=new ks(this._client)}}it.Realtime=Ns;it.ChatKit=Is;it.Assistants=ki;it.Threads=ks;class Pi extends S{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class Di extends S{retrieve(e,t,n){const{container_id:r}=t;return this._client.get(m`/containers/${r}/files/${e}/content`,{...n,headers:y([{Accept:"application/binary"},n?.headers]),__binaryResponse:!0})}}let kn=class extends S{constructor(){super(...arguments),this.content=new Di(this._client)}create(e,t,n){return this._client.post(m`/containers/${e}/files`,Ke({body:t,...n},this._client))}retrieve(e,t,n){const{container_id:r}=t;return this._client.get(m`/containers/${r}/files/${e}`,n)}list(e,t={},n){return this._client.getAPIList(m`/containers/${e}/files`,W,{query:t,...n})}delete(e,t,n){const{container_id:r}=t;return this._client.delete(m`/containers/${r}/files/${e}`,{...n,headers:y([{Accept:"*/*"},n?.headers])})}};kn.Content=Di;class Rn extends S{constructor(){super(...arguments),this.files=new kn(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(m`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",W,{query:e,...t})}delete(e,t){return this._client.delete(m`/containers/${e}`,{...t,headers:y([{Accept:"*/*"},t?.headers])})}}Rn.Files=kn;class Li extends S{create(e,t,n){const{include:r,...a}=t;return this._client.post(m`/conversations/${e}/items`,{query:{include:r},body:a,...n})}retrieve(e,t,n){const{conversation_id:r,...a}=t;return this._client.get(m`/conversations/${r}/items/${e}`,{query:a,...n})}list(e,t={},n){return this._client.getAPIList(m`/conversations/${e}/items`,ps,{query:t,...n})}delete(e,t,n){const{conversation_id:r}=t;return this._client.delete(m`/conversations/${r}/items/${e}`,n)}}class On extends S{constructor(){super(...arguments),this.items=new Li(this._client)}create(e={},t){return this._client.post("/conversations",{body:e,...t})}retrieve(e,t){return this._client.get(m`/conversations/${e}`,t)}update(e,t,n){return this._client.post(m`/conversations/${e}`,{body:t,...n})}delete(e,t){return this._client.delete(m`/conversations/${e}`,t)}}On.Items=Li;class Fi extends S{create(e,t){const n=!!e.encoding_format;let r=n?e.encoding_format:"base64";n&&ee(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);const a=this._client.post("/embeddings",{body:{...e,encoding_format:r},...t});return n?a:(ee(this._client).debug("embeddings/decoding base64 embeddings from base64"),a._thenUnwrap(o=>(o&&o.data&&o.data.forEach(c=>{const u=c.embedding;c.embedding=kc(u)}),o)))}}class Hi extends S{retrieve(e,t,n){const{eval_id:r,run_id:a}=t;return this._client.get(m`/evals/${r}/runs/${a}/output_items/${e}`,n)}list(e,t,n){const{eval_id:r,...a}=t;return this._client.getAPIList(m`/evals/${r}/runs/${e}/output_items`,W,{query:a,...n})}}class jn extends S{constructor(){super(...arguments),this.outputItems=new Hi(this._client)}create(e,t,n){return this._client.post(m`/evals/${e}/runs`,{body:t,...n})}retrieve(e,t,n){const{eval_id:r}=t;return this._client.get(m`/evals/${r}/runs/${e}`,n)}list(e,t={},n){return this._client.getAPIList(m`/evals/${e}/runs`,W,{query:t,...n})}delete(e,t,n){const{eval_id:r}=t;return this._client.delete(m`/evals/${r}/runs/${e}`,n)}cancel(e,t,n){const{eval_id:r}=t;return this._client.post(m`/evals/${r}/runs/${e}`,n)}}jn.OutputItems=Hi;class Tn extends S{constructor(){super(...arguments),this.runs=new jn(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(m`/evals/${e}`,t)}update(e,t,n){return this._client.post(m`/evals/${e}`,{body:t,...n})}list(e={},t){return this._client.getAPIList("/evals",W,{query:e,...t})}delete(e,t){return this._client.delete(m`/evals/${e}`,t)}}Tn.Runs=jn;let Bi=class extends S{create(e,t){return this._client.post("/files",Ke({body:e,...t},this._client))}retrieve(e,t){return this._client.get(m`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",W,{query:e,...t})}delete(e,t){return this._client.delete(m`/files/${e}`,t)}content(e,t){return this._client.get(m`/files/${e}/content`,{...t,headers:y([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=1800*1e3}={}){const r=new Set(["processed","error","deleted"]),a=Date.now();let o=await this.retrieve(e);for(;!o.status||!r.has(o.status);)if(await Tt(t),o=await this.retrieve(e),Date.now()-a>n)throw new yn({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return o}};class Ui extends S{}let Gi=class extends S{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};class $n extends S{constructor(){super(...arguments),this.graders=new Gi(this._client)}}$n.Graders=Gi;class Ki extends S{create(e,t,n){return this._client.getAPIList(m`/fine_tuning/checkpoints/${e}/permissions`,Es,{body:t,method:"post",...n})}retrieve(e,t={},n){return this._client.get(m`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...n})}delete(e,t,n){const{fine_tuned_model_checkpoint:r}=t;return this._client.delete(m`/fine_tuning/checkpoints/${r}/permissions/${e}`,n)}}let Mn=class extends S{constructor(){super(...arguments),this.permissions=new Ki(this._client)}};Mn.Permissions=Ki;class Wi extends S{list(e,t={},n){return this._client.getAPIList(m`/fine_tuning/jobs/${e}/checkpoints`,W,{query:t,...n})}}class Pn extends S{constructor(){super(...arguments),this.checkpoints=new Wi(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(m`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",W,{query:e,...t})}cancel(e,t){return this._client.post(m`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return this._client.getAPIList(m`/fine_tuning/jobs/${e}/events`,W,{query:t,...n})}pause(e,t){return this._client.post(m`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(m`/fine_tuning/jobs/${e}/resume`,t)}}Pn.Checkpoints=Wi;class ot extends S{constructor(){super(...arguments),this.methods=new Ui(this._client),this.jobs=new Pn(this._client),this.checkpoints=new Mn(this._client),this.alpha=new $n(this._client)}}ot.Methods=Ui;ot.Jobs=Pn;ot.Checkpoints=Mn;ot.Alpha=$n;class qi extends S{}class Dn extends S{constructor(){super(...arguments),this.graderModels=new qi(this._client)}}Dn.GraderModels=qi;class Xi extends S{createVariation(e,t){return this._client.post("/images/variations",Ke({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",Ke({body:e,...t,stream:e.stream??!1},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t,stream:e.stream??!1})}}class Yi extends S{retrieve(e,t){return this._client.get(m`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Es,e)}delete(e,t){return this._client.delete(m`/models/${e}`,t)}}class Vi extends S{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class zi extends S{accept(e,t,n){return this._client.post(m`/realtime/calls/${e}/accept`,{body:t,...n,headers:y([{Accept:"*/*"},n?.headers])})}hangup(e,t){return this._client.post(m`/realtime/calls/${e}/hangup`,{...t,headers:y([{Accept:"*/*"},t?.headers])})}refer(e,t,n){return this._client.post(m`/realtime/calls/${e}/refer`,{body:t,...n,headers:y([{Accept:"*/*"},n?.headers])})}reject(e,t={},n){return this._client.post(m`/realtime/calls/${e}/reject`,{body:t,...n,headers:y([{Accept:"*/*"},n?.headers])})}}class Ji extends S{create(e,t){return this._client.post("/realtime/client_secrets",{body:e,...t})}}class Rs extends S{constructor(){super(...arguments),this.clientSecrets=new Ji(this._client),this.calls=new zi(this._client)}}Rs.ClientSecrets=Ji;Rs.Calls=zi;function Oc(s,e){return!e||!Tc(e)?{...s,output_parsed:null,output:s.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(n=>({...n,parsed:null}))}:t)}:Qi(s,e)}function Qi(s,e){const t=s.output.map(r=>{if(r.type==="function_call")return{...r,parsed_arguments:Pc(e,r)};if(r.type==="message"){const a=r.content.map(o=>o.type==="output_text"?{...o,parsed:jc(e,o.text)}:o);return{...r,content:a}}return r}),n=Object.assign({},s,{output:t});return Object.getOwnPropertyDescriptor(s,"output_text")||hn(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(const r of n.output)if(r.type==="message"){for(const a of r.content)if(a.type==="output_text"&&a.parsed!==null)return a.parsed}return null}}),n}function jc(s,e){return s.text?.format?.type!=="json_schema"?null:"$parseRaw"in s.text?.format?(s.text?.format).$parseRaw(e):JSON.parse(e)}function Tc(s){return!!vn(s.text?.format)}function $c(s){return s?.$brand==="auto-parseable-tool"}function Mc(s,e){return s.find(t=>t.type==="function"&&t.name===e)}function Pc(s,e){const t=Mc(s.tools??[],e.name);return{...e,...e,parsed_arguments:$c(t)?t.$parseRaw(e.arguments):t?.strict?JSON.parse(e.arguments):null}}function hn(s){const e=[];for(const t of s.output)if(t.type==="message")for(const n of t.content)n.type==="output_text"&&e.push(n.text);s.output_text=e.join("")}var et,Zt,Re,es,pa,ma,ga,ba;class Ln extends Cn{constructor(e){super(),et.add(this),Zt.set(this,void 0),Re.set(this,void 0),es.set(this,void 0),E(this,Zt,e)}static createResponse(e,t,n){const r=new Ln(t);return r._run(()=>r._createOrRetrieveResponse(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createOrRetrieveResponse(e,t,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),d(this,et,"m",pa).call(this);let a,o=null;"response_id"in t?(a=await e.responses.retrieve(t.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),o=t.starting_after??null):a=await e.responses.create({...t,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(const c of a)d(this,et,"m",ma).call(this,c,o);if(a.controller.signal?.aborted)throw new pe;return d(this,et,"m",ga).call(this)}[(Zt=new WeakMap,Re=new WeakMap,es=new WeakMap,et=new WeakSet,pa=function(){this.ended||E(this,Re,void 0)},ma=function(t,n){if(this.ended)return;const r=(o,c)=>{(n==null||c.sequence_number>n)&&this._emit(o,c)},a=d(this,et,"m",ba).call(this,t);switch(r("event",t),t.type){case"response.output_text.delta":{const o=a.output[t.output_index];if(!o)throw new C(`missing output at index ${t.output_index}`);if(o.type==="message"){const c=o.content[t.content_index];if(!c)throw new C(`missing content at index ${t.content_index}`);if(c.type!=="output_text")throw new C(`expected content to be 'output_text', got ${c.type}`);r("response.output_text.delta",{...t,snapshot:c.text})}break}case"response.function_call_arguments.delta":{const o=a.output[t.output_index];if(!o)throw new C(`missing output at index ${t.output_index}`);o.type==="function_call"&&r("response.function_call_arguments.delta",{...t,snapshot:o.arguments});break}default:r(t.type,t);break}},ga=function(){if(this.ended)throw new C("stream has ended, this shouldn't happen");const t=d(this,Re,"f");if(!t)throw new C("request ended without sending any events");E(this,Re,void 0);const n=Dc(t,d(this,Zt,"f"));return E(this,es,n),n},ba=function(t){let n=d(this,Re,"f");if(!n){if(t.type!=="response.created")throw new C(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return n=E(this,Re,t.response),n}switch(t.type){case"response.output_item.added":{n.output.push(t.item);break}case"response.content_part.added":{const r=n.output[t.output_index];if(!r)throw new C(`missing output at index ${t.output_index}`);const a=r.type,o=t.part;a==="message"&&o.type!=="reasoning_text"?r.content.push(o):a==="reasoning"&&o.type==="reasoning_text"&&(r.content||(r.content=[]),r.content.push(o));break}case"response.output_text.delta":{const r=n.output[t.output_index];if(!r)throw new C(`missing output at index ${t.output_index}`);if(r.type==="message"){const a=r.content[t.content_index];if(!a)throw new C(`missing content at index ${t.content_index}`);if(a.type!=="output_text")throw new C(`expected content to be 'output_text', got ${a.type}`);a.text+=t.delta}break}case"response.function_call_arguments.delta":{const r=n.output[t.output_index];if(!r)throw new C(`missing output at index ${t.output_index}`);r.type==="function_call"&&(r.arguments+=t.delta);break}case"response.reasoning_text.delta":{const r=n.output[t.output_index];if(!r)throw new C(`missing output at index ${t.output_index}`);if(r.type==="reasoning"){const a=r.content?.[t.content_index];if(!a)throw new C(`missing content at index ${t.content_index}`);if(a.type!=="reasoning_text")throw new C(`expected content to be 'reasoning_text', got ${a.type}`);a.text+=t.delta}break}case"response.completed":{E(this,Re,t.response);break}}return n},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",r=>{const a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{n=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),this.on("error",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,o)=>t.push({resolve:a,reject:o})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=d(this,es,"f");if(!e)throw new C("stream ended without producing a ChatCompletion");return e}}function Dc(s,e){return Oc(s,e)}class Zi extends S{list(e,t={},n){return this._client.getAPIList(m`/responses/${e}/input_items`,W,{query:t,...n})}}class eo extends S{count(e={},t){return this._client.post("/responses/input_tokens",{body:e,...t})}}class Os extends S{constructor(){super(...arguments),this.inputItems=new Zi(this._client),this.inputTokens=new eo(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&hn(n),n))}retrieve(e,t={},n){return this._client.get(m`/responses/${e}`,{query:t,...n,stream:t?.stream??!1})._thenUnwrap(r=>("object"in r&&r.object==="response"&&hn(r),r))}delete(e,t){return this._client.delete(m`/responses/${e}`,{...t,headers:y([{Accept:"*/*"},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(n=>Qi(n,e))}stream(e,t){return Ln.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(m`/responses/${e}/cancel`,t)}}Os.InputItems=Zi;Os.InputTokens=eo;class to extends S{create(e,t,n){return this._client.post(m`/uploads/${e}/parts`,Ke({body:t,...n},this._client))}}class Fn extends S{constructor(){super(...arguments),this.parts=new to(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(m`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(m`/uploads/${e}/complete`,{body:t,...n})}}Fn.Parts=to;const Lc=async s=>{const e=await Promise.allSettled(s),t=e.filter(r=>r.status==="rejected");if(t.length){for(const r of t)console.error(r.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const n=[];for(const r of e)r.status==="fulfilled"&&n.push(r.value);return n};class so extends S{create(e,t,n){return this._client.post(m`/vector_stores/${e}/file_batches`,{body:t,...n,headers:y([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,t,n){const{vector_store_id:r}=t;return this._client.get(m`/vector_stores/${r}/file_batches/${e}`,{...n,headers:y([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(e,t,n){const{vector_store_id:r}=t;return this._client.post(m`/vector_stores/${r}/file_batches/${e}/cancel`,{...n,headers:y([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,t,n){const r=await this.create(e,t);return await this.poll(e,r.id,n)}listFiles(e,t,n){const{vector_store_id:r,...a}=t;return this._client.getAPIList(m`/vector_stores/${r}/file_batches/${e}/files`,W,{query:a,...n,headers:y([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async poll(e,t,n){const r=y([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){const{data:a,response:o}=await this.retrieve(t,{vector_store_id:e},{...n,headers:r}).withResponse();switch(a.status){case"in_progress":let c=5e3;if(n?.pollIntervalMs)c=n.pollIntervalMs;else{const u=o.headers.get("openai-poll-after-ms");if(u){const f=parseInt(u);isNaN(f)||(c=f)}}await Tt(c);break;case"failed":case"cancelled":case"completed":return a}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},r){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const a=r?.maxConcurrency??5,o=Math.min(a,t.length),c=this._client,u=t.values(),f=[...n];async function b(g){for(let h of g){const v=await c.files.create({file:h,purpose:"assistants"},r);f.push(v.id)}}const p=Array(o).fill(u).map(b);return await Lc(p),await this.createAndPoll(e,{file_ids:f})}}class no extends S{create(e,t,n){return this._client.post(m`/vector_stores/${e}/files`,{body:t,...n,headers:y([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,t,n){const{vector_store_id:r}=t;return this._client.get(m`/vector_stores/${r}/files/${e}`,{...n,headers:y([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,t,n){const{vector_store_id:r,...a}=t;return this._client.post(m`/vector_stores/${r}/files/${e}`,{body:a,...n,headers:y([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,t={},n){return this._client.getAPIList(m`/vector_stores/${e}/files`,W,{query:t,...n,headers:y([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,t,n){const{vector_store_id:r}=t;return this._client.delete(m`/vector_stores/${r}/files/${e}`,{...n,headers:y([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}async poll(e,t,n){const r=y([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){const a=await this.retrieve(t,{vector_store_id:e},{...n,headers:r}).withResponse(),o=a.data;switch(o.status){case"in_progress":let c=5e3;if(n?.pollIntervalMs)c=n.pollIntervalMs;else{const u=a.response.headers.get("openai-poll-after-ms");if(u){const f=parseInt(u);isNaN(f)||(c=f)}}await Tt(c);break;case"failed":case"completed":return o}}}async upload(e,t,n){const r=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:r.id},n)}async uploadAndPoll(e,t,n){const r=await this.upload(e,t,n);return await this.poll(e,r.id,n)}content(e,t,n){const{vector_store_id:r}=t;return this._client.getAPIList(m`/vector_stores/${r}/files/${e}/content`,Es,{...n,headers:y([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}class js extends S{constructor(){super(...arguments),this.files=new no(this._client),this.fileBatches=new so(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:y([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(m`/vector_stores/${e}`,{...t,headers:y([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,n){return this._client.post(m`/vector_stores/${e}`,{body:t,...n,headers:y([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",W,{query:e,...t,headers:y([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(m`/vector_stores/${e}`,{...t,headers:y([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}search(e,t,n){return this._client.getAPIList(m`/vector_stores/${e}/search`,Es,{body:t,method:"post",...n,headers:y([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}js.Files=no;js.FileBatches=so;class ro extends S{create(e,t){return this._client.post("/videos",sa({body:e,...t},this._client))}retrieve(e,t){return this._client.get(m`/videos/${e}`,t)}list(e={},t){return this._client.getAPIList("/videos",ps,{query:e,...t})}delete(e,t){return this._client.delete(m`/videos/${e}`,t)}downloadContent(e,t={},n){return this._client.get(m`/videos/${e}/content`,{query:t,...n,headers:y([{Accept:"application/binary"},n?.headers]),__binaryResponse:!0})}remix(e,t,n){return this._client.post(m`/videos/${e}/remix`,sa({body:t,...n},this._client))}}var rt,ao,us;class io extends S{constructor(){super(...arguments),rt.add(this)}async unwrap(e,t,n=this._client.webhookSecret,r=300){return await this.verifySignature(e,t,n,r),JSON.parse(e)}async verifySignature(e,t,n=this._client.webhookSecret,r=300){if(typeof crypto>"u"||typeof crypto.subtle.importKey!="function"||typeof crypto.subtle.verify!="function")throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");d(this,rt,"m",ao).call(this,n);const a=y([t]).values,o=d(this,rt,"m",us).call(this,a,"webhook-signature"),c=d(this,rt,"m",us).call(this,a,"webhook-timestamp"),u=d(this,rt,"m",us).call(this,a,"webhook-id"),f=parseInt(c,10);if(isNaN(f))throw new pt("Invalid webhook timestamp format");const b=Math.floor(Date.now()/1e3);if(b-f>r)throw new pt("Webhook timestamp is too old");if(f>b+r)throw new pt("Webhook timestamp is too new");const p=o.split(" ").map(w=>w.startsWith("v1,")?w.substring(3):w),g=n.startsWith("whsec_")?Buffer.from(n.replace("whsec_",""),"base64"):Buffer.from(n,"utf-8"),h=u?`${u}.${c}.${e}`:`${c}.${e}`,v=await crypto.subtle.importKey("raw",g,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(const w of p)try{const L=Buffer.from(w,"base64");if(await crypto.subtle.verify("HMAC",v,L,new TextEncoder().encode(h)))return}catch{continue}throw new pt("The given webhook signature does not match the expected signature")}}rt=new WeakSet,ao=function(e){if(typeof e!="string"||e.length===0)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},us=function(e,t){if(!e)throw new Error("Headers are required");const n=e.get(t);if(n==null)throw new Error(`Missing required header: ${t}`);return n};var fn,Hn,hs,oo;class I{constructor({baseURL:e=Ze("OPENAI_BASE_URL"),apiKey:t=Ze("OPENAI_API_KEY"),organization:n=Ze("OPENAI_ORG_ID")??null,project:r=Ze("OPENAI_PROJECT_ID")??null,webhookSecret:a=Ze("OPENAI_WEBHOOK_SECRET")??null,...o}={}){if(fn.add(this),hs.set(this,void 0),this.completions=new Pi(this),this.chat=new Nn(this),this.embeddings=new Fi(this),this.files=new Bi(this),this.images=new Xi(this),this.audio=new Mt(this),this.moderations=new Vi(this),this.models=new Yi(this),this.fineTuning=new ot(this),this.graders=new Dn(this),this.vectorStores=new js(this),this.webhooks=new io(this),this.beta=new it(this),this.batches=new Ii(this),this.uploads=new Fn(this),this.responses=new Os(this),this.realtime=new Rs(this),this.conversations=new On(this),this.evals=new Tn(this),this.containers=new Rn(this),this.videos=new ro(this),t===void 0)throw new C("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");const c={apiKey:t,organization:n,project:r,webhookSecret:a,...o,baseURL:e||"https://api.openai.com/v1"};if(!c.dangerouslyAllowBrowser&&Fl())throw new C(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);this.baseURL=c.baseURL,this.timeout=c.timeout??Hn.DEFAULT_TIMEOUT,this.logger=c.logger??console;const u="warn";this.logLevel=u,this.logLevel=ea(c.logLevel,"ClientOptions.logLevel",this)??ea(Ze("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??u,this.fetchOptions=c.fetchOptions,this.maxRetries=c.maxRetries??2,this.fetch=c.fetch??Kl(),E(this,hs,ql),this._options=c,this.apiKey=typeof t=="string"?t:"Missing Key",this.organization=n,this.project=r,this.webhookSecret=a}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}async authHeaders(e){return y([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return Ql(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${st}`}defaultIdempotencyKey(){return`stainless-node-retry-${Ra()}`}makeStatusError(e,t,n,r){return se.generate(e,t,n,r)}async _callApiKey(){const e=this._options.apiKey;if(typeof e!="function")return!1;let t;try{t=await e()}catch(n){throw n instanceof C?n:new C(`Failed to get token from 'apiKey' function: ${n.message}`,{cause:n})}if(typeof t!="string"||!t)throw new C(`Expected 'apiKey' function argument to return a string but it returned ${t}`);return this.apiKey=t,!0}buildURL(e,t,n){const r=!d(this,fn,"m",oo).call(this)&&n||this.baseURL,a=$l(e)?new URL(e):new URL(r+(r.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),o=this.defaultQuery();return Ml(o)||(t={...o,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(a.search=this.stringifyQuery(t)),a.toString()}async prepareOptions(e){await this._callApiKey()}async prepareRequest(e,{url:t,options:n}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(r=>({method:e,path:t,...r})))}request(e,t=null){return new As(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){const r=await e,a=r.maxRetries??this.maxRetries;t==null&&(t=a),await this.prepareOptions(r);const{req:o,url:c,timeout:u}=await this.buildRequest(r,{retryCount:a-t});await this.prepareRequest(o,{url:c,options:r});const f="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),b=n===void 0?"":`, retryOf: ${n}`,p=Date.now();if(ee(this).debug(`[${f}] sending request`,Fe({retryOfRequestLogID:n,method:r.method,url:c,options:r,headers:o.headers})),r.signal?.aborted)throw new pe;const g=new AbortController,h=await this.fetchWithTimeout(c,o,u,g).catch(en),v=Date.now();if(h instanceof globalThis.Error){const P=`retrying, ${t} attempts remaining`;if(r.signal?.aborted)throw new pe;const _=Zs(h)||/timed? ?out/i.test(String(h)+("cause"in h?String(h.cause):""));if(t)return ee(this).info(`[${f}] connection ${_?"timed out":"failed"} - ${P}`),ee(this).debug(`[${f}] connection ${_?"timed out":"failed"} (${P})`,Fe({retryOfRequestLogID:n,url:c,durationMs:v-p,message:h.message})),this.retryRequest(r,t,n??f);throw ee(this).info(`[${f}] connection ${_?"timed out":"failed"} - error; no more retries left`),ee(this).debug(`[${f}] connection ${_?"timed out":"failed"} (error; no more retries left)`,Fe({retryOfRequestLogID:n,url:c,durationMs:v-p,message:h.message})),_?new yn:new Ss({cause:h})}const w=[...h.headers.entries()].filter(([P])=>P==="x-request-id").map(([P,_])=>", "+P+": "+JSON.stringify(_)).join(""),L=`[${f}${b}${w}] ${o.method} ${c} ${h.ok?"succeeded":"failed"} with status ${h.status} in ${v-p}ms`;if(!h.ok){const P=await this.shouldRetry(h);if(t&&P){const k=`retrying, ${t} attempts remaining`;return await Wl(h.body),ee(this).info(`${L} - ${k}`),ee(this).debug(`[${f}] response error (${k})`,Fe({retryOfRequestLogID:n,url:h.url,status:h.status,headers:h.headers,durationMs:v-p})),this.retryRequest(r,t,n??f,h.headers)}const _=P?"error; no more retries left":"error; not retryable";ee(this).info(`${L} - ${_}`);const G=await h.text().catch(k=>en(k).message),M=Ll(G),V=M?void 0:G;throw ee(this).debug(`[${f}] response error (${_})`,Fe({retryOfRequestLogID:n,url:h.url,status:h.status,headers:h.headers,message:V,durationMs:Date.now()-p})),this.makeStatusError(h.status,M,V,h.headers)}return ee(this).info(L),ee(this).debug(`[${f}] response start`,Fe({retryOfRequestLogID:n,url:h.url,status:h.status,headers:h.headers,durationMs:v-p})),{response:h,options:r,controller:g,requestLogID:f,retryOfRequestLogID:n,startTime:p}}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}requestAPIList(e,t){const n=this.makeRequest(t,null,void 0);return new oc(this,n,e)}async fetchWithTimeout(e,t,n,r){const{signal:a,method:o,...c}=t||{};a&&a.addEventListener("abort",()=>r.abort());const u=setTimeout(()=>r.abort(),n),f=globalThis.ReadableStream&&c.body instanceof globalThis.ReadableStream||typeof c.body=="object"&&c.body!==null&&Symbol.asyncIterator in c.body,b={signal:r.signal,...f?{duplex:"half"}:{},method:"GET",...c};o&&(b.method=o.toUpperCase());try{return await this.fetch.call(void 0,e,b)}finally{clearTimeout(u)}}async shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n,r){let a;const o=r?.get("retry-after-ms");if(o){const u=parseFloat(o);Number.isNaN(u)||(a=u)}const c=r?.get("retry-after");if(c&&!a){const u=parseFloat(c);Number.isNaN(u)?a=Date.parse(c)-Date.now():a=u*1e3}if(!(a&&0<=a&&a<60*1e3)){const u=e.maxRetries??this.maxRetries;a=this.calculateDefaultRetryTimeoutMillis(t,u)}return await Tt(a),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){const a=t-e,o=Math.min(.5*Math.pow(2,a),8),c=1-Math.random()*.25;return o*c*1e3}async buildRequest(e,{retryCount:t=0}={}){const n={...e},{method:r,path:a,query:o,defaultBaseURL:c}=n,u=this.buildURL(a,o,c);"timeout"in n&&Dl("timeout",n.timeout),n.timeout=n.timeout??this.timeout;const{bodyHeaders:f,body:b}=this.buildBody({options:n}),p=await this.buildHeaders({options:e,method:r,bodyHeaders:f,retryCount:t});return{req:{method:r,headers:p,...n.signal&&{signal:n.signal},...globalThis.ReadableStream&&b instanceof globalThis.ReadableStream&&{duplex:"half"},...b&&{body:b},...this.fetchOptions??{},...n.fetchOptions??{}},url:u,timeout:n.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:n,retryCount:r}){let a={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const o=y([a,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(r),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...Gl(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,n,e.headers]);return this.validateHeaders(o),o.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};const n=y([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&n.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:Ga(e)}:d(this,hs,"f").call(this,{body:e,headers:n})}}Hn=I,hs=new WeakMap,fn=new WeakSet,oo=function(){return this.baseURL!=="https://api.openai.com/v1"};I.OpenAI=Hn;I.DEFAULT_TIMEOUT=6e5;I.OpenAIError=C;I.APIError=se;I.APIConnectionError=Ss;I.APIConnectionTimeoutError=yn;I.APIUserAbortError=pe;I.NotFoundError=$a;I.ConflictError=Ma;I.RateLimitError=Da;I.BadRequestError=Oa;I.AuthenticationError=ja;I.InternalServerError=La;I.PermissionDeniedError=Ta;I.UnprocessableEntityError=Pa;I.InvalidWebhookSignatureError=pt;I.toFile=hc;I.Completions=Pi;I.Chat=Nn;I.Embeddings=Fi;I.Files=Bi;I.Images=Xi;I.Audio=Mt;I.Moderations=Vi;I.Models=Yi;I.FineTuning=ot;I.Graders=Dn;I.VectorStores=js;I.Webhooks=io;I.Beta=it;I.Batches=Ii;I.Uploads=Fn;I.Responses=Os;I.Realtime=Rs;I.Conversations=On;I.Evals=Tn;I.Containers=Rn;I.Videos=ro;const Fc=[{keywords:["yoy","year over year","growth"],answer:"For Year-over-Year growth, use the 'YoY Growth %' pattern in the DAX Library. It uses `SAMEPERIODLASTYEAR`.",link:"/dax"},{keywords:["blue","color","hex","brand"],answer:"The official HHS Blue hex code is #005EA2. You can find the full palette in the Style Guide.",link:"/style-guide"},{keywords:["pareto","80/20"],answer:"We have a Pareto Analysis pattern in the DAX Library under 'Advanced Analytics'.",link:"/dax"},{keywords:["font","typography"],answer:"The approved font is 'Source Sans Pro'. See the Style Guide for heading sizes.",link:"/style-guide"},{keywords:["dax","measure","calculation"],answer:"The DAX Library contains patterns for Time Intelligence, Financial Formulas, and more. Check the 'DAX Library' tab.",link:"/dax"}],St=180,pn=4e3,Hc=280,Ct=(s,e,t)=>Math.min(Math.max(s,e),t),Bc=()=>typeof window>"u"?360:Ct(window.innerWidth*.3,St,pn),ts=()=>({id:"welcome",text:"Hi, I'm your **Analytics Assistant**. Ask me about **DAX**, **HHS Branding**, or **data strategy**.",sender:"guru",isSystem:!0,createdAt:new Date().toISOString()}),Js=[{label:"Generate DAX",value:"Create a reusable DAX measure for year-over-year revenue with clear comments."},{label:"Explain Visual",value:"Explain how to design an executive KPI card for Power BI with HHS branding guidance."},{label:"Build Checklist",value:"Give me a pre-publish checklist for a Power BI report destined for leadership review."},{label:"Debug Measure",value:"Help me troubleshoot why my DAX measure is returning blank values."}],ya="guru_session_notes",wa="guru_messages",xa="guru_font_size",_a="guru_line_height",tt={small:{label:"Small",message:"text-xs",meta:"text-[10px]",code:"text-xs",description:"Compact"},medium:{label:"Medium",message:"text-sm",meta:"text-xs",code:"text-sm",description:"Default"},large:{label:"Large",message:"text-base",meta:"text-sm",code:"text-base",description:"Comfortable"},xlarge:{label:"Extra Large",message:"text-lg",meta:"text-sm",code:"text-base",description:"Accessibility"}},ss={normal:{label:"Normal",class:"leading-normal"},relaxed:{label:"Relaxed",class:"leading-relaxed"},loose:{label:"Loose",class:"leading-loose"}},mn=["gemini-1.5-flash","gemini-1.5-pro","gemini-1.0-pro"];mn[0];const ft="v1beta2",Uc=["generateMessage","generateText"],Gc=[{name:"chat-bison-001",method:"generateMessage"},{name:"text-bison-001",method:"generateText"}],va="AIzaSyBQmBPQc-dFJRa9456iCbZBHrMimbO1s9A".trim()||"",vs=va==="YOUR_GOOGLE_GEMINI_API_KEY"?"":va,Kc="localhost,127.0.0.1,williamdalston.github.io",Qs=s=>(s||"").replace(/^models\//i,"").trim(),Wc=s=>s.split(",").map(e=>e.trim()).filter(Boolean).map(e=>e.replace(/^https?:\/\//,"").split("/")[0].toLowerCase()),qc=(s,e,t)=>{if(s==="*")return!0;if(s.startsWith(".")){const n=s.slice(1);return e===n||e.endsWith(`.${n}`)}return s.includes(":")?t===s:e===s},Sa=Wc(Kc),Xc=()=>{if(!vs||typeof window>"u")return!1;if(Sa.length===0)return!0;const s=window.location.hostname.toLowerCase(),e=window.location.host.toLowerCase();return Sa.some(t=>qc(t,s,e))},gn=()=>Xc()?vs:"",Yc=()=>{if(typeof window>"u")return"";const s=window.localStorage.getItem("gemini_api_key");return s?s.trim():""},Ca=()=>{if(typeof window>"u")return"";const s=window.localStorage.getItem("openai_api_key");return s?s.trim():""},Vc=()=>{const s=Yc();if(s)return{key:s,source:"custom"};const e=gn();return e?{key:e,source:"project"}:{key:"",source:"none"}},zc=(s,e=120)=>s?s.length>e?`${s.slice(0,e)}`:s:"",yd=()=>{const{addToast:s}=Oo(),{isSidebarCollapsed:e,toggleSidebar:t}=jo(),n=N.useRef(Vc()),[r,a]=N.useState(()=>{if(typeof window>"u")return[ts()];try{const l=window.localStorage.getItem(wa);return l?JSON.parse(l).map(T=>T.sender==="bot"?{...T,sender:"guru"}:T):[ts()]}catch(l){return console.error("Failed to parse messages",l),[ts()]}}),[o,c]=N.useState(""),[u,f]=N.useState(n.current.key),[b,p]=N.useState(()=>Ca()),[g,h]=N.useState(n.current.source==="custom"?n.current.key:""),[v,w]=N.useState(()=>Ca()),[L,P]=N.useState(n.current.source==="custom"),[_,G]=N.useState(!1),[M,V]=N.useState(!1),[K,k]=N.useState(n.current.key?"connecting":"idle"),[q,j]=N.useState(""),[B,F]=N.useState(null),Te=N.useRef(null),Ee=N.useRef(null),Pt=N.useRef({}),[Dt,lo]=N.useState(!0),Lt=N.useRef(null),Ne=N.useRef(null),[Bn,Ts]=N.useState(()=>Bc()),[de,co]=N.useState(!1),[Ie,uo]=N.useState(()=>typeof window>"u"?!1:window.innerWidth>=1024),[$e,$s]=N.useState(()=>typeof window>"u"?"":window.localStorage.getItem(ya)||""),[lt,ho]=N.useState(!1),[Ms,Un]=N.useState(!1),[Me,Gn]=N.useState(null),[Ft,We]=N.useState(null),[qe,Kn]=N.useState(()=>typeof window>"u"?"medium":window.localStorage.getItem(xa)||"medium"),[ct,Wn]=N.useState(()=>typeof window>"u"?"relaxed":window.localStorage.getItem(_a)||"relaxed"),[Xe,qn]=N.useState(!1),Ht=N.useCallback(()=>{if(!Ne.current||typeof window>"u")return pn;const l=window.getComputedStyle(Ne.current),x=parseFloat(l.columnGap||l.gap||"0")||0,O=Ne.current.getBoundingClientRect().width-x-Hc;return Ct(O,St,pn)},[Ne]),Pe=N.useCallback(()=>{if(typeof window>"u")return;const l=window.innerWidth>=1024;if(uo(l),!l)return;const x=Ht();Ts(T=>Ct(T,St,x))},[Ht]);N.useEffect(()=>{},[]),N.useEffect(()=>{if(Pe(),!(typeof window>"u"))return window.addEventListener("resize",Pe),()=>window.removeEventListener("resize",Pe)},[Pe]),N.useEffect(()=>{Pe();const l=x=>{x.key==="Escape"&&Ms&&Un(!1)};if(typeof window<"u")return window.addEventListener("keydown",l),()=>window.removeEventListener("keydown",l)},[Ms,Pe]),N.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(wa,JSON.stringify(r))},[r]);const Xn=l=>{if(!l)return;const x=document.getElementById(`message-${l}`);x&&x.scrollIntoView({behavior:"smooth",block:"start"})};N.useEffect(()=>{const l=r[r.length-1];if(l?.sender==="guru"&&!l.isSystem&&Me?.id){Xn(Me.id);return}Te.current?.scrollIntoView({behavior:"smooth"})},[r,Me]),N.useEffect(()=>{const l=Ee.current;if(!l)return;const x=()=>{const{scrollTop:T,scrollHeight:O,clientHeight:A}=l,D=T+A>=O-10;lo(D)};return l.addEventListener("scroll",x),x(),()=>l.removeEventListener("scroll",x)},[r]);const Yn=()=>{Te.current?.scrollIntoView({behavior:"smooth"})},fo=()=>{Ee.current?.scrollTo({top:0,behavior:"smooth"})},Vn=()=>{confirm("This will clear the cache and refresh the application. Continue?")&&(window.localStorage.clear(),window.location.reload())};N.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(ya,$e)},[$e]),N.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(xa,qe)},[qe]),N.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(_a,ct)},[ct]);const zn=N.useCallback(()=>{const l=Lt.current;if(!l)return;l.style.height="auto";const T=Math.min(l.scrollHeight,200);l.style.height=`${T}px`},[]),po=N.useCallback(async(l,x)=>{if(!x||typeof window>"u"||typeof fetch>"u")return{success:!1,models:[]};const T=`${l}:${x}`,O=Pt.current[T];if(O)return O;const A=new URL(`https://generativelanguage.googleapis.com/${l}/models`);A.searchParams.set("pageSize","200"),A.searchParams.set("key",x);const D=new AbortController,re=setTimeout(()=>D.abort(),8e3);try{const z=await fetch(A.toString(),{signal:D.signal});if(clearTimeout(re),!z.ok)return{success:!1,models:[]};const R={success:!0,models:((await z.json()).models||[]).map(J=>({name:Qs(J.name),supportedGenerationMethods:Array.isArray(J.supportedGenerationMethods)?J.supportedGenerationMethods:[]})).filter(J=>!!J.name)};return Pt.current[T]=R,R}catch{return clearTimeout(re),{success:!1,models:[]}}},[]);N.useEffect(()=>{zn()},[o,zn]),N.useEffect(()=>{if(!u.trim()){k("idle"),j(""),F(null);return}k("connected"),j(""),F("v1beta")},[u]);const mo=()=>{const l=g.trim();if(!l){s("Please enter a valid access code","error");return}typeof window<"u"&&window.localStorage.setItem("gemini_api_key",l),P(!0),f(l),h(""),k("connecting"),j(""),G(!1),s("Personal access code saved. Connecting now...","success")},go=()=>{const l=v.trim();if(!l){s("Please enter a valid OpenAI API key","error");return}typeof window<"u"&&window.localStorage.setItem("openai_api_key",l),p(l),w(""),k("connecting"),j(""),G(!1),s("OpenAI API key saved. Connecting now...","success")},bo=()=>{typeof window<"u"&&window.localStorage.removeItem("gemini_api_key");const l=gn()||"",x=!!vs&&!l;P(!1),h(""),f(l),k(l?"connecting":"idle"),j(""),s(l?"Reverted to the built-in HHS access code.":x?"The built-in HHS access code is restricted on this domain. Add your personal key to enable AI responses.":"Access code removed. Running in local knowledge mode.","info")},yo=()=>{typeof window<"u"&&window.localStorage.removeItem("openai_api_key"),p(""),w(""),k("idle"),j(""),s("OpenAI API key removed.","info")},wo=l=>{const x=l.toLowerCase();return Fc.find(T=>T.keywords.some(O=>x.includes(O)))},Ps=async l=>{if(l)try{if(typeof navigator>"u"||!navigator.clipboard)throw new Error("Clipboard unavailable");await navigator.clipboard.writeText(l),s("Message copied to clipboard","success")}catch(x){console.error("Copy failed",x),s("Unable to copy message","error")}},Jn=()=>{confirm("Clear this conversation and start fresh?")&&(a([ts()]),s("Conversation cleared","success"),Yn(),Gn(null),We(null))},Qn=()=>{const l=r.filter(A=>!A.isSystem).map(A=>`${A.sender.toUpperCase()} (${dt(A,!0)}):
${A.text}`).join(`

---

`),x=new Blob([l],{type:"text/plain"}),T=URL.createObjectURL(x),O=document.createElement("a");O.href=T,O.download=`power-bi-guru-chat-${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(O),O.click(),document.body.removeChild(O),URL.revokeObjectURL(T),s("Chat exported","success")},Ds=l=>{c(l),Lt.current?.focus()},xo=async()=>{if(!$e.trim()){s("No notes to copy","info");return}try{await navigator.clipboard.writeText($e),s("Session notes copied","success")}catch(l){console.error("Copy notes failed",l),s("Unable to copy notes","error")}},_o=()=>{$e.trim()&&confirm("Clear session notes?")&&($s(""),s("Session notes cleared","success"))},Zn=l=>{if(!Ie||de||!Ne.current)return;l.preventDefault();const x=l.clientX,T=Bn,O=document.body.style.userSelect;document.body.style.userSelect="none";const A=re=>{const z=Ht(),le=re.clientX-x,ae=Ct(T-le,St,z);Ts(ae)},D=()=>{document.body.style.userSelect=O,window.removeEventListener("pointermove",A),window.removeEventListener("pointerup",D)};window.addEventListener("pointermove",A),window.addEventListener("pointerup",D)},er=l=>{if(!Ie||de||!Ne.current||l.key!=="ArrowLeft"&&l.key!=="ArrowRight")return;l.preventDefault();const x=Ht(),T=l.key==="ArrowLeft"?24:-24;Ts(O=>Ct(O+T,St,x))},tr=()=>{co(l=>!l),typeof window<"u"&&requestAnimationFrame(()=>Pe())},vo=()=>{ho(l=>!l)},sr=()=>{Un(l=>!l)},Ls=l=>{l&&($s(x=>`${x?`${x}

`:""}${l}`),s("Saved to session notes","success"))},dt=(l,x=!1)=>{if(l.isSystem&&l.id==="welcome"&&!x)return"";const T=l.createdAt||(typeof l.id=="number"?new Date(l.id).toISOString():null),O=T?new Date(T):x?new Date:null;return O?O.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""},nr=lt?"space-y-2":"space-y-4",rr=lt?"p-3":"p-4",ar=(tt[qe]||tt.medium).meta,So=(l,x)=>{const[T,O]=N.useState(x?"":l);return N.useEffect(()=>{if(!x){O(l);return}let A=0;const D=setInterval(()=>{if(A>=l.length){clearInterval(D),O(l);return}const z=l.length>1e3?50:l.length>500?25:10;O(l.slice(0,A+z)),A+=z},10);return()=>clearInterval(D)},[l,x]),T},ir=({text:l,shouldAnimate:x,isUser:T=!1})=>{const O=So(l,x);if(!O)return i.jsx("span",{className:"animate-pulse",children:"..."});const A=O.split(/(```[\s\S]*?```)/g),D=tt[qe]||tt.medium,re=ss[ct]||ss.relaxed,z=le=>le.split(/(`[^`]+`|\*\*[^*]+\*\*|\*[^*]+\*)/g).map((R,J)=>{if(R.startsWith("`")&&R.endsWith("`")){const be=R.slice(1,-1);return i.jsx("code",{className:`px-1.5 py-0.5 rounded font-mono text-[0.9em] border ${T?"bg-brand-700 text-brand-50 border-brand-600":"bg-slate-200/60 text-slate-800 border-slate-200/50"}`,children:be},J)}return R.startsWith("**")&&R.endsWith("**")?i.jsx("strong",{className:"font-bold opacity-100",children:R.slice(2,-2)},J):R.startsWith("*")&&R.endsWith("*")?i.jsx("em",{className:"italic opacity-90",children:R.slice(1,-1)},J):R});return i.jsx("div",{className:`whitespace-pre-wrap break-words overflow-hidden ${re.class} ${D.message}`,children:A.map((le,ae)=>{if(le.startsWith("```")&&le.endsWith("```")){const R=le.match(/^```(\w+)?\n([\s\S]*)```$/),J=R?R[1]:"",be=R?R[2]:le.slice(3,-3);return i.jsxs("div",{className:"my-3 rounded-lg bg-slate-800 text-slate-100 overflow-hidden shadow-sm border border-slate-700",children:[i.jsxs("div",{className:"flex items-center justify-between px-3 py-1.5 bg-slate-900/50 text-slate-400 border-b border-white/10 select-none",children:[i.jsx("span",{className:`uppercase font-semibold tracking-wider ${D.meta}`,children:J||"CODE"}),i.jsxs("button",{onClick:Hs=>{Hs.stopPropagation(),Ps(be.trim())},className:"hover:text-white flex items-center gap-1.5 transition-colors text-xs","aria-label":"Copy code",children:[i.jsx(qt,{className:"h-3 w-3"})," Copy"]})]}),i.jsx("pre",{className:`p-3 overflow-x-auto font-mono ${D.code} scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-transparent whitespace-pre`,children:i.jsx("code",{children:be.trim()})})]},ae)}return i.jsx("span",{children:z(le)},ae)})})},Bt=async()=>{if(!o.trim())return;const l={id:Date.now(),text:o,sender:"user",createdAt:new Date().toISOString()};a(A=>[...A,l]),c(""),V(!0),Gn({id:l.id,text:l.text});const x=wo(l.text);if(x){setTimeout(()=>{const A={id:Date.now()+1,text:x.answer,sender:"guru",link:x.link,createdAt:new Date().toISOString()};a(D=>[...D,A]),We(A.id),V(!1)},600);return}const T=b.trim(),O=u.trim();if(T)try{const A=new I({apiKey:T,dangerouslyAllowBrowser:!0}),re=`You are an expert Power BI Developer and Data Analyst for the US Department of Health and Human Services (HHS), but you are also a helpful general-purpose AI assistant.
                
Current Date and Time: ${new Date().toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",timeZoneName:"short"})}

You can answer ANY question the user asks, regardless of the topic (including general knowledge, coding in other languages, creative writing, etc.).

Guidelines for Power BI & Data Questions:
- Provide expert, production-ready advice.
- Always format DAX code clearly with line breaks and indentation.
- Explain complex logic step-by-step.
- Reference HHS style guidelines (blue #005EA2, Source Sans Pro) if relevant to visuals.

Guidelines for General Questions:
- Answer helpfully and accurately.
- Do not force a connection to data if the topic is unrelated.
- Be concise and direct.`,z=r.filter(R=>!R.isError&&!R.isSystem).map(R=>({role:R.sender==="user"?"user":"assistant",content:R.text})),ae=(await A.chat.completions.create({model:"gpt-4o-mini",messages:[{role:"system",content:re},...z,{role:"user",content:l.text}],temperature:.7,max_tokens:4096})).choices[0]?.message?.content;if(ae){const R={id:Date.now()+1,text:ae,sender:"guru",createdAt:new Date().toISOString()};a(J=>[...J,R]),We(R.id),k("connected"),j(""),F("OpenAI / gpt-4o-mini"),V(!1);return}}catch{}if(O){try{let A,D=null,re="",z="";const ae=`You are an expert Power BI Developer and Data Analyst for the US Department of Health and Human Services (HHS), but you are also a helpful general-purpose AI assistant.
                
Current Date and Time: ${new Date().toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",timeZoneName:"short"})}

You can answer ANY question the user asks, regardless of the topic (including general knowledge, coding in other languages, creative writing, etc.).

Guidelines for Power BI & Data Questions:
- Provide expert, production-ready advice.
- Always format DAX code clearly with line breaks and indentation.
- Explain complex logic step-by-step.
- Reference HHS style guidelines (blue #005EA2, Source Sans Pro) if relevant to visuals.

Guidelines for General Questions:
- Answer helpfully and accurately.
- Do not force a connection to data if the topic is unrelated.
- Be concise and direct.

You have access to Google Search tools. Use them proactively to verify facts, find current information, or answer questions about recent events.`,J=[...r.filter($=>!$.isError&&!$.isSystem).map($=>({role:$.sender==="user"?"user":"model",parts:[{text:$.text}]})),{role:"user",parts:[{text:l.text}]}],be=r.filter($=>!$.isSystem).map($=>({author:$.sender==="user"?"user":"bot",content:$.text})),Hs=[...be,{author:"user",content:l.text}],Eo=[ae,...be.map($=>`${$.author==="user"?"User":"Assistant"}: ${$.content}`),`User: ${l.text}`,"Assistant:"].filter(Boolean).join(`

`),No=async()=>{if(typeof fetch>"u")return null;const $=await po(ft,O),U=($.success?$.models.filter(H=>H.supportedGenerationMethods.some(Q=>Uc.includes(Q))):[]).map(H=>{const Q=H.supportedGenerationMethods.includes("generateMessage"),me=H.supportedGenerationMethods.includes("generateText");return Q?{name:H.name,method:"generateMessage"}:me?{name:H.name,method:"generateText"}:null}).filter(Boolean);if(Gc.forEach(H=>{U.some(Q=>Q.name===H.name)||U.push(H)}),U.length===0)return null;for(const H of U)try{if(H.method==="generateMessage"){const Q=`https://generativelanguage.googleapis.com/${ft}/models/${H.name}:generateMessage?key=${O}`,me=await fetch(Q,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:{context:ae,messages:Hs},temperature:.7})}),De=await me.json().catch(()=>({}));if(!me.ok)throw new Error(De.error?.message||`PaLM model ${H.name} failed (${me.status})`);const Ve=De.candidates?.[0],Wt=typeof Ve?.content=="string"?Ve.content.trim():"";if(Wt)return{text:Wt,providerLabel:`${ft} / ${H.name}`};throw new Error(`PaLM model ${H.name} returned no content`)}if(H.method==="generateText"){const Q=`https://generativelanguage.googleapis.com/${ft}/models/${H.name}:generateText?key=${O}`,me=await fetch(Q,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:{text:Eo},temperature:.7})}),De=await me.json().catch(()=>({}));if(!me.ok)throw new Error(De.error?.message||`PaLM model ${H.name} failed (${me.status})`);const Ve=De.candidates?.[0]?.output?.trim()||De.output?.trim();if(Ve)return{text:Ve,providerLabel:`${ft} / ${H.name}`};throw new Error(`PaLM model ${H.name} returned no content`)}}catch(Q){if(Q.message?.includes("404")||Q.message?.includes("not found")||Q.message?.includes("NOT_FOUND")||Q.message?.includes("400")&&Q.message?.includes("not available"))continue;A=Q}return null},Io=3e4;let Bs;try{Bs=new jl(O)}catch($){throw A=$,k("error"),j("Failed to initialize AI client."),$}let _e=mn,Ut=!1;try{const{models:$}=await Bs.listModels(),ve=($||[]).filter(U=>(U.supportedGenerationMethods||[]).includes("generateContent")).map(U=>Qs(U.name));if(ve.length>0){Ut=!0;const U=mn.filter(H=>ve.includes(Qs(H)));U.length>0?_e=U:(_e=[],Ut=!1)}else Ut=!1,_e=[]}catch{Ut=!1,_e=[]}let ut=_e.length>0;if(_e.length===0)ut=!1,A=new Error("No accessible models found for this API key");else for(const $ of _e){let ve;try{const U=Bs.getGenerativeModel({model:$,systemInstruction:ae,safetySettings:[{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_MEDIUM_AND_ABOVE"}]}),H=new Promise((Ve,Wt)=>{ve=setTimeout(()=>Wt(new Error("Request timeout")),Io)}),Q=U.generateContent({contents:J,generationConfig:{maxOutputTokens:8192,temperature:.7,topP:.95,topK:40}}),me=await Promise.race([Q,H]);ve&&clearTimeout(ve),D=await me.response,re=$,z="current",k("connected"),j(""),ut=!1;break}catch(U){if(ve&&clearTimeout(ve),U.message?.includes("404")||U.message?.includes("not found")||U.message?.includes("NOT_FOUND")||U.message?.includes("Requested entity was not found")){A=U;continue}else ut=!1;if(U.message?.includes("API_KEY")||U.message?.includes("PERMISSION_DENIED")){A=U;break}A=U}}let Gt=null,Kt=null;if(D)Gt=D.text(),Kt=re,F(Kt);else if(!ut&&_e.length>0){const $=await No();$&&(Gt=$.text,Kt=$.providerLabel,k("connected"),j(""),F(Kt))}else ut&&_e.length>0&&(k("error"),j("API key does not have access to any AI models. Please check your API key permissions."));if(!Gt)throw k("error"),j("No compatible AI model found for this access code."),A||new Error("No compatible AI model found");const ko=Gt,dr={id:Date.now()+1,text:ko,sender:"guru",createdAt:new Date().toISOString()};a($=>[...$,dr]),We(dr.id)}catch(A){console.error("AI Connection Error:",A.message);const D=A.message?.includes("No accessible models")||A.message?.includes("No compatible AI model"),re=A.message?.includes("API_KEY")||A.message?.includes("PERMISSION_DENIED")||A.message?.includes("INVALID_ARGUMENT"),z=A.message?.includes("not found")||A.message?.includes("NOT_FOUND")||A.message?.includes("404")||A.message?.includes("Requested entity was not found"),le=A.message?.includes("timeout")||A.message?.includes("Timeout"),ae=A.message?.includes("network")||A.message?.includes("fetch");(D||re||z)&&(k("error"),j(D||z?"API key does not have access to any AI models. Please check your API key permissions or create a new one at https://makersuite.google.com/app/apikey":"Invalid API key or insufficient permissions"));let R;D||z?R="The API key doesn't have access to any AI models. Please check that your Google AI Studio API key has the correct permissions, or create a new key at https://makersuite.google.com/app/apikey. I can still help with local knowledge about DAX and Power BI.":re?R="I couldn't connect to the AI service with the current access code. Please update your API key in settings, or I can help with local knowledge about DAX and Power BI.":le?R="The AI service is taking too long to respond. This can happen on slower connections. Please try again, or I can help with local knowledge about DAX and Power BI.":ae?R="I'm having trouble reaching the AI service. Please check your internet connection and try again, or I can help with local knowledge about DAX and Power BI.":R="I'm having trouble connecting to the AI service right now. Let me help with what I know about DAX and Power BI instead.";const J={id:Date.now()+1,text:R,sender:"guru",isError:!0,createdAt:new Date().toISOString()};a(be=>[...be,J]),We(J.id)}finally{V(!1)}return}setTimeout(()=>{const A={id:Date.now()+1,text:"I don't have an answer for that in my local knowledge base. To unlock full AI capabilities, please configure the AI Access Code in settings.",sender:"guru",isSystem:!0,createdAt:new Date().toISOString()};a(D=>[...D,A]),We(A.id),V(!1)},600)},Fs=!!gn(),Co=!!vs&&!Fs,Ye=u?K==="connected"?{text:B?`AI Connected (${B})`:"AI Connected",className:"bg-emerald-100 text-emerald-700"}:K==="connecting"?{text:"Verifying Access Code",className:"bg-sky-100 text-sky-700"}:K==="error"?{text:"Connection Error",className:"bg-rose-100 text-rose-700"}:null:null,or=!de,lr=Ie?{width:`${Bn}px`}:void 0,cr=i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex items-center justify-between mb-3 gap-2",children:[i.jsxs("div",{children:[i.jsxs("p",{className:"text-sm font-semibold text-slate-900 flex items-center gap-2",children:[i.jsx(wr,{className:"h-4 w-4 text-brand-500"}),"Session Notes"]}),i.jsx("p",{className:"text-xs text-slate-500",children:"Capture insights or follow-ups"})]}),i.jsxs("div",{className:"flex gap-1",children:[i.jsx("button",{onClick:xo,className:"p-2 text-slate-400 hover:text-brand-600 hover:bg-brand-50 rounded transition-colors",title:"Copy notes","aria-label":"Copy notes",children:i.jsx(qt,{className:"h-4 w-4"})}),i.jsx("button",{onClick:_o,className:"p-2 text-slate-400 hover:text-rose-600 hover:bg-rose-50 rounded transition-colors",title:"Clear notes","aria-label":"Clear notes",children:i.jsx(Ho,{className:"h-4 w-4"})})]})]}),i.jsx("textarea",{value:$e,onChange:l=>$s(l.target.value),placeholder:"Capture project context, action items, or next steps...",className:"input-field flex-1 min-h-[200px] resize-none"}),i.jsxs("p",{className:"text-[11px] text-slate-400 text-right mt-2",children:["Autosaved locally  ",$e.trim().length," chars"]})]}),Ao=({onPromptClick:l})=>i.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 text-center animate-fadeIn",children:[i.jsx("div",{className:"bg-brand-50 p-6 rounded-full mb-6 ring-8 ring-brand-50/50",children:i.jsx(Le,{className:"h-12 w-12 text-brand-600"})}),i.jsx("h3",{className:"text-2xl font-bold text-slate-900 mb-2",children:"How can I help you today?"}),i.jsx("p",{className:"text-slate-600 max-w-md mb-8",children:"I'm your dedicated analytics assistant. Ask me about DAX patterns, report design, or HHS data standards."}),i.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 max-w-2xl w-full",children:Js.map(x=>i.jsxs("button",{onClick:()=>l(x.value),className:"p-4 bg-white border border-slate-200 rounded-xl hover:border-brand-300 hover:shadow-brand transition-all text-left group",children:[i.jsx("span",{className:"text-xs font-bold text-brand-600 uppercase tracking-wider mb-1 block group-hover:text-brand-700",children:x.label}),i.jsx("span",{className:"text-sm text-slate-700 group-hover:text-slate-900",children:x.value})]},x.label))})]});return Ms?Mo.createPortal(i.jsxs("div",{className:"fixed inset-0 z-[100] bg-white flex flex-col animate-fadeIn",children:[i.jsxs("div",{className:"bg-white/90 backdrop-blur-md border-b border-slate-200 px-4 py-3 flex flex-wrap items-center justify-between gap-3 sticky top-0 z-20",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Le,{className:"h-5 w-5 text-brand-600"}),i.jsx("h2",{className:"text-lg font-bold text-slate-900",children:"Power BI Guru"}),Ye&&i.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full font-medium ${Ye.className}`,children:Ye.text})]}),i.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[i.jsx("button",{onClick:Vn,className:"p-2 hover:bg-slate-100 rounded-lg text-slate-500 transition-colors",title:"Clear Cache & Refresh",children:i.jsx(Cr,{className:"h-5 w-5"})}),i.jsxs("button",{onClick:t,"aria-pressed":e,"aria-label":e?"Show sidebar":"Hide sidebar",className:`hidden lg:flex p-2 rounded-lg text-sm font-medium items-center gap-2 border transition-colors ${e?"border-slate-200 text-slate-600 hover:bg-slate-100":"bg-emerald-50 text-emerald-700 border-emerald-100"}`,title:e?"Show sidebar":"Hide sidebar",children:[e?i.jsx(_r,{className:"h-4 w-4"}):i.jsx(xr,{className:"h-4 w-4"}),i.jsx("span",{className:"hidden xl:inline",children:e?"Show sidebar":"Hide sidebar"})]}),i.jsxs("button",{onClick:tr,"aria-pressed":!de,"aria-label":de?"Show notes panel":"Hide notes panel",className:`p-2 rounded-lg text-sm font-medium flex items-center gap-2 border transition-colors ${de?"border-slate-200 text-slate-600 hover:bg-slate-100":"bg-brand-50 text-brand-700 border-brand-100"}`,children:[de?i.jsx(Sr,{className:"h-4 w-4"}):i.jsx(vr,{className:"h-4 w-4"}),i.jsx("span",{className:"hidden sm:inline",children:de?"Show notes":"Hide notes"})]}),i.jsx("button",{onClick:sr,className:"p-2 hover:bg-slate-200 rounded-lg transition-colors text-slate-600",title:"Exit Fullscreen",children:i.jsx(Xo,{className:"h-5 w-5"})})]})]}),i.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:i.jsxs("div",{ref:Ne,className:"flex-1 flex flex-col gap-4 lg:flex-row lg:items-stretch px-4 pb-4 pt-2 overflow-hidden",children:[i.jsxs("div",{className:"flex-1 flex flex-col min-w-0 bg-white relative border border-slate-200 rounded-xl shadow-sm",children:[i.jsxs("div",{className:"px-4 py-2 border-b border-slate-100 bg-white flex items-center gap-2 overflow-x-auto shrink-0",children:[i.jsxs("div",{className:"flex items-center gap-2 text-xs font-semibold uppercase text-slate-500 whitespace-nowrap",children:[i.jsx(Ar,{className:"h-3 w-3 text-brand-500"}),"Quick prompts"]}),i.jsx("div",{className:"flex gap-2",children:Js.map(l=>i.jsx("button",{onClick:()=>Ds(l.value),className:"flex-shrink-0 px-3 py-1 text-xs bg-slate-100 text-slate-700 rounded-full hover:bg-brand-50 hover:text-brand-700 transition-colors whitespace-nowrap",children:l.label},l.label))}),i.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[i.jsx("button",{onClick:()=>qn(!Xe),className:`p-1.5 rounded transition-colors flex items-center gap-1 ${Xe?"bg-brand-100 text-brand-700":"text-slate-400 hover:text-slate-600 hover:bg-slate-200"}`,title:"Text & Style Settings","aria-label":"Text style settings",children:i.jsx(Xt,{className:"h-4 w-4"})}),i.jsx("button",{onClick:Qn,className:"p-1.5 text-slate-400 hover:text-slate-600 hover:bg-slate-200 rounded transition-colors",title:"Export chat","aria-label":"Export chat",children:i.jsx(pr,{className:"h-4 w-4"})}),i.jsx("button",{onClick:Jn,className:"p-1.5 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded transition-colors",title:"Clear chat","aria-label":"Clear chat",children:i.jsx(ur,{className:"h-4 w-4"})})]})]}),i.jsx(ze,{children:Xe&&i.jsx(Se.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden border-b border-slate-200",children:i.jsxs("div",{className:"px-4 py-3 bg-gradient-to-br from-brand-50 to-slate-50",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[i.jsx(Xt,{className:"h-4 w-4 text-brand-600"}),i.jsx("h3",{className:"font-semibold text-slate-900 text-sm",children:"Text & Style Settings"})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 max-w-3xl",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-2",children:"Font Size"}),i.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(tt).map(([l,x])=>i.jsxs("button",{onClick:()=>Kn(l),className:`px-3 py-2 text-xs rounded-lg border transition-all ${qe===l?"bg-brand-600 text-white border-brand-600 shadow-md":"bg-white text-slate-700 border-slate-200 hover:border-brand-300 hover:bg-brand-50"}`,children:[i.jsx("div",{className:"font-semibold",children:x.label}),i.jsx("div",{className:"text-[10px] opacity-75",children:x.description})]},l))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-2",children:"Line Spacing"}),i.jsx("div",{className:"grid grid-cols-1 gap-2",children:Object.entries(ss).map(([l,x])=>i.jsx("button",{onClick:()=>Wn(l),className:`px-3 py-2 text-xs rounded-lg border transition-all ${ct===l?"bg-brand-600 text-white border-brand-600 shadow-md":"bg-white text-slate-700 border-slate-200 hover:border-brand-300 hover:bg-brand-50"}`,children:x.label},l))})]})]}),i.jsxs("p",{className:"text-xs text-slate-500 mt-3 flex items-center gap-1",children:[i.jsx(Le,{className:"h-3 w-3"}),"Settings are saved automatically and persist across sessions"]})]})})}),i.jsxs("div",{ref:Ee,className:`flex-1 overflow-y-auto p-4 md:p-8 ${nr} relative`,children:[r.length<=1?i.jsx(Ao,{onPromptClick:Ds}):r.map(l=>i.jsx(Se.div,{id:`message-${l.id}`,initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex ${l.sender==="user"?"justify-end":"justify-start"}`,children:i.jsxs("div",{className:`max-w-[90%] md:max-w-[70%] rounded-2xl ${rr} group relative shadow-sm ${l.sender==="user"?"bg-brand-600 text-white rounded-br-none":l.isSystem?"bg-amber-50 text-amber-800 border border-amber-100":"bg-slate-100 text-slate-800 rounded-bl-none"} ${l.id===Ft?"ring-2 ring-brand-200 shadow-brand-200/60":""}`,children:[i.jsx("button",{onClick:()=>Ps(l.text),className:`absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded ${l.sender==="user"?"text-brand-100 hover:text-white hover:bg-brand-500":"text-slate-400 hover:text-brand-600 hover:bg-slate-200"}`,title:"Copy message","aria-label":"Copy message",children:i.jsx(qt,{className:"h-3 w-3"})}),l.sender==="guru"&&!l.isSystem&&i.jsx("button",{onClick:()=>Ls(l.text),className:`absolute top-2 right-10 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded ${l.sender==="user"?"text-brand-100 hover:text-white hover:bg-brand-500":"text-slate-400 hover:text-brand-600 hover:bg-slate-200"}`,title:"Save to notes","aria-label":"Save to notes",children:i.jsx(Us,{className:"h-3 w-3"})}),i.jsxs("div",{className:`flex items-center justify-between mb-1 opacity-75 ${ar}`,children:[i.jsxs("div",{className:"flex items-center gap-2",children:[l.sender==="user"?i.jsx(hr,{className:"h-3 w-3"}):i.jsx(Le,{className:"h-3 w-3"}),i.jsx("span",{className:"uppercase font-bold tracking-wider",children:l.sender})]}),dt(l)&&i.jsx("span",{className:"opacity-75",children:dt(l)})]}),i.jsx(ir,{text:l.text,shouldAnimate:l.id===Ft&&l.sender==="guru"&&!l.isSystem,isUser:l.sender==="user"}),l.link&&i.jsx("div",{className:`mt-3 pt-3 border-t ${l.sender==="user"?"border-white/20":"border-black/10"}`,children:i.jsxs("a",{href:`#${l.link}`,className:`text-xs font-bold flex items-center gap-1 hover:underline ${l.sender==="user"?"text-white":"text-brand-600"}`,children:["View Resource ",i.jsx(mr,{className:"h-3 w-3"})]})})]})},l.id)),i.jsx(ze,{children:M&&i.jsx(Se.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex justify-start",children:i.jsxs("div",{className:"bg-slate-100 rounded-2xl rounded-bl-none p-4 flex gap-1",children:[i.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce"}),i.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce delay-75"}),i.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce delay-150"})]})})}),i.jsx("div",{ref:Te})]}),i.jsxs("div",{className:"p-4 bg-white border-t border-slate-200 shrink-0 shadow-up z-10",children:[i.jsxs("div",{className:"max-w-4xl mx-auto w-full flex gap-2",children:[i.jsx("textarea",{ref:Lt,value:o,onChange:l=>{c(l.target.value)},onKeyDown:l=>{l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),Bt())},placeholder:"Ask anything about Power BI... (Shift+Enter for new line)",className:"input-field flex-1 shadow-sm resize-none min-h-[48px] max-h-[200px] overflow-hidden",rows:1}),i.jsx("button",{onClick:Bt,disabled:!o.trim()||M,className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed px-6","aria-label":"Send message",children:i.jsx(gr,{className:"h-5 w-5"})})]}),!u&&i.jsxs("p",{className:"text-xs text-slate-400 mt-2 text-center",children:["Running in ",i.jsx("span",{className:"font-semibold text-brand-600",children:"Local Knowledge Mode"}),". Add an Access Code for full AI features."]})]})]}),or&&i.jsxs("div",{className:"flex flex-col gap-4 lg:gap-0 lg:flex-row shrink-0 w-full lg:w-auto",children:[Ie&&i.jsx("div",{className:"hidden lg:flex items-center justify-center w-5 cursor-col-resize select-none text-slate-400 hover:bg-slate-100 hover:text-brand-500 transition-colors -ml-2.5 z-10 group",role:"separator","aria-label":"Resize session notes panel","aria-orientation":"vertical",tabIndex:0,onPointerDown:Zn,onKeyDown:er,title:"Drag to resize notes",children:i.jsx("div",{className:"flex flex-col items-center gap-1 bg-white/80 rounded-full px-1 py-3 shadow-sm border border-slate-200 group-hover:border-brand-300 group-hover:scale-110 transition-all",children:i.jsx(yr,{className:"h-4 w-4"})})}),i.jsx("div",{className:"border border-slate-200 bg-slate-50 rounded-xl shadow-inner p-4 sm:p-5 flex flex-col w-full lg:w-auto transition-[width] duration-200 max-h-[300px] lg:max-h-none",style:lr,children:cr})]})]})})]}),document.body):i.jsxs("div",{className:"flex flex-col gap-4 min-h-[calc(100vh-10rem)] sm:min-h-[calc(100vh-8rem)]",children:[i.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3 mb-2 sm:mb-4",children:[i.jsxs("div",{children:[i.jsxs("h2",{className:"text-xl sm:text-2xl font-bold text-slate-900 flex flex-wrap items-center gap-2",children:[i.jsx(Le,{className:`h-5 w-5 sm:h-6 sm:w-6 text-brand-600 ${M?"animate-pulse":""}`}),"Power BI Guru",Ye&&i.jsx("span",{className:`text-[10px] sm:text-xs px-2 py-0.5 rounded-full font-medium ${Ye.className}`,children:Ye.text})]}),i.jsx("p",{className:"text-sm sm:text-base text-slate-600 mt-1",children:"Your AI assistant for DAX, Design, and Strategy."}),u&&i.jsx("p",{className:"mt-1 text-xs text-slate-500",children:L?"Using your personal Gemini access code.":Fs?"Using the built-in HHS Gemini access code.":"Using the currently stored Gemini access code."}),!u&&Co&&i.jsxs("p",{className:"mt-1 text-xs text-amber-600 flex items-center gap-1",children:[i.jsx(fr,{className:"h-3 w-3"}),"Built-in cloud access is limited to approved internal domains. Add your own access code in settings to chat from this site."]}),K==="error"&&u&&i.jsxs("p",{className:"mt-1 text-sm text-rose-600 flex items-center gap-1",children:[i.jsx(fr,{className:"h-4 w-4"}),i.jsx("span",{children:q||"Unable to connect to the AI. Update the access code in settings."})]})]}),i.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[i.jsx("button",{onClick:Vn,className:"p-2.5 sm:p-2 rounded-lg text-slate-500 hover:text-brand-600 hover:bg-slate-100 transition-colors",title:"Clear Cache & Refresh App","aria-label":"Clear Cache & Refresh App",children:i.jsx(Cr,{className:"h-5 w-5 sm:h-4 sm:w-4"})}),Ie&&i.jsxs("button",{onClick:t,"aria-pressed":e,"aria-label":e?"Show sidebar":"Hide sidebar",className:"p-2.5 sm:p-2 rounded-lg text-sm font-medium flex items-center gap-2 border transition-colors border-slate-200 text-slate-600 hover:bg-slate-100",title:e?"Show sidebar":"Hide sidebar",children:[e?i.jsx(_r,{className:"h-4 w-4"}):i.jsx(xr,{className:"h-4 w-4"}),i.jsx("span",{className:"hidden xl:inline",children:e?"Show sidebar":"Hide sidebar"})]}),i.jsxs("button",{onClick:tr,"aria-pressed":!de,"aria-label":de?"Show notes panel":"Hide notes panel",className:`p-2.5 sm:p-2 rounded-lg text-xs sm:text-sm font-medium flex items-center gap-1.5 sm:gap-2 border transition-colors ${de?"border-slate-200 text-slate-600 hover:bg-slate-100":"bg-brand-50 text-brand-700 border-brand-100"}`,children:[de?Ie?i.jsx(Sr,{className:"h-4 w-4"}):i.jsx(wr,{className:"h-4 w-4"}):Ie?i.jsx(vr,{className:"h-4 w-4"}):i.jsx(br,{className:"h-4 w-4"}),i.jsx("span",{className:"hidden sm:inline",children:de?"Show notes":"Hide notes"})]}),i.jsx("button",{onClick:sr,className:"p-2.5 sm:p-2 rounded-lg bg-slate-100 text-slate-600 hover:bg-slate-200 transition-colors",title:"Maximize (Fullscreen Mode)","aria-label":"Maximize (Fullscreen Mode)",children:i.jsx(Go,{className:"h-5 w-5"})}),i.jsx("button",{onClick:()=>G(!_),className:`p-2.5 sm:p-2 rounded-lg transition-colors ${_?"bg-brand-50 text-brand-700":L?"bg-emerald-100 text-emerald-700":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,title:"Manage AI Access Code","aria-label":"Manage AI Access Code",children:i.jsx(tl,{className:"h-5 w-5"})})]})]}),i.jsx(ze,{children:_&&i.jsx(Se.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden mb-4",children:i.jsxs("div",{className:"bg-slate-50 border border-slate-200 rounded-lg p-4",children:[i.jsxs("h3",{className:"font-semibold text-slate-900 mb-2 flex items-center gap-2",children:[i.jsx(To,{className:"h-4 w-4"})," AI Settings"]}),i.jsx("p",{className:"text-sm text-slate-600 mb-4",children:"Enter an API key to enable full AI chat capabilities. OpenAI is recommended for better reliability."}),i.jsxs("div",{className:"mb-4",children:[i.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-2",children:"OpenAI API Key (Recommended)"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("input",{type:"password",value:v,onChange:l=>w(l.target.value),placeholder:"sk-...",className:"input-field flex-1"}),i.jsx("button",{onClick:go,className:"btn-primary",children:"Save"}),b&&i.jsx("button",{onClick:yo,className:"btn-secondary text-red-600 hover:bg-red-50",children:"Clear"})]}),i.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Get your key at ",i.jsx("a",{href:"https://platform.openai.com/api-keys",target:"_blank",rel:"noopener noreferrer",className:"text-brand-600 hover:underline",children:"platform.openai.com/api-keys"})]})]}),i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-2",children:"Google Gemini API Key (Alternative)"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("input",{type:"password",value:g,onChange:l=>h(l.target.value),placeholder:"Enter Gemini Access Code...",className:"input-field flex-1"}),i.jsx("button",{onClick:mo,className:"btn-primary",children:"Save"}),L&&i.jsx("button",{onClick:bo,className:"btn-secondary text-red-600 hover:bg-red-50",children:"Clear"})]}),i.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Get your key at ",i.jsx("a",{href:"https://makersuite.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"text-brand-600 hover:underline",children:"makersuite.google.com/app/apikey"})]})]}),i.jsxs("div",{className:"text-xs text-slate-500 mt-3 space-y-1 border-t border-slate-200 pt-3",children:[i.jsx("p",{children:b?"Using OpenAI API. It will be tried first, then Gemini if available.":L?"Currently using your personal Gemini key. Clear to switch back to the built-in HHS access code.":Fs?"Using the built-in HHS Gemini key by default. Add your own key if you need to run chats under a personal quota.":"No API key is configured yet. Add one to enable cloud AI responses."}),i.jsx("p",{className:"text-slate-400",children:"Any personal key you add stays in your browser only."})]})]})})}),i.jsxs("div",{ref:Ne,className:"flex-1 flex flex-col gap-4 lg:flex-row lg:items-stretch overflow-hidden",children:[i.jsxs("div",{className:"flex-1 bg-white border border-slate-200 rounded-xl shadow-sm overflow-hidden flex flex-col relative min-w-0 min-h-[420px]",children:[i.jsxs("div",{className:"bg-slate-50 border-b border-slate-200 px-3 sm:px-4 py-2 sm:py-3 flex flex-wrap items-center gap-3",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Wo,{className:"h-4 w-4 text-slate-500"}),i.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Conversation"}),i.jsxs("span",{className:"text-xs text-slate-500 bg-slate-200 px-2 py-0.5 rounded-full",children:[r.filter(l=>!l.isSystem).length," messages"]})]}),i.jsxs("div",{className:"flex gap-1.5 sm:gap-2 ml-auto",children:[i.jsx("button",{onClick:Qn,className:"p-1.5 text-slate-400 hover:text-slate-600 hover:bg-slate-200 rounded transition-colors",title:"Export chat",children:i.jsx(pr,{className:"h-4 w-4"})}),i.jsx("button",{onClick:Jn,className:"p-1.5 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded transition-colors",title:"Clear chat",children:i.jsx(ur,{className:"h-4 w-4"})})]})]}),r.length>1&&i.jsxs("div",{className:"px-3 sm:px-4 py-2 sm:py-3 border-b border-slate-100 bg-white flex flex-wrap items-center gap-2",children:[i.jsxs("div",{className:"flex items-center gap-2 text-[10px] sm:text-xs font-semibold uppercase text-slate-500",children:[i.jsx(Ar,{className:"h-3 w-3 text-brand-500"}),i.jsx("span",{className:"hidden xs:inline",children:"Quick prompts"})]}),i.jsx("div",{className:"flex flex-wrap gap-1.5 sm:gap-2",children:Js.map(l=>i.jsx("button",{onClick:()=>Ds(l.value),className:"px-2.5 sm:px-3 py-1.5 sm:py-1 text-[11px] sm:text-xs bg-slate-100 text-slate-700 rounded-full hover:bg-brand-50 hover:text-brand-700 transition-colors whitespace-nowrap flex-shrink-0",children:l.label},l.label))}),i.jsxs("div",{className:"ml-auto flex items-center gap-1.5 sm:gap-2",children:[i.jsxs("button",{onClick:()=>qn(!Xe),className:`text-[11px] sm:text-xs px-2.5 sm:px-3 py-1.5 sm:py-1 rounded-full border flex items-center gap-1 sm:gap-1.5 ${Xe?"bg-brand-600 text-white border-brand-600":"border-slate-200 text-slate-600 hover:bg-slate-100"}`,title:"Text & Style Settings","aria-label":"Text & Style Settings",children:[i.jsx(Xt,{className:"h-3 w-3"}),i.jsx("span",{className:"hidden sm:inline",children:"Style"})]}),i.jsx("button",{onClick:vo,className:`text-[11px] sm:text-xs px-2.5 sm:px-3 py-1.5 sm:py-1 rounded-full border whitespace-nowrap ${lt?"bg-brand-600 text-white border-brand-600":"border-slate-200 text-slate-600"}`,"aria-label":lt?"Switch to normal mode":"Switch to compact mode",children:lt?"Compact":"Normal"})]})]}),i.jsx(ze,{children:Xe&&i.jsx(Se.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden border-b border-slate-200",children:i.jsxs("div",{className:"px-3 sm:px-4 py-3 bg-gradient-to-br from-brand-50 to-slate-50",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[i.jsx(Xt,{className:"h-4 w-4 text-brand-600"}),i.jsx("h3",{className:"font-semibold text-slate-900 text-sm",children:"Text & Style Settings"})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-2",children:"Font Size"}),i.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(tt).map(([l,x])=>i.jsxs("button",{onClick:()=>Kn(l),className:`px-3 py-2 text-xs rounded-lg border transition-all ${qe===l?"bg-brand-600 text-white border-brand-600 shadow-md":"bg-white text-slate-700 border-slate-200 hover:border-brand-300 hover:bg-brand-50"}`,children:[i.jsx("div",{className:"font-semibold",children:x.label}),i.jsx("div",{className:"text-[10px] opacity-75",children:x.description})]},l))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-2",children:"Line Spacing"}),i.jsx("div",{className:"grid grid-cols-1 gap-2",children:Object.entries(ss).map(([l,x])=>i.jsx("button",{onClick:()=>Wn(l),className:`px-3 py-2 text-xs rounded-lg border transition-all ${ct===l?"bg-brand-600 text-white border-brand-600 shadow-md":"bg-white text-slate-700 border-slate-200 hover:border-brand-300 hover:bg-brand-50"}`,children:x.label},l))})]})]}),i.jsxs("p",{className:"text-xs text-slate-500 mt-3 flex items-center gap-1",children:[i.jsx(Le,{className:"h-3 w-3"}),"Settings are saved automatically and persist across sessions"]})]})})}),Me&&i.jsxs("div",{className:"px-3 sm:px-4 py-2 sm:py-3 border-b border-slate-100 bg-slate-50 flex flex-wrap items-center gap-3",children:[i.jsxs("div",{className:"flex-1 min-w-[240px]",children:[i.jsx("p",{className:"text-xs uppercase font-semibold text-slate-500 tracking-wide",children:"Current question"}),i.jsx("p",{className:"font-medium text-slate-900",children:zc(Me.text,160)})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("button",{onClick:()=>Xn(Me.id),className:"px-3 py-1.5 text-xs rounded-full bg-white border border-slate-200 hover:border-brand-300 hover:text-brand-600 transition-colors flex items-center gap-1",children:[i.jsx(Do,{className:"h-3 w-3"})," Jump to question"]}),i.jsxs("button",{onClick:()=>Ls(Me.text),className:"px-3 py-1.5 text-xs rounded-full bg-brand-50 text-brand-700 border border-brand-100 flex items-center gap-1",children:[i.jsx(Us,{className:"h-3 w-3"})," Save"]})]})]}),i.jsxs("div",{ref:Ee,className:`flex-1 overflow-y-auto p-3 sm:p-4 lg:p-5 ${nr} relative`,children:[r.map(l=>i.jsx(Se.div,{id:`message-${l.id}`,initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex ${l.sender==="user"?"justify-end":"justify-start"}`,children:i.jsxs("div",{className:`max-w-[80%] rounded-2xl ${rr} group relative ${l.sender==="user"?"bg-brand-600 text-white rounded-br-none":l.isSystem?"bg-amber-50 text-amber-800 border border-amber-100":"bg-slate-100 text-slate-800 rounded-bl-none"} ${l.id===Ft?"ring-2 ring-brand-200 shadow-lg shadow-brand-200/60":""}`,children:[i.jsx("button",{onClick:()=>Ps(l.text),className:`absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded ${l.sender==="user"?"text-brand-100 hover:text-white hover:bg-brand-500":"text-slate-400 hover:text-brand-600 hover:bg-slate-200"}`,title:"Copy message","aria-label":"Copy message",children:i.jsx(qt,{className:"h-4 w-4"})}),l.sender==="guru"&&!l.isSystem&&i.jsx("button",{onClick:()=>Ls(l.text),className:`absolute top-2 right-10 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded ${l.sender==="user"?"text-brand-100 hover:text-white hover:bg-brand-500":"text-slate-400 hover:text-brand-600 hover:bg-slate-200"}`,title:"Save to notes","aria-label":"Save to notes",children:i.jsx(Us,{className:"h-4 w-4"})}),i.jsxs("div",{className:`flex items-center justify-between mb-1 opacity-75 ${ar}`,children:[i.jsxs("div",{className:"flex items-center gap-2",children:[l.sender==="user"?i.jsx(hr,{className:"h-3 w-3"}):i.jsx(Le,{className:"h-3 w-3"}),i.jsx("span",{className:"uppercase font-bold tracking-wider",children:l.sender})]}),dt(l)&&i.jsx("span",{className:`text-xs ${l.sender==="user"?"text-brand-100":"text-slate-400"}`,children:dt(l)})]}),i.jsx(ir,{text:l.text,shouldAnimate:l.id===Ft&&l.sender==="guru"&&!l.isSystem}),l.link&&i.jsx("div",{className:`mt-3 pt-3 border-t ${l.sender==="user"?"border-white/20":"border-black/10"}`,children:i.jsxs("a",{href:`#${l.link}`,className:`text-xs font-bold flex items-center gap-1 hover:underline ${l.sender==="user"?"text-white":"text-brand-600"}`,children:["View Resource ",i.jsx(mr,{className:"h-3 w-3"})]})})]})},l.id)),i.jsx(ze,{children:M&&i.jsx(Se.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex justify-start",children:i.jsxs("div",{className:"bg-slate-100 rounded-2xl rounded-bl-none p-4 flex gap-1",children:[i.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce"}),i.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce delay-75"}),i.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce delay-150"})]})})}),i.jsx("div",{ref:Te})]}),i.jsx(ze,{children:!Dt&&i.jsx(Se.button,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},onClick:Yn,className:"absolute bottom-24 right-4 bg-brand-600 text-white p-2 rounded-full shadow-lg hover:bg-brand-700 transition-colors z-10",title:"Scroll to bottom",children:i.jsx(br,{className:"h-4 w-4"})})}),i.jsx(Se.button,{initial:{opacity:0,scale:.8},animate:{opacity:.5,scale:1},whileHover:{opacity:1,scale:1.1},onClick:fo,className:"absolute bottom-36 right-4 bg-slate-100 text-slate-600 border border-slate-200 p-2 rounded-full shadow-md hover:bg-white hover:text-brand-600 transition-all z-10",title:"Scroll to top",children:i.jsx($o,{className:"h-4 w-4"})}),i.jsxs("div",{className:"p-3 sm:p-4 bg-white border-t border-slate-200 shadow-up z-10",children:[i.jsxs("div",{className:"flex gap-2",children:[i.jsx("textarea",{ref:Lt,value:o,onChange:l=>c(l.target.value),onKeyDown:l=>{l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),Bt())},placeholder:"Ask anything about Power BI...",className:"input-field flex-1 shadow-sm resize-none min-h-[48px] sm:min-h-[44px] max-h-[200px] text-base sm:text-sm",rows:1}),i.jsx("button",{onClick:Bt,disabled:!o.trim()||M,className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed min-w-[48px] sm:min-w-[44px]","aria-label":"Send message",children:i.jsx(gr,{className:"h-5 w-5 sm:h-4 sm:w-4"})})]}),i.jsxs("p",{className:"text-[10px] sm:text-xs text-slate-400 mt-2 text-center flex flex-wrap items-center justify-center gap-x-2 gap-y-1",children:[i.jsx("span",{className:"hidden sm:inline",children:"Enter = Send"}),i.jsx("span",{className:"hidden sm:inline",children:"Shift+Enter = New line"}),i.jsx("span",{className:"sm:hidden",children:"Tap Send or press Enter"}),i.jsx("span",{className:"hidden md:inline",children:"Copy buttons appear when you hover a message"})]}),!u&&i.jsxs("p",{className:"text-xs text-slate-400 mt-2 text-center",children:["Running in ",i.jsx("span",{className:"font-semibold text-brand-600",children:"Local Knowledge Mode"}),". Add an Access Code for full AI features."]})]})]}),or&&i.jsxs("div",{className:"flex flex-col gap-4 lg:gap-0 lg:flex-row shrink-0 w-full lg:w-auto",children:[Ie&&i.jsx("div",{className:"hidden lg:flex items-center justify-center w-5 cursor-col-resize select-none text-slate-400 hover:bg-slate-100 hover:text-brand-500 transition-colors -ml-2.5 z-10 group",role:"separator","aria-label":"Resize session notes panel","aria-orientation":"vertical",tabIndex:0,onPointerDown:Zn,onKeyDown:er,title:"Drag to resize notes",children:i.jsx("div",{className:"flex flex-col items-center gap-1 bg-white/80 rounded-full px-1 py-3 shadow-sm border border-slate-200 group-hover:border-brand-300 group-hover:scale-110 transition-all",children:i.jsx(yr,{className:"h-4 w-4"})})}),i.jsx("aside",{className:"bg-white border border-slate-200 rounded-xl shadow-sm p-4 sm:p-5 flex flex-col w-full lg:w-auto min-h-[260px] max-h-[300px] lg:max-h-none transition-[width] duration-200",style:lr,children:cr})]})]})]})};export{yd as default};
