import{d as hs,c as C,u as ms,e as fs,r as h,j as t,f as K,T as ct,A as q,m as T,h as dt,a as ut}from"./index-Dp2-qaib.js";import{C as ge}from"./copy-CjwmDyLL.js";import{T as be}from"./type-Bv7K48gE.js";import{D as ht}from"./download-BwvILQps.js";import{D as mt}from"./database-DPUdv9cl.js";import{S as ft,K as xs}from"./send-D9WCjJJv.js";import{C as ps}from"./chevron-down-H2XRY5G3.js";var gs=hs();const bs=[["path",{d:"M12 17V3",key:"1cwfxf"}],["path",{d:"m6 11 6 6 6-6",key:"12ii2o"}],["path",{d:"M19 21H5",key:"150jfl"}]],ws=C("arrow-down-to-line",bs);const ys=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}],["line",{x1:"12",x2:"12",y1:"7",y2:"13",key:"1cppfj"}],["line",{x1:"15",x2:"9",y1:"10",y2:"10",key:"1gty7f"}]],Oe=C("bookmark-plus",ys);const vs=[["path",{d:"M21 21H8a2 2 0 0 1-1.42-.587l-3.994-3.999a2 2 0 0 1 0-2.828l10-10a2 2 0 0 1 2.829 0l5.999 6a2 2 0 0 1 0 2.828L12.834 21",key:"g5wo59"}],["path",{d:"m5.082 11.09 8.828 8.828",key:"1wx5vj"}]],Ns=C("eraser",vs);const Cs=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],xt=C("grip-vertical",Cs);const js=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],Es=C("maximize-2",js);const Ss=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],Is=C("message-square",Ss);const _s=[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]],As=C("minimize-2",_s);const ks=[["path",{d:"M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4",key:"re6nr2"}],["path",{d:"M2 6h4",key:"aawbzj"}],["path",{d:"M2 10h4",key:"l0bgd4"}],["path",{d:"M2 14h4",key:"1gsvsf"}],["path",{d:"M2 18h4",key:"1bu2t1"}],["path",{d:"M21.378 5.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"pqwjuv"}]],Rs=C("notebook-pen",ks);const Os=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m16 15-3-3 3-3",key:"14y99z"}]],pt=C("panel-left-close",Os);const Ts=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m14 9 3 3-3 3",key:"8010ee"}]],gt=C("panel-left-open",Ts);const Ms=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M15 3v18",key:"14nvp0"}],["path",{d:"m8 9 3 3-3 3",key:"12hl5m"}]],bt=C("panel-right-close",Ms);const Ds=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M15 3v18",key:"14nvp0"}],["path",{d:"m10 15-3-3 3-3",key:"1pgupc"}]],wt=C("panel-right-open",Ds);const Ls=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Hs=C("settings",Ls);const $s=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],yt=C("wand-sparkles",$s);var vt;(function(e){e.STRING="string",e.NUMBER="number",e.INTEGER="integer",e.BOOLEAN="boolean",e.ARRAY="array",e.OBJECT="object"})(vt||(vt={}));var Nt;(function(e){e.LANGUAGE_UNSPECIFIED="language_unspecified",e.PYTHON="python"})(Nt||(Nt={}));var Ct;(function(e){e.OUTCOME_UNSPECIFIED="outcome_unspecified",e.OUTCOME_OK="outcome_ok",e.OUTCOME_FAILED="outcome_failed",e.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(Ct||(Ct={}));const jt=["user","model","function","system"];var Et;(function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(Et||(Et={}));var St;(function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"})(St||(St={}));var It;(function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"})(It||(It={}));var _t;(function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER"})(_t||(_t={}));var re;(function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.OTHER="OTHER"})(re||(re={}));var At;(function(e){e.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",e.RETRIEVAL_QUERY="RETRIEVAL_QUERY",e.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",e.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",e.CLASSIFICATION="CLASSIFICATION",e.CLUSTERING="CLUSTERING"})(At||(At={}));var kt;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE"})(kt||(kt={}));var Rt;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"})(Rt||(Rt={}));class v extends Error{constructor(s){super(`[GoogleGenerativeAI Error]: ${s}`)}}class W extends v{constructor(s,a){super(s),this.response=a}}class Bt extends v{constructor(s,a,o,r){super(s),this.status=a,this.statusText=o,this.errorDetails=r}}class D extends v{}class Yt extends v{}const Gs="https://generativelanguage.googleapis.com",Ps="v1beta",Ks="0.24.1",Us="genai-js";var U;(function(e){e.GENERATE_CONTENT="generateContent",e.STREAM_GENERATE_CONTENT="streamGenerateContent",e.COUNT_TOKENS="countTokens",e.EMBED_CONTENT="embedContent",e.BATCH_EMBED_CONTENTS="batchEmbedContents"})(U||(U={}));class Fs{constructor(s,a,o,r,i){this.model=s,this.task=a,this.apiKey=o,this.stream=r,this.requestOptions=i}toString(){var s,a;const o=((s=this.requestOptions)===null||s===void 0?void 0:s.apiVersion)||Ps;let i=`${((a=this.requestOptions)===null||a===void 0?void 0:a.baseUrl)||Gs}/${o}/${this.model}:${this.task}`;return this.stream&&(i+="?alt=sse"),i}}function Bs(e){const s=[];return e?.apiClient&&s.push(e.apiClient),s.push(`${Us}/${Ks}`),s.join(" ")}async function Ys(e){var s;const a=new Headers;a.append("Content-Type","application/json"),a.append("x-goog-api-client",Bs(e.requestOptions)),a.append("x-goog-api-key",e.apiKey);let o=(s=e.requestOptions)===null||s===void 0?void 0:s.customHeaders;if(o){if(!(o instanceof Headers))try{o=new Headers(o)}catch(r){throw new D(`unable to convert customHeaders value ${JSON.stringify(o)} to Headers: ${r.message}`)}for(const[r,i]of o.entries()){if(r==="x-goog-api-key")throw new D(`Cannot set reserved header name ${r}`);if(r==="x-goog-api-client")throw new D(`Header name ${r} can only be set using the apiClient field`);a.append(r,i)}}return a}async function zs(e,s,a,o,r,i){const l=new Fs(e,s,a,o,i);return{url:l.toString(),fetchOptions:Object.assign(Object.assign({},Xs(i)),{method:"POST",headers:await Ys(l),body:r})}}async function ce(e,s,a,o,r,i={},l=fetch){const{url:d,fetchOptions:m}=await zs(e,s,a,o,r,i);return qs(d,m,l)}async function qs(e,s,a=fetch){let o;try{o=await a(e,s)}catch(r){Ws(r,e)}return o.ok||await Vs(o,e),o}function Ws(e,s){let a=e;throw a.name==="AbortError"?(a=new Yt(`Request aborted when fetching ${s.toString()}: ${e.message}`),a.stack=e.stack):e instanceof Bt||e instanceof D||(a=new v(`Error fetching from ${s.toString()}: ${e.message}`),a.stack=e.stack),a}async function Vs(e,s){let a="",o;try{const r=await e.json();a=r.error.message,r.error.details&&(a+=` ${JSON.stringify(r.error.details)}`,o=r.error.details)}catch{}throw new Bt(`Error fetching from ${s.toString()}: [${e.status} ${e.statusText}] ${a}`,e.status,e.statusText,o)}function Xs(e){const s={};if(e?.signal!==void 0||e?.timeout>=0){const a=new AbortController;e?.timeout>=0&&setTimeout(()=>a.abort(),e.timeout),e?.signal&&e.signal.addEventListener("abort",()=>{a.abort()}),s.signal=a.signal}return s}function Le(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),ve(e.candidates[0]))throw new W(`${M(e)}`,e);return Js(e)}else if(e.promptFeedback)throw new W(`Text not available. ${M(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),ve(e.candidates[0]))throw new W(`${M(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),Ot(e)[0]}else if(e.promptFeedback)throw new W(`Function call not available. ${M(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),ve(e.candidates[0]))throw new W(`${M(e)}`,e);return Ot(e)}else if(e.promptFeedback)throw new W(`Function call not available. ${M(e)}`,e)},e}function Js(e){var s,a,o,r;const i=[];if(!((a=(s=e.candidates)===null||s===void 0?void 0:s[0].content)===null||a===void 0)&&a.parts)for(const l of(r=(o=e.candidates)===null||o===void 0?void 0:o[0].content)===null||r===void 0?void 0:r.parts)l.text&&i.push(l.text),l.executableCode&&i.push("\n```"+l.executableCode.language+`
`+l.executableCode.code+"\n```\n"),l.codeExecutionResult&&i.push("\n```\n"+l.codeExecutionResult.output+"\n```\n");return i.length>0?i.join(""):""}function Ot(e){var s,a,o,r;const i=[];if(!((a=(s=e.candidates)===null||s===void 0?void 0:s[0].content)===null||a===void 0)&&a.parts)for(const l of(r=(o=e.candidates)===null||o===void 0?void 0:o[0].content)===null||r===void 0?void 0:r.parts)l.functionCall&&i.push(l.functionCall);if(i.length>0)return i}const Qs=[re.RECITATION,re.SAFETY,re.LANGUAGE];function ve(e){return!!e.finishReason&&Qs.includes(e.finishReason)}function M(e){var s,a,o;let r="";if((!e.candidates||e.candidates.length===0)&&e.promptFeedback)r+="Response was blocked",!((s=e.promptFeedback)===null||s===void 0)&&s.blockReason&&(r+=` due to ${e.promptFeedback.blockReason}`),!((a=e.promptFeedback)===null||a===void 0)&&a.blockReasonMessage&&(r+=`: ${e.promptFeedback.blockReasonMessage}`);else if(!((o=e.candidates)===null||o===void 0)&&o[0]){const i=e.candidates[0];ve(i)&&(r+=`Candidate was blocked due to ${i.finishReason}`,i.finishMessage&&(r+=`: ${i.finishMessage}`))}return r}function ie(e){return this instanceof ie?(this.v=e,this):new ie(e)}function Zs(e,s,a){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o=a.apply(e,s||[]),r,i=[];return r={},l("next"),l("throw"),l("return"),r[Symbol.asyncIterator]=function(){return this},r;function l(x){o[x]&&(r[x]=function(g){return new Promise(function(b,k){i.push([x,g,b,k])>1||d(x,g)})})}function d(x,g){try{m(o[x](g))}catch(b){I(i[0][3],b)}}function m(x){x.value instanceof ie?Promise.resolve(x.value.v).then(j,A):I(i[0][2],x)}function j(x){d("next",x)}function A(x){d("throw",x)}function I(x,g){x(g),i.shift(),i.length&&d(i[0][0],i[0][1])}}const Tt=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function en(e){const s=e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),a=nn(s),[o,r]=a.tee();return{stream:sn(o),response:tn(r)}}async function tn(e){const s=[],a=e.getReader();for(;;){const{done:o,value:r}=await a.read();if(o)return Le(an(s));s.push(r)}}function sn(e){return Zs(this,arguments,function*(){const a=e.getReader();for(;;){const{value:o,done:r}=yield ie(a.read());if(r)break;yield yield ie(Le(o))}})}function nn(e){const s=e.getReader();return new ReadableStream({start(o){let r="";return i();function i(){return s.read().then(({value:l,done:d})=>{if(d){if(r.trim()){o.error(new v("Failed to parse stream"));return}o.close();return}r+=l;let m=r.match(Tt),j;for(;m;){try{j=JSON.parse(m[1])}catch{o.error(new v(`Error parsing JSON response: "${m[1]}"`));return}o.enqueue(j),r=r.substring(m[0].length),m=r.match(Tt)}return i()}).catch(l=>{let d=l;throw d.stack=l.stack,d.name==="AbortError"?d=new Yt("Request aborted when reading from the stream"):d=new v("Error reading from the stream"),d})}}})}function an(e){const s=e[e.length-1],a={promptFeedback:s?.promptFeedback};for(const o of e){if(o.candidates){let r=0;for(const i of o.candidates)if(a.candidates||(a.candidates=[]),a.candidates[r]||(a.candidates[r]={index:r}),a.candidates[r].citationMetadata=i.citationMetadata,a.candidates[r].groundingMetadata=i.groundingMetadata,a.candidates[r].finishReason=i.finishReason,a.candidates[r].finishMessage=i.finishMessage,a.candidates[r].safetyRatings=i.safetyRatings,i.content&&i.content.parts){a.candidates[r].content||(a.candidates[r].content={role:i.content.role||"user",parts:[]});const l={};for(const d of i.content.parts)d.text&&(l.text=d.text),d.functionCall&&(l.functionCall=d.functionCall),d.executableCode&&(l.executableCode=d.executableCode),d.codeExecutionResult&&(l.codeExecutionResult=d.codeExecutionResult),Object.keys(l).length===0&&(l.text=""),a.candidates[r].content.parts.push(l)}r++}o.usageMetadata&&(a.usageMetadata=o.usageMetadata)}return a}async function zt(e,s,a,o){const r=await ce(s,U.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(a),o);return en(r)}async function qt(e,s,a,o){const i=await(await ce(s,U.GENERATE_CONTENT,e,!1,JSON.stringify(a),o)).json();return{response:Le(i)}}function Wt(e){if(e!=null){if(typeof e=="string")return{role:"system",parts:[{text:e}]};if(e.text)return{role:"system",parts:[e]};if(e.parts)return e.role?e:{role:"system",parts:e.parts}}}function le(e){let s=[];if(typeof e=="string")s=[{text:e}];else for(const a of e)typeof a=="string"?s.push({text:a}):s.push(a);return on(s)}function on(e){const s={role:"user",parts:[]},a={role:"function",parts:[]};let o=!1,r=!1;for(const i of e)"functionResponse"in i?(a.parts.push(i),r=!0):(s.parts.push(i),o=!0);if(o&&r)throw new v("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!o&&!r)throw new v("No content is provided for sending chat message.");return o?s:a}function rn(e,s){var a;let o={model:s?.model,generationConfig:s?.generationConfig,safetySettings:s?.safetySettings,tools:s?.tools,toolConfig:s?.toolConfig,systemInstruction:s?.systemInstruction,cachedContent:(a=s?.cachedContent)===null||a===void 0?void 0:a.name,contents:[]};const r=e.generateContentRequest!=null;if(e.contents){if(r)throw new D("CountTokensRequest must have one of contents or generateContentRequest, not both.");o.contents=e.contents}else if(r)o=Object.assign(Object.assign({},o),e.generateContentRequest);else{const i=le(e);o.contents=[i]}return{generateContentRequest:o}}function Mt(e){let s;return e.contents?s=e:s={contents:[le(e)]},e.systemInstruction&&(s.systemInstruction=Wt(e.systemInstruction)),s}function ln(e){return typeof e=="string"||Array.isArray(e)?{content:le(e)}:e}const Dt=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],cn={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function dn(e){let s=!1;for(const a of e){const{role:o,parts:r}=a;if(!s&&o!=="user")throw new v(`First content should be with role 'user', got ${o}`);if(!jt.includes(o))throw new v(`Each item should include role field. Got ${o} but valid roles are: ${JSON.stringify(jt)}`);if(!Array.isArray(r))throw new v("Content should have 'parts' property with an array of Parts");if(r.length===0)throw new v("Each Content should have at least one part");const i={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const d of r)for(const m of Dt)m in d&&(i[m]+=1);const l=cn[o];for(const d of Dt)if(!l.includes(d)&&i[d]>0)throw new v(`Content with role '${o}' can't contain '${d}' part`);s=!0}}function Lt(e){var s;if(e.candidates===void 0||e.candidates.length===0)return!1;const a=(s=e.candidates[0])===null||s===void 0?void 0:s.content;if(a===void 0||a.parts===void 0||a.parts.length===0)return!1;for(const o of a.parts)if(o===void 0||Object.keys(o).length===0||o.text!==void 0&&o.text==="")return!1;return!0}const Ht="SILENT_ERROR";class un{constructor(s,a,o,r={}){this.model=a,this.params=o,this._requestOptions=r,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=s,o?.history&&(dn(o.history),this._history=o.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(s,a={}){var o,r,i,l,d,m;await this._sendPromise;const j=le(s),A={safetySettings:(o=this.params)===null||o===void 0?void 0:o.safetySettings,generationConfig:(r=this.params)===null||r===void 0?void 0:r.generationConfig,tools:(i=this.params)===null||i===void 0?void 0:i.tools,toolConfig:(l=this.params)===null||l===void 0?void 0:l.toolConfig,systemInstruction:(d=this.params)===null||d===void 0?void 0:d.systemInstruction,cachedContent:(m=this.params)===null||m===void 0?void 0:m.cachedContent,contents:[...this._history,j]},I=Object.assign(Object.assign({},this._requestOptions),a);let x;return this._sendPromise=this._sendPromise.then(()=>qt(this._apiKey,this.model,A,I)).then(g=>{var b;if(Lt(g.response)){this._history.push(j);const k=Object.assign({parts:[],role:"model"},(b=g.response.candidates)===null||b===void 0?void 0:b[0].content);this._history.push(k)}else{const k=M(g.response);k&&console.warn(`sendMessage() was unsuccessful. ${k}. Inspect response object for details.`)}x=g}).catch(g=>{throw this._sendPromise=Promise.resolve(),g}),await this._sendPromise,x}async sendMessageStream(s,a={}){var o,r,i,l,d,m;await this._sendPromise;const j=le(s),A={safetySettings:(o=this.params)===null||o===void 0?void 0:o.safetySettings,generationConfig:(r=this.params)===null||r===void 0?void 0:r.generationConfig,tools:(i=this.params)===null||i===void 0?void 0:i.tools,toolConfig:(l=this.params)===null||l===void 0?void 0:l.toolConfig,systemInstruction:(d=this.params)===null||d===void 0?void 0:d.systemInstruction,cachedContent:(m=this.params)===null||m===void 0?void 0:m.cachedContent,contents:[...this._history,j]},I=Object.assign(Object.assign({},this._requestOptions),a),x=zt(this._apiKey,this.model,A,I);return this._sendPromise=this._sendPromise.then(()=>x).catch(g=>{throw new Error(Ht)}).then(g=>g.response).then(g=>{if(Lt(g)){this._history.push(j);const b=Object.assign({},g.candidates[0].content);b.role||(b.role="model"),this._history.push(b)}else{const b=M(g);b&&console.warn(`sendMessageStream() was unsuccessful. ${b}. Inspect response object for details.`)}}).catch(g=>{g.message!==Ht&&console.error(g)}),x}}async function hn(e,s,a,o){return(await ce(s,U.COUNT_TOKENS,e,!1,JSON.stringify(a),o)).json()}async function mn(e,s,a,o){return(await ce(s,U.EMBED_CONTENT,e,!1,JSON.stringify(a),o)).json()}async function fn(e,s,a,o){const r=a.requests.map(l=>Object.assign(Object.assign({},l),{model:s}));return(await ce(s,U.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:r}),o)).json()}class $t{constructor(s,a,o={}){this.apiKey=s,this._requestOptions=o,a.model.includes("/")?this.model=a.model:this.model=`models/${a.model}`,this.generationConfig=a.generationConfig||{},this.safetySettings=a.safetySettings||[],this.tools=a.tools,this.toolConfig=a.toolConfig,this.systemInstruction=Wt(a.systemInstruction),this.cachedContent=a.cachedContent}async generateContent(s,a={}){var o;const r=Mt(s),i=Object.assign(Object.assign({},this._requestOptions),a);return qt(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(o=this.cachedContent)===null||o===void 0?void 0:o.name},r),i)}async generateContentStream(s,a={}){var o;const r=Mt(s),i=Object.assign(Object.assign({},this._requestOptions),a);return zt(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(o=this.cachedContent)===null||o===void 0?void 0:o.name},r),i)}startChat(s){var a;return new un(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(a=this.cachedContent)===null||a===void 0?void 0:a.name},s),this._requestOptions)}async countTokens(s,a={}){const o=rn(s,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),r=Object.assign(Object.assign({},this._requestOptions),a);return hn(this.apiKey,this.model,o,r)}async embedContent(s,a={}){const o=ln(s),r=Object.assign(Object.assign({},this._requestOptions),a);return mn(this.apiKey,this.model,o,r)}async batchEmbedContents(s,a={}){const o=Object.assign(Object.assign({},this._requestOptions),a);return fn(this.apiKey,this.model,s,o)}}class xn{constructor(s){this.apiKey=s}getGenerativeModel(s,a){if(!s.model)throw new v("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new $t(this.apiKey,s,a)}getGenerativeModelFromCachedContent(s,a,o){if(!s.name)throw new D("Cached content must contain a `name` field.");if(!s.model)throw new D("Cached content must contain a `model` field.");const r=["model","systemInstruction"];for(const l of r)if(a?.[l]&&s[l]&&a?.[l]!==s[l]){if(l==="model"){const d=a.model.startsWith("models/")?a.model.replace("models/",""):a.model,m=s.model.startsWith("models/")?s.model.replace("models/",""):s.model;if(d===m)continue}throw new D(`Different value for "${l}" specified in modelParams (${a[l]}) and cachedContent (${s[l]})`)}const i=Object.assign(Object.assign({},a),{model:s.model,tools:s.tools,toolConfig:s.toolConfig,systemInstruction:s.systemInstruction,cachedContent:s});return new $t(this.apiKey,i,o)}}const pn=[{keywords:["yoy","year over year","growth"],answer:"For Year-over-Year growth, use the 'YoY Growth %' pattern in the DAX Library. It uses `SAMEPERIODLASTYEAR`.",link:"/dax"},{keywords:["blue","color","hex","brand"],answer:"The official HHS Blue hex code is #005EA2. You can find the full palette in the Style Guide.",link:"/style-guide"},{keywords:["pareto","80/20"],answer:"We have a Pareto Analysis pattern in the DAX Library under 'Advanced Analytics'.",link:"/dax"},{keywords:["font","typography"],answer:"The approved font is 'Source Sans Pro'. See the Style Guide for heading sizes.",link:"/style-guide"},{keywords:["dax","measure","calculation"],answer:"The DAX Library contains patterns for Time Intelligence, Financial Formulas, and more. Check the 'DAX Library' tab.",link:"/dax"}],ae=180,Me=4e3,gn=280,oe=(e,s,a)=>Math.min(Math.max(e,s),a),bn=()=>typeof window>"u"?360:oe(window.innerWidth*.3,ae,Me),we=()=>({id:"welcome",text:"Hi, I'm your **Analytics Assistant**. Ask me about **DAX**, **HHS Branding**, or **data strategy**.",sender:"guru",isSystem:!0,createdAt:new Date().toISOString()}),Te=[{label:"Generate DAX",value:"Create a reusable DAX measure for year-over-year revenue with clear comments."},{label:"Explain Visual",value:"Explain how to design an executive KPI card for Power BI with HHS branding guidance."},{label:"Build Checklist",value:"Give me a pre-publish checklist for a Power BI report destined for leadership review."},{label:"Debug Measure",value:"Help me troubleshoot why my DAX measure is returning blank values."}],Gt="guru_session_notes",Pt="guru_messages",Kt="guru_font_size",Ut="guru_line_height",V={small:{label:"Small",message:"text-xs",meta:"text-[10px]",code:"text-xs",description:"Compact"},medium:{label:"Medium",message:"text-sm",meta:"text-xs",code:"text-sm",description:"Default"},large:{label:"Large",message:"text-base",meta:"text-sm",code:"text-base",description:"Comfortable"},xlarge:{label:"Extra Large",message:"text-lg",meta:"text-sm",code:"text-base",description:"Accessibility"}},ye={normal:{label:"Normal",class:"leading-normal"},relaxed:{label:"Relaxed",class:"leading-relaxed"},loose:{label:"Loose",class:"leading-loose"}},Vt=["gemini-1.5-pro","gemini-1.5-flash","gemini-pro"];Vt[0];const Ne="AIzaSyBQmBPQc-dFJRa9456iCbZBHrMimbO1s9A".trim()||"",wn="localhost,127.0.0.1,williamdalston.github.io",yn=e=>e.split(",").map(s=>s.trim()).filter(Boolean).map(s=>s.replace(/^https?:\/\//,"").split("/")[0].toLowerCase()),vn=(e,s,a)=>{if(e==="*")return!0;if(e.startsWith(".")){const o=e.slice(1);return s===o||s.endsWith(`.${o}`)}return e.includes(":")?a===e:s===e},Ft=yn(wn),Nn=()=>{if(!Ne||typeof window>"u")return!1;if(Ft.length===0)return!0;const e=window.location.hostname.toLowerCase(),s=window.location.host.toLowerCase();return Ft.some(a=>vn(a,e,s))},De=()=>Nn()?Ne:"",Cn=()=>{if(typeof window>"u")return"";const e=window.localStorage.getItem("gemini_api_key");return e?e.trim():""},jn=()=>{const e=Cn();if(e)return{key:e,source:"custom"};const s=De();return s?{key:s,source:"project"}:{key:"",source:"none"}},En=(e,s=120)=>e?e.length>s?`${e.slice(0,s)}…`:e:"",Hn=()=>{const{addToast:e}=ms(),{isSidebarCollapsed:s,toggleSidebar:a}=fs(),o=h.useRef(jn()),[r,i]=h.useState(()=>{if(typeof window>"u")return[we()];try{const n=window.localStorage.getItem(Pt);return n?JSON.parse(n).map(f=>f.sender==="bot"?{...f,sender:"guru"}:f):[we()]}catch(n){return console.error("Failed to parse messages",n),[we()]}}),[l,d]=h.useState(""),[m,j]=h.useState(o.current.key),[A,I]=h.useState(o.current.source==="custom"?o.current.key:""),[x,g]=h.useState(o.current.source==="custom"),[b,k]=h.useState(!1),[X,de]=h.useState(!1),[ue,J]=h.useState(o.current.key?"connecting":"idle"),[Xt,Q]=h.useState(""),[He,$e]=h.useState(null),he=h.useRef(null),Ce=h.useRef(null),[Jt,Qt]=h.useState(!0),me=h.useRef(null),O=h.useRef(null),[Ge,je]=h.useState(()=>bn()),[E,Zt]=h.useState(!1),[Z,es]=h.useState(()=>typeof window>"u"?!1:window.innerWidth>=1024),[L,Ee]=h.useState(()=>typeof window>"u"?"":window.localStorage.getItem(Gt)||""),[ee,ts]=h.useState(!1),[Se,Pe]=h.useState(!1),[H,Ke]=h.useState(null),[fe,te]=h.useState(null),[F,Ue]=h.useState(()=>typeof window>"u"?"medium":window.localStorage.getItem(Kt)||"medium"),[se,Fe]=h.useState(()=>typeof window>"u"?"relaxed":window.localStorage.getItem(Ut)||"relaxed"),[B,Be]=h.useState(!1),xe=h.useCallback(()=>{if(!O.current||typeof window>"u")return Me;const n=window.getComputedStyle(O.current),c=parseFloat(n.columnGap||n.gap||"0")||0,u=O.current.getBoundingClientRect().width-c-gn;return oe(u,ae,Me)},[O]),$=h.useCallback(()=>{if(typeof window>"u")return;const n=window.innerWidth>=1024;if(es(n),!n)return;const c=xe();je(f=>oe(f,ae,c))},[xe]);h.useEffect(()=>{},[]),h.useEffect(()=>{if($(),!(typeof window>"u"))return window.addEventListener("resize",$),()=>window.removeEventListener("resize",$)},[$]),h.useEffect(()=>{$();const n=c=>{c.key==="Escape"&&Se&&Pe(!1)};if(typeof window<"u")return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[Se,$]),h.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(Pt,JSON.stringify(r))},[r]);const Ye=n=>{if(!n)return;const c=document.getElementById(`message-${n}`);c&&c.scrollIntoView({behavior:"smooth",block:"start"})};h.useEffect(()=>{const n=r[r.length-1];if(n?.sender==="guru"&&!n.isSystem&&H?.id){Ye(H.id);return}he.current?.scrollIntoView({behavior:"smooth"})},[r,H]),h.useEffect(()=>{const n=Ce.current;if(!n)return;const c=()=>{const{scrollTop:f,scrollHeight:u,clientHeight:p}=n,y=f+p>=u-10;Qt(y)};return n.addEventListener("scroll",c),c(),()=>n.removeEventListener("scroll",c)},[r]);const ze=()=>{he.current?.scrollIntoView({behavior:"smooth"})};h.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(Gt,L)},[L]),h.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(Kt,F)},[F]),h.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(Ut,se)},[se]);const qe=h.useCallback(()=>{const n=me.current;if(!n)return;n.style.height="auto";const f=Math.min(n.scrollHeight,200);n.style.height=`${f}px`},[]);h.useEffect(()=>{qe()},[l,qe]),h.useEffect(()=>{if(!m.trim()){J("idle"),Q(""),$e(null);return}J("connected"),Q(""),$e("v1beta")},[m]);const ss=()=>{const n=A.trim();if(!n){e("Please enter a valid access code","error");return}typeof window<"u"&&window.localStorage.setItem("gemini_api_key",n),g(!0),j(n),I(""),J("connecting"),Q(""),k(!1),e("Personal access code saved. Connecting now...","success")},ns=()=>{typeof window<"u"&&window.localStorage.removeItem("gemini_api_key");const n=De()||"",c=!!Ne&&!n;g(!1),I(""),j(n),J(n?"connecting":"idle"),Q(""),e(n?"Reverted to the built-in HHS access code.":c?"The built-in HHS access code is restricted on this domain. Add your personal key to enable AI responses.":"Access code removed. Running in local knowledge mode.","info")},as=n=>{const c=n.toLowerCase();return pn.find(f=>f.keywords.some(u=>c.includes(u)))},Ie=async n=>{if(n)try{if(typeof navigator>"u"||!navigator.clipboard)throw new Error("Clipboard unavailable");await navigator.clipboard.writeText(n),e("Message copied to clipboard","success")}catch(c){console.error("Copy failed",c),e("Unable to copy message","error")}},We=()=>{confirm("Clear this conversation and start fresh?")&&(i([we()]),e("Conversation cleared","success"),ze(),Ke(null),te(null))},Ve=()=>{const n=r.filter(p=>!p.isSystem).map(p=>`${p.sender.toUpperCase()} (${ne(p,!0)}):
${p.text}`).join(`

---

`),c=new Blob([n],{type:"text/plain"}),f=URL.createObjectURL(c),u=document.createElement("a");u.href=f,u.download=`power-bi-guru-chat-${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(f),e("Chat exported","success")},_e=n=>{d(n),me.current?.focus()},os=async()=>{if(!L.trim()){e("No notes to copy","info");return}try{await navigator.clipboard.writeText(L),e("Session notes copied","success")}catch(n){console.error("Copy notes failed",n),e("Unable to copy notes","error")}},rs=()=>{L.trim()&&confirm("Clear session notes?")&&(Ee(""),e("Session notes cleared","success"))},Xe=n=>{if(!Z||E||!O.current)return;n.preventDefault();const c=n.clientX,f=Ge,u=document.body.style.userSelect;document.body.style.userSelect="none";const p=G=>{const N=xe(),S=G.clientX-c,R=oe(f-S,ae,N);je(R)},y=()=>{document.body.style.userSelect=u,window.removeEventListener("pointermove",p),window.removeEventListener("pointerup",y)};window.addEventListener("pointermove",p),window.addEventListener("pointerup",y)},Je=n=>{if(!Z||E||!O.current||n.key!=="ArrowLeft"&&n.key!=="ArrowRight")return;n.preventDefault();const c=xe(),f=n.key==="ArrowLeft"?24:-24;je(u=>oe(u+f,ae,c))},Qe=()=>{Zt(n=>!n),typeof window<"u"&&requestAnimationFrame(()=>$())},is=()=>{ts(n=>!n)},Ze=()=>{Pe(n=>!n)},Ae=n=>{n&&(Ee(c=>`${c?`${c}

`:""}${n}`),e("Saved to session notes","success"))},ne=(n,c=!1)=>{if(n.isSystem&&n.id==="welcome"&&!c)return"";const f=n.createdAt||(typeof n.id=="number"?new Date(n.id).toISOString():null),u=f?new Date(f):c?new Date:null;return u?u.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""},et=ee?"space-y-2":"space-y-4",tt=ee?"p-3":"p-4",st=(V[F]||V.medium).meta,ls=(n,c)=>{const[f,u]=h.useState(c?"":n);return h.useEffect(()=>{if(!c){u(n);return}let p=0;const y=setInterval(()=>{if(p>=n.length){clearInterval(y),u(n);return}const N=n.length>1e3?50:n.length>500?25:10;u(n.slice(0,p+N)),p+=N},10);return()=>clearInterval(y)},[n,c]),f},nt=({text:n,shouldAnimate:c,isUser:f=!1})=>{const u=ls(n,c);if(!u)return t.jsx("span",{className:"animate-pulse",children:"..."});const p=u.split(/(```[\s\S]*?```)/g),y=V[F]||V.medium,G=ye[se]||ye.relaxed,N=S=>S.split(/(`[^`]+`|\*\*[^*]+\*\*|\*[^*]+\*)/g).map((w,P)=>{if(w.startsWith("`")&&w.endsWith("`")){const z=w.slice(1,-1);return t.jsx("code",{className:`px-1.5 py-0.5 rounded font-mono text-[0.9em] border ${f?"bg-brand-700 text-brand-50 border-brand-600":"bg-slate-200/60 text-slate-800 border-slate-200/50"}`,children:z},P)}return w.startsWith("**")&&w.endsWith("**")?t.jsx("strong",{className:"font-bold opacity-100",children:w.slice(2,-2)},P):w.startsWith("*")&&w.endsWith("*")?t.jsx("em",{className:"italic opacity-90",children:w.slice(1,-1)},P):w});return t.jsx("div",{className:`whitespace-pre-wrap break-words overflow-hidden ${G.class} ${y.message}`,children:p.map((S,R)=>{if(S.startsWith("```")&&S.endsWith("```")){const w=S.match(/^```(\w+)?\n([\s\S]*)```$/),P=w?w[1]:"",z=w?w[2]:S.slice(3,-3);return t.jsxs("div",{className:"my-3 rounded-lg bg-slate-800 text-slate-100 overflow-hidden shadow-sm border border-slate-700",children:[t.jsxs("div",{className:"flex items-center justify-between px-3 py-1.5 bg-slate-900/50 text-slate-400 border-b border-white/10 select-none",children:[t.jsx("span",{className:`uppercase font-semibold tracking-wider ${y.meta}`,children:P||"CODE"}),t.jsxs("button",{onClick:it=>{it.stopPropagation(),Ie(z.trim())},className:"hover:text-white flex items-center gap-1.5 transition-colors text-xs","aria-label":"Copy code",children:[t.jsx(ge,{className:"h-3 w-3"})," Copy"]})]}),t.jsx("pre",{className:`p-3 overflow-x-auto font-mono ${y.code} scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-transparent whitespace-pre`,children:t.jsx("code",{children:z.trim()})})]},R)}return t.jsx("span",{children:N(S)},R)})})},pe=async()=>{if(!l.trim())return;const n={id:Date.now(),text:l,sender:"user",createdAt:new Date().toISOString()};i(u=>[...u,n]),d(""),de(!0),Ke({id:n.id,text:n.text});const c=as(n.text);if(c){setTimeout(()=>{const u={id:Date.now()+1,text:c.answer,sender:"guru",link:c.link,createdAt:new Date().toISOString()};i(p=>[...p,u]),te(u.id),de(!1)},600);return}const f=m.trim();if(f){try{const u=new xn(f);let p,y;const N=`You are an expert Power BI Developer and Data Analyst for the US Department of Health and Human Services (HHS), but you are also a helpful general-purpose AI assistant.
                
Current Date and Time: ${new Date().toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",timeZoneName:"short"})}

You can answer ANY question the user asks, regardless of the topic (including general knowledge, coding in other languages, creative writing, etc.).
If the question is about Power BI, DAX, or data, provide expert advice.
If the question is unrelated, answer it helpfully and accurately without forcing a connection to data.
You have access to Google Search tools. Use them proactively to verify facts, find current information, or answer questions about recent events.`;for(const _ of Vt)try{p=u.getGenerativeModel({model:_,systemInstruction:N,tools:[{googleSearchRetrieval:{dynamicRetrievalConfig:{mode:"dynamic",dynamicThreshold:.6}}}]});break}catch(Re){y=Re;continue}if(!p)throw y||new Error("No compatible Gemini model found");const R=[...r.filter(_=>!_.isError&&!_.isSystem).map(_=>({role:_.sender==="user"?"user":"model",parts:[{text:_.text}]})),{role:"user",parts:[{text:n.text}]}],w=3e4,P=new Promise((_,Re)=>setTimeout(()=>Re(new Error("Request timeout")),w)),z=p.generateContent({contents:R,generationConfig:{maxOutputTokens:1e3}}),us=(await(await Promise.race([z,P])).response).text(),lt={id:Date.now()+1,text:us,sender:"guru",createdAt:new Date().toISOString()};i(_=>[..._,lt]),te(lt.id)}catch(u){console.error("AI Connection Error:",u.message);const p=u.message?.includes("API_KEY")||u.message?.includes("PERMISSION_DENIED")||u.message?.includes("INVALID_ARGUMENT"),y=u.message?.includes("timeout")||u.message?.includes("Timeout"),G=u.message?.includes("network")||u.message?.includes("fetch");p&&(J("error"),Q("Invalid API key or insufficient permissions"));let N;p?N="I couldn't connect to the AI service with the current access code. Please update your API key in settings, or I can help with local knowledge about DAX and Power BI.":y?N="The AI service is taking too long to respond. This can happen on slower connections. Please try again, or I can help with local knowledge about DAX and Power BI.":G?N="I'm having trouble reaching the AI service. Please check your internet connection and try again, or I can help with local knowledge about DAX and Power BI.":N="I'm having trouble connecting to the AI service right now. Let me help with what I know about DAX and Power BI instead.";const S={id:Date.now()+1,text:N,sender:"guru",isError:!0,createdAt:new Date().toISOString()};i(R=>[...R,S]),te(S.id)}finally{de(!1)}return}setTimeout(()=>{const u={id:Date.now()+1,text:"I don't have an answer for that in my local knowledge base. To unlock full AI capabilities, please configure the AI Access Code in settings.",sender:"guru",isSystem:!0,createdAt:new Date().toISOString()};i(p=>[...p,u]),te(u.id),de(!1)},600)},ke=!!De(),cs=!!Ne&&!ke,Y=m?ue==="connected"?{text:He?`AI Connected (${He})`:"AI Connected",className:"bg-emerald-100 text-emerald-700"}:ue==="connecting"?{text:"Verifying Access Code",className:"bg-sky-100 text-sky-700"}:ue==="error"?{text:"Connection Error",className:"bg-rose-100 text-rose-700"}:null:null,at=!E,ot=Z?{width:`${Ge}px`}:void 0,rt=t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center justify-between mb-3 gap-2",children:[t.jsxs("div",{children:[t.jsxs("p",{className:"text-sm font-semibold text-slate-900 flex items-center gap-2",children:[t.jsx(Rs,{className:"h-4 w-4 text-brand-500"}),"Session Notes"]}),t.jsx("p",{className:"text-xs text-slate-500",children:"Capture insights or follow-ups"})]}),t.jsxs("div",{className:"flex gap-1",children:[t.jsx("button",{onClick:os,className:"p-2 text-slate-400 hover:text-brand-600 hover:bg-brand-50 rounded transition-colors",title:"Copy notes","aria-label":"Copy notes",children:t.jsx(ge,{className:"h-4 w-4"})}),t.jsx("button",{onClick:rs,className:"p-2 text-slate-400 hover:text-rose-600 hover:bg-rose-50 rounded transition-colors",title:"Clear notes","aria-label":"Clear notes",children:t.jsx(Ns,{className:"h-4 w-4"})})]})]}),t.jsx("textarea",{value:L,onChange:n=>Ee(n.target.value),placeholder:"Capture project context, action items, or next steps...",className:"input-field flex-1 min-h-[200px] resize-none"}),t.jsxs("p",{className:"text-[11px] text-slate-400 text-right mt-2",children:["Autosaved locally • ",L.trim().length," chars"]})]}),ds=({onPromptClick:n})=>t.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 text-center animate-fadeIn",children:[t.jsx("div",{className:"bg-brand-50 p-6 rounded-full mb-6 ring-8 ring-brand-50/50",children:t.jsx(K,{className:"h-12 w-12 text-brand-600"})}),t.jsx("h3",{className:"text-2xl font-bold text-slate-900 mb-2",children:"How can I help you today?"}),t.jsx("p",{className:"text-slate-600 max-w-md mb-8",children:"I'm your dedicated analytics assistant. Ask me about DAX patterns, report design, or HHS data standards."}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 max-w-2xl w-full",children:Te.map(c=>t.jsxs("button",{onClick:()=>n(c.value),className:"p-4 bg-white border border-slate-200 rounded-xl hover:border-brand-300 hover:shadow-brand transition-all text-left group",children:[t.jsx("span",{className:"text-xs font-bold text-brand-600 uppercase tracking-wider mb-1 block group-hover:text-brand-700",children:c.label}),t.jsx("span",{className:"text-sm text-slate-700 group-hover:text-slate-900",children:c.value})]},c.label))})]});return Se?gs.createPortal(t.jsxs("div",{className:"fixed inset-0 z-[100] bg-white flex flex-col animate-fadeIn",children:[t.jsxs("div",{className:"bg-white/90 backdrop-blur-md border-b border-slate-200 px-4 py-3 flex flex-wrap items-center justify-between gap-3 sticky top-0 z-20",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(K,{className:"h-5 w-5 text-brand-600"}),t.jsx("h2",{className:"text-lg font-bold text-slate-900",children:"Power BI Guru"}),Y&&t.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full font-medium ${Y.className}`,children:Y.text})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsxs("button",{onClick:a,"aria-pressed":s,"aria-label":s?"Show sidebar":"Hide sidebar",className:`hidden lg:flex p-2 rounded-lg text-sm font-medium items-center gap-2 border transition-colors ${s?"border-slate-200 text-slate-600 hover:bg-slate-100":"bg-emerald-50 text-emerald-700 border-emerald-100"}`,title:s?"Show sidebar":"Hide sidebar",children:[s?t.jsx(gt,{className:"h-4 w-4"}):t.jsx(pt,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden xl:inline",children:s?"Show sidebar":"Hide sidebar"})]}),t.jsxs("button",{onClick:Qe,"aria-pressed":!E,"aria-label":E?"Show notes panel":"Hide notes panel",className:`p-2 rounded-lg text-sm font-medium flex items-center gap-2 border transition-colors ${E?"border-slate-200 text-slate-600 hover:bg-slate-100":"bg-brand-50 text-brand-700 border-brand-100"}`,children:[E?t.jsx(wt,{className:"h-4 w-4"}):t.jsx(bt,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:E?"Show notes":"Hide notes"})]}),t.jsx("button",{onClick:Ze,className:"p-2 hover:bg-slate-200 rounded-lg transition-colors text-slate-600",title:"Exit Fullscreen",children:t.jsx(As,{className:"h-5 w-5"})})]})]}),t.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:t.jsxs("div",{ref:O,className:"flex-1 flex flex-col gap-4 lg:flex-row lg:items-stretch px-4 pb-4 pt-2 overflow-hidden",children:[t.jsxs("div",{className:"flex-1 flex flex-col min-w-0 bg-white relative border border-slate-200 rounded-xl shadow-sm",children:[t.jsxs("div",{className:"px-4 py-2 border-b border-slate-100 bg-white flex items-center gap-2 overflow-x-auto shrink-0",children:[t.jsxs("div",{className:"flex items-center gap-2 text-xs font-semibold uppercase text-slate-500 whitespace-nowrap",children:[t.jsx(yt,{className:"h-3 w-3 text-brand-500"}),"Quick prompts"]}),t.jsx("div",{className:"flex gap-2",children:Te.map(n=>t.jsx("button",{onClick:()=>_e(n.value),className:"flex-shrink-0 px-3 py-1 text-xs bg-slate-100 text-slate-700 rounded-full hover:bg-brand-50 hover:text-brand-700 transition-colors whitespace-nowrap",children:n.label},n.label))}),t.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[t.jsx("button",{onClick:()=>Be(!B),className:`p-1.5 rounded transition-colors flex items-center gap-1 ${B?"bg-brand-100 text-brand-700":"text-slate-400 hover:text-slate-600 hover:bg-slate-200"}`,title:"Text & Style Settings","aria-label":"Text style settings",children:t.jsx(be,{className:"h-4 w-4"})}),t.jsx("button",{onClick:Ve,className:"p-1.5 text-slate-400 hover:text-slate-600 hover:bg-slate-200 rounded transition-colors",title:"Export chat","aria-label":"Export chat",children:t.jsx(ht,{className:"h-4 w-4"})}),t.jsx("button",{onClick:We,className:"p-1.5 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded transition-colors",title:"Clear chat","aria-label":"Clear chat",children:t.jsx(ct,{className:"h-4 w-4"})})]})]}),t.jsx(q,{children:B&&t.jsx(T.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden border-b border-slate-200",children:t.jsxs("div",{className:"px-4 py-3 bg-gradient-to-br from-brand-50 to-slate-50",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(be,{className:"h-4 w-4 text-brand-600"}),t.jsx("h3",{className:"font-semibold text-slate-900 text-sm",children:"Text & Style Settings"})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 max-w-3xl",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-2",children:"Font Size"}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(V).map(([n,c])=>t.jsxs("button",{onClick:()=>Ue(n),className:`px-3 py-2 text-xs rounded-lg border transition-all ${F===n?"bg-brand-600 text-white border-brand-600 shadow-md":"bg-white text-slate-700 border-slate-200 hover:border-brand-300 hover:bg-brand-50"}`,children:[t.jsx("div",{className:"font-semibold",children:c.label}),t.jsx("div",{className:"text-[10px] opacity-75",children:c.description})]},n))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-2",children:"Line Spacing"}),t.jsx("div",{className:"grid grid-cols-1 gap-2",children:Object.entries(ye).map(([n,c])=>t.jsx("button",{onClick:()=>Fe(n),className:`px-3 py-2 text-xs rounded-lg border transition-all ${se===n?"bg-brand-600 text-white border-brand-600 shadow-md":"bg-white text-slate-700 border-slate-200 hover:border-brand-300 hover:bg-brand-50"}`,children:c.label},n))})]})]}),t.jsxs("p",{className:"text-xs text-slate-500 mt-3 flex items-center gap-1",children:[t.jsx(K,{className:"h-3 w-3"}),"Settings are saved automatically and persist across sessions"]})]})})}),t.jsxs("div",{ref:Ce,className:`flex-1 overflow-y-auto p-4 md:p-8 ${et} relative`,children:[r.length<=1?t.jsx(ds,{onPromptClick:_e}):r.map(n=>t.jsx(T.div,{id:`message-${n.id}`,initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex ${n.sender==="user"?"justify-end":"justify-start"}`,children:t.jsxs("div",{className:`max-w-[90%] md:max-w-[70%] rounded-2xl ${tt} group relative shadow-sm ${n.sender==="user"?"bg-brand-600 text-white rounded-br-none":n.isSystem?"bg-amber-50 text-amber-800 border border-amber-100":"bg-slate-100 text-slate-800 rounded-bl-none"} ${n.id===fe?"ring-2 ring-brand-200 shadow-brand-200/60":""}`,children:[t.jsx("button",{onClick:()=>Ie(n.text),className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity text-slate-400 hover:text-brand-600 bg-white/20 p-1 rounded",title:"Copy message","aria-label":"Copy message",children:t.jsx(ge,{className:"h-3 w-3"})}),n.sender==="guru"&&!n.isSystem&&t.jsx("button",{onClick:()=>Ae(n.text),className:"absolute top-2 right-12 opacity-0 group-hover:opacity-100 transition-opacity text-slate-400 hover:text-brand-600 bg-white/20 p-1 rounded",title:"Save to notes","aria-label":"Save to notes",children:t.jsx(Oe,{className:"h-3 w-3"})}),t.jsxs("div",{className:`flex items-center justify-between mb-1 opacity-75 ${st}`,children:[t.jsxs("div",{className:"flex items-center gap-2",children:[n.sender==="user"?t.jsx(dt,{className:"h-3 w-3"}):t.jsx(K,{className:"h-3 w-3"}),t.jsx("span",{className:"uppercase font-bold tracking-wider",children:n.sender})]}),ne(n)&&t.jsx("span",{className:"opacity-75",children:ne(n)})]}),t.jsx(nt,{text:n.text,shouldAnimate:n.id===fe&&n.sender==="guru"&&!n.isSystem,isUser:n.sender==="user"}),n.link&&t.jsx("div",{className:"mt-3 pt-3 border-t border-black/10",children:t.jsxs("a",{href:`#${n.link}`,className:"text-xs font-bold flex items-center gap-1 hover:underline",children:["View Resource ",t.jsx(mt,{className:"h-3 w-3"})]})})]})},n.id)),t.jsx(q,{children:X&&t.jsx(T.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex justify-start",children:t.jsxs("div",{className:"bg-slate-100 rounded-2xl rounded-bl-none p-4 flex gap-1",children:[t.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce"}),t.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce delay-75"}),t.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce delay-150"})]})})}),t.jsx("div",{ref:he})]}),t.jsxs("div",{className:"p-4 bg-white border-t border-slate-200 shrink-0 shadow-up z-10",children:[t.jsxs("div",{className:"max-w-4xl mx-auto w-full flex gap-2",children:[t.jsx("textarea",{ref:me,value:l,onChange:n=>{d(n.target.value)},onKeyDown:n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),pe())},placeholder:"Ask anything about Power BI... (Shift+Enter for new line)",className:"input-field flex-1 shadow-sm resize-none min-h-[48px] max-h-[200px] overflow-hidden",rows:1}),t.jsx("button",{onClick:pe,disabled:!l.trim()||X,className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed px-6","aria-label":"Send message",children:t.jsx(ft,{className:"h-5 w-5"})})]}),!m&&t.jsxs("p",{className:"text-xs text-slate-400 mt-2 text-center",children:["Running in ",t.jsx("span",{className:"font-semibold text-brand-600",children:"Local Knowledge Mode"}),". Add an Access Code for full AI features."]})]})]}),at&&t.jsxs("div",{className:"flex flex-col gap-4 lg:gap-0 lg:flex-row shrink-0 w-full lg:w-auto",children:[Z&&t.jsx("div",{className:"hidden lg:flex items-center justify-center w-5 cursor-col-resize select-none text-slate-400 hover:bg-slate-100 hover:text-brand-500 transition-colors -ml-2.5 z-10 group",role:"separator","aria-label":"Resize session notes panel","aria-orientation":"vertical",tabIndex:0,onPointerDown:Xe,onKeyDown:Je,title:"Drag to resize notes",children:t.jsx("div",{className:"flex flex-col items-center gap-1 bg-white/80 rounded-full px-1 py-3 shadow-sm border border-slate-200 group-hover:border-brand-300 group-hover:scale-110 transition-all",children:t.jsx(xt,{className:"h-4 w-4"})})}),t.jsx("div",{className:"border border-slate-200 bg-slate-50 rounded-xl shadow-inner p-4 sm:p-5 flex flex-col w-full lg:w-auto transition-[width] duration-200 max-h-[300px] lg:max-h-none",style:ot,children:rt})]})]})})]}),document.body):t.jsxs("div",{className:"flex flex-col gap-4 min-h-[calc(100vh-10rem)] sm:min-h-[calc(100vh-8rem)]",children:[t.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3 mb-2 sm:mb-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-xl sm:text-2xl font-bold text-slate-900 flex flex-wrap items-center gap-2",children:[t.jsx(K,{className:`h-5 w-5 sm:h-6 sm:w-6 text-brand-600 ${X?"animate-pulse":""}`}),"Power BI Guru",Y&&t.jsx("span",{className:`text-[10px] sm:text-xs px-2 py-0.5 rounded-full font-medium ${Y.className}`,children:Y.text})]}),t.jsx("p",{className:"text-sm sm:text-base text-slate-600 mt-1",children:"Your AI assistant for DAX, Design, and Strategy."}),m&&t.jsx("p",{className:"mt-1 text-xs text-slate-500",children:x?"Using your personal Gemini access code.":ke?"Using the built-in HHS Gemini access code.":"Using the currently stored Gemini access code."}),!m&&cs&&t.jsxs("p",{className:"mt-1 text-xs text-amber-600 flex items-center gap-1",children:[t.jsx(ut,{className:"h-3 w-3"}),"Built-in cloud access is limited to approved internal domains. Add your own access code in settings to chat from this site."]}),ue==="error"&&m&&t.jsxs("p",{className:"mt-1 text-sm text-rose-600 flex items-center gap-1",children:[t.jsx(ut,{className:"h-4 w-4"}),t.jsx("span",{children:Xt||"Unable to connect to the AI. Update the access code in settings."})]})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsxs("button",{onClick:a,"aria-pressed":s,"aria-label":s?"Show sidebar":"Hide sidebar",className:`hidden lg:flex p-2.5 sm:p-2 rounded-lg text-sm font-medium items-center gap-2 border transition-colors ${s?"border-slate-200 text-slate-600 hover:bg-slate-100":"bg-emerald-50 text-emerald-700 border-emerald-100"}`,title:s?"Show sidebar":"Hide sidebar",children:[s?t.jsx(gt,{className:"h-4 w-4"}):t.jsx(pt,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden xl:inline",children:s?"Show sidebar":"Hide sidebar"})]}),t.jsxs("button",{onClick:Qe,"aria-pressed":!E,"aria-label":E?"Show notes panel":"Hide notes panel",className:`p-2.5 sm:p-2 rounded-lg text-xs sm:text-sm font-medium flex items-center gap-1.5 sm:gap-2 border transition-colors ${E?"border-slate-200 text-slate-600 hover:bg-slate-100":"bg-brand-50 text-brand-700 border-brand-100"}`,children:[E?t.jsx(wt,{className:"h-4 w-4"}):t.jsx(bt,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:E?"Show notes":"Hide notes"})]}),t.jsx("button",{onClick:Ze,className:"p-2.5 sm:p-2 rounded-lg bg-slate-100 text-slate-600 hover:bg-slate-200 transition-colors",title:"Maximize (Fullscreen Mode)","aria-label":"Maximize (Fullscreen Mode)",children:t.jsx(Es,{className:"h-5 w-5"})}),t.jsx("button",{onClick:()=>k(!b),className:`p-2.5 sm:p-2 rounded-lg transition-colors ${b?"bg-brand-50 text-brand-700":x?"bg-emerald-100 text-emerald-700":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,title:"Manage AI Access Code","aria-label":"Manage AI Access Code",children:t.jsx(Hs,{className:"h-5 w-5"})})]})]}),t.jsx(q,{children:b&&t.jsx(T.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden mb-4",children:t.jsxs("div",{className:"bg-slate-50 border border-slate-200 rounded-lg p-4",children:[t.jsxs("h3",{className:"font-semibold text-slate-900 mb-2 flex items-center gap-2",children:[t.jsx(xs,{className:"h-4 w-4"})," AI Settings"]}),t.jsx("p",{className:"text-sm text-slate-600 mb-3",children:"Enter your access code to enable full AI chat capabilities."}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"password",value:A,onChange:n=>I(n.target.value),placeholder:"Enter Access Code...",className:"input-field flex-1"}),t.jsx("button",{onClick:ss,className:"btn-primary",children:"Save & Connect"}),x&&t.jsx("button",{onClick:ns,className:"btn-secondary text-red-600 hover:bg-red-50",children:"Clear"})]}),t.jsxs("div",{className:"text-xs text-slate-500 mt-3 space-y-1",children:[t.jsx("p",{children:x?"Currently using your personal Gemini key. Clear to switch back to the built-in HHS access code.":ke?"Using the built-in HHS Gemini key by default. Add your own key if you need to run chats under a personal quota.":"No access code is configured yet. Add one to enable cloud AI responses."}),t.jsx("p",{className:"text-slate-400",children:"Any personal key you add stays in your browser only."})]})]})})}),t.jsxs("div",{ref:O,className:"flex-1 flex flex-col gap-4 lg:flex-row lg:items-stretch overflow-hidden",children:[t.jsxs("div",{className:"flex-1 bg-white border border-slate-200 rounded-xl shadow-sm overflow-hidden flex flex-col relative min-w-0 min-h-[420px]",children:[t.jsxs("div",{className:"bg-slate-50 border-b border-slate-200 px-3 sm:px-4 py-2 sm:py-3 flex flex-wrap items-center gap-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Is,{className:"h-4 w-4 text-slate-500"}),t.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Conversation"}),t.jsxs("span",{className:"text-xs text-slate-500 bg-slate-200 px-2 py-0.5 rounded-full",children:[r.filter(n=>!n.isSystem).length," messages"]})]}),t.jsxs("div",{className:"flex gap-1.5 sm:gap-2 ml-auto",children:[t.jsx("button",{onClick:Ve,className:"p-1.5 text-slate-400 hover:text-slate-600 hover:bg-slate-200 rounded transition-colors",title:"Export chat",children:t.jsx(ht,{className:"h-4 w-4"})}),t.jsx("button",{onClick:We,className:"p-1.5 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded transition-colors",title:"Clear chat",children:t.jsx(ct,{className:"h-4 w-4"})})]})]}),r.length>1&&t.jsxs("div",{className:"px-3 sm:px-4 py-2 sm:py-3 border-b border-slate-100 bg-white flex flex-wrap items-center gap-2",children:[t.jsxs("div",{className:"flex items-center gap-2 text-[10px] sm:text-xs font-semibold uppercase text-slate-500",children:[t.jsx(yt,{className:"h-3 w-3 text-brand-500"}),t.jsx("span",{className:"hidden xs:inline",children:"Quick prompts"})]}),t.jsx("div",{className:"flex flex-wrap gap-1.5 sm:gap-2",children:Te.map(n=>t.jsx("button",{onClick:()=>_e(n.value),className:"px-2.5 sm:px-3 py-1.5 sm:py-1 text-[11px] sm:text-xs bg-slate-100 text-slate-700 rounded-full hover:bg-brand-50 hover:text-brand-700 transition-colors whitespace-nowrap flex-shrink-0",children:n.label},n.label))}),t.jsxs("div",{className:"ml-auto flex items-center gap-1.5 sm:gap-2",children:[t.jsxs("button",{onClick:()=>Be(!B),className:`text-[11px] sm:text-xs px-2.5 sm:px-3 py-1.5 sm:py-1 rounded-full border flex items-center gap-1 sm:gap-1.5 ${B?"bg-brand-600 text-white border-brand-600":"border-slate-200 text-slate-600 hover:bg-slate-100"}`,title:"Text & Style Settings","aria-label":"Text & Style Settings",children:[t.jsx(be,{className:"h-3 w-3"}),t.jsx("span",{className:"hidden sm:inline",children:"Style"})]}),t.jsx("button",{onClick:is,className:`text-[11px] sm:text-xs px-2.5 sm:px-3 py-1.5 sm:py-1 rounded-full border whitespace-nowrap ${ee?"bg-brand-600 text-white border-brand-600":"border-slate-200 text-slate-600"}`,"aria-label":ee?"Switch to normal mode":"Switch to compact mode",children:ee?"Compact":"Normal"})]})]}),t.jsx(q,{children:B&&t.jsx(T.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden border-b border-slate-200",children:t.jsxs("div",{className:"px-3 sm:px-4 py-3 bg-gradient-to-br from-brand-50 to-slate-50",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(be,{className:"h-4 w-4 text-brand-600"}),t.jsx("h3",{className:"font-semibold text-slate-900 text-sm",children:"Text & Style Settings"})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-2",children:"Font Size"}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(V).map(([n,c])=>t.jsxs("button",{onClick:()=>Ue(n),className:`px-3 py-2 text-xs rounded-lg border transition-all ${F===n?"bg-brand-600 text-white border-brand-600 shadow-md":"bg-white text-slate-700 border-slate-200 hover:border-brand-300 hover:bg-brand-50"}`,children:[t.jsx("div",{className:"font-semibold",children:c.label}),t.jsx("div",{className:"text-[10px] opacity-75",children:c.description})]},n))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-2",children:"Line Spacing"}),t.jsx("div",{className:"grid grid-cols-1 gap-2",children:Object.entries(ye).map(([n,c])=>t.jsx("button",{onClick:()=>Fe(n),className:`px-3 py-2 text-xs rounded-lg border transition-all ${se===n?"bg-brand-600 text-white border-brand-600 shadow-md":"bg-white text-slate-700 border-slate-200 hover:border-brand-300 hover:bg-brand-50"}`,children:c.label},n))})]})]}),t.jsxs("p",{className:"text-xs text-slate-500 mt-3 flex items-center gap-1",children:[t.jsx(K,{className:"h-3 w-3"}),"Settings are saved automatically and persist across sessions"]})]})})}),H&&t.jsxs("div",{className:"px-3 sm:px-4 py-2 sm:py-3 border-b border-slate-100 bg-slate-50 flex flex-wrap items-center gap-3",children:[t.jsxs("div",{className:"flex-1 min-w-[240px]",children:[t.jsx("p",{className:"text-xs uppercase font-semibold text-slate-500 tracking-wide",children:"Current question"}),t.jsx("p",{className:"font-medium text-slate-900",children:En(H.text,160)})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("button",{onClick:()=>Ye(H.id),className:"px-3 py-1.5 text-xs rounded-full bg-white border border-slate-200 hover:border-brand-300 hover:text-brand-600 transition-colors flex items-center gap-1",children:[t.jsx(ws,{className:"h-3 w-3"})," Jump to question"]}),t.jsxs("button",{onClick:()=>Ae(H.text),className:"px-3 py-1.5 text-xs rounded-full bg-brand-50 text-brand-700 border border-brand-100 flex items-center gap-1",children:[t.jsx(Oe,{className:"h-3 w-3"})," Save"]})]})]}),t.jsxs("div",{ref:Ce,className:`flex-1 overflow-y-auto p-3 sm:p-4 lg:p-5 ${et} relative`,children:[r.map(n=>t.jsx(T.div,{id:`message-${n.id}`,initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex ${n.sender==="user"?"justify-end":"justify-start"}`,children:t.jsxs("div",{className:`max-w-[80%] rounded-2xl ${tt} group relative ${n.sender==="user"?"bg-brand-600 text-white rounded-br-none":n.isSystem?"bg-amber-50 text-amber-800 border border-amber-100":"bg-slate-100 text-slate-800 rounded-bl-none"} ${n.id===fe?"ring-2 ring-brand-200 shadow-lg shadow-brand-200/60":""}`,children:[t.jsx("button",{onClick:()=>Ie(n.text),className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity text-slate-400 hover:text-brand-600",title:"Copy message","aria-label":"Copy message",children:t.jsx(ge,{className:"h-4 w-4"})}),n.sender==="guru"&&!n.isSystem&&t.jsx("button",{onClick:()=>Ae(n.text),className:"absolute top-2 right-10 opacity-0 group-hover:opacity-100 transition-opacity text-slate-400 hover:text-brand-600",title:"Save to notes","aria-label":"Save to notes",children:t.jsx(Oe,{className:"h-4 w-4"})}),t.jsxs("div",{className:`flex items-center justify-between mb-1 opacity-75 ${st}`,children:[t.jsxs("div",{className:"flex items-center gap-2",children:[n.sender==="user"?t.jsx(dt,{className:"h-3 w-3"}):t.jsx(K,{className:"h-3 w-3"}),t.jsx("span",{className:"uppercase font-bold tracking-wider",children:n.sender})]}),ne(n)&&t.jsx("span",{className:"text-slate-400",children:ne(n)})]}),t.jsx(nt,{text:n.text,shouldAnimate:n.id===fe&&n.sender==="guru"&&!n.isSystem}),n.link&&t.jsx("div",{className:"mt-3 pt-3 border-t border-black/10",children:t.jsxs("a",{href:`#${n.link}`,className:"text-xs font-bold flex items-center gap-1 hover:underline",children:["View Resource ",t.jsx(mt,{className:"h-3 w-3"})]})})]})},n.id)),t.jsx(q,{children:X&&t.jsx(T.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex justify-start",children:t.jsxs("div",{className:"bg-slate-100 rounded-2xl rounded-bl-none p-4 flex gap-1",children:[t.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce"}),t.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce delay-75"}),t.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce delay-150"})]})})}),t.jsx("div",{ref:he})]}),t.jsx(q,{children:!Jt&&t.jsx(T.button,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},onClick:ze,className:"absolute bottom-24 right-4 bg-brand-600 text-white p-2 rounded-full shadow-lg hover:bg-brand-700 transition-colors z-10",title:"Scroll to bottom",children:t.jsx(ps,{className:"h-4 w-4"})})}),t.jsxs("div",{className:"p-3 sm:p-4 bg-white border-t border-slate-200 shadow-up z-10",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx("textarea",{ref:me,value:l,onChange:n=>d(n.target.value),onKeyDown:n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),pe())},placeholder:"Ask anything about Power BI...",className:"input-field flex-1 shadow-sm resize-none min-h-[48px] sm:min-h-[44px] max-h-[200px] text-base sm:text-sm",rows:1}),t.jsx("button",{onClick:pe,disabled:!l.trim()||X,className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed min-w-[48px] sm:min-w-[44px]","aria-label":"Send message",children:t.jsx(ft,{className:"h-5 w-5 sm:h-4 sm:w-4"})})]}),t.jsxs("p",{className:"text-[10px] sm:text-xs text-slate-400 mt-2 text-center flex flex-wrap items-center justify-center gap-x-2 gap-y-1",children:[t.jsx("span",{className:"hidden sm:inline",children:"Enter = Send"}),t.jsx("span",{className:"hidden sm:inline",children:"Shift+Enter = New line"}),t.jsx("span",{className:"sm:hidden",children:"Tap Send or press Enter"}),t.jsx("span",{className:"hidden md:inline",children:"Copy buttons appear when you hover a message"})]}),!m&&t.jsxs("p",{className:"text-xs text-slate-400 mt-2 text-center",children:["Running in ",t.jsx("span",{className:"font-semibold text-brand-600",children:"Local Knowledge Mode"}),". Add an Access Code for full AI features."]})]})]}),at&&t.jsxs("div",{className:"flex flex-col gap-4 lg:gap-0 lg:flex-row shrink-0 w-full lg:w-auto",children:[Z&&t.jsx("div",{className:"hidden lg:flex items-center justify-center w-5 cursor-col-resize select-none text-slate-400 hover:bg-slate-100 hover:text-brand-500 transition-colors -ml-2.5 z-10 group",role:"separator","aria-label":"Resize session notes panel","aria-orientation":"vertical",tabIndex:0,onPointerDown:Xe,onKeyDown:Je,title:"Drag to resize notes",children:t.jsx("div",{className:"flex flex-col items-center gap-1 bg-white/80 rounded-full px-1 py-3 shadow-sm border border-slate-200 group-hover:border-brand-300 group-hover:scale-110 transition-all",children:t.jsx(xt,{className:"h-4 w-4"})})}),t.jsx("aside",{className:"bg-white border border-slate-200 rounded-xl shadow-sm p-4 sm:p-5 flex flex-col w-full lg:w-auto min-h-[260px] max-h-[300px] lg:max-h-none transition-[width] duration-200",style:ot,children:rt})]})]})]})};export{Hn as default};
