import{d as Ps,c as I,u as Hs,e as Gs,r as u,j as t,f as J,T as It,A as ae,m as U,h as _t,a as At}from"./index-CPWup0tv.js";import{C as Te}from"./copy-B65RbjzX.js";import{T as Me}from"./type-aCYR2vpI.js";import{D as kt}from"./download-P1I8P-Sq.js";import{D as Ot}from"./database-BI8EHGbG.js";import{S as Rt,K as Ks}from"./send-Cg9_QSHv.js";import{a as Tt,C as Us}from"./chevron-up-ibKfm82J.js";var Bs=Ps();const Fs=[["path",{d:"M12 17V3",key:"1cwfxf"}],["path",{d:"m6 11 6 6 6-6",key:"12ii2o"}],["path",{d:"M19 21H5",key:"150jfl"}]],Ys=I("arrow-down-to-line",Fs);const zs=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}],["line",{x1:"12",x2:"12",y1:"7",y2:"13",key:"1cppfj"}],["line",{x1:"15",x2:"9",y1:"10",y2:"10",key:"1gty7f"}]],qe=I("bookmark-plus",zs);const qs=[["path",{d:"M21 21H8a2 2 0 0 1-1.42-.587l-3.994-3.999a2 2 0 0 1 0-2.828l10-10a2 2 0 0 1 2.829 0l5.999 6a2 2 0 0 1 0 2.828L12.834 21",key:"g5wo59"}],["path",{d:"m5.082 11.09 8.828 8.828",key:"1wx5vj"}]],Vs=I("eraser",qs);const Ws=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],Mt=I("grip-vertical",Ws);const Xs=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],Js=I("maximize-2",Xs);const Qs=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],Zs=I("message-square",Qs);const en=[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]],tn=I("minimize-2",en);const sn=[["path",{d:"M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4",key:"re6nr2"}],["path",{d:"M2 6h4",key:"aawbzj"}],["path",{d:"M2 10h4",key:"l0bgd4"}],["path",{d:"M2 14h4",key:"1gsvsf"}],["path",{d:"M2 18h4",key:"1bu2t1"}],["path",{d:"M21.378 5.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"pqwjuv"}]],Dt=I("notebook-pen",sn);const nn=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m16 15-3-3 3-3",key:"14y99z"}]],Lt=I("panel-left-close",nn);const an=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m14 9 3 3-3 3",key:"8010ee"}]],$t=I("panel-left-open",an);const on=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M15 3v18",key:"14nvp0"}],["path",{d:"m8 9 3 3-3 3",key:"12hl5m"}]],Pt=I("panel-right-close",on);const rn=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M15 3v18",key:"14nvp0"}],["path",{d:"m10 15-3-3 3-3",key:"1pgupc"}]],Ht=I("panel-right-open",rn);const ln=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],Gt=I("rotate-cw",ln);const cn=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],dn=I("settings",cn);const un=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],Kt=I("wand-sparkles",un);var Ut;(function(e){e.STRING="string",e.NUMBER="number",e.INTEGER="integer",e.BOOLEAN="boolean",e.ARRAY="array",e.OBJECT="object"})(Ut||(Ut={}));var Bt;(function(e){e.LANGUAGE_UNSPECIFIED="language_unspecified",e.PYTHON="python"})(Bt||(Bt={}));var Ft;(function(e){e.OUTCOME_UNSPECIFIED="outcome_unspecified",e.OUTCOME_OK="outcome_ok",e.OUTCOME_FAILED="outcome_failed",e.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(Ft||(Ft={}));const Yt=["user","model","function","system"];var zt;(function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(zt||(zt={}));var qt;(function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"})(qt||(qt={}));var Vt;(function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"})(Vt||(Vt={}));var Wt;(function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER"})(Wt||(Wt={}));var xe;(function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.OTHER="OTHER"})(xe||(xe={}));var Xt;(function(e){e.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",e.RETRIEVAL_QUERY="RETRIEVAL_QUERY",e.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",e.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",e.CLASSIFICATION="CLASSIFICATION",e.CLUSTERING="CLUSTERING"})(Xt||(Xt={}));var Jt;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE"})(Jt||(Jt={}));var Qt;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"})(Qt||(Qt={}));class S extends Error{constructor(n){super(`[GoogleGenerativeAI Error]: ${n}`)}}class oe extends S{constructor(n,a){super(n),this.response=a}}class hs extends S{constructor(n,a,o,r){super(n),this.status=a,this.statusText=o,this.errorDetails=r}}class z extends S{}class ms extends S{}const hn="https://generativelanguage.googleapis.com",mn="v1beta",fn="0.24.1",pn="genai-js";var Q;(function(e){e.GENERATE_CONTENT="generateContent",e.STREAM_GENERATE_CONTENT="streamGenerateContent",e.COUNT_TOKENS="countTokens",e.EMBED_CONTENT="embedContent",e.BATCH_EMBED_CONTENTS="batchEmbedContents"})(Q||(Q={}));class xn{constructor(n,a,o,r,i){this.model=n,this.task=a,this.apiKey=o,this.stream=r,this.requestOptions=i}toString(){var n,a;const o=((n=this.requestOptions)===null||n===void 0?void 0:n.apiVersion)||mn;let i=`${((a=this.requestOptions)===null||a===void 0?void 0:a.baseUrl)||hn}/${o}/${this.model}:${this.task}`;return this.stream&&(i+="?alt=sse"),i}}function gn(e){const n=[];return e?.apiClient&&n.push(e.apiClient),n.push(`${pn}/${fn}`),n.join(" ")}async function bn(e){var n;const a=new Headers;a.append("Content-Type","application/json"),a.append("x-goog-api-client",gn(e.requestOptions)),a.append("x-goog-api-key",e.apiKey);let o=(n=e.requestOptions)===null||n===void 0?void 0:n.customHeaders;if(o){if(!(o instanceof Headers))try{o=new Headers(o)}catch(r){throw new z(`unable to convert customHeaders value ${JSON.stringify(o)} to Headers: ${r.message}`)}for(const[r,i]of o.entries()){if(r==="x-goog-api-key")throw new z(`Cannot set reserved header name ${r}`);if(r==="x-goog-api-client")throw new z(`Header name ${r} can only be set using the apiClient field`);a.append(r,i)}}return a}async function wn(e,n,a,o,r,i){const l=new xn(e,n,a,o,i);return{url:l.toString(),fetchOptions:Object.assign(Object.assign({},En(i)),{method:"POST",headers:await bn(l),body:r})}}async function we(e,n,a,o,r,i={},l=fetch){const{url:h,fetchOptions:f}=await wn(e,n,a,o,r,i);return yn(h,f,l)}async function yn(e,n,a=fetch){let o;try{o=await a(e,n)}catch(r){vn(r,e)}return o.ok||await Nn(o,e),o}function vn(e,n){let a=e;throw a.name==="AbortError"?(a=new ms(`Request aborted when fetching ${n.toString()}: ${e.message}`),a.stack=e.stack):e instanceof hs||e instanceof z||(a=new S(`Error fetching from ${n.toString()}: ${e.message}`),a.stack=e.stack),a}async function Nn(e,n){let a="",o;try{const r=await e.json();a=r.error.message,r.error.details&&(a+=` ${JSON.stringify(r.error.details)}`,o=r.error.details)}catch{}throw new hs(`Error fetching from ${n.toString()}: [${e.status} ${e.statusText}] ${a}`,e.status,e.statusText,o)}function En(e){const n={};if(e?.signal!==void 0||e?.timeout>=0){const a=new AbortController;e?.timeout>=0&&setTimeout(()=>a.abort(),e.timeout),e?.signal&&e.signal.addEventListener("abort",()=>{a.abort()}),n.signal=a.signal}return n}function Ze(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),$e(e.candidates[0]))throw new oe(`${Y(e)}`,e);return Cn(e)}else if(e.promptFeedback)throw new oe(`Text not available. ${Y(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),$e(e.candidates[0]))throw new oe(`${Y(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),Zt(e)[0]}else if(e.promptFeedback)throw new oe(`Function call not available. ${Y(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),$e(e.candidates[0]))throw new oe(`${Y(e)}`,e);return Zt(e)}else if(e.promptFeedback)throw new oe(`Function call not available. ${Y(e)}`,e)},e}function Cn(e){var n,a,o,r;const i=[];if(!((a=(n=e.candidates)===null||n===void 0?void 0:n[0].content)===null||a===void 0)&&a.parts)for(const l of(r=(o=e.candidates)===null||o===void 0?void 0:o[0].content)===null||r===void 0?void 0:r.parts)l.text&&i.push(l.text),l.executableCode&&i.push("\n```"+l.executableCode.language+`
`+l.executableCode.code+"\n```\n"),l.codeExecutionResult&&i.push("\n```\n"+l.codeExecutionResult.output+"\n```\n");return i.length>0?i.join(""):""}function Zt(e){var n,a,o,r;const i=[];if(!((a=(n=e.candidates)===null||n===void 0?void 0:n[0].content)===null||a===void 0)&&a.parts)for(const l of(r=(o=e.candidates)===null||o===void 0?void 0:o[0].content)===null||r===void 0?void 0:r.parts)l.functionCall&&i.push(l.functionCall);if(i.length>0)return i}const jn=[xe.RECITATION,xe.SAFETY,xe.LANGUAGE];function $e(e){return!!e.finishReason&&jn.includes(e.finishReason)}function Y(e){var n,a,o;let r="";if((!e.candidates||e.candidates.length===0)&&e.promptFeedback)r+="Response was blocked",!((n=e.promptFeedback)===null||n===void 0)&&n.blockReason&&(r+=` due to ${e.promptFeedback.blockReason}`),!((a=e.promptFeedback)===null||a===void 0)&&a.blockReasonMessage&&(r+=`: ${e.promptFeedback.blockReasonMessage}`);else if(!((o=e.candidates)===null||o===void 0)&&o[0]){const i=e.candidates[0];$e(i)&&(r+=`Candidate was blocked due to ${i.finishReason}`,i.finishMessage&&(r+=`: ${i.finishMessage}`))}return r}function ge(e){return this instanceof ge?(this.v=e,this):new ge(e)}function Sn(e,n,a){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o=a.apply(e,n||[]),r,i=[];return r={},l("next"),l("throw"),l("return"),r[Symbol.asyncIterator]=function(){return this},r;function l(g){o[g]&&(r[g]=function(b){return new Promise(function(C,H){i.push([g,b,C,H])>1||h(g,b)})})}function h(g,b){try{f(o[g](b))}catch(C){M(i[0][3],C)}}function f(g){g.value instanceof ge?Promise.resolve(g.value.v).then(A,P):M(i[0][2],g)}function A(g){h("next",g)}function P(g){h("throw",g)}function M(g,b){g(b),i.shift(),i.length&&h(i[0][0],i[0][1])}}const es=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function In(e){const n=e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),a=kn(n),[o,r]=a.tee();return{stream:An(o),response:_n(r)}}async function _n(e){const n=[],a=e.getReader();for(;;){const{done:o,value:r}=await a.read();if(o)return Ze(On(n));n.push(r)}}function An(e){return Sn(this,arguments,function*(){const a=e.getReader();for(;;){const{value:o,done:r}=yield ge(a.read());if(r)break;yield yield ge(Ze(o))}})}function kn(e){const n=e.getReader();return new ReadableStream({start(o){let r="";return i();function i(){return n.read().then(({value:l,done:h})=>{if(h){if(r.trim()){o.error(new S("Failed to parse stream"));return}o.close();return}r+=l;let f=r.match(es),A;for(;f;){try{A=JSON.parse(f[1])}catch{o.error(new S(`Error parsing JSON response: "${f[1]}"`));return}o.enqueue(A),r=r.substring(f[0].length),f=r.match(es)}return i()}).catch(l=>{let h=l;throw h.stack=l.stack,h.name==="AbortError"?h=new ms("Request aborted when reading from the stream"):h=new S("Error reading from the stream"),h})}}})}function On(e){const n=e[e.length-1],a={promptFeedback:n?.promptFeedback};for(const o of e){if(o.candidates){let r=0;for(const i of o.candidates)if(a.candidates||(a.candidates=[]),a.candidates[r]||(a.candidates[r]={index:r}),a.candidates[r].citationMetadata=i.citationMetadata,a.candidates[r].groundingMetadata=i.groundingMetadata,a.candidates[r].finishReason=i.finishReason,a.candidates[r].finishMessage=i.finishMessage,a.candidates[r].safetyRatings=i.safetyRatings,i.content&&i.content.parts){a.candidates[r].content||(a.candidates[r].content={role:i.content.role||"user",parts:[]});const l={};for(const h of i.content.parts)h.text&&(l.text=h.text),h.functionCall&&(l.functionCall=h.functionCall),h.executableCode&&(l.executableCode=h.executableCode),h.codeExecutionResult&&(l.codeExecutionResult=h.codeExecutionResult),Object.keys(l).length===0&&(l.text=""),a.candidates[r].content.parts.push(l)}r++}o.usageMetadata&&(a.usageMetadata=o.usageMetadata)}return a}async function fs(e,n,a,o){const r=await we(n,Q.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(a),o);return In(r)}async function ps(e,n,a,o){const i=await(await we(n,Q.GENERATE_CONTENT,e,!1,JSON.stringify(a),o)).json();return{response:Ze(i)}}function xs(e){if(e!=null){if(typeof e=="string")return{role:"system",parts:[{text:e}]};if(e.text)return{role:"system",parts:[e]};if(e.parts)return e.role?e:{role:"system",parts:e.parts}}}function be(e){let n=[];if(typeof e=="string")n=[{text:e}];else for(const a of e)typeof a=="string"?n.push({text:a}):n.push(a);return Rn(n)}function Rn(e){const n={role:"user",parts:[]},a={role:"function",parts:[]};let o=!1,r=!1;for(const i of e)"functionResponse"in i?(a.parts.push(i),r=!0):(n.parts.push(i),o=!0);if(o&&r)throw new S("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!o&&!r)throw new S("No content is provided for sending chat message.");return o?n:a}function Tn(e,n){var a;let o={model:n?.model,generationConfig:n?.generationConfig,safetySettings:n?.safetySettings,tools:n?.tools,toolConfig:n?.toolConfig,systemInstruction:n?.systemInstruction,cachedContent:(a=n?.cachedContent)===null||a===void 0?void 0:a.name,contents:[]};const r=e.generateContentRequest!=null;if(e.contents){if(r)throw new z("CountTokensRequest must have one of contents or generateContentRequest, not both.");o.contents=e.contents}else if(r)o=Object.assign(Object.assign({},o),e.generateContentRequest);else{const i=be(e);o.contents=[i]}return{generateContentRequest:o}}function ts(e){let n;return e.contents?n=e:n={contents:[be(e)]},e.systemInstruction&&(n.systemInstruction=xs(e.systemInstruction)),n}function Mn(e){return typeof e=="string"||Array.isArray(e)?{content:be(e)}:e}const ss=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],Dn={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function Ln(e){let n=!1;for(const a of e){const{role:o,parts:r}=a;if(!n&&o!=="user")throw new S(`First content should be with role 'user', got ${o}`);if(!Yt.includes(o))throw new S(`Each item should include role field. Got ${o} but valid roles are: ${JSON.stringify(Yt)}`);if(!Array.isArray(r))throw new S("Content should have 'parts' property with an array of Parts");if(r.length===0)throw new S("Each Content should have at least one part");const i={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const h of r)for(const f of ss)f in h&&(i[f]+=1);const l=Dn[o];for(const h of ss)if(!l.includes(h)&&i[h]>0)throw new S(`Content with role '${o}' can't contain '${h}' part`);n=!0}}function ns(e){var n;if(e.candidates===void 0||e.candidates.length===0)return!1;const a=(n=e.candidates[0])===null||n===void 0?void 0:n.content;if(a===void 0||a.parts===void 0||a.parts.length===0)return!1;for(const o of a.parts)if(o===void 0||Object.keys(o).length===0||o.text!==void 0&&o.text==="")return!1;return!0}const as="SILENT_ERROR";class $n{constructor(n,a,o,r={}){this.model=a,this.params=o,this._requestOptions=r,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=n,o?.history&&(Ln(o.history),this._history=o.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(n,a={}){var o,r,i,l,h,f;await this._sendPromise;const A=be(n),P={safetySettings:(o=this.params)===null||o===void 0?void 0:o.safetySettings,generationConfig:(r=this.params)===null||r===void 0?void 0:r.generationConfig,tools:(i=this.params)===null||i===void 0?void 0:i.tools,toolConfig:(l=this.params)===null||l===void 0?void 0:l.toolConfig,systemInstruction:(h=this.params)===null||h===void 0?void 0:h.systemInstruction,cachedContent:(f=this.params)===null||f===void 0?void 0:f.cachedContent,contents:[...this._history,A]},M=Object.assign(Object.assign({},this._requestOptions),a);let g;return this._sendPromise=this._sendPromise.then(()=>ps(this._apiKey,this.model,P,M)).then(b=>{var C;if(ns(b.response)){this._history.push(A);const H=Object.assign({parts:[],role:"model"},(C=b.response.candidates)===null||C===void 0?void 0:C[0].content);this._history.push(H)}else{const H=Y(b.response);H&&console.warn(`sendMessage() was unsuccessful. ${H}. Inspect response object for details.`)}g=b}).catch(b=>{throw this._sendPromise=Promise.resolve(),b}),await this._sendPromise,g}async sendMessageStream(n,a={}){var o,r,i,l,h,f;await this._sendPromise;const A=be(n),P={safetySettings:(o=this.params)===null||o===void 0?void 0:o.safetySettings,generationConfig:(r=this.params)===null||r===void 0?void 0:r.generationConfig,tools:(i=this.params)===null||i===void 0?void 0:i.tools,toolConfig:(l=this.params)===null||l===void 0?void 0:l.toolConfig,systemInstruction:(h=this.params)===null||h===void 0?void 0:h.systemInstruction,cachedContent:(f=this.params)===null||f===void 0?void 0:f.cachedContent,contents:[...this._history,A]},M=Object.assign(Object.assign({},this._requestOptions),a),g=fs(this._apiKey,this.model,P,M);return this._sendPromise=this._sendPromise.then(()=>g).catch(b=>{throw new Error(as)}).then(b=>b.response).then(b=>{if(ns(b)){this._history.push(A);const C=Object.assign({},b.candidates[0].content);C.role||(C.role="model"),this._history.push(C)}else{const C=Y(b);C&&console.warn(`sendMessageStream() was unsuccessful. ${C}. Inspect response object for details.`)}}).catch(b=>{b.message!==as&&console.error(b)}),g}}async function Pn(e,n,a,o){return(await we(n,Q.COUNT_TOKENS,e,!1,JSON.stringify(a),o)).json()}async function Hn(e,n,a,o){return(await we(n,Q.EMBED_CONTENT,e,!1,JSON.stringify(a),o)).json()}async function Gn(e,n,a,o){const r=a.requests.map(l=>Object.assign(Object.assign({},l),{model:n}));return(await we(n,Q.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:r}),o)).json()}class os{constructor(n,a,o={}){this.apiKey=n,this._requestOptions=o,a.model.includes("/")?this.model=a.model:this.model=`models/${a.model}`,this.generationConfig=a.generationConfig||{},this.safetySettings=a.safetySettings||[],this.tools=a.tools,this.toolConfig=a.toolConfig,this.systemInstruction=xs(a.systemInstruction),this.cachedContent=a.cachedContent}async generateContent(n,a={}){var o;const r=ts(n),i=Object.assign(Object.assign({},this._requestOptions),a);return ps(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(o=this.cachedContent)===null||o===void 0?void 0:o.name},r),i)}async generateContentStream(n,a={}){var o;const r=ts(n),i=Object.assign(Object.assign({},this._requestOptions),a);return fs(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(o=this.cachedContent)===null||o===void 0?void 0:o.name},r),i)}startChat(n){var a;return new $n(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(a=this.cachedContent)===null||a===void 0?void 0:a.name},n),this._requestOptions)}async countTokens(n,a={}){const o=Tn(n,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),r=Object.assign(Object.assign({},this._requestOptions),a);return Pn(this.apiKey,this.model,o,r)}async embedContent(n,a={}){const o=Mn(n),r=Object.assign(Object.assign({},this._requestOptions),a);return Hn(this.apiKey,this.model,o,r)}async batchEmbedContents(n,a={}){const o=Object.assign(Object.assign({},this._requestOptions),a);return Gn(this.apiKey,this.model,n,o)}}class Kn{constructor(n){this.apiKey=n}getGenerativeModel(n,a){if(!n.model)throw new S("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new os(this.apiKey,n,a)}getGenerativeModelFromCachedContent(n,a,o){if(!n.name)throw new z("Cached content must contain a `name` field.");if(!n.model)throw new z("Cached content must contain a `model` field.");const r=["model","systemInstruction"];for(const l of r)if(a?.[l]&&n[l]&&a?.[l]!==n[l]){if(l==="model"){const h=a.model.startsWith("models/")?a.model.replace("models/",""):a.model,f=n.model.startsWith("models/")?n.model.replace("models/",""):n.model;if(h===f)continue}throw new z(`Different value for "${l}" specified in modelParams (${a[l]}) and cachedContent (${n[l]})`)}const i=Object.assign(Object.assign({},a),{model:n.model,tools:n.tools,toolConfig:n.toolConfig,systemInstruction:n.systemInstruction,cachedContent:n});return new os(this.apiKey,i,o)}}const Un=[{keywords:["yoy","year over year","growth"],answer:"For Year-over-Year growth, use the 'YoY Growth %' pattern in the DAX Library. It uses `SAMEPERIODLASTYEAR`.",link:"/dax"},{keywords:["blue","color","hex","brand"],answer:"The official HHS Blue hex code is #005EA2. You can find the full palette in the Style Guide.",link:"/style-guide"},{keywords:["pareto","80/20"],answer:"We have a Pareto Analysis pattern in the DAX Library under 'Advanced Analytics'.",link:"/dax"},{keywords:["font","typography"],answer:"The approved font is 'Source Sans Pro'. See the Style Guide for heading sizes.",link:"/style-guide"},{keywords:["dax","measure","calculation"],answer:"The DAX Library contains patterns for Time Intelligence, Financial Formulas, and more. Check the 'DAX Library' tab.",link:"/dax"}],fe=180,Xe=4e3,Bn=280,pe=(e,n,a)=>Math.min(Math.max(e,n),a),Fn=()=>typeof window>"u"?360:pe(window.innerWidth*.3,fe,Xe),De=()=>({id:"welcome",text:"Hi, I'm your **Analytics Assistant**. Ask me about **DAX**, **HHS Branding**, or **data strategy**.",sender:"guru",isSystem:!0,createdAt:new Date().toISOString()}),Ve=[{label:"Generate DAX",value:"Create a reusable DAX measure for year-over-year revenue with clear comments."},{label:"Explain Visual",value:"Explain how to design an executive KPI card for Power BI with HHS branding guidance."},{label:"Build Checklist",value:"Give me a pre-publish checklist for a Power BI report destined for leadership review."},{label:"Debug Measure",value:"Help me troubleshoot why my DAX measure is returning blank values."}],rs="guru_session_notes",is="guru_messages",ls="guru_font_size",cs="guru_line_height",re={small:{label:"Small",message:"text-xs",meta:"text-[10px]",code:"text-xs",description:"Compact"},medium:{label:"Medium",message:"text-sm",meta:"text-xs",code:"text-sm",description:"Default"},large:{label:"Large",message:"text-base",meta:"text-sm",code:"text-base",description:"Comfortable"},xlarge:{label:"Extra Large",message:"text-lg",meta:"text-sm",code:"text-base",description:"Accessibility"}},Le={normal:{label:"Normal",class:"leading-normal"},relaxed:{label:"Relaxed",class:"leading-relaxed"},loose:{label:"Loose",class:"leading-loose"}},Je=["gemini-1.5-flash","gemini-1.5-pro","gemini-1.0-pro"];Je[0];const me="v1beta2",Yn=["generateMessage","generateText"],zn=[{name:"chat-bison-001",method:"generateMessage"},{name:"text-bison-001",method:"generateText"}],ds="AIzaSyBQmBPQc-dFJRa9456iCbZBHrMimbO1s9A".trim()||"",Pe=ds==="YOUR_GOOGLE_GEMINI_API_KEY"?"":ds,qn="localhost,127.0.0.1,williamdalston.github.io",We=e=>(e||"").replace(/^models\//i,"").trim(),Vn=e=>e.split(",").map(n=>n.trim()).filter(Boolean).map(n=>n.replace(/^https?:\/\//,"").split("/")[0].toLowerCase()),Wn=(e,n,a)=>{if(e==="*")return!0;if(e.startsWith(".")){const o=e.slice(1);return n===o||n.endsWith(`.${o}`)}return e.includes(":")?a===e:n===e},us=Vn(qn),Xn=()=>{if(!Pe||typeof window>"u")return!1;if(us.length===0)return!0;const e=window.location.hostname.toLowerCase(),n=window.location.host.toLowerCase();return us.some(a=>Wn(a,e,n))},Qe=()=>Xn()?Pe:"",Jn=()=>{if(typeof window>"u")return"";const e=window.localStorage.getItem("gemini_api_key");return e?e.trim():""},Qn=()=>{const e=Jn();if(e)return{key:e,source:"custom"};const n=Qe();return n?{key:n,source:"project"}:{key:"",source:"none"}},Zn=(e,n=120)=>e?e.length>n?`${e.slice(0,n)}…`:e:"",da=()=>{const{addToast:e}=Hs(),{isSidebarCollapsed:n,toggleSidebar:a}=Gs(),o=u.useRef(Qn()),[r,i]=u.useState(()=>{if(typeof window>"u")return[De()];try{const s=window.localStorage.getItem(is);return s?JSON.parse(s).map(m=>m.sender==="bot"?{...m,sender:"guru"}:m):[De()]}catch(s){return console.error("Failed to parse messages",s),[De()]}}),[l,h]=u.useState(""),[f,A]=u.useState(o.current.key),[P,M]=u.useState(o.current.source==="custom"?o.current.key:""),[g,b]=u.useState(o.current.source==="custom"),[C,H]=u.useState(!1),[ie,ye]=u.useState(!1),[ve,D]=u.useState(o.current.key?"connecting":"idle"),[gs,L]=u.useState(""),[et,Ne]=u.useState(null),Ee=u.useRef(null),Ce=u.useRef(null),tt=u.useRef({}),[bs,ws]=u.useState(!0),je=u.useRef(null),B=u.useRef(null),[st,He]=u.useState(()=>Fn()),[k,ys]=u.useState(!1),[F,vs]=u.useState(()=>typeof window>"u"?!1:window.innerWidth>=1024),[q,Ge]=u.useState(()=>typeof window>"u"?"":window.localStorage.getItem(rs)||""),[le,Ns]=u.useState(!1),[Ke,nt]=u.useState(!1),[V,at]=u.useState(null),[Se,ce]=u.useState(null),[Z,ot]=u.useState(()=>typeof window>"u"?"medium":window.localStorage.getItem(ls)||"medium"),[de,rt]=u.useState(()=>typeof window>"u"?"relaxed":window.localStorage.getItem(cs)||"relaxed"),[ee,it]=u.useState(!1),Ie=u.useCallback(()=>{if(!B.current||typeof window>"u")return Xe;const s=window.getComputedStyle(B.current),c=parseFloat(s.columnGap||s.gap||"0")||0,d=B.current.getBoundingClientRect().width-c-Bn;return pe(d,fe,Xe)},[B]),W=u.useCallback(()=>{if(typeof window>"u")return;const s=window.innerWidth>=1024;if(vs(s),!s)return;const c=Ie();He(m=>pe(m,fe,c))},[Ie]);u.useEffect(()=>{},[]),u.useEffect(()=>{if(W(),!(typeof window>"u"))return window.addEventListener("resize",W),()=>window.removeEventListener("resize",W)},[W]),u.useEffect(()=>{W();const s=c=>{c.key==="Escape"&&Ke&&nt(!1)};if(typeof window<"u")return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[Ke,W]),u.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(is,JSON.stringify(r))},[r]);const lt=s=>{if(!s)return;const c=document.getElementById(`message-${s}`);c&&c.scrollIntoView({behavior:"smooth",block:"start"})};u.useEffect(()=>{const s=r[r.length-1];if(s?.sender==="guru"&&!s.isSystem&&V?.id){lt(V.id);return}Ee.current?.scrollIntoView({behavior:"smooth"})},[r,V]),u.useEffect(()=>{const s=Ce.current;if(!s)return;const c=()=>{const{scrollTop:m,scrollHeight:d,clientHeight:p}=s,N=m+p>=d-10;ws(N)};return s.addEventListener("scroll",c),c(),()=>s.removeEventListener("scroll",c)},[r]);const ct=()=>{Ee.current?.scrollIntoView({behavior:"smooth"})},Es=()=>{Ce.current?.scrollTo({top:0,behavior:"smooth"})},dt=()=>{confirm("This will clear the cache and refresh the application. Continue?")&&(window.localStorage.clear(),window.location.reload())};u.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(rs,q)},[q]),u.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(ls,Z)},[Z]),u.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(cs,de)},[de]);const ut=u.useCallback(()=>{const s=je.current;if(!s)return;s.style.height="auto";const m=Math.min(s.scrollHeight,200);s.style.height=`${m}px`},[]),Cs=u.useCallback(async(s,c)=>{if(!c||typeof window>"u"||typeof fetch>"u")return{success:!1,models:[]};const m=`${s}:${c}`,d=tt.current[m];if(d)return d;const p=new URL(`https://generativelanguage.googleapis.com/${s}/models`);p.searchParams.set("pageSize","200"),p.searchParams.set("key",c);const N=new AbortController,R=setTimeout(()=>N.abort(),8e3);try{const O=await fetch(p.toString(),{signal:N.signal});if(clearTimeout(R),!O.ok)return{success:!1,models:[]};const v={success:!0,models:((await O.json()).models||[]).map(_=>({name:We(_.name),supportedGenerationMethods:Array.isArray(_.supportedGenerationMethods)?_.supportedGenerationMethods:[]})).filter(_=>!!_.name)};return tt.current[m]=v,v}catch{return clearTimeout(R),{success:!1,models:[]}}},[]);u.useEffect(()=>{ut()},[l,ut]),u.useEffect(()=>{if(!f.trim()){D("idle"),L(""),Ne(null);return}D("connected"),L(""),Ne("v1beta")},[f]);const js=()=>{const s=P.trim();if(!s){e("Please enter a valid access code","error");return}typeof window<"u"&&window.localStorage.setItem("gemini_api_key",s),b(!0),A(s),M(""),D("connecting"),L(""),H(!1),e("Personal access code saved. Connecting now...","success")},Ss=()=>{typeof window<"u"&&window.localStorage.removeItem("gemini_api_key");const s=Qe()||"",c=!!Pe&&!s;b(!1),M(""),A(s),D(s?"connecting":"idle"),L(""),e(s?"Reverted to the built-in HHS access code.":c?"The built-in HHS access code is restricted on this domain. Add your personal key to enable AI responses.":"Access code removed. Running in local knowledge mode.","info")},Is=s=>{const c=s.toLowerCase();return Un.find(m=>m.keywords.some(d=>c.includes(d)))},Ue=async s=>{if(s)try{if(typeof navigator>"u"||!navigator.clipboard)throw new Error("Clipboard unavailable");await navigator.clipboard.writeText(s),e("Message copied to clipboard","success")}catch(c){console.error("Copy failed",c),e("Unable to copy message","error")}},ht=()=>{confirm("Clear this conversation and start fresh?")&&(i([De()]),e("Conversation cleared","success"),ct(),at(null),ce(null))},mt=()=>{const s=r.filter(p=>!p.isSystem).map(p=>`${p.sender.toUpperCase()} (${ue(p,!0)}):
${p.text}`).join(`

---

`),c=new Blob([s],{type:"text/plain"}),m=URL.createObjectURL(c),d=document.createElement("a");d.href=m,d.download=`power-bi-guru-chat-${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(m),e("Chat exported","success")},Be=s=>{h(s),je.current?.focus()},_s=async()=>{if(!q.trim()){e("No notes to copy","info");return}try{await navigator.clipboard.writeText(q),e("Session notes copied","success")}catch(s){console.error("Copy notes failed",s),e("Unable to copy notes","error")}},As=()=>{q.trim()&&confirm("Clear session notes?")&&(Ge(""),e("Session notes cleared","success"))},ft=s=>{if(!F||k||!B.current)return;s.preventDefault();const c=s.clientX,m=st,d=document.body.style.userSelect;document.body.style.userSelect="none";const p=R=>{const O=Ie(),E=R.clientX-c,$=pe(m-E,fe,O);He($)},N=()=>{document.body.style.userSelect=d,window.removeEventListener("pointermove",p),window.removeEventListener("pointerup",N)};window.addEventListener("pointermove",p),window.addEventListener("pointerup",N)},pt=s=>{if(!F||k||!B.current||s.key!=="ArrowLeft"&&s.key!=="ArrowRight")return;s.preventDefault();const c=Ie(),m=s.key==="ArrowLeft"?24:-24;He(d=>pe(d+m,fe,c))},xt=()=>{ys(s=>!s),typeof window<"u"&&requestAnimationFrame(()=>W())},ks=()=>{Ns(s=>!s)},gt=()=>{nt(s=>!s)},Fe=s=>{s&&(Ge(c=>`${c?`${c}

`:""}${s}`),e("Saved to session notes","success"))},ue=(s,c=!1)=>{if(s.isSystem&&s.id==="welcome"&&!c)return"";const m=s.createdAt||(typeof s.id=="number"?new Date(s.id).toISOString():null),d=m?new Date(m):c?new Date:null;return d?d.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""},bt=le?"space-y-2":"space-y-4",wt=le?"p-3":"p-4",yt=(re[Z]||re.medium).meta,Os=(s,c)=>{const[m,d]=u.useState(c?"":s);return u.useEffect(()=>{if(!c){d(s);return}let p=0;const N=setInterval(()=>{if(p>=s.length){clearInterval(N),d(s);return}const O=s.length>1e3?50:s.length>500?25:10;d(s.slice(0,p+O)),p+=O},10);return()=>clearInterval(N)},[s,c]),m},vt=({text:s,shouldAnimate:c,isUser:m=!1})=>{const d=Os(s,c);if(!d)return t.jsx("span",{className:"animate-pulse",children:"..."});const p=d.split(/(```[\s\S]*?```)/g),N=re[Z]||re.medium,R=Le[de]||Le.relaxed,O=E=>E.split(/(`[^`]+`|\*\*[^*]+\*\*|\*[^*]+\*)/g).map((v,_)=>{if(v.startsWith("`")&&v.endsWith("`")){const se=v.slice(1,-1);return t.jsx("code",{className:`px-1.5 py-0.5 rounded font-mono text-[0.9em] border ${m?"bg-brand-700 text-brand-50 border-brand-600":"bg-slate-200/60 text-slate-800 border-slate-200/50"}`,children:se},_)}return v.startsWith("**")&&v.endsWith("**")?t.jsx("strong",{className:"font-bold opacity-100",children:v.slice(2,-2)},_):v.startsWith("*")&&v.endsWith("*")?t.jsx("em",{className:"italic opacity-90",children:v.slice(1,-1)},_):v});return t.jsx("div",{className:`whitespace-pre-wrap break-words overflow-hidden ${R.class} ${N.message}`,children:p.map((E,$)=>{if(E.startsWith("```")&&E.endsWith("```")){const v=E.match(/^```(\w+)?\n([\s\S]*)```$/),_=v?v[1]:"",se=v?v[2]:E.slice(3,-3);return t.jsxs("div",{className:"my-3 rounded-lg bg-slate-800 text-slate-100 overflow-hidden shadow-sm border border-slate-700",children:[t.jsxs("div",{className:"flex items-center justify-between px-3 py-1.5 bg-slate-900/50 text-slate-400 border-b border-white/10 select-none",children:[t.jsx("span",{className:`uppercase font-semibold tracking-wider ${N.meta}`,children:_||"CODE"}),t.jsxs("button",{onClick:jt=>{jt.stopPropagation(),Ue(se.trim())},className:"hover:text-white flex items-center gap-1.5 transition-colors text-xs","aria-label":"Copy code",children:[t.jsx(Te,{className:"h-3 w-3"})," Copy"]})]}),t.jsx("pre",{className:`p-3 overflow-x-auto font-mono ${N.code} scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-transparent whitespace-pre`,children:t.jsx("code",{children:se.trim()})})]},$)}return t.jsx("span",{children:O(E)},$)})})},_e=async()=>{if(!l.trim())return;const s={id:Date.now(),text:l,sender:"user",createdAt:new Date().toISOString()};i(d=>[...d,s]),h(""),ye(!0),at({id:s.id,text:s.text});const c=Is(s.text);if(c){setTimeout(()=>{const d={id:Date.now()+1,text:c.answer,sender:"guru",link:c.link,createdAt:new Date().toISOString()};i(p=>[...p,d]),ce(d.id),ye(!1)},600);return}const m=f.trim();if(m){try{let d,p=null,N="",R="";const E=`You are an expert Power BI Developer and Data Analyst for the US Department of Health and Human Services (HHS), but you are also a helpful general-purpose AI assistant.
                
Current Date and Time: ${new Date().toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",timeZoneName:"short"})}

You can answer ANY question the user asks, regardless of the topic (including general knowledge, coding in other languages, creative writing, etc.).

Guidelines for Power BI & Data Questions:
- Provide expert, production-ready advice.
- Always format DAX code clearly with line breaks and indentation.
- Explain complex logic step-by-step.
- Reference HHS style guidelines (blue #005EA2, Source Sans Pro) if relevant to visuals.

Guidelines for General Questions:
- Answer helpfully and accurately.
- Do not force a connection to data if the topic is unrelated.
- Be concise and direct.

You have access to Google Search tools. Use them proactively to verify facts, find current information, or answer questions about recent events.`,v=[...r.filter(x=>!x.isError&&!x.isSystem).map(x=>({role:x.sender==="user"?"user":"model",parts:[{text:x.text}]})),{role:"user",parts:[{text:s.text}]}],_=r.filter(x=>!x.isSystem).map(x=>({author:x.sender==="user"?"user":"bot",content:x.text})),se=[..._,{author:"user",content:s.text}],Ms=[E,..._.map(x=>`${x.author==="user"?"User":"Assistant"}: ${x.content}`),`User: ${s.text}`,"Assistant:"].filter(Boolean).join(`

`),Ds=async()=>{if(typeof fetch>"u")return null;const x=await Cs(me,m),y=(x.success?x.models.filter(w=>w.supportedGenerationMethods.some(j=>Yn.includes(j))):[]).map(w=>{const j=w.supportedGenerationMethods.includes("generateMessage"),T=w.supportedGenerationMethods.includes("generateText");return j?{name:w.name,method:"generateMessage"}:T?{name:w.name,method:"generateText"}:null}).filter(Boolean);if(zn.forEach(w=>{y.some(j=>j.name===w.name)||y.push(w)}),y.length===0)return null;for(const w of y)try{if(w.method==="generateMessage"){const j=`https://generativelanguage.googleapis.com/${me}/models/${w.name}:generateMessage?key=${m}`,T=await fetch(j,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:{context:E,messages:se},temperature:.7,candidateCount:1,topP:.95,topK:40,maxOutputTokens:1024})}),X=await T.json().catch(()=>({}));if(!T.ok)throw new Error(X.error?.message||`PaLM model ${w.name} failed (${T.status})`);const ne=X.candidates?.[0],Re=typeof ne?.content=="string"?ne.content.trim():"";if(Re)return{text:Re,providerLabel:`${me} / ${w.name}`};throw new Error(`PaLM model ${w.name} returned no content`)}if(w.method==="generateText"){const j=`https://generativelanguage.googleapis.com/${me}/models/${w.name}:generateText?key=${m}`,T=await fetch(j,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:{text:Ms},temperature:.7,candidateCount:1,topP:.95,topK:40,maxOutputTokens:1024})}),X=await T.json().catch(()=>({}));if(!T.ok)throw new Error(X.error?.message||`PaLM model ${w.name} failed (${T.status})`);const ne=X.candidates?.[0]?.output?.trim()||X.output?.trim();if(ne)return{text:ne,providerLabel:`${me} / ${w.name}`};throw new Error(`PaLM model ${w.name} returned no content`)}}catch(j){if(j.message?.includes("404")||j.message?.includes("not found")||j.message?.includes("NOT_FOUND")||j.message?.includes("400")&&j.message?.includes("not available"))continue;d=j}return null},Ls=3e4;let ze;try{ze=new Kn(m)}catch(x){throw d=x,D("error"),L("Failed to initialize AI client."),x}let G=Je,Ae=!1;try{const{models:x}=await ze.listModels(),K=(x||[]).filter(y=>(y.supportedGenerationMethods||[]).includes("generateContent")).map(y=>We(y.name));if(K.length>0){Ae=!0;const y=Je.filter(w=>K.includes(We(w)));y.length>0?G=y:(G=[],Ae=!1)}else Ae=!1,G=[]}catch{Ae=!1,G=[]}let he=G.length>0;if(G.length===0)he=!1,d=new Error("No accessible models found for this API key");else for(const x of G){let K;try{const y=ze.getGenerativeModel({model:x,systemInstruction:E,safetySettings:[{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_MEDIUM_AND_ABOVE"}]}),w=new Promise((ne,Re)=>{K=setTimeout(()=>Re(new Error("Request timeout")),Ls)}),j=y.generateContent({contents:v,generationConfig:{maxOutputTokens:8192,temperature:.7,topP:.95,topK:40}}),T=await Promise.race([j,w]);K&&clearTimeout(K),p=await T.response,N=x,R="current",D("connected"),L(""),he=!1;break}catch(y){if(K&&clearTimeout(K),y.message?.includes("404")||y.message?.includes("not found")||y.message?.includes("NOT_FOUND")||y.message?.includes("Requested entity was not found")){d=y;continue}else he=!1;if(y.message?.includes("API_KEY")||y.message?.includes("PERMISSION_DENIED")){d=y;break}d=y}}let ke=null,Oe=null;if(p)ke=p.text(),Oe=N,Ne(Oe);else if(!he&&G.length>0){const x=await Ds();x&&(ke=x.text,Oe=x.providerLabel,D("connected"),L(""),Ne(Oe))}else he&&G.length>0&&(D("error"),L("API key does not have access to any AI models. Please check your API key permissions."));if(!ke)throw D("error"),L("No compatible AI model found for this access code."),d||new Error("No compatible AI model found");const $s=ke,St={id:Date.now()+1,text:$s,sender:"guru",createdAt:new Date().toISOString()};i(x=>[...x,St]),ce(St.id)}catch(d){console.error("AI Connection Error:",d.message);const p=d.message?.includes("API_KEY")||d.message?.includes("PERMISSION_DENIED")||d.message?.includes("INVALID_ARGUMENT"),N=d.message?.includes("not found")||d.message?.includes("NOT_FOUND")||d.message?.includes("404")||d.message?.includes("Requested entity was not found"),R=d.message?.includes("timeout")||d.message?.includes("Timeout"),O=d.message?.includes("network")||d.message?.includes("fetch");(p||N)&&(D("error"),L(N?"API key does not have access to any AI models. Please check your API key permissions or create a new one at https://makersuite.google.com/app/apikey":"Invalid API key or insufficient permissions"));let E;N?E="The API key doesn't have access to any AI models. Please check that your Google AI Studio API key has the correct permissions, or create a new key at https://makersuite.google.com/app/apikey. I can still help with local knowledge about DAX and Power BI.":p?E="I couldn't connect to the AI service with the current access code. Please update your API key in settings, or I can help with local knowledge about DAX and Power BI.":R?E="The AI service is taking too long to respond. This can happen on slower connections. Please try again, or I can help with local knowledge about DAX and Power BI.":O?E="I'm having trouble reaching the AI service. Please check your internet connection and try again, or I can help with local knowledge about DAX and Power BI.":E="I'm having trouble connecting to the AI service right now. Let me help with what I know about DAX and Power BI instead.";const $={id:Date.now()+1,text:E,sender:"guru",isError:!0,createdAt:new Date().toISOString()};i(v=>[...v,$]),ce($.id)}finally{ye(!1)}return}setTimeout(()=>{const d={id:Date.now()+1,text:"I don't have an answer for that in my local knowledge base. To unlock full AI capabilities, please configure the AI Access Code in settings.",sender:"guru",isSystem:!0,createdAt:new Date().toISOString()};i(p=>[...p,d]),ce(d.id),ye(!1)},600)},Ye=!!Qe(),Rs=!!Pe&&!Ye,te=f?ve==="connected"?{text:et?`AI Connected (${et})`:"AI Connected",className:"bg-emerald-100 text-emerald-700"}:ve==="connecting"?{text:"Verifying Access Code",className:"bg-sky-100 text-sky-700"}:ve==="error"?{text:"Connection Error",className:"bg-rose-100 text-rose-700"}:null:null,Nt=!k,Et=F?{width:`${st}px`}:void 0,Ct=t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center justify-between mb-3 gap-2",children:[t.jsxs("div",{children:[t.jsxs("p",{className:"text-sm font-semibold text-slate-900 flex items-center gap-2",children:[t.jsx(Dt,{className:"h-4 w-4 text-brand-500"}),"Session Notes"]}),t.jsx("p",{className:"text-xs text-slate-500",children:"Capture insights or follow-ups"})]}),t.jsxs("div",{className:"flex gap-1",children:[t.jsx("button",{onClick:_s,className:"p-2 text-slate-400 hover:text-brand-600 hover:bg-brand-50 rounded transition-colors",title:"Copy notes","aria-label":"Copy notes",children:t.jsx(Te,{className:"h-4 w-4"})}),t.jsx("button",{onClick:As,className:"p-2 text-slate-400 hover:text-rose-600 hover:bg-rose-50 rounded transition-colors",title:"Clear notes","aria-label":"Clear notes",children:t.jsx(Vs,{className:"h-4 w-4"})})]})]}),t.jsx("textarea",{value:q,onChange:s=>Ge(s.target.value),placeholder:"Capture project context, action items, or next steps...",className:"input-field flex-1 min-h-[200px] resize-none"}),t.jsxs("p",{className:"text-[11px] text-slate-400 text-right mt-2",children:["Autosaved locally • ",q.trim().length," chars"]})]}),Ts=({onPromptClick:s})=>t.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 text-center animate-fadeIn",children:[t.jsx("div",{className:"bg-brand-50 p-6 rounded-full mb-6 ring-8 ring-brand-50/50",children:t.jsx(J,{className:"h-12 w-12 text-brand-600"})}),t.jsx("h3",{className:"text-2xl font-bold text-slate-900 mb-2",children:"How can I help you today?"}),t.jsx("p",{className:"text-slate-600 max-w-md mb-8",children:"I'm your dedicated analytics assistant. Ask me about DAX patterns, report design, or HHS data standards."}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 max-w-2xl w-full",children:Ve.map(c=>t.jsxs("button",{onClick:()=>s(c.value),className:"p-4 bg-white border border-slate-200 rounded-xl hover:border-brand-300 hover:shadow-brand transition-all text-left group",children:[t.jsx("span",{className:"text-xs font-bold text-brand-600 uppercase tracking-wider mb-1 block group-hover:text-brand-700",children:c.label}),t.jsx("span",{className:"text-sm text-slate-700 group-hover:text-slate-900",children:c.value})]},c.label))})]});return Ke?Bs.createPortal(t.jsxs("div",{className:"fixed inset-0 z-[100] bg-white flex flex-col animate-fadeIn",children:[t.jsxs("div",{className:"bg-white/90 backdrop-blur-md border-b border-slate-200 px-4 py-3 flex flex-wrap items-center justify-between gap-3 sticky top-0 z-20",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(J,{className:"h-5 w-5 text-brand-600"}),t.jsx("h2",{className:"text-lg font-bold text-slate-900",children:"Power BI Guru"}),te&&t.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full font-medium ${te.className}`,children:te.text})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx("button",{onClick:dt,className:"p-2 hover:bg-slate-100 rounded-lg text-slate-500 transition-colors",title:"Clear Cache & Refresh",children:t.jsx(Gt,{className:"h-5 w-5"})}),t.jsxs("button",{onClick:a,"aria-pressed":n,"aria-label":n?"Show sidebar":"Hide sidebar",className:`hidden lg:flex p-2 rounded-lg text-sm font-medium items-center gap-2 border transition-colors ${n?"border-slate-200 text-slate-600 hover:bg-slate-100":"bg-emerald-50 text-emerald-700 border-emerald-100"}`,title:n?"Show sidebar":"Hide sidebar",children:[n?t.jsx($t,{className:"h-4 w-4"}):t.jsx(Lt,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden xl:inline",children:n?"Show sidebar":"Hide sidebar"})]}),t.jsxs("button",{onClick:xt,"aria-pressed":!k,"aria-label":k?"Show notes panel":"Hide notes panel",className:`p-2 rounded-lg text-sm font-medium flex items-center gap-2 border transition-colors ${k?"border-slate-200 text-slate-600 hover:bg-slate-100":"bg-brand-50 text-brand-700 border-brand-100"}`,children:[k?t.jsx(Ht,{className:"h-4 w-4"}):t.jsx(Pt,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:k?"Show notes":"Hide notes"})]}),t.jsx("button",{onClick:gt,className:"p-2 hover:bg-slate-200 rounded-lg transition-colors text-slate-600",title:"Exit Fullscreen",children:t.jsx(tn,{className:"h-5 w-5"})})]})]}),t.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:t.jsxs("div",{ref:B,className:"flex-1 flex flex-col gap-4 lg:flex-row lg:items-stretch px-4 pb-4 pt-2 overflow-hidden",children:[t.jsxs("div",{className:"flex-1 flex flex-col min-w-0 bg-white relative border border-slate-200 rounded-xl shadow-sm",children:[t.jsxs("div",{className:"px-4 py-2 border-b border-slate-100 bg-white flex items-center gap-2 overflow-x-auto shrink-0",children:[t.jsxs("div",{className:"flex items-center gap-2 text-xs font-semibold uppercase text-slate-500 whitespace-nowrap",children:[t.jsx(Kt,{className:"h-3 w-3 text-brand-500"}),"Quick prompts"]}),t.jsx("div",{className:"flex gap-2",children:Ve.map(s=>t.jsx("button",{onClick:()=>Be(s.value),className:"flex-shrink-0 px-3 py-1 text-xs bg-slate-100 text-slate-700 rounded-full hover:bg-brand-50 hover:text-brand-700 transition-colors whitespace-nowrap",children:s.label},s.label))}),t.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[t.jsx("button",{onClick:()=>it(!ee),className:`p-1.5 rounded transition-colors flex items-center gap-1 ${ee?"bg-brand-100 text-brand-700":"text-slate-400 hover:text-slate-600 hover:bg-slate-200"}`,title:"Text & Style Settings","aria-label":"Text style settings",children:t.jsx(Me,{className:"h-4 w-4"})}),t.jsx("button",{onClick:mt,className:"p-1.5 text-slate-400 hover:text-slate-600 hover:bg-slate-200 rounded transition-colors",title:"Export chat","aria-label":"Export chat",children:t.jsx(kt,{className:"h-4 w-4"})}),t.jsx("button",{onClick:ht,className:"p-1.5 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded transition-colors",title:"Clear chat","aria-label":"Clear chat",children:t.jsx(It,{className:"h-4 w-4"})})]})]}),t.jsx(ae,{children:ee&&t.jsx(U.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden border-b border-slate-200",children:t.jsxs("div",{className:"px-4 py-3 bg-gradient-to-br from-brand-50 to-slate-50",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(Me,{className:"h-4 w-4 text-brand-600"}),t.jsx("h3",{className:"font-semibold text-slate-900 text-sm",children:"Text & Style Settings"})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 max-w-3xl",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-2",children:"Font Size"}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(re).map(([s,c])=>t.jsxs("button",{onClick:()=>ot(s),className:`px-3 py-2 text-xs rounded-lg border transition-all ${Z===s?"bg-brand-600 text-white border-brand-600 shadow-md":"bg-white text-slate-700 border-slate-200 hover:border-brand-300 hover:bg-brand-50"}`,children:[t.jsx("div",{className:"font-semibold",children:c.label}),t.jsx("div",{className:"text-[10px] opacity-75",children:c.description})]},s))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-2",children:"Line Spacing"}),t.jsx("div",{className:"grid grid-cols-1 gap-2",children:Object.entries(Le).map(([s,c])=>t.jsx("button",{onClick:()=>rt(s),className:`px-3 py-2 text-xs rounded-lg border transition-all ${de===s?"bg-brand-600 text-white border-brand-600 shadow-md":"bg-white text-slate-700 border-slate-200 hover:border-brand-300 hover:bg-brand-50"}`,children:c.label},s))})]})]}),t.jsxs("p",{className:"text-xs text-slate-500 mt-3 flex items-center gap-1",children:[t.jsx(J,{className:"h-3 w-3"}),"Settings are saved automatically and persist across sessions"]})]})})}),t.jsxs("div",{ref:Ce,className:`flex-1 overflow-y-auto p-4 md:p-8 ${bt} relative`,children:[r.length<=1?t.jsx(Ts,{onPromptClick:Be}):r.map(s=>t.jsx(U.div,{id:`message-${s.id}`,initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex ${s.sender==="user"?"justify-end":"justify-start"}`,children:t.jsxs("div",{className:`max-w-[90%] md:max-w-[70%] rounded-2xl ${wt} group relative shadow-sm ${s.sender==="user"?"bg-brand-600 text-white rounded-br-none":s.isSystem?"bg-amber-50 text-amber-800 border border-amber-100":"bg-slate-100 text-slate-800 rounded-bl-none"} ${s.id===Se?"ring-2 ring-brand-200 shadow-brand-200/60":""}`,children:[t.jsx("button",{onClick:()=>Ue(s.text),className:`absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded ${s.sender==="user"?"text-brand-100 hover:text-white hover:bg-brand-500":"text-slate-400 hover:text-brand-600 hover:bg-slate-200"}`,title:"Copy message","aria-label":"Copy message",children:t.jsx(Te,{className:"h-3 w-3"})}),s.sender==="guru"&&!s.isSystem&&t.jsx("button",{onClick:()=>Fe(s.text),className:`absolute top-2 right-10 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded ${s.sender==="user"?"text-brand-100 hover:text-white hover:bg-brand-500":"text-slate-400 hover:text-brand-600 hover:bg-slate-200"}`,title:"Save to notes","aria-label":"Save to notes",children:t.jsx(qe,{className:"h-3 w-3"})}),t.jsxs("div",{className:`flex items-center justify-between mb-1 opacity-75 ${yt}`,children:[t.jsxs("div",{className:"flex items-center gap-2",children:[s.sender==="user"?t.jsx(_t,{className:"h-3 w-3"}):t.jsx(J,{className:"h-3 w-3"}),t.jsx("span",{className:"uppercase font-bold tracking-wider",children:s.sender})]}),ue(s)&&t.jsx("span",{className:"opacity-75",children:ue(s)})]}),t.jsx(vt,{text:s.text,shouldAnimate:s.id===Se&&s.sender==="guru"&&!s.isSystem,isUser:s.sender==="user"}),s.link&&t.jsx("div",{className:`mt-3 pt-3 border-t ${s.sender==="user"?"border-white/20":"border-black/10"}`,children:t.jsxs("a",{href:`#${s.link}`,className:`text-xs font-bold flex items-center gap-1 hover:underline ${s.sender==="user"?"text-white":"text-brand-600"}`,children:["View Resource ",t.jsx(Ot,{className:"h-3 w-3"})]})})]})},s.id)),t.jsx(ae,{children:ie&&t.jsx(U.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex justify-start",children:t.jsxs("div",{className:"bg-slate-100 rounded-2xl rounded-bl-none p-4 flex gap-1",children:[t.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce"}),t.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce delay-75"}),t.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce delay-150"})]})})}),t.jsx("div",{ref:Ee})]}),t.jsxs("div",{className:"p-4 bg-white border-t border-slate-200 shrink-0 shadow-up z-10",children:[t.jsxs("div",{className:"max-w-4xl mx-auto w-full flex gap-2",children:[t.jsx("textarea",{ref:je,value:l,onChange:s=>{h(s.target.value)},onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),_e())},placeholder:"Ask anything about Power BI... (Shift+Enter for new line)",className:"input-field flex-1 shadow-sm resize-none min-h-[48px] max-h-[200px] overflow-hidden",rows:1}),t.jsx("button",{onClick:_e,disabled:!l.trim()||ie,className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed px-6","aria-label":"Send message",children:t.jsx(Rt,{className:"h-5 w-5"})})]}),!f&&t.jsxs("p",{className:"text-xs text-slate-400 mt-2 text-center",children:["Running in ",t.jsx("span",{className:"font-semibold text-brand-600",children:"Local Knowledge Mode"}),". Add an Access Code for full AI features."]})]})]}),Nt&&t.jsxs("div",{className:"flex flex-col gap-4 lg:gap-0 lg:flex-row shrink-0 w-full lg:w-auto",children:[F&&t.jsx("div",{className:"hidden lg:flex items-center justify-center w-5 cursor-col-resize select-none text-slate-400 hover:bg-slate-100 hover:text-brand-500 transition-colors -ml-2.5 z-10 group",role:"separator","aria-label":"Resize session notes panel","aria-orientation":"vertical",tabIndex:0,onPointerDown:ft,onKeyDown:pt,title:"Drag to resize notes",children:t.jsx("div",{className:"flex flex-col items-center gap-1 bg-white/80 rounded-full px-1 py-3 shadow-sm border border-slate-200 group-hover:border-brand-300 group-hover:scale-110 transition-all",children:t.jsx(Mt,{className:"h-4 w-4"})})}),t.jsx("div",{className:"border border-slate-200 bg-slate-50 rounded-xl shadow-inner p-4 sm:p-5 flex flex-col w-full lg:w-auto transition-[width] duration-200 max-h-[300px] lg:max-h-none",style:Et,children:Ct})]})]})})]}),document.body):t.jsxs("div",{className:"flex flex-col gap-4 min-h-[calc(100vh-10rem)] sm:min-h-[calc(100vh-8rem)]",children:[t.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3 mb-2 sm:mb-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-xl sm:text-2xl font-bold text-slate-900 flex flex-wrap items-center gap-2",children:[t.jsx(J,{className:`h-5 w-5 sm:h-6 sm:w-6 text-brand-600 ${ie?"animate-pulse":""}`}),"Power BI Guru",te&&t.jsx("span",{className:`text-[10px] sm:text-xs px-2 py-0.5 rounded-full font-medium ${te.className}`,children:te.text})]}),t.jsx("p",{className:"text-sm sm:text-base text-slate-600 mt-1",children:"Your AI assistant for DAX, Design, and Strategy."}),f&&t.jsx("p",{className:"mt-1 text-xs text-slate-500",children:g?"Using your personal Gemini access code.":Ye?"Using the built-in HHS Gemini access code.":"Using the currently stored Gemini access code."}),!f&&Rs&&t.jsxs("p",{className:"mt-1 text-xs text-amber-600 flex items-center gap-1",children:[t.jsx(At,{className:"h-3 w-3"}),"Built-in cloud access is limited to approved internal domains. Add your own access code in settings to chat from this site."]}),ve==="error"&&f&&t.jsxs("p",{className:"mt-1 text-sm text-rose-600 flex items-center gap-1",children:[t.jsx(At,{className:"h-4 w-4"}),t.jsx("span",{children:gs||"Unable to connect to the AI. Update the access code in settings."})]})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx("button",{onClick:dt,className:"p-2.5 sm:p-2 rounded-lg text-slate-500 hover:text-brand-600 hover:bg-slate-100 transition-colors",title:"Clear Cache & Refresh App","aria-label":"Clear Cache & Refresh App",children:t.jsx(Gt,{className:"h-5 w-5 sm:h-4 sm:w-4"})}),F&&t.jsxs("button",{onClick:a,"aria-pressed":n,"aria-label":n?"Show sidebar":"Hide sidebar",className:"p-2.5 sm:p-2 rounded-lg text-sm font-medium flex items-center gap-2 border transition-colors border-slate-200 text-slate-600 hover:bg-slate-100",title:n?"Show sidebar":"Hide sidebar",children:[n?t.jsx($t,{className:"h-4 w-4"}):t.jsx(Lt,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden xl:inline",children:n?"Show sidebar":"Hide sidebar"})]}),t.jsxs("button",{onClick:xt,"aria-pressed":!k,"aria-label":k?"Show notes panel":"Hide notes panel",className:`p-2.5 sm:p-2 rounded-lg text-xs sm:text-sm font-medium flex items-center gap-1.5 sm:gap-2 border transition-colors ${k?"border-slate-200 text-slate-600 hover:bg-slate-100":"bg-brand-50 text-brand-700 border-brand-100"}`,children:[k?F?t.jsx(Ht,{className:"h-4 w-4"}):t.jsx(Dt,{className:"h-4 w-4"}):F?t.jsx(Pt,{className:"h-4 w-4"}):t.jsx(Tt,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:k?"Show notes":"Hide notes"})]}),t.jsx("button",{onClick:gt,className:"p-2.5 sm:p-2 rounded-lg bg-slate-100 text-slate-600 hover:bg-slate-200 transition-colors",title:"Maximize (Fullscreen Mode)","aria-label":"Maximize (Fullscreen Mode)",children:t.jsx(Js,{className:"h-5 w-5"})}),t.jsx("button",{onClick:()=>H(!C),className:`p-2.5 sm:p-2 rounded-lg transition-colors ${C?"bg-brand-50 text-brand-700":g?"bg-emerald-100 text-emerald-700":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,title:"Manage AI Access Code","aria-label":"Manage AI Access Code",children:t.jsx(dn,{className:"h-5 w-5"})})]})]}),t.jsx(ae,{children:C&&t.jsx(U.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden mb-4",children:t.jsxs("div",{className:"bg-slate-50 border border-slate-200 rounded-lg p-4",children:[t.jsxs("h3",{className:"font-semibold text-slate-900 mb-2 flex items-center gap-2",children:[t.jsx(Ks,{className:"h-4 w-4"})," AI Settings"]}),t.jsx("p",{className:"text-sm text-slate-600 mb-3",children:"Enter your access code to enable full AI chat capabilities."}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"password",value:P,onChange:s=>M(s.target.value),placeholder:"Enter Access Code...",className:"input-field flex-1"}),t.jsx("button",{onClick:js,className:"btn-primary",children:"Save & Connect"}),g&&t.jsx("button",{onClick:Ss,className:"btn-secondary text-red-600 hover:bg-red-50",children:"Clear"})]}),t.jsxs("div",{className:"text-xs text-slate-500 mt-3 space-y-1",children:[t.jsx("p",{children:g?"Currently using your personal Gemini key. Clear to switch back to the built-in HHS access code.":Ye?"Using the built-in HHS Gemini key by default. Add your own key if you need to run chats under a personal quota.":"No access code is configured yet. Add one to enable cloud AI responses."}),t.jsx("p",{className:"text-slate-400",children:"Any personal key you add stays in your browser only."})]})]})})}),t.jsxs("div",{ref:B,className:"flex-1 flex flex-col gap-4 lg:flex-row lg:items-stretch overflow-hidden",children:[t.jsxs("div",{className:"flex-1 bg-white border border-slate-200 rounded-xl shadow-sm overflow-hidden flex flex-col relative min-w-0 min-h-[420px]",children:[t.jsxs("div",{className:"bg-slate-50 border-b border-slate-200 px-3 sm:px-4 py-2 sm:py-3 flex flex-wrap items-center gap-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Zs,{className:"h-4 w-4 text-slate-500"}),t.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Conversation"}),t.jsxs("span",{className:"text-xs text-slate-500 bg-slate-200 px-2 py-0.5 rounded-full",children:[r.filter(s=>!s.isSystem).length," messages"]})]}),t.jsxs("div",{className:"flex gap-1.5 sm:gap-2 ml-auto",children:[t.jsx("button",{onClick:mt,className:"p-1.5 text-slate-400 hover:text-slate-600 hover:bg-slate-200 rounded transition-colors",title:"Export chat",children:t.jsx(kt,{className:"h-4 w-4"})}),t.jsx("button",{onClick:ht,className:"p-1.5 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded transition-colors",title:"Clear chat",children:t.jsx(It,{className:"h-4 w-4"})})]})]}),r.length>1&&t.jsxs("div",{className:"px-3 sm:px-4 py-2 sm:py-3 border-b border-slate-100 bg-white flex flex-wrap items-center gap-2",children:[t.jsxs("div",{className:"flex items-center gap-2 text-[10px] sm:text-xs font-semibold uppercase text-slate-500",children:[t.jsx(Kt,{className:"h-3 w-3 text-brand-500"}),t.jsx("span",{className:"hidden xs:inline",children:"Quick prompts"})]}),t.jsx("div",{className:"flex flex-wrap gap-1.5 sm:gap-2",children:Ve.map(s=>t.jsx("button",{onClick:()=>Be(s.value),className:"px-2.5 sm:px-3 py-1.5 sm:py-1 text-[11px] sm:text-xs bg-slate-100 text-slate-700 rounded-full hover:bg-brand-50 hover:text-brand-700 transition-colors whitespace-nowrap flex-shrink-0",children:s.label},s.label))}),t.jsxs("div",{className:"ml-auto flex items-center gap-1.5 sm:gap-2",children:[t.jsxs("button",{onClick:()=>it(!ee),className:`text-[11px] sm:text-xs px-2.5 sm:px-3 py-1.5 sm:py-1 rounded-full border flex items-center gap-1 sm:gap-1.5 ${ee?"bg-brand-600 text-white border-brand-600":"border-slate-200 text-slate-600 hover:bg-slate-100"}`,title:"Text & Style Settings","aria-label":"Text & Style Settings",children:[t.jsx(Me,{className:"h-3 w-3"}),t.jsx("span",{className:"hidden sm:inline",children:"Style"})]}),t.jsx("button",{onClick:ks,className:`text-[11px] sm:text-xs px-2.5 sm:px-3 py-1.5 sm:py-1 rounded-full border whitespace-nowrap ${le?"bg-brand-600 text-white border-brand-600":"border-slate-200 text-slate-600"}`,"aria-label":le?"Switch to normal mode":"Switch to compact mode",children:le?"Compact":"Normal"})]})]}),t.jsx(ae,{children:ee&&t.jsx(U.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden border-b border-slate-200",children:t.jsxs("div",{className:"px-3 sm:px-4 py-3 bg-gradient-to-br from-brand-50 to-slate-50",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(Me,{className:"h-4 w-4 text-brand-600"}),t.jsx("h3",{className:"font-semibold text-slate-900 text-sm",children:"Text & Style Settings"})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-2",children:"Font Size"}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(re).map(([s,c])=>t.jsxs("button",{onClick:()=>ot(s),className:`px-3 py-2 text-xs rounded-lg border transition-all ${Z===s?"bg-brand-600 text-white border-brand-600 shadow-md":"bg-white text-slate-700 border-slate-200 hover:border-brand-300 hover:bg-brand-50"}`,children:[t.jsx("div",{className:"font-semibold",children:c.label}),t.jsx("div",{className:"text-[10px] opacity-75",children:c.description})]},s))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-2",children:"Line Spacing"}),t.jsx("div",{className:"grid grid-cols-1 gap-2",children:Object.entries(Le).map(([s,c])=>t.jsx("button",{onClick:()=>rt(s),className:`px-3 py-2 text-xs rounded-lg border transition-all ${de===s?"bg-brand-600 text-white border-brand-600 shadow-md":"bg-white text-slate-700 border-slate-200 hover:border-brand-300 hover:bg-brand-50"}`,children:c.label},s))})]})]}),t.jsxs("p",{className:"text-xs text-slate-500 mt-3 flex items-center gap-1",children:[t.jsx(J,{className:"h-3 w-3"}),"Settings are saved automatically and persist across sessions"]})]})})}),V&&t.jsxs("div",{className:"px-3 sm:px-4 py-2 sm:py-3 border-b border-slate-100 bg-slate-50 flex flex-wrap items-center gap-3",children:[t.jsxs("div",{className:"flex-1 min-w-[240px]",children:[t.jsx("p",{className:"text-xs uppercase font-semibold text-slate-500 tracking-wide",children:"Current question"}),t.jsx("p",{className:"font-medium text-slate-900",children:Zn(V.text,160)})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("button",{onClick:()=>lt(V.id),className:"px-3 py-1.5 text-xs rounded-full bg-white border border-slate-200 hover:border-brand-300 hover:text-brand-600 transition-colors flex items-center gap-1",children:[t.jsx(Ys,{className:"h-3 w-3"})," Jump to question"]}),t.jsxs("button",{onClick:()=>Fe(V.text),className:"px-3 py-1.5 text-xs rounded-full bg-brand-50 text-brand-700 border border-brand-100 flex items-center gap-1",children:[t.jsx(qe,{className:"h-3 w-3"})," Save"]})]})]}),t.jsxs("div",{ref:Ce,className:`flex-1 overflow-y-auto p-3 sm:p-4 lg:p-5 ${bt} relative`,children:[r.map(s=>t.jsx(U.div,{id:`message-${s.id}`,initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex ${s.sender==="user"?"justify-end":"justify-start"}`,children:t.jsxs("div",{className:`max-w-[80%] rounded-2xl ${wt} group relative ${s.sender==="user"?"bg-brand-600 text-white rounded-br-none":s.isSystem?"bg-amber-50 text-amber-800 border border-amber-100":"bg-slate-100 text-slate-800 rounded-bl-none"} ${s.id===Se?"ring-2 ring-brand-200 shadow-lg shadow-brand-200/60":""}`,children:[t.jsx("button",{onClick:()=>Ue(s.text),className:`absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded ${s.sender==="user"?"text-brand-100 hover:text-white hover:bg-brand-500":"text-slate-400 hover:text-brand-600 hover:bg-slate-200"}`,title:"Copy message","aria-label":"Copy message",children:t.jsx(Te,{className:"h-4 w-4"})}),s.sender==="guru"&&!s.isSystem&&t.jsx("button",{onClick:()=>Fe(s.text),className:`absolute top-2 right-10 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded ${s.sender==="user"?"text-brand-100 hover:text-white hover:bg-brand-500":"text-slate-400 hover:text-brand-600 hover:bg-slate-200"}`,title:"Save to notes","aria-label":"Save to notes",children:t.jsx(qe,{className:"h-4 w-4"})}),t.jsxs("div",{className:`flex items-center justify-between mb-1 opacity-75 ${yt}`,children:[t.jsxs("div",{className:"flex items-center gap-2",children:[s.sender==="user"?t.jsx(_t,{className:"h-3 w-3"}):t.jsx(J,{className:"h-3 w-3"}),t.jsx("span",{className:"uppercase font-bold tracking-wider",children:s.sender})]}),ue(s)&&t.jsx("span",{className:`text-xs ${s.sender==="user"?"text-brand-100":"text-slate-400"}`,children:ue(s)})]}),t.jsx(vt,{text:s.text,shouldAnimate:s.id===Se&&s.sender==="guru"&&!s.isSystem}),s.link&&t.jsx("div",{className:`mt-3 pt-3 border-t ${s.sender==="user"?"border-white/20":"border-black/10"}`,children:t.jsxs("a",{href:`#${s.link}`,className:`text-xs font-bold flex items-center gap-1 hover:underline ${s.sender==="user"?"text-white":"text-brand-600"}`,children:["View Resource ",t.jsx(Ot,{className:"h-3 w-3"})]})})]})},s.id)),t.jsx(ae,{children:ie&&t.jsx(U.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex justify-start",children:t.jsxs("div",{className:"bg-slate-100 rounded-2xl rounded-bl-none p-4 flex gap-1",children:[t.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce"}),t.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce delay-75"}),t.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce delay-150"})]})})}),t.jsx("div",{ref:Ee})]}),t.jsx(ae,{children:!bs&&t.jsx(U.button,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},onClick:ct,className:"absolute bottom-24 right-4 bg-brand-600 text-white p-2 rounded-full shadow-lg hover:bg-brand-700 transition-colors z-10",title:"Scroll to bottom",children:t.jsx(Tt,{className:"h-4 w-4"})})}),t.jsx(U.button,{initial:{opacity:0,scale:.8},animate:{opacity:.5,scale:1},whileHover:{opacity:1,scale:1.1},onClick:Es,className:"absolute bottom-36 right-4 bg-slate-100 text-slate-600 border border-slate-200 p-2 rounded-full shadow-md hover:bg-white hover:text-brand-600 transition-all z-10",title:"Scroll to top",children:t.jsx(Us,{className:"h-4 w-4"})}),t.jsxs("div",{className:"p-3 sm:p-4 bg-white border-t border-slate-200 shadow-up z-10",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx("textarea",{ref:je,value:l,onChange:s=>h(s.target.value),onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),_e())},placeholder:"Ask anything about Power BI...",className:"input-field flex-1 shadow-sm resize-none min-h-[48px] sm:min-h-[44px] max-h-[200px] text-base sm:text-sm",rows:1}),t.jsx("button",{onClick:_e,disabled:!l.trim()||ie,className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed min-w-[48px] sm:min-w-[44px]","aria-label":"Send message",children:t.jsx(Rt,{className:"h-5 w-5 sm:h-4 sm:w-4"})})]}),t.jsxs("p",{className:"text-[10px] sm:text-xs text-slate-400 mt-2 text-center flex flex-wrap items-center justify-center gap-x-2 gap-y-1",children:[t.jsx("span",{className:"hidden sm:inline",children:"Enter = Send"}),t.jsx("span",{className:"hidden sm:inline",children:"Shift+Enter = New line"}),t.jsx("span",{className:"sm:hidden",children:"Tap Send or press Enter"}),t.jsx("span",{className:"hidden md:inline",children:"Copy buttons appear when you hover a message"})]}),!f&&t.jsxs("p",{className:"text-xs text-slate-400 mt-2 text-center",children:["Running in ",t.jsx("span",{className:"font-semibold text-brand-600",children:"Local Knowledge Mode"}),". Add an Access Code for full AI features."]})]})]}),Nt&&t.jsxs("div",{className:"flex flex-col gap-4 lg:gap-0 lg:flex-row shrink-0 w-full lg:w-auto",children:[F&&t.jsx("div",{className:"hidden lg:flex items-center justify-center w-5 cursor-col-resize select-none text-slate-400 hover:bg-slate-100 hover:text-brand-500 transition-colors -ml-2.5 z-10 group",role:"separator","aria-label":"Resize session notes panel","aria-orientation":"vertical",tabIndex:0,onPointerDown:ft,onKeyDown:pt,title:"Drag to resize notes",children:t.jsx("div",{className:"flex flex-col items-center gap-1 bg-white/80 rounded-full px-1 py-3 shadow-sm border border-slate-200 group-hover:border-brand-300 group-hover:scale-110 transition-all",children:t.jsx(Mt,{className:"h-4 w-4"})})}),t.jsx("aside",{className:"bg-white border border-slate-200 rounded-xl shadow-sm p-4 sm:p-5 flex flex-col w-full lg:w-auto min-h-[260px] max-h-[300px] lg:max-h-none transition-[width] duration-200",style:Et,children:Ct})]})]})]})};export{da as default};
